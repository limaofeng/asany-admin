(self.webpackChunkasany_admin=self.webpackChunkasany_admin||[]).push([[2847],{80590:function(q,R,e){"use strict";e.d(R,{Z:function(){return P}});var n=e(2824),t=e(67294),w=e(96486),C=e(94184),_=e.n(C),Q=e(65814),h=e(85893),V=260,d=768;function D(s){var o=s.minWidth,m=o===void 0?V:o,c=s.maxWidth,g=c===void 0?d:c,j=s.collapsible,l=j===void 0?!0:j,U=s.children,Z=s.className,A=s.onWidthChange,a=(0,t.useRef)({minimized:!1,width:s.width}),X=(0,t.useReducer)(function(O){return O+1},0),E=(0,n.Z)(X,2),H=E[1],N=(0,t.useMemo)(function(){return(0,w.debounce)(function(){H()},10)},[]),T=(0,t.useCallback)(function(O){return l&&m-O>m/2||O<=30},[l,m]),Y=(0,t.useCallback)(function(){a.current.minimized&&a.current.width>0&&(a.current.width=0)},[]),G=(0,t.useCallback)(function(O){a.current.width+=O,T(a.current.width)?a.current.minimized=!0:a.current.minimized=!1,N()},[N,T]),J=(0,t.useCallback)(function(){a.current.width=T(a.current.width)?0:Math.min(g,Math.max(m,a.current.width))},[T,g,m]),z=(0,t.useCallback)(function(){a.current.minimized=!a.current.minimized,a.current.width||(a.current.width=m),N()},[N,m]),S=a.current,x=S.minimized,L=S.width,B=(0,t.useMemo)(function(){return Math.min(g,Math.max(m,L))},[g,m,L]);return(0,t.useEffect)(function(){A&&A(x?0:B)},[A,x,B]),(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("div",{className:"secondary_sidebar-resizer__mirror",style:{width:x?void 0:B}}),(0,h.jsxs)(Q.w_,{className:_()("secondary_sidebar-resizer d-flex flex-column flex-lg-row",Z,{"secondary_sidebar-resizer-minimized":x}),style:{width:x?void 0:B},onResizeStart:Y,onResize:G,onResizeEnd:J,children:[l&&(0,h.jsxs)("button",{onClick:z,className:_()("secondary_sidebar-resize-button",{collapsed:x,expanded:!x}),type:"button",children:[(0,h.jsx)("div",{className:"invisible-area"}),(0,h.jsx)("span",{className:"homemade-button",role:"presentation",children:(0,h.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",focusable:"false",role:"presentation",children:(0,h.jsx)("path",{d:"M10.294 9.698a.988.988 0 0 1 0-1.407 1.01 1.01 0 0 1 1.419 0l2.965 2.94a1.09 1.09 0 0 1 0 1.548l-2.955 2.93a1.01 1.01 0 0 1-1.42 0 .988.988 0 0 1 0-1.407l2.318-2.297-2.327-2.307z",fill:"currentColor",fillRule:"evenodd"})})})]}),(0,h.jsx)("div",{className:"secondary_sidebar-inner flex-column flex-lg-row-auto w-100 mb-10 mb-lg-0",children:U})]})]})}var P=D},64043:function(q,R,e){"use strict";e.d(R,{ZO:function(){return n.ZO},Yw:function(){return n.Yw},KX:function(){return n.KX},I1:function(){return n.I1},Pw:function(){return n.Pw},aA:function(){return n.aA},Af:function(){return n.Af},G$:function(){return n.G$},_c:function(){return n._c},c9:function(){return n.c9},P6:function(){return n.P6},jS:function(){return n.jS},oM:function(){return n.oM},WF:function(){return n.WF},ot:function(){return n.ot},au:function(){return n.au},Nq:function(){return n.Nq},wp:function(){return n.wp},w4:function(){return n.w4},ko:function(){return n.ko},AQ:function(){return n.AQ}});var n=e(23798)},82847:function(q,R,e){"use strict";e.r(R);var n=e(2824),t=e(67294),w=e(28865),C=e(1861),_=e(51615),Q=e(73727),h=e(94184),V=e.n(h),d=e(4277),D=e(80590),P=e(74200),s=e(64043),o=e(85893);function m(c){var g=c.location,j=c.history,l=c.children,U=g.state,Z=U.module,A=U.baseUrl,a=A===void 0?"":A,X=(0,t.useState)(!1),E=(0,n.Z)(X,2),H=E[0],N=E[1],T=(0,s.wp)({variables:{module:Z.id},fetchPolicy:"cache-and-network"}),Y=T.data,G=T.loading,J=Y||{},z=J.models,S=z===void 0?[]:z,x=(0,t.useCallback)(function(){N(!0)},[]),L=(0,t.useCallback)(function(){N(!1)},[]),B=(0,t.useCallback)(function(M){L(),j.push("".concat(a,"/schema/models/").concat(M.id))},[a,L,j]),O=(0,t.useCallback)(function(M){return function(){j.push("".concat(a,"/schema/models/").concat(M.id))}},[a,j]),k=(0,t.useMemo)(function(){var M=(0,_.LX)(g.pathname,{path:"".concat(a,"/schema/models/:mid"),exact:!0,strict:!0});return M?"model_"+M.params.mid:(M=(0,_.LX)(g.pathname,{path:"".concat(a,"/schema/models"),exact:!0,strict:!0}),M?"model_overview":"")},[a,g.pathname]);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(D.Z,{className:"module_secondary_sidebar",width:260,children:(0,o.jsxs)("div",{className:"h-100",children:[(0,o.jsx)("div",{className:"mx-2 p-5 mt-5",children:(0,o.jsx)("h3",{className:"fw-bold text-dark mx-0 mb-0",children:"\u7ED3\u6784\u5B9A\u4E49"})}),(0,o.jsx)(C.E,{className:"d-flex h-100 flex-column custom-scrollbar",options:{scrollbars:{autoHide:"scroll"}},children:(0,o.jsxs)(P.v2,{className:"px-7 menu-state-bg menu-title-gray-600 menu-icon-gray-400 menu-state-primary menu-state-icon-primary menu-state-bullet-primary menu-arrow-gray-500 fw-bold fs-6 my-5 my-lg-0",selectedKeys:k?[k]:[],accordion:!1,selectable:"AllMenu",fit:!0,children:[(0,o.jsxs)(P.v2.Section,{className:"menu-section-container",sectionClassName:"d-flex align-items-center",children:[(0,o.jsxs)("span",{className:"menu-section text-muted text-uppercase fs-8 ls-1 flex-row-fluid",children:[(0,o.jsx)(Q.Link,{to:"".concat(a,"/schema/models"),className:V()("menu-section__link cursor-pointer text-muted",{checked:k=="model_overview"}),children:"\u5B9E\u4F53"}),G&&" - \u52A0\u8F7D\u4E2D..."]}),(0,o.jsx)(P.zx,{icon:(0,o.jsx)(w.JO,{style:{marginRight:".2rem"},name:"Duotune/arr087",className:""}),size:"sm",variant:"white",activeColor:"light",className:"px-3 me-n4",onClick:x,children:"\u65B0\u589E"})]}),S.map(function(M){return(0,o.jsx)(P.v2.Item,{onClick:O(M),children:M.name},"model_".concat(M.id))})]})})]})}),(0,o.jsx)(d.Z,{module:Z,onSuccess:B,visible:H,onClose:L}),l]})}R.default=m},4277:function(q,R,e){"use strict";var n=e(11849),t=e(39428),w=e(3182),C=e(2824),_=e(67294),Q=e(94184),h=e.n(Q),V=e(5926),d=e(74200),D=e(64043),P=e(40446),s=e(85893);function o(m){var c=m.module,g=m.visible,j=m.onClose,l=m.data,U=m.onSuccess,Z=(0,_.useState)("settings"),A=(0,C.Z)(Z,2),a=A[0],X=A[1],E=d.l0.useForm(),H=(0,D.oM)(),N=(0,C.Z)(H,1),T=N[0],Y=(0,D.oM)(),G=(0,C.Z)(Y,1),J=G[0],z=(0,D.oM)(),S=(0,C.Z)(z,1),x=S[0],L=(0,D.Pw)({refetchQueries:[{query:D.Yw,variables:{module:c.id}}]}),B=(0,C.Z)(L,2),O=B[0],k=B[1].loading,M=(0,D.ko)({refetchQueries:[{query:D.Yw,variables:{module:c.id}},{query:D.ZO,variables:{id:l==null?void 0:l.id}}]}),ae=(0,C.Z)(M,2),ne=ae[0],re=ae[1].loading,se=(0,_.useMemo)(function(){return k||re},[k,re]),K=(0,_.useMemo)(function(){return(c.code||"").split(".").map(function(i){return i.charAt(0).toUpperCase()+i.substring(1)}).join("")},[c]),$=(0,_.useMemo)(function(){return(c.code||"").replaceAll(".","_").toUpperCase()+"_"},[c]),de=(0,P.RO)(function(){var i=(0,w.Z)((0,t.Z)().mark(function u(I,v,F){var f,y;return(0,t.Z)().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(!(l&&v==l.name)){b.next=2;break}return b.abrupt("return",!0);case 2:return b.next=4,T({variables:{moduleId:c.id,filter:{name:v}},fetchPolicy:"network-only",context:{fetchOptions:{signal:F}}});case 4:return f=b.sent,y=f.data,b.abrupt("return",!(y!=null&&y.models.length));case 7:case"end":return b.stop()}},u)}));return function(u,I,v){return i.apply(this,arguments)}}()),oe=(0,P.RO)(function(){var i=(0,w.Z)((0,t.Z)().mark(function u(I,v,F){var f,y,p;return(0,t.Z)().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(v){r.next=2;break}return r.abrupt("return",!0);case 2:if(f=K+v.charAt(0).toUpperCase()+v.substring(1),!(l&&f==l.code)){r.next=5;break}return r.abrupt("return",!0);case 5:return r.next=7,J({variables:{moduleId:c.id,filter:{code:f}},fetchPolicy:"network-only",context:{fetchOptions:{signal:F}}});case 7:return y=r.sent,p=y.data,r.abrupt("return",!(p!=null&&p.models.length));case 10:case"end":return r.stop()}},u)}));return function(u,I,v){return i.apply(this,arguments)}}()),ce=(0,P.RO)(function(){var i=(0,w.Z)((0,t.Z)().mark(function u(I,v,F){var f,y,p,b;return(0,t.Z)().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:if(y=$+(v||"").toUpperCase(),!(l&&y==((f=l.metadata)===null||f===void 0?void 0:f.databaseTableName))){W.next=3;break}return W.abrupt("return",!0);case 3:return W.next=5,x({variables:{moduleId:c.id,filter:{databaseTableName:y}},fetchPolicy:"network-only",context:{fetchOptions:{signal:F}}});case 5:return p=W.sent,b=p.data,W.abrupt("return",!(b!=null&&b.models.length));case 8:case"end":return W.stop()}},u)}));return function(u,I,v){return i.apply(this,arguments)}}()),te=(0,_.useCallback)(function(i){return function(){X(i)}},[]),me=(0,_.useCallback)((0,w.Z)((0,t.Z)().mark(function i(){var u,I,v,F,f,y,p;return(0,t.Z)().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,E.validateFields();case 2:if(u=r.sent,I=$+(u.databaseTableName||u.code).toUpperCase(),v=K+u.code.charAt(0).toUpperCase()+u.code.substring(1),r.prev=5,l){r.next=15;break}return r.next=9,O({variables:{input:(0,n.Z)((0,n.Z)({},u),{},{databaseTableName:I,code:v,features:["master","system-fields"],module:c.id})}});case 9:F=r.sent,f=F.data,d.FN.success("\u5B9E\u4F53 \u201C".concat(u.name,"\u201D \u65B0\u589E\u6210\u529F"),2e3,{placement:"bottom-end",progressBar:!0}),U(f==null?void 0:f.createModel),r.next=21;break;case 15:return r.next=17,ne({variables:{id:l.id,input:(0,n.Z)((0,n.Z)({},u),{},{databaseTableName:I,code:v,features:["master","system-fields"]})}});case 17:y=r.sent,p=y.data,d.FN.success("\u5B9E\u4F53 \u201C".concat(u.name,"\u201D \u66F4\u65B0\u6210\u529F"),2e3,{placement:"bottom-end",progressBar:!0}),U(p==null?void 0:p.updateModel);case 21:r.next=26;break;case 23:r.prev=23,r.t0=r.catch(5),d.FN.error(r.t0.message,2e3,{placement:"bottom-end",progressBar:!0});case 26:case"end":return r.stop()}},i,null,[[5,23]])})),[K,O,l,E,c.id,U,$,ne]),_e=(0,_.useState)(!0),le=(0,C.Z)(_e,2),ue=le[0],he=le[1],ve=(0,_.useState)(!0),ie=(0,C.Z)(ve,2),ee=ie[0],fe=ie[1],be=(0,_.useCallback)(function(i){if(Object.hasOwn(i,"code")&&he(!1),Object.hasOwn(i,"databaseTableName")&&fe(!1),Object.hasOwn(i,"name")&&ue){var u=(0,V.N9)(i.name,{toneType:"none",type:"array"}).join("");E.setFieldValue("code",u),ee&&E.setFieldValue("databaseTableName",u.toUpperCase())}Object.hasOwn(i,"code")&&ee&&E.setFieldValue("databaseTableName",i.code.toUpperCase())},[ue,ee,E]);return(0,_.useEffect)(function(){if(l){var i,u;E.setFieldsValue((0,n.Z)((0,n.Z)({},l),{},{code:l.code.substring(K.length),databaseTableName:(i=l.metadata)===null||i===void 0||(u=i.databaseTableName)===null||u===void 0?void 0:u.substring($.length)}))}},[K,l,E,$.length]),(0,s.jsxs)(d.u_,{confirmLoading:se,maskClosable:!se,width:592,centered:!0,visible:g,closable:!1,onCancel:j,onOk:me,children:[(0,s.jsx)(d.u_.Header,{children:(0,s.jsx)("h4",{children:l?"\u7F16\u8F91\u5B9E\u4F53":"\u65B0\u589E\u5B9E\u4F53"})}),(0,s.jsx)(d.u_.Body,{children:(0,s.jsxs)(d.l0,{form:E,onValuesChange:l?void 0:be,children:[(0,s.jsxs)("div",{className:"mb-5",children:[(0,s.jsx)(d.zx,{color:a!="settings"&&"gray-700",variant:a=="settings"?"light-primary":!1,activeColor:a=="settings"?"light-primary":"secondary",className:"me-4 px-5",onClick:te("settings"),children:"\u8BBE\u7F6E"}),(0,s.jsx)(d.zx,{color:a!="advanced"&&"gray-700",variant:a=="advanced"?"light-primary":!1,activeColor:a=="advanced"?"light-primary":"secondary",className:"me-4 px-5",onClick:te("advanced"),children:"\u9AD8\u7EA7"})]}),(0,s.jsxs)("div",{className:h()("modal-tabpane",{"d-none":a!="settings"}),children:[(0,s.jsx)(d.l0.Item,{required:!1,className:"mb-5",name:"name",hasFeedback:!0,label:"\u663E\u793A\u540D\u79F0",help:"\u914D\u7F6E\u5B9E\u4F53\u65F6\u663E\u793A\u7684\u540D\u79F0, \u901A\u5E38\u4E3A\u4E2D\u6587",rules:[{required:!0,message:"\u663E\u793A\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A"},{validator:de,message:"\u540D\u79F0\u91CD\u590D"}],children:(0,s.jsx)(d.II,{solid:!0,boxClassName:"w-75"})}),(0,s.jsx)(d.l0.Item,{required:!1,className:"my-5",name:"code",label:"\u7F16\u7801",hasFeedback:!0,help:"\u7528\u4E8E\u901A\u8FC7 API \u8BBF\u95EE\u6B64\u5B9E\u4F53\u7684 ID, \u4E0D\u80FD\u4E3A\u4E2D\u6587",rules:[{required:!0,message:"\u7F16\u7801\u4E0D\u80FD\u4E3A\u7A7A"},{pattern:/^([a-z])([a-z1-9])*(_([a-z1-9]+))*/i,message:"\u8BF7\u9075\u5FAA Java \u547D\u540D\u89C4\u8303"},{validator:oe,message:"\u7F16\u7801\u91CD\u590D"}],children:(0,s.jsx)(d.II,{addonBefore:K,style:{textTransform:"capitalize"},solid:!0,boxClassName:"w-75"})}),(0,s.jsx)(d.l0.Item,{className:"mt-5",name:"description",label:"\u63CF\u8FF0",help:"\u4E3A\u5185\u5BB9\u7F16\u8F91\u8005\u548C API \u7528\u6237\u663E\u793A\u63D0\u793A",requiredMark:"optional",children:(0,s.jsx)(d.II.TextArea,{className:"w-75",solid:!0,autoSize:{maxRows:4,minRows:2}})})]}),(0,s.jsx)("div",{className:h()("modal-tabpane",{"d-none":a!="advanced"}),children:(0,s.jsx)(d.l0.Item,{className:"mb-5",name:"databaseTableName",label:"\u8868\u540D",hasFeedback:!0,help:"\u6620\u5C04\u5230\u6570\u636E\u5E93\u4E2D\u7684\u8868\u540D",rules:[{pattern:/(^_([A-Z0-9]_?)*$)|(^[A-Z](_?[A-Z0-9])*_?$)/i,message:"\u8BF7\u9075\u5FAA\u6570\u636E\u5E93\u547D\u540D\u89C4\u8303"},{validator:ce,message:"\u6570\u636E\u5E93\u8868\u540D\u91CD\u590D"}],children:(0,s.jsx)(d.II,{solid:!0,addonBefore:$,boxClassName:"w-75",className:"text-uppercase"})})})]})})]})}R.Z=o}}]);

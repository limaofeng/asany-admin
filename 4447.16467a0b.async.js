(self.webpackChunkasany_admin=self.webpackChunkasany_admin||[]).push([[4447],{14447:function(ge,B,t){"use strict";t.r(B);var Pe=t(3515),q=t(86288),ee=t(93224),ae=t(3182),v=t(11849),P=t(2824),te=t(94043),L=t.n(te),r=t(67294),le=t(94184),ne=t.n(le),se=t(30381),f=t.n(se),re=t(89887),b=t(33043),K=t(8845),ie=t(75468),o=t(53704),I=t(25496),l=t(85893);function ue(W){var F=W.match.params,de=F.cid,M=F.id,$=W.location.state,i=$.categories,_e=$.baseUrl,Z=(0,r.useRef)(null),u=(0,r.useRef)({publishedAt:f()()}),oe=(0,r.useReducer)(function(e){return e+1},0),ce=(0,P.Z)(oe,2),S=ce[1],d=o.l0.useForm(),k=(0,K.V7)({fetchPolicy:"cache-and-network",variables:{id:M}}),O=k.data,me=k.loading,a=O==null?void 0:O.article,ve=(0,r.useMemo)(function(){return!i||!i.length?[]:(0,I.G_)(i.map(function(e){return(0,v.Z)((0,v.Z)({},e),{},{value:e.id,title:e.name})}),{idKey:"id",childrenKey:"children",pidKey:"parent.id",sort:function(n,s){return n.index-s.index}})},[i]),he=(0,K.Mq)(),H=(0,P.Z)(he,2),N=H[0],C=H[1].loading,fe=(0,r.useState)(),Q=(0,P.Z)(fe,2),Ee=Q[0],V=Q[1],be=(0,r.useCallback)(function(e){var n,s=i.find(function(_){return _.id==e});V(s==null||(n=s.storeTemplate)===null||n===void 0?void 0:n.id)},[i]);(0,r.useEffect)(function(){var e,n;!i||!i.length||!a||V((e=i.find(function(s){var _;return s.id==((_=a.category)===null||_===void 0?void 0:_.id)}))===null||e===void 0||(n=e.storeTemplate)===null||n===void 0?void 0:n.id)},[a,i]);var p=(0,r.useCallback)(function(){var e=(0,ae.Z)(L().mark(function n(s){var _,h,A,G,z,x,T,w,R,D,U,E,y,j,g,c,J,X;return L().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return u.current.action=s,m.next=3,(_=Z.current)===null||_===void 0?void 0:_.uploadAll();case 3:return m.next=5,d.validateFields();case 5:for(h=m.sent,A=h.meta,G=h.category,z=h.body,x=h.publishedAt,T=(0,ee.Z)(h,["meta","category","body","publishedAt"]),w={seo_title:"single_line_text_field",seo_description:"multi_line_text_field",seo_keywords:"list.single_line_text_field"},R=[],D=0,U=Object.keys(A);D<U.length;D++)for(E=U[D],y=0,j=Object.keys(A[E]);y<j.length;y++)g=j[y],R.push({namespace:E,key:g,value:A[E][g],type:w[E+"_"+g]});return c=(0,v.Z)((0,v.Z)({},T),{},{metafields:R,category:G.id,body:{type:"HTML",text:z.text}}),s=="publish"?c.status="PUBLISHED":s=="schedule"||s=="reschedule"?(c.status="SCHEDULED",c.publishedAt=x):s=="unpublish"||s=="revert_to_draft"?c.status="DRAFT":s=="update"&&(c.status=a==null?void 0:a.status,c.publishedAt=x),J=N({variables:{id:M,input:c}}),m.next=19,o.FN.promise((0,I.gw)(J,350),{pending:"\u63D0\u4EA4\u4E2D...",success:"\u201C".concat(T.title,"\u201D \u4FDD\u5B58\u6210\u529F"),error:"\u63D0\u4EA4\u51FA\u9519"},{duration:2e3,placement:"top-center"});case 19:X=m.sent,console.log("submit result set",X);case 21:case"end":return m.stop()}},n)}));return function(n){return e.apply(this,arguments)}}(),[d,N,M,a==null?void 0:a.status]),Y=u.current.publishedAt,pe=(0,r.useCallback)(function(e){u.current.publishedAt=e,d.setFieldsValue({publishedAt:e}),S()},[d]);(0,r.useEffect)(function(){var e;!a||(a.publishedAt&&(u.current.publishedAt=f()(a.publishedAt)),u.current.article=a,d.setFieldsValue((0,v.Z)((0,v.Z)({},a),{},{publishedAt:u.current.publishedAt,image:(e=a.image)===null||e===void 0?void 0:e.id})))},[a,d]);var Ae=(0,r.useCallback)(function(){p("update")},[p]),De=(0,r.useCallback)(function(e){p(e)},[p]),ye=(0,r.useCallback)(function(){var e=u.current.article,n=e!=null&&e.publishedAt?f()(e.publishedAt):f()();u.current.publishedAt=n,S(),d.setFieldsValue({publishedAt:n})},[d]);return console.log("storeTemplate",Ee,Y),(0,l.jsx)(ie.v,{loading:me,header:{title:"\u7F16\u8F91\u6587\u7AE0"},children:(0,l.jsxs)(o.l0,{form:d,initialValues:{status:"DRAFT",channel:de},className:"form d-flex flex-column flex-lg-row",children:[(0,l.jsxs)("div",{className:"d-flex flex-column flex-row-fluid gap-7 gap-lg-10  me-lg-10",children:[(0,l.jsxs)(o.mQ,{defaultActiveKey:"general",renderContainer:!1,className:"border-0 fs-4 fw-bold mb-n2 nav-line-tabs-2x",children:[(0,l.jsx)(o.mQ.TabPane,{tab:"\u57FA\u672C\u4FE1\u606F",forceRender:!0,children:(0,l.jsx)(b.LQ,{queueUpload:Z})},"general"),(0,l.jsx)(o.mQ.TabPane,{tab:"\u9AD8\u7EA7\u8BBE\u7F6E",forceRender:!0,children:(0,l.jsx)(b.aE,{})},"advanced"),(0,l.jsx)(o.mQ.TabPane,{tab:"\u5143\u6570\u636E",forceRender:!0,children:(0,l.jsx)(b.SF,{})},"meta")]}),(0,l.jsx)(q.Z,{offsetBottom:16,children:(0,l.jsxs)("div",{className:ne()("d-flex bg-body-color p-5 mx-4 tw-rounded-2xl align-items-center"),children:[(0,l.jsx)("div",{className:"text-primary flex-row-fluid",children:(a==null?void 0:a.status)=="SCHEDULED"&&(0,l.jsxs)(l.Fragment,{children:["\u5C06\u4E8E ",f()(a.publishedAt).format("YYYY \u5E74 MM \u6708 DD \u65E5 HH:mm")," \u53D1\u5E03"]})}),(a==null?void 0:a.status)=="DRAFT"&&(0,l.jsx)(o.zx,{variant:"light",loading:u.current.action=="update"&&C,onClick:Ae,className:"me-5",children:u.current.action=="update"&&C?"\u4FDD\u5B58\u4E2D...":"\u4FDD\u5B58\u8349\u7A3F"}),(0,l.jsx)(b.H5,{article:a,onPublish:De,publishedAt:Y,submitting:C,setPublishedAt:pe,onCancel:ye})]})})]}),(0,l.jsx)(re.Z,{baseUrl:_e,article:a,categoryTreeData:ve,onChangeCategory:be})]})})}B.default=ue}}]);

"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[4034],{66012:function($e,N,e){e.r(N);var se=e(52677),le=e.n(se),ue=e(64599),ie=e.n(ue),de=e(13769),oe=e.n(de),me=e(15009),M=e.n(me),ce=e(99289),w=e.n(ce),ve=e(97857),f=e.n(ve),pe=e(5574),I=e.n(pe),r=e(62435),K=e(96974),be=e(93967),Ee=e.n(be),he=e(30381),y=e.n(he),fe=e(73588),i=e(79817),ye=e(75981),V=e(12708),De=e(70005),Pe=e(25136),T=e(80596),Y=e(42755),ke=e(34545),n=e(86074),Ae=["meta","category","publishedAt","content"];function Oe(){var L,G=(0,K.UO)(),g=G.cid,C=G.id,Q=(0,K.bx)(),d=Q.categories,Z=Q.baseUrl,Me=(0,K.s0)(),z=(0,r.useRef)(null),o=(0,r.useRef)({publishedAt:y()()}),Te=(0,r.useReducer)(function(_){return _+1},0),ge=I()(Te,2),J=ge[1],m=i.Form.useForm(),X=(0,Y.V7)({fetchPolicy:"network-only",variables:{id:C}}),W=X.data,Ce=X.loading,a=W==null?void 0:W.article,je=(0,r.useMemo)(function(){return!d||!d.length?[]:(0,V.G_)(d.map(function(_){return f()(f()({},_),{},{value:_.id,title:_.name})}),{idKey:"id",childrenKey:"children",pidKey:"parent.id",sort:function(c,u){return c.index-u.index}})},[d]),Re=(0,Y.Mq)(),q=I()(Re,2),ee=q[0],F=q[1].loading,Ue=(0,r.useState)(),ae=I()(Ue,2),s=ae[0],xe=ae[1],Be=(0,r.useCallback)(function(){var _=w()(M()().mark(function c(u){var E,v,l,D;return M()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(l=d.find(function(P){return P.id===u}),(l==null||(E=l.storeTemplate)===null||E===void 0?void 0:E.contentType)===(s==null||(v=s.storeTemplate)===null||v===void 0?void 0:v.contentType)){t.next=8;break}return t.next=4,i.Modal.confirm({title:"\u4FEE\u6539\u680F\u76EE\u786E\u8BA4",content:"\u76EE\u6807\u680F\u76EE\u7684\u6B63\u6587\u7C7B\u578B\u4E0D\u4E00\u81F4\uFF0C\u662F\u5426\u786E\u5B9A\u5207\u6362 \uFF1F"});case 4:if(D=t.sent,D.isConfirmed){t.next=8;break}return m.setFieldValue(["category","id"],s==null?void 0:s.id),t.abrupt("return");case 8:Me("".concat(Z,"/categories/").concat(l==null?void 0:l.id,"/articles/").concat(C),{replace:!0});case 9:case"end":return t.stop()}},c)}));return function(c){return _.apply(this,arguments)}}(),[d,s]);(0,r.useEffect)(function(){!d||!d.length||!g||xe(d.find(function(_){return _.id===g}))},[d,g]);var S=s==null||(L=s.storeTemplate)===null||L===void 0?void 0:L.contentType,j=(0,r.useCallback)(function(){var _=w()(M()().mark(function c(u){var E,v,l,D,R,t,P,_e,$,U,k,A,x,H,B,O,te,h,p,ne,re;return M()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return o.current.action=u,b.next=3,(E=z.current)===null||E===void 0?void 0:E.uploadAll();case 3:return b.next=5,m.validateFields();case 5:for(v=b.sent,l=v.meta,D=v.category,R=v.publishedAt,t=v.content,P=oe()(v,Ae),_e={seo_title:"single_line_text_field",seo_description:"multi_line_text_field",seo_keywords:"list.single_line_text_field"},$=[],U=0,k=Object.keys(l);U<k.length;U++)for(A=k[U],x=0,H=Object.keys(l[A]);x<H.length;x++)B=H[x],$.push({namespace:A,key:B,value:l[A][B],type:_e[A+"_"+B]});if(t.hasOwnProperty("__typename")&&delete t.__typename,t.hasOwnProperty("documentType")&&(!t.type&&t.documentType&&(t.type=t.documentType),delete t.documentType),t.hasOwnProperty("textType")&&(!t.type&&t.textType&&(t.type=t.textType),delete t.textType),S===ye.zc.Image){O=ie()(t.images);try{for(O.s();!(te=O.n()).done;)h=te.value,delete h.__typename,delete h.id,h.image&&le()(h.image)==="object"&&(h.image=h.image.id)}catch(Se){O.e(Se)}finally{O.f()}}return p=f()(f()({},P),{},{content:t,metafields:$,category:D.id}),u==="publish"?p.status="PUBLISHED":u==="schedule"||u==="reschedule"?(p.status="SCHEDULED",p.publishedAt=R):u==="unpublish"||u==="revert_to_draft"?p.status="DRAFT":u==="update"&&(p.status=a==null?void 0:a.status,p.publishedAt=R),ne=ee({variables:{id:C,input:p}}),b.next=23,i.Toast.promise((0,V.gw)(ne,350),{pending:"\u63D0\u4EA4\u4E2D...",success:"\u201C".concat(P.title,"\u201D \u4FDD\u5B58\u6210\u529F"),error:"\u63D0\u4EA4\u51FA\u9519"},{duration:2e3,placement:"top-center"});case 23:re=b.sent,console.log("submit result set",re);case 25:case"end":return b.stop()}},c)}));return function(c){return _.apply(this,arguments)}}(),[m,ee,C,a==null?void 0:a.status,S]),Ie=o.current.publishedAt,Ke=(0,r.useCallback)(function(_){o.current.publishedAt=_,m.setFieldsValue({publishedAt:_}),J()},[m]);(0,r.useEffect)(function(){var _;a&&(a.publishedAt&&(o.current.publishedAt=y()(a.publishedAt)),o.current.article=a,m.setFieldsValue(f()(f()({},a),{},{publishedAt:o.current.publishedAt,image:(_=a.image)===null||_===void 0?void 0:_.id})))},[a,m]);var Le=(0,r.useCallback)(function(){j("update")},[j]),We=(0,r.useCallback)(function(_){j(_)},[j]),Fe=(0,r.useCallback)(function(){var _=o.current.article,c=_!=null&&_.publishedAt?y()(_.publishedAt):y()();o.current.publishedAt=c,J(),m.setFieldsValue({publishedAt:c})},[m]);return(0,n.jsx)(fe.vs,{loading:Ce,header:{title:"\u7F16\u8F91\u6587\u7AE0"},breadcrumb:(0,n.jsx)(De.Z,{categoryId:s==null?void 0:s.id,append:(0,n.jsx)(i.Breadcrumb.Item,{className:"text-dark",children:a==null?void 0:a.title})}),children:(0,n.jsxs)(i.Form,{form:m,initialValues:{status:"DRAFT",channel:g},className:"form d-flex flex-column flex-lg-row",children:[(0,n.jsxs)("div",{className:"d-flex flex-column flex-row-fluid gap-7 gap-lg-10  me-lg-10",children:[(0,n.jsxs)(i.Tabs,{type:"line-tabs",defaultActiveKey:"general",contentContainer:!1,className:"border-0 fs-4 fw-bold mb-n2 nav-line-tabs-2x",children:[(0,n.jsx)(i.Tabs.TabPane,{tab:"\u57FA\u672C\u4FE1\u606F",forceRender:!0,children:(0,n.jsx)(T.LQ,{article:a,contentType:S,queueUpload:z})},"general"),(0,n.jsx)(i.Tabs.TabPane,{tab:"\u9AD8\u7EA7\u8BBE\u7F6E",forceRender:!0,children:(0,n.jsx)(T.aE,{})},"advanced"),(0,n.jsx)(i.Tabs.TabPane,{tab:"\u5143\u6570\u636E",forceRender:!0,children:(0,n.jsx)(T.SF,{})},"meta")]}),(0,n.jsxs)("div",{className:Ee()("d-flex bg-body-color p-5 mx-4 tw-rounded-2xl align-items-center"),children:[(0,n.jsx)("div",{className:"text-primary flex-row-fluid",children:(a==null?void 0:a.status)==="SCHEDULED"&&(0,n.jsxs)(n.Fragment,{children:["\u5C06\u4E8E"," ",y()(a.publishedAt).format("YYYY \u5E74 MM \u6708 DD \u65E5 HH:mm")," ","\u53D1\u5E03"]})}),(a==null?void 0:a.status)==="DRAFT"&&(0,n.jsx)(i.Button,{variant:"light",loading:o.current.action==="update"&&F,onClick:Le,className:"me-5",children:o.current.action==="update"&&F?"\u4FDD\u5B58\u4E2D...":"\u4FDD\u5B58\u8349\u7A3F"}),(0,n.jsx)(T.H5,{article:a,onPublish:We,publishedAt:Ie,submitting:F,setPublishedAt:Ke,onCancel:Fe})]})]}),(0,n.jsx)(Pe.Z,{baseUrl:Z,article:a,categoryTreeData:je,onChangeCategory:Be})]})})}N.default=Oe}}]);

(self.webpackChunkasany_admin=self.webpackChunkasany_admin||[]).push([[3619],{43619:function(Y,A,l){"use strict";l.r(A);var p=l(11849),v=l(39428),D=l(3182),j=l(2824),c=l(67294),_=l(250),S=l(18071),a=l(51186),e=l(85893);function T(N){var F,d=N.match,u=N.history,U=(0,_.ZL)({fetchPolicy:"cache-and-network",variables:{pageSize:1e3}}),g=U.data,z=(0,_.Nd)({fetchPolicy:"cache-and-network",variables:{pageSize:1e3}}),x=z.data,K=(0,_.V_)({fetchPolicy:"cache-and-network"}),B=(0,j.Z)(K,2),I=B[0],M=B[1],f=M.data,L=M.loading,W=(0,_.mp)({}),O=(0,j.Z)(W,2),Z=O[0],V=O[1].loading,$=(0,_.qV)({}),k=(0,j.Z)($,2),R=k[0],Q=k[1].loading,i=d.params.id=="new",t=a.l0.useForm(),H=(0,c.useCallback)((0,D.Z)((0,v.Z)().mark(function n(){var s;return(0,v.Z)().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.validateFields();case 2:if(s=r.sent,!i){r.next=8;break}return r.next=6,Z({variables:{input:s}});case 6:r.next=10;break;case 8:return r.next=10,R({variables:{id:d.params.id,input:s}});case 10:a.FN.success("\u6D3B\u52A8 \u201C".concat(s.name,"\u201D ").concat(i?"\u65B0\u589E":"\u4FEE\u6539","\u6210\u529F"),2e3,{placement:"bottom-start",progressBar:!0}),!u.length||i?u.replace("/website/landing/pages"):u.go(-2);case 12:case"end":return r.stop()}},n)})),[Z,d.params.id,t,u,i,R]);(0,c.useEffect)(function(){if(d.params.id!="new"){var n=new AbortController;return I({variables:{id:d.params.id},context:{fetchOptions:{signal:n.signal}}}).then(function(){var s=(0,D.Z)((0,v.Z)().mark(function h(r){var w,P,y,C,E,o;return(0,v.Z)().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(E=r.data,o=E==null?void 0:E.page,o){m.next=7;break}return m.next=5,a.u_.error({content:"\u6D3B\u52A8\u4E0D\u5B58\u5728,\u53EF\u80FD\u5DF2\u7ECF\u88AB\u5220\u9664\u4E86",timer:3e3,timerProgressBar:!0});case 5:return u.length?u.goBack():u.replace("/website/landing/pages"),m.abrupt("return");case 7:t.setFieldsValue((0,p.Z)((0,p.Z)({},o),{},{metadata:(0,p.Z)((0,p.Z)({},o.metadata),{},{thumb:(w=o.metadata)===null||w===void 0||(P=w.thumb)===null||P===void 0?void 0:P.id}),poster:(y=o.poster)===null||y===void 0?void 0:y.id,stores:(C=o.stores)===null||C===void 0?void 0:C.map(function(J){return J.id})}));case 8:case"end":return m.stop()}},h)}));return function(h){return s.apply(this,arguments)}}()),function(){n.abort()}}},[t,I,u,d.params.id]);var b=(0,c.useMemo)(function(){return g==null?void 0:g.landingStores.edges.map(function(n){var s=n.node;return{value:s.id,label:s.name}})},[g]),X=(0,c.useMemo)(function(){return x==null?void 0:x.landingPosters.edges.map(function(n){var s=n.node;return{value:s.id,label:s.name}})},[x]),G=(0,c.useCallback)(function(){!b||t.setFieldsValue({stores:b.map(function(n){return n.value})})},[t,b]);return(0,e.jsx)(S.v,{header:i?{title:"\u65B0\u589E\u6D3B\u52A8"}:void 0,footer:!1,children:(0,e.jsxs)(a.Zb,{className:"mb-5 mb-xl-10",children:[(0,e.jsx)(a.Zb.Header,{children:(0,e.jsx)(a.Zb.Title,{children:i?"\u65B0\u589E\u6D3B\u52A8":f==null||(F=f.page)===null||F===void 0?void 0:F.name})}),(0,e.jsxs)(a.Zb.Body,{children:[(0,e.jsx)(a.bH,{zIndex:10,overlayClassName:"bg-white bg-opacity-25",loading:L,children:(0,e.jsxs)(a.l0,{form:t,children:[(0,e.jsxs)("div",{className:"mw-800px row d-flex flex-shrink-0 flex-column-reverse flex-md-row",children:[(0,e.jsxs)("div",{className:"col-12 col-md-8",children:[(0,e.jsx)(a.l0.Item,{className:"mb-5",name:"name",label:"\u540D\u79F0",rules:[{required:!0,message:"\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A"}],children:(0,e.jsx)(a.II,{solid:!0,className:"w-400px"})}),(0,e.jsx)(a.l0.Item,{className:"my-5",name:"poster",label:"\u6D77\u62A5",children:(0,e.jsx)(a.ub,{solid:!0,className:"w-400px",options:X})}),(0,e.jsx)(a.l0.Item,{className:"my-5",name:"stores",label:(0,e.jsxs)(e.Fragment,{children:["\u53C2\u52A0\u6D3B\u52A8\u7684\u95E8\u5E97",(0,e.jsx)("a",{onClick:G,className:"ps-2 cursor-pointer",children:"\u6DFB\u52A0\u5168\u90E8\u95E8\u5E97"})]}),children:(0,e.jsx)(a.ub,{solid:!0,multiple:!0,className:"w-400px",options:b})}),(0,e.jsx)(a.l0.Item,{className:"my-5",name:"start",label:"\u5F00\u59CB\u65F6\u95F4",children:(0,e.jsx)(a.Mt,{solid:!0,className:"w-400px"})}),(0,e.jsx)(a.l0.Item,{dependencies:["start"],noStyle:!0,children:function(){return(0,e.jsx)(a.l0.Item,{className:"my-5",name:"end",label:"\u622A\u6B62\u65F6\u95F4",children:(0,e.jsx)(a.Mt,{solid:!0,minDate:t.getFieldValue("start"),className:"w-400px"})})}}),(0,e.jsx)(a.l0.Item,{className:"my-5",name:"description",label:"\u63CF\u8FF0",help:"\u8BF7\u7528\u5C11\u4E8E250\u5B57\u7B26\u63CF\u8FF0",children:(0,e.jsx)(a.II.TextArea,{solid:!0,autoSize:{minRows:4,maxRows:8},showCount:!0,maxLength:250,className:"w-400px"})})]}),(0,e.jsx)("div",{className:"col-12 col-md-4",children:(0,e.jsx)(a.AS.iPhoneX,{children:(0,e.jsx)(a.l0.Item,{dependencies:["poster","stores"],noStyle:!0,children:function(s){var h=s.getFieldValue("poster"),r=s.getFieldValue("stores");return(0,e.jsx)("iframe",{src:"http://47.103.119.188:8002"+"/lps/0?&poster=".concat(h,"&stores=").concat(r==null?void 0:r.join(",")),style:{width:"100%",height:"100%"}})}})})})]}),(0,e.jsxs)("div",{className:"row",children:[(0,e.jsx)("h4",{className:"mt-10",children:"HTML \u9875\u9762\u5143\u6570\u636E"}),(0,e.jsx)(a.Z0,{className:"mt-4 mb-8"}),(0,e.jsxs)("div",{className:"mw-800px row d-flex flex-shrink-0 flex-column-reverse flex-md-row",children:[(0,e.jsxs)("div",{className:"col-12 col-md-8",children:[(0,e.jsx)(a.l0.Item,{className:"my-5 w-400px",name:["metadata","title"],label:"\u6807\u9898",help:"\u53EF\u4F5C\u4E3A\u5FAE\u4FE1\u5206\u4EAB\u65F6,\u7684\u6807\u9898",children:(0,e.jsx)(a.II,{solid:!0,className:""})}),(0,e.jsx)(a.l0.Item,{className:"my-5 w-400px",name:["metadata","description"],label:"\u63CF\u8FF0",help:"\u8BF7\u7528\u5C11\u4E8E250\u5B57\u7B26\u63CF\u8FF0,\u53EF\u4F5C\u4E3A\u5FAE\u4FE1\u5206\u4EAB\u65F6\u7684\u526F\u6807\u9898",children:(0,e.jsx)(a.II.TextArea,{solid:!0,autoSize:{minRows:4,maxRows:8},showCount:!0,maxLength:250})})]}),(0,e.jsx)("div",{className:"col-12 col-md-4",children:(0,e.jsx)(a.l0.Item,{className:"mb-5",name:["metadata","thumb"],label:"\u7F29\u7565\u56FE",help:"\u53EF\u4F5C\u4E3A\u5FAE\u4FE1\u5206\u4EAB\u65F6\u7684\u56FE\u7247",children:(0,e.jsx)(a.gq.Image,{width:250,height:250,space:"orX8kLOV",crop:{height:300,zoomable:!1,aspectRatio:1}})})})]})]})]})}),(0,e.jsx)(a.zx,{loading:L||V||Q,onClick:H,children:i?(0,e.jsx)(e.Fragment,{children:"\u6DFB\u52A0\u6D3B\u52A8"}):(0,e.jsx)(e.Fragment,{children:"\u4FEE\u6539\u6D3B\u52A8"})})]})]})})}A.default=T}}]);

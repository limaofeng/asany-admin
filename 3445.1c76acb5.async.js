(self.webpackChunkasany_admin=self.webpackChunkasany_admin||[]).push([[3445],{19273:function(Y,P,r){"use strict";r.d(P,{Z:function(){return a}});function a(F){if(F==null)throw new TypeError("Cannot destructure undefined")}},14843:function(Y,P,r){"use strict";r.d(P,{u7:function(){return a.u7},pM:function(){return a.pM},dP:function(){return a.dP},zR:function(){return a.zR},bo:function(){return a.bo},CF:function(){return a.CF},hT:function(){return a.hT},X4:function(){return a.X4},rq:function(){return a.rq},qb:function(){return a.qb},a$:function(){return a.a$},mp:function(){return a.mp},WE:function(){return a.WE},HC:function(){return a.HC},cT:function(){return z},Hr:function(){return G},r3:function(){return a.r3},bI:function(){return a.bI},A6:function(){return a.A6},LV:function(){return a.LV}});var a=r(8305),F=r(39428),l=r(3182),p=r(2824),d=r(67294),E=r(74200),D=r(85893);function Q(u,A){var n,X=(0,a.rz)({variables:{id:u==null?void 0:u.id},refetchQueries:[{query:a.dP,variables:{id:u==null||(n=u.application)===null||n===void 0?void 0:n.id}}]}),e=(0,p.Z)(X,1),$=e[0],U=(0,d.useCallback)((0,l.Z)((0,F.Z)().mark(function L(){var w;return(0,F.Z)().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return C.next=2,E.u_.confirm({title:"\u4F60\u786E\u5B9A\u8981\u5220\u9664\u8BE5\u8DEF\u7531\u5417\uFF1F",content:(0,D.jsxs)(D.Fragment,{children:["\u60A8\u5373\u5C06\u5220\u9664\u201C",(0,D.jsx)("strong",{children:u.name}),"\u201D\u3002\u5220\u9664\u64CD\u4F5C\u4E0D\u53EF\u9006\u8F6C\uFF0C\u8BF7\u8C28\u614E\u64CD\u4F5C\uFF0C\u60A8\u786E\u5B9A\u5220\u9664\u5417\uFF1F"]}),okText:"\u5220 \u9664",okClassName:"btn-danger"});case 2:if(w=C.sent,!w.isConfirmed){C.next=8;break}return C.next=6,$();case 6:E.FN.success("\u5220\u9664\u6210\u529F"),A(u);case 8:case"end":return C.stop()}},L)})),[$,u,A]);return[U]}var z=Q,J=r(11849),K=r(25496);function q(u,A){var n,X,e,$=E.l0.useForm(),U=(0,d.useState)(!1),L=(0,p.Z)(U,2),w=L[0],T=L[1],C=(0,a.X4)({fetchPolicy:"no-cache",refetchQueries:[{query:a.dP,variables:{id:u==null||(n=u.application)===null||n===void 0?void 0:n.id}}]}),_=(0,p.Z)(C,1),O=_[0],v=(0,a.LV)({fetchPolicy:"no-cache",refetchQueries:[{query:a.dP,variables:{id:u==null||(X=u.application)===null||X===void 0?void 0:X.id}}]}),i=(0,p.Z)(v,1),x=i[0],Z=(0,d.useMemo)(function(){return u!=null&&u.id?(0,l.Z)((0,F.Z)().mark(function I(){var h,b,y;return(0,F.Z)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return T(!0),t.prev=1,t.next=4,$.validateFields();case 4:return h=t.sent,t.next=7,E.FN.promise((0,K.gw)(x({variables:{id:u.id,input:(0,J.Z)({},h)}}),350),{pending:"\u63D0\u4EA4\u4E2D...",success:{render:function(){return(0,D.jsxs)(D.Fragment,{children:["\u8DEF\u7531 ",(0,D.jsx)("strong",{children:h.name})," \u4FDD\u5B58\u6210\u529F"]})}},error:"\u63D0\u4EA4\u51FA\u9519"},{duration:2e3,placement:"top-center"});case 7:b=t.sent,y=b.data,A(y.updateRoute),T(!1),t.next=16;break;case 13:t.prev=13,t.t0=t.catch(1),T(!1);case 16:case"end":return t.stop()}},I,null,[[1,13]])})):(0,l.Z)((0,F.Z)().mark(function I(){var h,b,y;return(0,F.Z)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return T(!0),t.prev=1,t.next=4,$.validateFields();case 4:return h=t.sent,t.next=7,E.FN.promise((0,K.gw)(O({variables:{input:(0,J.Z)((0,J.Z)({},h),{},{application:u.application.id})}}),350),{pending:"\u63D0\u4EA4\u4E2D...",success:{render:function(){return(0,D.jsxs)(D.Fragment,{children:["\u8DEF\u7531 ",(0,D.jsx)("strong",{children:h.name})," \u65B0\u589E\u6210\u529F"]})}},error:"\u63D0\u4EA4\u51FA\u9519"},{duration:2e3,placement:"top-center"});case 7:b=t.sent,y=b.data,A(y.createRoute),T(!1),t.next=16;break;case 13:t.prev=13,t.t0=t.catch(1),T(!1);case 16:case"end":return t.stop()}},I,null,[[1,13]])}))},[O,u==null||(e=u.application)===null||e===void 0?void 0:e.id,u==null?void 0:u.id,$,A,x]);return[Z,{form:$,submitting:w}]}var G=q},33445:function(Y,P,r){"use strict";r.r(P),r.d(P,{default:function(){return O}});var a=r(39428),F=r(3182),l=r(11849),p=r(2824),d=r(67294),E=r(28865),D=r(94184),Q=r.n(D),z=r(86582),J=r(93224),K=r(91220),q=r(19273),G=r(65814),u=r(14843),A=r(2970),n=r(74200),X=r(25496),e=r(85893),$=["children","_rect","pos","parent"];function U(v){var i,x=v.form,Z=v.appId,I=v.libraryId,h=(0,u.mp)({variables:{id:Z}}),b=h.data,y=(0,u.qb)({variables:{id:I},fetchPolicy:"cache-and-network"}),N=y.data,t=(b==null||(i=b.app)===null||i===void 0?void 0:i.routes)||[],M=(0,d.useMemo)(function(){return(0,X.$H)((0,X.G_)((t||[]).map(function(c){return(0,l.Z)({},c)}),{pidKey:"parent.id",sort:function(j,g){return j.index-g.index},converter:function(j,g){return(0,q.Z)(g),(0,l.Z)((0,l.Z)({},j),{},{key:j.id,routeType:j.type,title:j.path})}}))},[t]),k=N==null?void 0:N.library,B=(0,d.useMemo)(function(){var c=[],j=(0,K.Z)((k==null?void 0:k.components)||[]),g;try{for(j.s();!(g=j.n()).done;){var R=g.value,f=(0,K.Z)(R.tags),S;try{for(f.s();!(S=f.n()).done;){var W=S.value;(0,A.v)(W,c,R)}}catch(V){f.e(V)}finally{f.f()}}}catch(V){j.e(V)}finally{j.f()}return c},[k]);return(0,d.useEffect)(function(){var c=v.data,j=c.children,g=c._rect,R=c.pos,f=c.parent,S=(0,J.Z)(c,$);v.data.id||x.resetFields(),x.setFieldsValue((0,l.Z)((0,l.Z)({},S),{},{parentRoute:f?f.id:void 0}))},[x,v.data]),console.log("componentTreeData",B),(0,e.jsxs)(n.l0,{form:x,children:[(0,e.jsx)(n.X2,{children:(0,e.jsx)(n.JX,{span:6,children:(0,e.jsx)(n.l0.Item,{name:"name",className:"d-flex flex-column mb-7",required:!0,label:"\u540D\u79F0",rules:[{required:!0,message:"\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A"}],children:(0,e.jsx)(n.II,{solid:!0})})})}),(0,e.jsx)(n.X2,{children:(0,e.jsx)(n.JX,{span:6,children:(0,e.jsx)(n.l0.Item,{name:"parentRoute",className:"d-flex flex-column mb-7",label:"\u4E0A\u7EA7\u8DEF\u7531",children:(0,e.jsx)(n.ub,{solid:!0,options:[{value:"",label:"\u6839\u8282\u70B9"}].concat((0,z.Z)(M.map(function(c){return{value:c.id,label:c.title}})))})})})}),(0,e.jsx)(n.X2,{children:(0,e.jsx)(n.l0.Item,{name:"type",className:"d-flex flex-column mb-7",label:"\u7C7B\u578B",children:(0,e.jsx)(n.Y8.Group,{solid:!0,options:[{value:"MENU",label:"\u83DC\u5355"},{value:"HEADER",label:"\u6807\u9898"},{value:"DIVIDER",label:"\u5206\u9694\u7B26"},{value:"ROUTE",label:"\u8DEF\u7531"}]})})}),(0,e.jsxs)(n.X2,{children:[(0,e.jsx)(n.JX,{span:6,children:(0,e.jsx)(n.l0.Item,{name:"icon",className:"d-flex flex-column mb-7",label:"\u56FE\u6807",children:(0,e.jsx)(n.II,{})})}),(0,e.jsx)(n.JX,{span:6,children:(0,e.jsx)(n.l0.Item,{className:"d-flex flex-column mb-7",name:"index",label:"\u6392\u5E8F\u4F4D\u7F6E",children:(0,e.jsx)(n.II,{solid:!0})})})]}),(0,e.jsxs)(n.X2,{children:[(0,e.jsx)(n.JX,{span:4,children:(0,e.jsx)(n.l0.Item,{valuePropName:"checked",className:"d-flex flex-column mb-7",name:"authorized",children:(0,e.jsx)(n.rs,{solid:!0,label:"\u6388\u6743\u540E\u8BBF\u95EE"})})}),(0,e.jsx)(n.JX,{span:4,children:(0,e.jsx)(n.l0.Item,{valuePropName:"checked",className:"d-flex flex-column mb-7",name:"enabled",children:(0,e.jsx)(n.rs,{solid:!0,label:"\u542F\u7528"})})}),(0,e.jsx)(n.JX,{span:4,children:(0,e.jsx)(n.l0.Item,{valuePropName:"checked",className:"d-flex flex-column mb-7",name:"hideInBreadcrumb",children:(0,e.jsx)(n.rs,{solid:!0,label:"\u4E0D\u5728\u9762\u5305\u5C51\u4E2D\u663E\u793A"})})})]}),(0,e.jsxs)(n.X2,{children:[(0,e.jsx)(n.JX,{span:4,children:(0,e.jsx)(n.l0.Item,{valuePropName:"checked",className:"d-flex flex-column mb-7",name:["layout","pure"],children:(0,e.jsx)(n.rs,{solid:!0,label:"\u4E0D\u4F7F\u7528\u9ED8\u8BA4\u5E03\u5C40"})})}),(0,e.jsx)(n.JX,{span:4,children:(0,e.jsx)(n.l0.Item,{valuePropName:"checked",className:"d-flex flex-column mb-7",name:["layout","hideMenu"],children:(0,e.jsx)(n.rs,{solid:!0,label:"\u9690\u85CF\u83DC\u5355\u680F"})})})]}),(0,e.jsx)(n.l0.Item,{dependencies:["hideInBreadcrumb"],noStyle:!0,children:function(){return x.getFieldValue("hideInBreadcrumb")?(0,e.jsx)(e.Fragment,{}):(0,e.jsx)(n.X2,{children:(0,e.jsx)(n.l0.Item,{className:"d-flex flex-column mb-7",name:"breadcrumb",label:"\u81EA\u5B9A\u4E49\u9762\u5305\u5C51\u7EC4\u4EF6",children:(0,e.jsx)(G.zm,{treeDate:B,placeholder:"\u9009\u62E9\u9762\u5305\u5C51\u7EC4\u4EF6"})})})}}),(0,e.jsx)(n.X2,{children:(0,e.jsx)(n.l0.Item,{className:"d-flex flex-column mb-7",name:"access",label:"\u8BBF\u95EE\u6743\u9650",children:(0,e.jsx)(n.II,{solid:!0})})}),(0,e.jsx)(n.X2,{children:(0,e.jsx)(n.l0.Item,{rules:[{required:!0,message:"\u8BBF\u95EE\u8DEF\u5F84\u4E0D\u80FD\u4E3A\u7A7A"}],className:"d-flex flex-column mb-7",name:"path",label:"\u8DEF\u5F84",children:(0,e.jsx)(n.II,{solid:!0})})}),(0,e.jsx)(n.X2,{children:(0,e.jsx)(n.l0.Item,{className:"d-flex flex-column mb-7",name:"redirect",label:"\u91CD\u5B9A\u5411",children:(0,e.jsx)(n.II,{solid:!0})})}),(0,e.jsx)(n.X2,{children:(0,e.jsx)(n.l0.Item,{className:"d-flex flex-column mb-7",name:"component",label:"\u7EC4\u4EF6",children:(0,e.jsx)(G.zm,{treeDate:B,placeholder:"\u9009\u62E9\u7EC4\u4EF6\u6A21\u7248"})})})]})}function L(v){var i=v.route,x=v.visible,Z=v.onClose,I=v.onSuccess,h=v.onDeleteSuccess,b=v.libraryId,y=(0,u.Hr)(i,I),N=(0,p.Z)(y,2),t=N[0],M=N[1],k=M.form,B=M.submitting,c=(0,d.useMemo)(function(){var f,S;return i?(0,l.Z)((0,l.Z)({},i),{},{breadcrumb:(f=i.breadcrumb)===null||f===void 0?void 0:f.id,component:(S=i.component)===null||S===void 0?void 0:S.id}):{type:"URL",index:0}},[i]),j=(0,u.cT)(i,h),g=(0,p.Z)(j,1),R=g[0];return(0,e.jsx)(n.dy,{title:i!=null&&i.id?"\u7F16\u8F91\u8DEF\u7531":"\u65B0\u589E\u8DEF\u7531",placement:"right",width:640,mask:!1,onClose:Z,visible:x,footer:(0,e.jsxs)(n.X2,{children:[(0,e.jsx)(n.JX,{span:6,children:(0,e.jsx)(n.zx,{style:{letterSpacing:"1rem"},className:"w-100",loading:B,onClick:t,children:"\u4FDD\u5B58"})}),(0,e.jsx)(n.JX,{span:6,children:(i==null?void 0:i.id)&&(0,e.jsx)(n.zx,{style:{letterSpacing:"1rem"},className:"w-100",variant:"light-danger",onClick:R,children:"\u5220\u9664"})})]}),children:i&&(0,e.jsx)(U,{submitting:B,data:c,appId:i.application.id,form:k,libraryId:b,submit:t,onDeleteSuccess:h})})}var w=L,T=r(18071);function C(v){var i=v.data,x=v.onDeleteSuccess,Z=(0,u.cT)(i,x),I=(0,p.Z)(Z,1),h=I[0];return(0,e.jsx)("div",{className:"d-flex flex-row-fluid justify-content-center",onClick:function(y){y.stopPropagation(),y.preventDefault()},children:(0,e.jsx)("div",{className:"ms-2",children:(0,e.jsx)(n.zx,{variant:"light-danger",onClick:h,icon:(0,e.jsx)(E.ZP,{className:"svg-icon-2",name:"Duotune/arr088"})})})})}function _(v){var i,x,Z=v.match.params.id,I=v.location.state.app,h=(0,u.mp)({variables:{id:Z},fetchPolicy:"cache-and-network"}),b=h.data,y=h.loading,N=I.dependencies.find(function(s){return s.name=="component.library"}).value,t=b==null||(i=b.app)===null||i===void 0?void 0:i.routes,M=(0,u.WE)({fetchPolicy:"no-cache",refetchQueries:[{query:u.dP,variables:{id:Z}}]}),k=(0,p.Z)(M,1),B=k[0],c=(0,d.useMemo)(function(){return(0,X.G_)((t||[]).map(function(s){return(0,l.Z)({},s)}),{pidKey:"parent.id",sort:function(m,o){return m.index-o.index},converter:function(m){return(0,l.Z)((0,l.Z)({},m),{},{key:m.id,title:m.name,routeType:m.type,type:"directory"})}})},[t]),j=(0,d.useState)({visible:!1}),g=(0,p.Z)(j,2),R=g[0],f=g[1],S=(0,d.useState)([]),W=(0,p.Z)(S,2),V=W[0],ne=W[1];(0,d.useEffect)(function(){!c.length||ne(function(s){return s.length?s:c.map(function(m){return m.id})})},[c]);var ue=(0,d.useCallback)(function(){f(function(s){return(0,l.Z)((0,l.Z)({},s),{},{visible:!1})})},[]),te=(0,d.useCallback)(function(s){f(function(m){return(0,l.Z)((0,l.Z)({},m),{},{route:s})})},[f]),re=(0,d.useCallback)(function(s){f(function(m){var o;return((o=m.route)===null||o===void 0?void 0:o.id)!=s.id?m:(0,l.Z)((0,l.Z)({},m),{},{visible:!1,menu:void 0})})},[f]),ae=(0,d.useCallback)(function(){f(function(s){return(0,l.Z)((0,l.Z)({},s),{},{visible:!0,route:{index:0,icon:"Duotune/abs005",type:"ROUTE",application:{id:Z}}})})},[Z]),le=(0,d.useCallback)(function(s){f(function(m){var o;return((o=m.route)===null||o===void 0?void 0:o.id)==s.node.id&&m.visible?(0,l.Z)((0,l.Z)({},m),{},{visible:!1}):(0,l.Z)((0,l.Z)({},m),{},{visible:!0,route:(0,l.Z)((0,l.Z)({},s.node),{},{type:s.node.routeType,parentRoute:s.node.parentKey})})})},[]),ie=(0,d.useCallback)(function(){var s=(0,F.Z)((0,a.Z)().mark(function m(o){var ee;return(0,a.Z)().wrap(function(H){for(;;)switch(H.prev=H.next){case 0:if(console.log("handleDrop",o),!(((ee=o.dragNode.parent)===null||ee===void 0?void 0:ee.id)==o.toParentKey&&o.dragNode.index==o.toIndex)){H.next=3;break}return H.abrupt("return");case 3:return H.next=5,n.FN.promise(B({variables:{id:o.dragNode.id,parentRoute:o.toParentKey,location:o.toIndex}}),{pending:"\u66F4\u65B0\u6392\u5E8F...",success:"\u6392\u5E8F\u8C03\u6574\u6210\u529F",error:"\u63D0\u4EA4\u51FA\u9519"},{duration:2e3,placement:"top-center"});case 5:case"end":return H.stop()}},m)}));return function(m){return s.apply(this,arguments)}}(),[B]);return console.log("keys",c.map(function(s){return s.id})),(0,e.jsxs)(T.vs,{header:{title:"\u8DEF\u7531\u8BBE\u7F6E"},loading:y,children:[(0,e.jsxs)(n.Zb,{flush:!0,className:"mt-6 mt-xl-9",headerClassName:"mt-5",children:[(0,e.jsxs)(n.Zb.Header,{className:"pt-8",children:[(0,e.jsx)(n.Zb.Title,{}),(0,e.jsx)(n.Zb.Toolbar,{children:(0,e.jsx)("div",{className:"d-flex justify-content-end",children:(0,e.jsx)(n.zx,{onClick:ae,variant:"primary",children:"\u65B0\u5EFA\u8DEF\u7531"})})})]}),(0,e.jsx)(n.Zb.Body,{className:"pt-0",children:(0,e.jsx)(n.N4,{className:"app-treelist",rowKey:"id",draggable:!0,expandedKeys:V,onExpand:ne,selectedKeys:(x=R.route)!==null&&x!==void 0&&x.id?[R.route.id]:[],onSelect:le,onDrop:ie,columns:[{key:"title",title:"\u540D\u79F0",width:"auto",render:function(m,o){return(0,e.jsxs)("div",{className:"d-flex flex-column py-5",children:[(0,e.jsx)("span",{className:Q()("title  text-hover-primary mb-1 fs-6",{"text-gray-800":!!o.title,"text-gray-600":!o.title}),children:o.title||"(\u672A\u8BBE\u7F6E\u540D\u79F0)"}),(0,e.jsxs)("div",{className:"d-flex flex-row col-stacked",children:[(0,e.jsx)(n.Ct,{color:"secondary",className:"me-2",children:o.path}),o.authorized&&(0,e.jsx)(n.Ct,{color:"primary",children:"\u9700\u8981\u767B\u5F55"})]})]})}},{key:"index",title:"\u6392\u5E8F",className:"w-100px"},{key:"actions",title:"\u64CD\u4F5C",className:"min-w-125px text-center",render:function(m,o){return(0,e.jsx)(C,{data:o,onDeleteSuccess:re})}}],dataSource:c})})]}),(0,e.jsx)(w,{route:R.route,libraryId:N,onClose:ue,onSuccess:te,onDeleteSuccess:re,visible:R.visible})]})}var O=_},2970:function(Y,P,r){"use strict";r.d(P,{v:function(){return F}});var a=r(11849);function F(l,p,d){l.split("/").forEach(function(E,D,Q){var z=p.find(function(J){var K=J.id;return K==="tag-".concat(E)});z||p.push(z={id:"tag-".concat(E),value:"tag-".concat(E),label:E,children:[]}),p=z.children,Q.length===D+1&&p.push((0,a.Z)((0,a.Z)({},d),{},{value:d.id,label:d.title||d.name||d.id}))})}}}]);

(self.webpackChunk=self.webpackChunk||[]).push([[1392],{79514:function(c,f,a){"use strict";a.d(f,{AQ:function(){return n.AQ},Af:function(){return n.Af},G$:function(){return n.G$},I1:function(){return n.I1},KX:function(){return n.KX},Nq:function(){return n.Nq},P6:function(){return n.P6},Pw:function(){return n.Pw},WF:function(){return n.WF},Yw:function(){return n.Yw},ZO:function(){return n.ZO},_c:function(){return n._c},aA:function(){return n.aA},au:function(){return n.au},c9:function(){return n.c9},jS:function(){return n.jS},ko:function(){return n.ko},oM:function(){return n.oM},ot:function(){return n.ot},w4:function(){return n.w4},wp:function(){return n.wp}});var n=a(70694)},41392:function(c,f,a){"use strict";a.r(f);var n=a(97857),D=a.n(n),R=a(15009),h=a.n(R),U=a(99289),B=a.n(U),K=a(49677),L=a.n(K),W=a(5574),v=a.n(W),t=a(62435),k=a(96974),S=a(93967),$=a.n(S),V=a(73588),u=a(13757),g=a(79514),e=a(86074);function G(_){var P=_.visible,s=_.onCancel,r=_.data,M=(0,t.useState)(!0),x=v()(M,2),F=x[0],O=x[1],I=(0,g.G$)(),A=v()(I,2),i=A[0];L()(A[1]);var C=(0,t.useCallback)(function(p,j){O(j.verify!==(r==null?void 0:r.name))},[r==null?void 0:r.name]),T=(0,t.useCallback)(B()(h()().mark(function p(){return h()().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return E.next=2,i({variables:{id:r.id}});case 2:u.Toast.success("\u6A21\u5757 \u201C".concat(r.name,"\u201D \u5220\u9664\u6210\u529F"),2e3,{placement:"bottom-right",progressBar:!0});case 3:case"end":return E.stop()}},p)})),[r.id,r.name,i]);return(0,e.jsxs)(u.Modal,{dialogClassName:$()("asany-confirm-modal w-450px"),visible:P,onCancel:s,title:"\u786E\u5B9A\u5220\u9664\u6A21\u5757\u5417\uFF1F",footer:!1,bodyClassName:"p-0",children:[(0,e.jsx)(u.Alert,{type:"danger",message:"\u8BF7\u4ED4\u7EC6\u9605\u8BFB\u4EE5\u4E0B\u4E8B\u9879"}),(0,e.jsxs)("div",{className:"inner-body p-7",children:[(0,e.jsxs)("p",{className:"fs-7",children:["\u60A8\u5373\u5C06\u5220\u9664 ",(0,e.jsx)("b",{children:r==null?void 0:r.name}),"\uFF0C\u6B64\u64CD\u4F5C\u65E0\u6CD5\u64A4\u9500\u548C\u6062\u590D\u3002"]}),(0,e.jsx)(u.Separator,{className:"my-5"}),(0,e.jsx)(u.Form,{onValuesChange:C,children:(0,e.jsx)(u.Form.Item,{className:"mb-5",name:"verify",label:(0,e.jsxs)(e.Fragment,{children:["\u8F93\u5165\u201C",(0,e.jsx)("i",{children:r==null?void 0:r.name}),"\u201D\uFF0C\u5DF2\u5B8C\u6210\u9A8C\u8BC1"]}),children:(0,e.jsx)(u.Input,{solid:!0})})}),(0,e.jsx)(u.Button,{onClick:T,className:"asany-confirm-modal-button",disabled:F,variant:"light-danger",children:"\u5220\u9664\u6B64\u6A21\u5757"})]})]})}function Q(){var _=u.Form.useForm(),P=(0,k.TH)(),s=P.state.module,r=(0,t.useState)(!1),M=v()(r,2),x=M[0],F=M[1],O=(0,g.ot)(),I=v()(O,1),A=I[0],i=(0,t.useRef)(new AbortController),C="cn.asany",T=(0,g.AQ)(),p=v()(T,2),j=p[0],E=p[1].loading,z=(0,t.useCallback)(B()(h()().mark(function b(){var l;return h()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,_.validateFields();case 2:return l=d.sent,d.next=5,j({variables:{id:s.id,input:D()(D()({},l),{},{code:C+"."+l.code})}});case 5:u.Toast.success("\u6A21\u5757 \u201C".concat(l.name,"\u201D \u66F4\u65B0\u6210\u529F"),2e3,{placement:"bottom-right",progressBar:!0});case 6:case"end":return d.stop()}},b)})),[_,s.id,j]),H=(0,t.useCallback)(function(){F(!1)},[]),X=(0,t.useCallback)(function(){F(!0)},[]);return(0,t.useEffect)(function(){var b,l;_.setFieldsValue(D()(D()({},s),{},{code:(b=s.code)===null||b===void 0?void 0:b.replaceAll(C+".",""),picture:(l=s.picture)===null||l===void 0?void 0:l.id}))},[_,s]),(0,e.jsxs)(V.JH,{children:[(0,e.jsxs)(u.Card,{className:"mb-5 mb-xl-10",children:[(0,e.jsx)(u.Card.Header,{children:(0,e.jsx)(u.Card.Title,{children:"\u6A21\u5757\u4FE1\u606F"})}),(0,e.jsxs)(u.Card.Body,{children:[(0,e.jsxs)(u.Form,{form:_,className:"mw-800px row d-flex flex-shrink-0 flex-column-reverse flex-md-row",children:[(0,e.jsx)("div",{className:"mw-500px col-12 col-md-8",children:(0,e.jsxs)("div",{className:"mw-400px",children:[(0,e.jsx)(u.Form.Item,{required:!1,className:"mb-5",name:"name",label:"\u540D\u79F0",rules:[{required:!0,message:"\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A"}],children:(0,e.jsx)(u.Input,{solid:!0})}),(0,e.jsx)(u.Form.Item,{required:!1,className:"my-5",name:"code",label:"\u7F16\u7801",hasFeedback:!0,help:"\u8BF7\u53C2\u8003\u7F16\u7A0B\u4E2D\u547D\u540D\u7A7A\u95F4\u7684\u5199\u6CD5",rules:[{required:!0,message:"\u7F16\u7801\u4E0D\u80FD\u4E3A\u7A7A"},{validator:function(l,y){return B()(h()().mark(function d(){var w,N,m;return h()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(y){o.next=2;break}return o.abrupt("return");case 2:if(w=C+"."+y,i.current&&i.current.abort(),w!==s.code){o.next=6;break}return o.abrupt("return");case 6:return i.current=new AbortController,o.next=9,A({variables:{filter:{code:w},limit:1},fetchPolicy:"network-only",context:{fetchOptions:{signal:i.current.signal}}});case 9:if(N=o.sent,m=N.data,console.log("validator",l,y,m==null?void 0:m.modules),!(m!=null&&m.modules.length)){o.next=14;break}throw new Error(l.message);case 14:case"end":return o.stop()}},d)}))()},message:"\u7F16\u7801\u4E0D\u80FD\u91CD\u590D"}],children:(0,e.jsx)(u.Input,{solid:!0,addonBefore:C+".",placeholder:"\u4F8B\u5982: module.text"})}),(0,e.jsx)(u.Form.Item,{className:"my-5",name:"description",label:"\u63CF\u8FF0",requiredMark:"optional",children:(0,e.jsx)(u.Input.TextArea,{solid:!0,autoSize:{maxRows:4,minRows:2}})})]})}),(0,e.jsx)("div",{className:"col-12 col-md-4",children:(0,e.jsx)("div",{className:"row",children:(0,e.jsx)(u.Form.Item,{className:"mb-5",name:"picture",label:"\u6A21\u5757\u56FE\u7247",help:"\u5141\u8BB8\u7684\u6587\u4EF6\u7C7B\u578B:png, jpg, jpeg\u3002",children:(0,e.jsx)(u.Upload.Image,{width:148,height:148,space:"7VE4SSrk",crop:{height:300,zoomable:!1,aspectRatio:1},accept:".png, .jpg, .jpeg",background:(0,e.jsx)(u.Symbol,{autoColor:!1,labelClassName:"bg-dark text-inverse-info fs-3tx",alt:s.name})})})})})]}),(0,e.jsx)(u.Button,{loading:E,onClick:z,children:"\u66F4\u65B0\u6A21\u5757\u4FE1\u606F"})]})]}),(0,e.jsxs)(u.Card,{className:"mb-5 mb-xl-10",children:[(0,e.jsx)(u.Card.Header,{children:(0,e.jsx)(u.Card.Title,{className:"text-danger",children:"\u5220\u9664\u6A21\u5757"})}),(0,e.jsxs)(u.Card.Body,{children:[(0,e.jsxs)("div",{className:"fs-7 gap-2 d-flex flex-column mb-3",children:[(0,e.jsx)("p",{className:"mb-0",children:"\u5220\u9664\u64CD\u4F5C\u5C06\u4F1A\u6E05\u9664\u6389\u6A21\u5757\u4E2D\u7684\u6240\u6709\u5185\u5BB9\uFF0C\u5305\u62EC\uFF1A\u6A21\u578B/\u6570\u636E\u7B49"}),(0,e.jsx)("p",{className:"mb-0",children:"\u5E10\u6237\u5220\u9664\u540E\uFF0C\u5C06\u65E0\u6CD5\u6062\u590D\u3002\u8BF7\u8C28\u614E\u64CD\u4F5C\u3002"})]}),(0,e.jsx)(u.Button,{variant:"danger",onClick:X,children:"\u5220\u9664\u6A21\u5757"}),(0,e.jsx)(G,{data:s,visible:x,onCancel:H})]})]})]})}f.default=Q},49677:function(c){function f(a){if(a==null)throw new TypeError("Cannot destructure "+a)}c.exports=f,c.exports.__esModule=!0,c.exports.default=c.exports}}]);

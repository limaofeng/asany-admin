"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7802],{57802:function(We,K,o){o.d(K,{$:function(){return me}});var Q=o(13769),G=o.n(Q),X=o(15009),j=o.n(X),H=o(19632),J=o.n(H),q=o(99289),U=o.n(q),ee=o(97857),M=o.n(ee),re=o(5574),m=o.n(re),d=o(67294),W=o(96974),te=o(39711),ne=o(46027),v=o(13316),ae=o(30381),P=o.n(ae),se=o(10185),oe=o(35908),ue=o(14336),le=o(94528),k=o(58301),u=o(89717),ie=o(59357),_e=o(82144),A=o(12708),g=o(60551),e=o(85893),de=["keywords"];function ce(i){var y=i.data,D=i.delete,x=(0,d.useState)(!1),E=m()(x,2),O=E[0],h=E[1],B=(0,W.s0)(),I=(0,d.useCallback)(function(c){var b=c.key;b==="edit"?B("/pim/devices/".concat(y.id)):b==="delete"&&D({name:y.name,id:y.id})},[]);return(0,e.jsx)(u.Dropdown,{overlay:(0,e.jsxs)(u.Menu,{onClick:I,className:"menu-sub menu-sub-dropdown menu-gray-600 menu-state-bg-light-primary fw-bold w-125px py-4",children:[(0,e.jsx)(u.Menu.Item,{className:"px-3",children:"\u7F16\u8F91"},"edit"),(0,e.jsx)(u.Menu.Item,{className:"px-3",children:"\u5220\u9664"},"delete")]}),placement:"bottomRight",onVisibleChange:h,visible:O,children:(0,e.jsxs)(u.Button,{variant:"light",activeColor:"light-primary",children:["\u64CD \u4F5C",(0,e.jsx)(ne.ZP,{className:"ms-2 svg-icon-5 m-0",name:"Duotune/arr072"})]})})}var me=function(i){return i.sn="sn",i.name="name",i.warrantyStatus="warrantyStatus",i.customer="store.customer.name",i.customerStore="store.name",i.createdAt="createdAt",i.action="action",i}({});function he(i){var y,D,x,E,O=(0,oe.ot)(),h=O.data,B=(0,te.lr)(),I=m()(B,1),c=I[0],b=(0,W.s0)(),C=(0,d.useMemo)(function(){return(0,k.bp)(c,[{source:"q",target:"keywords"},{source:"customer",target:"customer"},{source:"stores",target:"customerStore_in",transform:function(r){return r.split(",")}},{source:"created_by",target:"createdBy_in",transform:function(r){return r.split(",")}},{source:"warranty_status",target:"warrantyStatus"},{source:"created_at_range",target:"createdAt_range",transform:function(r){var a=r.split("~"),s=m()(a,2),l=s[0],t=s[1];return[P()(l),P()(t)]}}])},[c.toString()]),ye=(0,_e.xY)({variables:{where:{tenantId:h==null?void 0:h.tenantId},pageSize:100},fetchPolicy:"network-only",skip:!(h!=null&&h.tenantId)}),S=ye.data,R=(0,d.useCallback)(function(n,r,a){console.log("handleSearch",n,r,a);var s=(0,k.Oh)({searchForm:n,pagination:r,sorter:a},[{source:"searchForm.keywords",target:"q",skip:function(t){return!t}},{source:"searchForm.customer",target:"customer",skip:function(t){return!t}},{source:"searchForm.customerStore_in",target:"stores",transform:function(t){return t==null?void 0:t.join(",")},skip:function(t){return!t||!t.length}},{source:"searchForm.createdBy_in",target:"created_by",transform:function(t){return t==null?void 0:t.join(",")},skip:function(t){return!t||!t.length}},{source:"searchForm.warrantyStatus",target:"warranty_status",transform:function(t){return t},skip:function(t){return!t||t==="ALL"}},{source:"searchForm.createdAt_range",target:"created_at_range",transform:function(t){return t[0].format("YYYY-MM-DD")+"~"+t[1].format("YYYY-MM-DD")},skip:function(t){return!t}},{source:"pagination.current",target:"page",skip:function(t){return t===1}},{source:"pagination.pageSize",target:"per_page",skip:function(t){return t===15}},{source:"sorter.field",target:"sort",transform:function(t){return"".concat(t,":").concat(a.order==="ascend"?"asc":"desc")}}]);b(location.pathname+"?"+s,{replace:!0})},[]),w=(0,d.useMemo)(function(){return(0,k.bp)(c,[{source:"q",target:"where.name_contains"},{source:"customer",target:"where.customer"},{source:"stores",target:"where.customerStore_in",transform:function(r){return r.split(",")}},{source:"created_by",target:"where.createdBy_in",transform:function(r){return r.split(",")}},{source:"warranty_status",target:"where.warrantyStatus"},{source:"created_at_range",target:"where.createdAt_range",transform:function(r){var a=r.split("~"),s=m()(a,2),l=s[0],t=s[1];return{start:P()(l),end:P()(t)}}},{source:"page",transform:function(r){return parseInt(r)}},{source:"per_page",transform:function(r){return parseInt(r)}},{source:"sort",target:"orderBy",transform:function(r){var a=r.split(":"),s=m()(a,2),l=s[0],t=s[1];return"".concat(l,"_").concat(t)}}],{where:M()({},i.where)})},[c.toString(),i.where]),fe=(0,d.useCallback)(function(n,r,a){R(C,n,a)},[C]),ve=(0,g.Eg)({fetchPolicy:"network-only"}),Ee=m()(ve,1),pe=Ee[0],ge=(0,k.ZP)(g.Ew,{variables:w,fetchPolicy:"network-only"}),N=m()(ge,2),De=N[0],L=N[1],xe=L.loading,be=L.pageInfo,je=L.refetch,Pe=(0,d.useCallback)(function(n){R({keywords:n},{},{})},[]),ke=(0,d.useCallback)(function(n){R(n,{},{})},[]),Ce=(0,d.useState)((y=w.where)===null||y===void 0?void 0:y.customer),$=m()(Ce,2),Z=$[0],we=$[1],Me=(0,g.rq)({fetchPolicy:"network-only",skip:!!((D=i.where)!==null&&D!==void 0&&D.customer)}),T=Me.data,Y=(0,g.YG)({fetchPolicy:"network-only",skip:!Z,variables:{where:{customer:Z||((x=w.where)===null||x===void 0?void 0:x.customer)}}}),F=Y.data,Ae=Y.loading,Oe=(0,le.Z)({fields:[{key:"sn",title:"\u5E8F\u5217\u53F7",type:"string"},{key:"brand.name",title:"\u54C1\u724C",type:"string"},{key:"product.name",title:"\u4EA7\u54C1\u540D\u79F0",type:"string"},{key:"name",title:"\u8BBE\u5907\u540D\u79F0",type:"string"},{key:"warrantyStatus",title:"\u4FDD\u56FA\u72B6\u6001",type:"string"},{key:"warrantyStartDate",title:"\u4FDD\u56FA\u5F00\u59CB\u65F6\u95F4",type:"date"},{key:"warrantyEndDate",title:"\u4FDD\u56FA\u7ED3\u675F\u65F6\u95F4",type:"date"},{key:"store.no",title:"\u6240\u5C5E\u95E8\u5E97\u5E97\u53F7",type:"string"},{key:"store.name",title:"\u6240\u5C5E\u95E8\u5E97\u540D\u79F0",type:"string"},{key:"store.address.fullAddress",title:"\u6240\u5C5E\u95E8\u5E97\u5730\u5740",type:"string"},{key:"store.phone",title:"\u6240\u5C5E\u95E8\u5E97\u7535\u8BDD",type:"string"}],export:{filename:"\u8BBE\u5907\u5217\u8868.xlsx",columns:[{key:"sn",style:{wch:20}},{key:"brand.name",style:{wch:10}},{key:"product.name",style:{wch:10}},{key:"name",style:{wch:16}},{key:"warrantyStatus",style:{wch:10}},{key:"warrantyStartDate",style:{wch:16}},{key:"warrantyEndDate",style:{wch:16}},{key:"store.no",style:{wch:10}},{key:"store.name",style:{wch:10}},{key:"store.address.fullAddress",style:{wch:40}},{key:"store.phone",style:{wch:20}}],dataSource:function(r){return U()(j()().mark(function a(){var s,l,t,_,p;return j()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:s=[],l={hasNextPage:!1},t=1;case 3:return f.next=5,pe({variables:M()(M()({},w),{},{page:t,pageSize:100})});case 5:_=f.sent,p=_.data,l=p.result.pageInfo,s.push.apply(s,J()(p.result.edges.map(function(Ue){return Ue.node}))),r.update("\u5DF2\u4E0B\u8F7D ".concat(s.length,"/").concat(p.result.pageInfo.total," \u6761\u6570\u636E")),t++;case 11:if(l.hasNextPage){f.next=3;break}case 12:return f.abrupt("return",s);case 13:case"end":return f.stop()}},a)}))()}}}),Be=(T==null?void 0:T.result)||[],Ie=(F==null?void 0:F.result)||[],V=(S==null?void 0:S.result.edges.map(function(n){return n.node}))||[],z=(0,ue.Z)(g.an,{onDeleted:function(){je()},dialog:{title:"\u4F60\u786E\u5B9A\u8981\u5220\u9664\u5417\uFF1F",content:function(r,a){var s;if(a.batch){var l=r;s="\u786E\u5B9A\u5220\u9664\u9009\u4E2D\u7684, \u5171 ".concat(l.length," \u4E2A\u8BBE\u5907\u5417\uFF1F")}else s=(0,e.jsxs)(e.Fragment,{children:["\u60A8\u5373\u5C06\u5220\u9664\u201C",(0,e.jsx)("strong",{children:r.name})]});return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("p",{className:"tip-confirm",children:s}),(0,e.jsx)("p",{children:"\u5220\u9664\u7684\u64CD\u4F5C\u4E0D\u53EF\u9006,\u8BF7\u8C28\u614E\u64CD\u4F5C"})]})}}}),Se=z.delete,Re=z.deleteMany,Le=(0,d.useCallback)(function(n){return U()(j()().mark(function r(){return j()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:Re(n);case 1:case"end":return s.stop()}},r)}))},[]),Te=C.keywords,Fe=G()(C,de),Ke=[{key:"sn",title:"\u5E8F\u5217\u53F7",sorter:!0,sortOrder:(0,A.PE)(c,"sn"),width:260,render:function(r,a){return(0,e.jsx)("span",{onClick:function(){b("/pim/devices/".concat(a.id))},children:r})}},{key:"name",title:"\u8BBE\u5907\u540D\u79F0",sorter:!0,sortOrder:(0,A.PE)(c,"name"),render:function(r,a){var s;return(0,e.jsxs)("div",{children:[a==null||(s=a.brand)===null||s===void 0?void 0:s.name," | ",r]})}},{key:"warrantyStatus",title:"\u4FDD\u4FEE\u72B6\u6001",width:80,render:function(r){var a={INACTIVE:"\u672A\u6FC0\u6D3B",ACTIVE:"\u6FC0\u6D3B",EXPIRED:"\u5DF2\u8FC7\u671F",CANCELED:"\u5DF2\u4F5C\u5E9F"};return(0,e.jsx)("div",{children:a[r]})}},{key:"store.customer.name",title:"\u6240\u5C5E\u5BA2\u6237",width:120,render:function(r){return(0,e.jsx)("div",{children:r})}},{key:"store.name",title:"\u6240\u5C5E\u95E8\u5E97",width:120,render:function(r){return(0,e.jsx)("div",{children:r})}},{key:"createdAt",title:"\u521B\u5EFA\u65F6\u95F4",width:120,sorter:!0,sortOrder:(0,A.PE)(c,"createdAt")},{title:"\u64CD\u4F5C",key:"action",width:140,render:function(r,a){return(0,e.jsx)(ce,{data:a,delete:Se})}}].filter(function(n){return i.columns.includes(n.key)}).sort(function(n,r){return i.columns.indexOf(n.key)-i.columns.indexOf(r.key)});return(0,e.jsxs)(u.Card,{className:"mb-5 mb-xl-10",children:[(0,e.jsxs)(u.Card.Header,{className:"pt-8",children:[(0,e.jsxs)(u.Card.Title,{className:"flex-row",children:[(0,e.jsx)(u.Input.Search,{solid:!0,value:Te,className:"w-250px",placeholder:"\u641C\u7D22\u8BBE\u5907",onSearch:Pe}),(0,e.jsxs)(se.ZJ,{values:Fe,onSearch:ke,children:[!((E=i.where)!==null&&E!==void 0&&E.customer)&&(0,e.jsx)(u.Row,{gutter:8,className:"mb-8",children:(0,e.jsxs)(u.Col,{xxl:7,children:[(0,e.jsx)("label",{className:"fs-6 form-label fw-bold text-dark",children:"\u5BA2\u6237"}),(0,e.jsx)(v.Z.Item,{noStyle:!0,name:"customer",children:(0,e.jsx)(u.Select2,{solid:!0,matcher:function(r,a){return!r.term||r.term===""||a.text.includes(r.term)?a:null},onChange:function(r){we(r)},placeholder:"\u5168\u90E8\u5BA2\u6237",options:Be.map(function(n){return{label:n.name,value:n.id}})})})]})}),(0,e.jsxs)(u.Row,{gutter:8,className:"mb-8",children:[(0,e.jsxs)(u.Col,{xxl:7,children:[(0,e.jsx)("label",{className:"fs-6 form-label fw-bold text-dark",children:"\u95E8\u5E97"}),(0,e.jsx)(v.Z.Item,{dependencies:["customer"],noStyle:!0,children:function(r){var a=r.getFieldValue("customer"),s=a?"\u5168\u90E8\u95E8\u5E97":"\u8BF7\u5148\u9009\u62E9\u5BA2\u6237";return(0,e.jsx)(v.Z.Item,{noStyle:!0,name:"customerStore_in",children:(0,e.jsx)(u.Select2,{solid:!0,multiple:!0,placeholder:Ae?"\u52A0\u8F7D\u4E2D...":s,options:Ie.map(function(l){return{label:l.name,value:l.id}})})})}})]}),(0,e.jsxs)(u.Col,{xxl:5,children:[(0,e.jsx)("label",{className:"fs-6 form-label fw-bold text-dark",children:"\u4FDD\u4FEE\u72B6\u6001"}),(0,e.jsx)(v.Z.Item,{noStyle:!0,name:"warrantyStatus",initialValue:"ALL",children:(0,e.jsxs)(u.Radio.Group,{children:[(0,e.jsx)(u.Radio.Button,{value:"ALL",children:"\u5168\u90E8"}),(0,e.jsx)(u.Radio.Button,{value:"ACTIVE",children:"\u5728\u4FDD"}),(0,e.jsx)(u.Radio.Button,{value:"EXPIRED",children:"\u5DF2\u8FC7\u671F"})]})})]})]}),(0,e.jsxs)(u.Row,{gutter:8,className:"mb-8",children:[(0,e.jsxs)(u.Col,{xxl:7,children:[(0,e.jsx)("label",{className:"fs-6 form-label fw-bold text-dark",children:"\u521B\u5EFA\u4EBA"}),(0,e.jsx)(v.Z.Item,{noStyle:!0,name:"createdBy_in",children:(0,e.jsx)(u.Select2,{solid:!0,multiple:!0,matcher:function(r,a){var s,l,t;if(!r.term||r.term==="")return a;var _=V.find(function(p){return p.id===a.id});return _!=null&&(s=_.nickname)!==null&&s!==void 0&&s.includes(r.term)||_!=null&&(l=_.username)!==null&&l!==void 0&&l.includes(r.term)||_!=null&&(t=_.phone)!==null&&t!==void 0&&(t=t.number)!==null&&t!==void 0&&t.includes(r.term)?a:null},placeholder:"\u521B\u5EFA\u4EBA",labelProp:"name",valueProp:"id",options:V})})]}),(0,e.jsxs)(u.Col,{xxl:5,children:[(0,e.jsx)("label",{className:"fs-6 form-label fw-bold text-dark",children:"\u521B\u5EFA\u65F6\u95F4"}),(0,e.jsx)(v.Z.Item,{noStyle:!0,name:"createdAt_range",children:(0,e.jsx)(ie.Z,{solid:!0})})]})]})]})]}),(0,e.jsxs)(u.Card.Toolbar,{children:[(0,e.jsx)("div",{className:"me-4 my-1"}),(0,e.jsx)("div",{className:"me-4 my-1"}),(0,e.jsx)(u.Button,{variant:"light",className:"me-4 my-1",onClick:function(){return Oe.export()},children:"\u5BFC\u51FA\u6570\u636E"})]})]}),(0,e.jsx)(u.Card.Body,{children:(0,e.jsx)(u.BlockUI,{overlayClassName:"bg-white bg-opacity-25",loading:xe,children:(0,e.jsx)(u.Table,{hover:!0,rowKey:"id",rowSelection:{type:"checkbox",renderTitle:function(r){return(0,e.jsxs)(e.Fragment,{children:["\u5DF2\u9009\u4E2D",(0,e.jsx)("span",{className:"mx-2",children:r}),"\u4E2A\u8BBE\u5907"]})},toolbar:function(r){return(0,e.jsx)("div",{children:(0,e.jsx)(u.Button,{color:"success",onClick:Le(r),variant:!1,children:"\u6279\u91CF\u5220\u9664"})})}},noRowsRenderer:function(){return(0,e.jsx)(u.Empty,{description:"\u5217\u8868\u6570\u636E\u4E3A\u7A7A",image:"/assets/media/illustrations/sigma-1/5.png"})},columns:Ke,pagination:be,onChange:fe,dataSource:De})})})]})}K.Z=he}}]);

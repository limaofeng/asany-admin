"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[2542,267],{51253:function(Qe,be,c){c.d(be,{GP:function(){return fe.Z},Hk:function(){return X},xx:function(){return Me.x}});var Ae=c(74958),fe=c(5166),Me=c(19260),S=c(68400),me=c.n(S),R=c(62435),he=c(93967),F=c.n(he),ge=c(94589),pe=c(97857),a=c.n(pe),Be=c(46027),Xe=c(10582),_=c(42687),Oe=c(79817),ae=c(5574),We=c.n(ae),ne=c(96486),ce=c(86074),o={aside:{minimize:!1,width:280}},Ee=R.createContext({state:o,dispatch:function(){}}),Te=function(I){return I.AsideToggle="ASIDE_TOGGLE",I.AsideWidth="ASIDE_WIDTH",I}({});function Re(I,re){switch(re.type){case"ASIDE_TOGGLE":return I.aside.minimize=!I.aside.minimize,a()({},I);case"ASIDE_WIDTH":return I.aside.width=re.payload,a()({},I);default:throw new Error}}var e=function(re){var de=(0,R.useReducer)(Re,(0,ne.cloneDeep)(o)),Ce=We()(de,2),oe=Ce[0],xe=Ce[1];return(0,ce.jsx)(Ee.Provider,{value:{state:oe,dispatch:xe},children:re.children})},Fe=function(){return(0,R.useContext)(Ee)},Ve=c(65495);function ie(I){var re=Fe(),de=re.dispatch,Ce=re.state.aside.minimize,oe=(0,R.useCallback)(function(){de({type:Te.AsideToggle})},[de]);return(0,ce.jsx)(Oe.Button,{style:a()({marginBottom:"1.35rem",zIndex:105},I.style),onClick:oe,activeColor:"primary",className:F()("micro-app-aside-toggle","btn-icon bg-body btn-color-gray-700 rounded-2 position-absolute translate-middle bottom-0 shadow-sm d-none d-lg-flex",I.className,{active:Ce}),children:(0,ce.jsx)(Be.JO,{name:"Duotune/arr063",className:"svg-icon-2 rotate-180"})})}var Ue={"drawer drawer-start":{maxWidth:992}};function Ie(I){var re=I.className,de=I.header,Ce=I.children,oe=I.collapsible,xe=oe===void 0?!0:oe,Ne=I.width,Se=Ne===void 0?280:Ne,je=(0,_.$Y)(),De=Fe(),we=De.dispatch;(0,R.useEffect)(function(){je.aside.width(Se+100),we({type:Te.AsideWidth,payload:Se})},[je.aside,we,Se]);var Pe=(0,Xe.CN)(Ue),Ye=(0,_.BK)(function(ze){return ze.aside.drawer});return(0,ce.jsxs)("div",{className:F()("app-aside aside",re,Pe,{"drawer-on":Ye}),children:[(0,ce.jsx)(Ve.Z,{children:(0,ce.jsx)(fe.Z,{header:de,resizeable:!0,className:"app-sidebar",children:Ce})}),xe&&(0,ce.jsx)(ie,{className:"start-100 end-0"})]})}Ie.Toggle=ie;var Ke=Ie,z,$e=ge.ZP.div(z||(z=me()([`
  --root-aside-width: `,`;
  --met-aside-width: `,`;
`])),function(I){return I.minimize?"100px":"".concat(I.width,"px")},function(I){return I.minimize?"100px":"".concat(I.width,"px")});function Le(I){var re=I.children,de=I.className,Ce=Fe(),oe=Ce.state.aside,xe=oe.minimize,Ne=oe.width,Se=(0,R.useCallback)(function(je){je.preventDefault()},[]);return(0,ce.jsx)($e,{minimize:xe,width:Ne,className:F()("micro-app-container page-full-content",de,{"aside-minimize":xe}),onContextMenu:Se,children:re})}function ye(I){var re=I.children,de=I.className;return(0,ce.jsx)(e,{children:(0,ce.jsx)(Le,{className:de,children:re})})}ye.Sidebar=Ke;var X=ye},48943:function(Qe,be,c){c.r(be),c.d(be,{default:function(){return xa}});var Ae=c(9783),fe=c.n(Ae),Me=c(15009),S=c.n(Me),me=c(99289),R=c.n(me),he=c(5574),F=c.n(he),ge=c(64599),pe=c.n(ge),a=c(62435),Be=c(49972),Xe=c(24689),_=c(12845),Oe=c(93967),ae=c.n(Oe),We=c(30381),ne=c.n(We),ce=c(51253),o=c(79817),Ee=c(12708),Te=c(19632),Re=c.n(Te),e=c(86074);function Fe(l){var s=l.calendarSets,n=l.onAction,i=(0,_.useModel)("calendar",function(f){return f.state.calendarSet}),t=(0,_.useModel)("calendar",function(f){return f.setCalendarSet}),b=(0,a.useCallback)(function(f){if(f.startsWith("calendar-set-"))t(f.substring(13));else return n(f),!1;return!0},[n,t]),h=(0,a.useMemo)(function(){return[{value:"calendar-set-all",label:"\u5168\u90E8\u65E5\u5386"}].concat(Re()(s.map(function(f){return{value:"calendar-set-".concat(f.id),label:f.name}})),[{type:"separator"},{value:"manage-calendars",label:"\u7BA1\u7406\u65E5\u5386"}])},[s]);return(0,e.jsx)("div",{className:"calendar-sidebar-footer",children:(0,e.jsx)(o.Select,{onChange:b,placement:"topCenter",value:"calendar-set-".concat(i),options:h})})}var Ve=Fe,ie=c(46027);function Ue(){var l=(0,a.useRef)(null),s=(0,a.useState)(!1),n=F()(s,2),i=n[0],t=n[1],b=(0,a.useState)(""),h=F()(b,2),f=h[0],j=h[1],P=(0,_.useModel)("calendar",function(m){var u=m.state;return u.selectedDay||new Date}),p=(0,_.useModel)("calendar",function(m){return m.state.state==="new"}),g=(0,_.useModel)("calendar",function(m){return m.changeState}),A=(0,a.useCallback)(function(){var m;(m=l.current)===null||m===void 0||m.focus()},[]),r=(0,a.useCallback)(function(){t(!0)},[]),v=(0,a.useCallback)(function(){var m=document.getElementsByClassName("main-calendar")[0];m==null||m.focus(),g("none"),j(""),t(!1)},[g]),K=(0,a.useCallback)(function(m){m.key==="Escape"&&v()},[v]),D=(0,a.useCallback)(function(m){if(j(m.target.value),!m.target.value){g("none");return}!p&&g("new",P)},[g,p,P]),N=(0,a.useCallback)(function(){var m;(m=l.current)!==null&&m!==void 0&&m.value||v()},[v]);return(0,a.useEffect)(function(){var m;if(!p){j(""),t(!1);return}var u=document.activeElement,V=!!u&&(u.tagName==="INPUT"||u.tagName==="SELECT"||u.tagName==="TEXTAREA"||u.contentEditable&&u.contentEditable==="true");V||((m=l.current)===null||m===void 0||m.focus(),j(ne()(P).format("YYYY-MM-DD")))},[p,P]),(0,e.jsxs)("div",{className:ae()("calendar-event-header",{"event-header-state-new":p}),children:[(0,e.jsx)("div",{className:ae()("calendar-event-header-left"),children:(0,e.jsx)(o.Input,{onFocus:r,onBlur:N,ref:l,value:f,onChange:D,solid:!0,placeholder:"\u65B0\u5EFA\u65E5\u7A0B",onKeyUp:K})}),(0,e.jsx)("a",{className:ae()("calendar-event-header-right",{"calendar-event-new-icon":!(i||p)}),onClick:i||p?v:A,children:(0,e.jsx)(ie.ZP,{className:ae()({"svg-icon-1":i||p,"svg-icon-2x svg-icon-dark":!(i||p)}),name:i||p?"Duotune/arr088":"Duotune/arr087"})})]})}var Ie=Ue,Ke=c(97857),z=c.n(Ke),$e=c(13769),Le=c.n($e),ye=c(52035),X=c(55760);function I(l){var s=(0,X.V7)({fetchPolicy:"cache-and-network"}),n=s.data,i=(0,a.useMemo)(function(){return n!=null&&n.calendars?n.calendars.filter(function(t){return t.type==="SUNRISE"}).map(function(t){return z()(z()({},t),{},{label:t.name,value:t.id})}):[]},[n==null?void 0:n.calendars]);return(0,e.jsx)(o.Select,z()(z()({},l),{},{options:i,itemRender:function(b,h){var f=b.color,j=(0,e.jsx)("div",{style:{backgroundColor:f,width:12,height:12,marginRight:8,border:"1px solid ".concat((0,ye.r5)(f)),borderRadius:6,display:"inline-block"}});return h?(0,e.jsxs)(e.Fragment,{children:[a.cloneElement(j,{style:z()(z()({},j.props.style),{},{marginRight:5})}),b.label]}):(0,e.jsxs)(e.Fragment,{children:[j,b.label]})}}))}var re=I,de=["calendar","alert"],Ce=o.Input.TextArea,oe=[{label:"\u65E0",value:"none",scope:["all-day","general"],remind:{alert:"NONE"}},{type:"separator",scope:["all-day","general"]},{label:"\u65E5\u7A0B\u5F53\u5929 (\u4E0A\u5348 8:00)",value:"on time of event",scope:["all-day"],remind:{alert:"ON_TIME_OF_EVENT"}},{label:"1 \u5929\u524D (\u4E0A\u5348 8:00)",value:"1 day before 8:00",scope:["all-day"],remind:{alert:"DAYS_BEFORE",times:1}},{label:"2 \u5929\u524D (\u4E0A\u5348 8:00)",value:"2 day before 8:00",scope:["all-day"],remind:{alert:"DAYS_BEFORE",times:2}},{label:"\u65E5\u7A0B\u53D1\u751F\u65F6",value:"at time of event",scope:["general"],remind:{alert:"AT_TIME_OF_EVENT"}},{label:"1 \u5206\u949F\u524D",value:"1 minute before",scope:["general"],remind:{alert:"MINUTES_BEFORE",times:1}},{label:"5 \u5206\u949F\u524D",value:"5 minute before",scope:["general"],remind:{alert:"MINUTES_BEFORE",times:5}},{label:"10 \u5206\u949F\u524D",value:"10 minute before",scope:["general"],remind:{alert:"MINUTES_BEFORE",times:10}},{label:"15 \u5206\u949F\u524D",value:"15 minute before",scope:["general"],remind:{alert:"MINUTES_BEFORE",times:15}},{label:"30 \u5206\u949F\u524D",value:"30 minute before",scope:["general"],remind:{alert:"MINUTES_BEFORE",times:30}},{label:"45 \u5206\u949F\u524D",value:"45 minute before",scope:["general"],remind:{alert:"MINUTES_BEFORE",times:45}},{label:"1 \u5C0F\u65F6\u524D",value:"1 hour before",scope:["general"],remind:{alert:"HOURS_BEFORE",times:1}},{label:"2 \u5C0F\u65F6\u524D",value:"2 hour before",scope:["general"],remind:{alert:"HOURS_BEFORE",times:2}},{label:"1 \u5929\u524D",value:"1 day before",scope:["general"],remind:{alert:"DAYS_BEFORE",times:1}},{label:"2 \u5929\u524D",value:"2 day before",scope:["general"],remind:{alert:"DAYS_BEFORE",times:2}},{type:"separator",scope:["all-day","general"]},{label:"\u81EA\u5B9A\u4E49",value:"custom",scope:[]}];function xe(l){var s=l.visible,n=l.calendarSets,i=l.onSuccess,t=(0,a.useRef)({title:"\u6D4B\u8BD5",allDay:!0,color:"none",alert:"none",starts:"2022-01-19",ends:"2022-01-19"}),b=(0,a.useState)(!1),h=F()(b,2),f=h[0],j=h[1],P=(0,_.useModel)("calendar",function(u){var V=u.state;return ne()(V.selectedDay||new Date).format("YYYY-MM-DD")}),p=(0,_.useModel)("calendar",function(u){return u.state.state==="new"}),g=(0,_.useModel)("calendar",function(u){return u.state.calendarSet}),A=(0,X.wO)(),r=F()(A,1),v=r[0];t.current.starts=P,t.current.ends=P;var K=(0,a.useCallback)(function(){j(function(u){return!u})},[]),D=(0,a.useCallback)(function(u){if(u.key==="Escape"){var V;(V=document.querySelector(".calendar-event-header input"))===null||V===void 0||V.focus()}},[]),N=o.Form.useForm();(0,a.useEffect)(function(){if(!t.current.calendar)if(g==="all")t.current.calendar=null;else{var u;t.current.calendar=(u=n.find(function(V){return V.id===g}))===null||u===void 0||(u=u.defaultCalendar)===null||u===void 0?void 0:u.id}N.setFieldsValue(t.current)},[g,n,N]);var m=(0,a.useCallback)(function(){var u=R()(S()().mark(function V(T){var G,W,E,w,J,Y,C;return S()().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return W=T.calendar,E=T.alert,w=Le()(T,de),J=(G=oe.find(function(O){return O.value===E}))===null||G===void 0?void 0:G.remind,k.next=4,v({variables:{calendar:W,input:z()(z()({},w),{},{remind:J||{alert:"NONE"}})}});case 4:Y=k.sent,C=Y.data,i(C==null?void 0:C.event);case 7:case"end":return k.stop()}},V)}));return function(V){return u.apply(this,arguments)}}(),[v,i]);return(0,a.useEffect)(function(){p&&N.setFieldsValue(t.current)},[p,N]),(0,e.jsx)("div",{className:ae()("calendar-new-event-container",{invisible:!s}),children:(0,e.jsx)("div",{className:"calendar-new-event",children:(0,e.jsx)(o.Form,{onFinish:m,form:N,onKeyUp:D,layout:"horizontal",initialValues:t.current,children:(0,e.jsxs)("ul",{children:[(0,e.jsx)("li",{children:(0,e.jsx)(o.Form.Item,{name:"title",noStyle:!0,children:(0,e.jsx)(o.Input,{solid:!0,placeholder:"\u65B0\u5EFA\u65E5\u7A0B"})})}),(0,e.jsx)("li",{children:(0,e.jsx)(o.Form.Item,{name:"allDay",valuePropName:"checked",label:"\u5168\u5929",children:(0,e.jsx)(o.Checkbox,{})})}),(0,e.jsx)("li",{children:(0,e.jsx)(o.Form.Item,{noStyle:!0,dependencies:["allDay"],children:function(){return(0,e.jsx)(o.Form.Item,{name:"starts",label:"\u5F00\u59CB\u65F6\u95F4",children:(0,e.jsx)(o.DatePicker,{solid:!0,timePicker:!N.getFieldValue("allDay"),format:N.getFieldValue("allDay")?"YYYY-MM-DD":"YYYY-MM-DD A HH:mm"})})}})}),(0,e.jsx)("li",{children:(0,e.jsx)(o.Form.Item,{noStyle:!0,dependencies:["allDay","starts"],children:function(){return(0,e.jsx)(o.Form.Item,{name:"ends",label:"\u7ED3\u675F\u65F6\u95F4",children:(0,e.jsx)(o.DatePicker,{solid:!0,minDate:N.getFieldValue("starts"),timePicker:!N.getFieldValue("allDay"),format:N.getFieldValue("allDay")?"YYYY-MM-DD":"YYYY-MM-DD A HH:mm"})})}})}),(0,e.jsx)("li",{children:(0,e.jsx)(o.Form.Item,{name:"calendar",label:"\u65E5\u5386",children:(0,e.jsx)(re,{solid:!0})})}),(0,e.jsx)("li",{children:(0,e.jsx)(o.Form.Item,{noStyle:!0,dependencies:["allDay"],children:function(){return(0,e.jsx)(o.Form.Item,{name:"alert",label:"\u63D0\u9192",children:(0,e.jsx)(o.Select,{solid:!0,options:oe.filter(function(V){return V.scope.includes(N.getFieldValue("allDay")?"all-day":"general")})})})}})}),(0,e.jsx)("li",{className:ae()({invisible:!f}),children:(0,e.jsx)(o.Form.Item,{noStyle:!0,children:(0,e.jsx)(o.Input,{solid:!0,placeholder:"\u8BBE\u7F6E\u94FE\u63A5"})})}),(0,e.jsx)("li",{className:ae()({invisible:!f}),children:(0,e.jsx)(o.Form.Item,{noStyle:!0,children:(0,e.jsx)(Ce,{autoSize:!0,solid:!0,placeholder:"\u5907\u6CE8"})})}),(0,e.jsxs)("li",{className:"event-actions",children:[(0,e.jsx)(ie.ZP,{onClick:K,className:"toggle-more svg-icon-1",name:f?"Bootstrap/chevron-compact-up":"Bootstrap/chevron-compact-down"}),(0,e.jsx)(o.Form.Item,{noStyle:!0,dependencies:["title"],children:function(){return(0,e.jsx)(o.Button,{htmlType:"submit",disabled:!N.getFieldValue("title"),className:"event-btn-add rounded-2",children:"\u6DFB\u52A0\u65E5\u7A0B"})}})]})]})})})})}var Ne=xe,Se=c(16085),je=c(69293),De=c(75275),we=c(59197),Pe=c(96486),Ye=c(38932),ze=a.forwardRef(function(l,s){var n=l.closeDropdown,i=l.onAction,t=l.accounts,b=(0,a.useCallback)(function(h){n(),h.keyPath.startsWith("new-calendar")?i("new",h.key):h.keyPath.startsWith("new-calendar-subscription")&&i("subscribe")},[n,i]);return(0,e.jsxs)(o.Menu,{className:"menu-gray-600 menu-state-bg-light-primary fw-bold fs-7 w-150px py-2",ref:s,dropdown:!0,onSelect:b,selectedKeys:[],children:[(0,e.jsx)(o.Menu.SubMenu,{title:"\u65B0\u589E\u65E5\u5386",className:"px-2",bodyClassName:"py-2 w-150px",offset:[-6.5,0],children:t.map(function(h){return(0,e.jsx)(o.Menu.Item,{title:h.name,className:"px-2"},h.id)})},"new-calendar"),(0,e.jsx)(o.Menu.Separator,{className:"mx-1"}),(0,e.jsx)(o.Menu.Item,{className:"px-2",children:"\u65B0\u589E\u65E5\u5386\u8BA2\u9605"},"new-calendar-subscription")]})});function _e(l){var s=l.onSuccess,n=l.selectedItem,i=l.onEdit,t=(0,X.Bo)(),b=F()(t,1),h=b[0],f=(0,X.Cn)(),j=F()(f,1),P=j[0],p=(0,X.e)({fetchPolicy:"cache-and-network"}),g=p.data,A=(0,a.useMemo)(function(){return g!=null&&g.calendarAccounts?g.calendarAccounts||[]:[]},[g==null?void 0:g.calendarAccounts]),r=(0,a.useCallback)(function(){var D=R()(S()().mark(function N(m,u){var V,T;return S()().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:if(console.log(m,u),m!=="new"){W.next=7;break}return W.next=4,h({variables:{input:{account:u}}});case 4:V=W.sent,T=V.data,s(T==null?void 0:T.createCalendar);case 7:case"end":return W.stop()}},N)}));return function(N,m){return D.apply(this,arguments)}}(),[h,s]),v=(0,a.useCallback)(function(){n&&i(n.id,"modal")},[i,n]),K=(0,a.useCallback)(R()(S()().mark(function D(){var N;return S()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(n){u.next=2;break}return u.abrupt("return");case 2:return u.next=4,o.Modal.confirm({title:"\u4F60\u786E\u5B9A\u8981\u5220\u9664\u65E5\u5386\u5417\uFF1F",content:"\u60A8\u786E\u5B9A\u8981\u5220\u9664\u65E5\u5386\u201C<strong>".concat(n.name,"</strong>\u201D\u5417\uFF1F\u8FD9\u4E5F\u5C06\u5220\u9664\u6B64\u65E5\u5386\u4E0A\u7684\u6240\u6709\u4E8B\u4EF6\u3002"),okText:"\u5220 \u9664",cancelClassName:"btn btn-secondary btn-sm",okClassName:"btn btn-danger btn-sm"});case 4:if(N=u.sent,N.isConfirmed){u.next=7;break}return u.abrupt("return");case 7:return u.next=9,P({variables:{id:n.id}});case 9:s();case 10:case"end":return u.stop()}},D)})),[P,n,s]);return(0,e.jsxs)("div",{className:"calendars-footer",children:[(0,e.jsx)(o.Dropdown,{overlay:(0,e.jsx)(ze,{onAction:r,accounts:A}),placement:"bottomLeft",children:(0,e.jsx)("a",{children:(0,e.jsx)(ie.ZP,{name:"Duotune/arr087",className:"svg-icon-2"})})}),(0,e.jsx)("a",{onClick:K,className:ae()({disabled:!n}),children:(0,e.jsx)(ie.ZP,{name:"Duotune/arr089",className:"svg-icon-2"})}),(0,e.jsx)("a",{onClick:v,className:ae()({disabled:!n}),children:(0,e.jsx)(ie.ZP,{name:"Bootstrap/gear-fill",className:"svg-icon-7"})})]})}var ea=_e,Ze=c(34155),aa=a.forwardRef(function(l,s){var n=l.data,i=l.onSelect,t=l.onEdit,b=l.onCheck,h=l.editing,f=l.actived,j=l.checked,P=l.drag,p=l.indicator,g=l.onShortcut,A=(0,a.useState)(n.name),r=F()(A,2),v=r[0],K=r[1],D=(0,a.useRef)(null),N=(0,X.wg)(),m=F()(N,1),u=m[0],V=(0,a.useCallback)(function(){i(n.id)},[n.id,i]),T=(0,a.useCallback)(function(y){K(y.target.value)},[]),G=(0,a.useMemo)(function(){return(0,Pe.debounce)(function(){var y=R()(S()().mark(function k(O){return S()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,u({variables:{id:n.id,input:{name:O}}});case 2:case"end":return d.stop()}},k)}));return function(k){return y.apply(this,arguments)}}(),250)},[u,n.id]),W=(0,a.useCallback)(R()(S()().mark(function y(){return S()().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:t(),n.name!==v&&G(v);case 2:case"end":return O.stop()}},y)})),[n.name,t,G,v]),E=(0,a.useCallback)(function(y,k){if(k){var O;(O=D.current)===null||O===void 0||O.focus(),Ze.nextTick(function(){var d;(d=D.current)===null||d===void 0||d.select()})}else if(y){var x;(x=D.current)===null||x===void 0||(x=x.offsetParent)===null||x===void 0||(x=x.parentElement)===null||x===void 0||(x=x.parentElement)===null||x===void 0||x.focus()}},[]);(0,a.useEffect)(function(){h&&E(f,h)},[f,h,E]);var w=(0,a.useCallback)(function(y){y.stopPropagation(),E(!0)},[E]),J=(0,a.useCallback)(function(y){b(n.id,y.target.checked)},[n,b]),Y=(0,a.useCallback)(function(){t(n.id,"modal")},[n.id,t]),C=(0,a.useCallback)(function(){var y=R()(S()().mark(function k(O){return S()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:O==="EXIT"?(t(),K(n.name)):O==="ENTER"?(t(),n.name!==v&&G(v)):g(O);case 1:case"end":return d.stop()}},k)}));return function(k){return y.apply(this,arguments)}}(),[n.name,t,g,G,v]);return(0,e.jsxs)(De.fQ,{tag:(0,e.jsx)("li",{ref:P(s),onClick:V,onDoubleClick:Y,className:ae()("calendar-list-item",{active:f,editing:h,"indicator-drag-over-bottom":p>0,"indicator-drag-over-top":p<0})}),name:"CALENDAR_PREFERENCES",handler:C,children:[(0,e.jsx)(o.Checkbox,{style:{backgroundColor:n.color,borderColor:f?(0,ye.tG)(n.color,80):(0,ye.r5)(n.color)},checked:j,onClick:w,onChange:J,className:"calendar-check",size:"sm"}),(0,e.jsxs)("div",{className:"calendar-list-item-btn",children:[(0,e.jsx)("span",{className:"input-state-view",children:v}),(0,e.jsx)("input",{className:"input-state-edit calendar-name",ref:D,onChange:T,onBlur:W,value:v}),n._type==="SUBSCRIPTION"&&(0,e.jsx)("span",{className:"calendar-type",children:"\u8BA2\u9605"})]})]})});function na(l){var s=l.onClose,n=l.visible,i=l.data,t=(0,X.wg)(),b=F()(t,1),h=b[0],f=o.Form.useForm(),j=(0,a.useState)(i==null?void 0:i.color),P=F()(j,2),p=P[0],g=P[1],A=(0,a.useState)(!1),r=F()(A,2),v=r[0],K=r[1],D=(0,a.useRef)(null),N=(0,a.useRef)(null),m=(0,a.useMemo)(function(){return[{value:"#ff3d33",label:"\u7EA2\u8272"},{value:"#fc8328",label:"\u6A59\u8272"},{value:"#ffcc00",label:"\u9EC4\u8272"},{value:"#63da38",label:"\u7EFF\u8272"},{value:"#1badf8",label:"\u84DD\u8272"},{value:"#cc73e1",label:"\u7D2B\u8272"},{value:"#a67a63",label:"\u68D5\u8272"},{type:"separator"},{value:"other",label:"\u5176\u4ED6"}]},[]),u=(0,a.useMemo)(function(){return p&&m.some(function(E){return E.value===p})?p:"other"},[m,p]);(0,a.useEffect)(function(){var E;n&&(g(i==null?void 0:i.color),f.setFieldsValue(i),(E=D.current)===null||E===void 0||E.focus(),Ze.nextTick(function(){var w;(w=D.current)===null||w===void 0||w.select()}))},[n]),(0,je.Z)(N,function(){K(!1)});var V=(0,a.useCallback)(function(E){E==="other"?K(!0):g(E)},[g]),T=(0,a.useCallback)(R()(S()().mark(function E(){var w;return S()().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return w=f.getFieldsValue(),Y.next=3,h({variables:{id:i.id,input:z()({color:p},w)}});case 3:s();case 4:case"end":return Y.stop()}},E)})),[p,i,f,s,h]),G=(0,a.useCallback)(function(){s(),K(!1)},[s]),W=(0,a.useCallback)(function(E){var w=E.hex;g(w)},[]);return(0,e.jsx)(o.Modal,{centered:!0,visible:n,dialogClassName:"modal-dialog-concise-style modal-dialog-small w-400px",onCancel:G,onOk:T,header:!1,closable:!1,okButtonProps:{className:"btn-xs"},cancelButtonProps:{className:"btn-xs"},children:(0,e.jsxs)(o.Form,{form:f,layout:"horizontal",initialValues:z()({},i),size:"xs",children:[(0,e.jsxs)("div",{className:"d-flex flex-row flex-center",children:[(0,e.jsx)("div",{className:"d-flex flex-column-fluid",children:(0,e.jsx)(o.Form.Item,{name:"name",label:"\u540D\u79F0",children:(0,e.jsx)(o.Input,{ref:D,className:"calendar-name"})})}),(0,e.jsx)("div",{className:"d-flex flex-column-auto flex-center",children:(0,e.jsxs)("div",{className:"asany-form-item",children:[(0,e.jsx)(o.Select,{value:u,size:"xs",onChange:V,placement:"bottomCenter",itemRender:function(w,J){var Y=w.value==="other"?p||(i==null?void 0:i.color):w.value;if(!Y)return(0,e.jsx)(e.Fragment,{});var C=(0,e.jsx)("div",{style:{backgroundColor:Y,width:20,height:14,marginRight:8,border:"1px solid ".concat((0,ye.r5)(Y)),display:"inline-block"}});return J?a.cloneElement(C,{style:z()(z()({},C.props.style),{},{marginRight:5})}):(0,e.jsxs)(e.Fragment,{children:[C,w.label]})},options:m}),(0,e.jsx)(o.Popover,{visible:v,overlayClassName:"popover-content-body",content:(0,e.jsx)("div",{ref:N,children:(0,e.jsx)(Se.xS,{presetColors:m.filter(function(E){return E.value!=="other"&&E.type!=="separator"}).map(function(E){return{color:E.value,title:E.label}}),color:p,onChangeComplete:W,onChange:W,width:"220px"})}),children:(0,e.jsx)("div",{})})]})})]}),(i==null?void 0:i.type)==="SUBSCRIPTION"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"d-flex flex-row flex-center",children:(0,e.jsx)(o.Form.Item,{name:"url",label:"\u5730\u5740",children:(0,e.jsx)(o.Input,{})})}),(0,e.jsx)("div",{className:"d-flex flex-row flex-center",children:(0,e.jsx)(o.Form.Item,{name:"refresh",label:"\u5237\u65B0",children:(0,e.jsx)(o.Select,{className:"w-100px",placement:"bottomCenter",options:[{value:"NEVER",label:"\u4ECE\u4E0D"},{value:"EVERY_5_MINUTES",label:"\u6BCF5\u5206\u949F"},{value:"EVERY_15_MINUTES",label:"\u6BCF15\u5206\u949F"},{value:"EVERY_HOVER",label:"\u6BCF\u5C0F\u65F6"},{value:"EVERY_DAY",label:"\u6BCF\u5929"},{value:"EVERY_WEEK",label:"\u6BCF\u5468"}]})})})]}),(0,e.jsxs)("div",{className:"d-flex flex-row flex-center",children:[(0,e.jsx)("div",{className:"d-flex flex-column-auto flex-center",style:{width:56}}),(0,e.jsx)("div",{className:"d-flex flex-column-fluid",children:(0,e.jsx)(o.Form.Item,{name:"ignoreAlerts",valuePropName:"checked",children:(0,e.jsx)(o.Checkbox,{label:"\u5FFD\u7565\u63D0\u9192"})})})]})]})})}function ra(l){var s=l.refresh,n=l.calendarSet,i=(0,X.wg)(),t=F()(i,1),b=t[0],h=(0,X.wN)(),f=F()(h,1),j=f[0],P=(0,X.DM)(),p=F()(P,1),g=p[0],A=(0,X.V7)({fetchPolicy:"cache-and-network"}),r=A.data,v=A.refetch,K=(0,a.useState)(),D=F()(K,2),N=D[0],m=D[1],u=(0,a.useState)(),V=F()(u,2),T=V[0],G=V[1],W=(0,a.useState)((n==null?void 0:n.calendars.map(function(M){return M.id}))||[]),E=F()(W,2),w=E[0],J=E[1],Y=(0,a.useRef)(null),C=(0,a.useRef)({checkedKeys:[],calendars:[]});C.current.checkedKeys=w,C.current.activeKey=N,C.current.editing=T,C.current.calendarSet=n,C.current.calendars=(r==null?void 0:r.calendars)||[];var y=(0,a.useCallback)(function(M){M&&m(M),G(void 0),Ze.nextTick(function(){var L;(L=Y.current)===null||L===void 0||L.focus()})},[]),k=(0,a.useCallback)(function(M){M!==C.current.activeKey&&y(M)},[y]),O=(0,a.useCallback)(function(){var M=R()(S()().mark(function L(B){var te,U=arguments;return S()().wrap(function(le){for(;;)switch(le.prev=le.next){case 0:te=U.length>1&&U[1]!==void 0?U[1]:"modal",B?G({key:B,type:te}):y();case 2:case"end":return le.stop()}},L)}));return function(L){return M.apply(this,arguments)}}(),[y]),x=(0,a.useMemo)(function(){if(!(r!=null&&r.calendars))return[];var M=[],L=pe()(r.calendars),B;try{var te=function(){var H=B.value,le=z()(z()({},H),{},{key:H.id,actived:N===H.id,editing:(T==null?void 0:T.key)===H.id&&(T==null?void 0:T.type)==="inline",checked:w.some(function(se){return se===H.id}),_type:H.type});delete le.type;var ke=M.find(function(se){return se.id===H.account.id});ke?ke==null||ke.calendars.push(le):M.push(z()(z()({},H.account),{},{calendars:[le]}))};for(L.s();!(B=L.n()).done;)te()}catch(U){L.e(U)}finally{L.f()}return M.sort(function(U,H){return U.index-H.index})},[N,w,r==null?void 0:r.calendars,T==null?void 0:T.key,T==null?void 0:T.type]),d=(0,a.useCallback)(function(){var M=R()(S()().mark(function L(B){return S()().wrap(function(U){for(;;)switch(U.prev=U.next){case 0:return U.next=2,v();case 2:B&&(m(B.id),G({type:"inline",key:B.id}));case 3:case"end":return U.stop()}},L)}));return function(L){return M.apply(this,arguments)}}(),[v]),$=(0,a.useCallback)(function(){},[]),Z=(0,a.useCallback)(function(){var M=R()(S()().mark(function L(B){var te,U,H,le;return S()().wrap(function(se){for(;;)switch(se.prev=se.next){case 0:return te=(0,Ye.y)(B.node._rect,B.node,B.dragNode,B.dropPosition,B.node.index),U=B.node.pos,H=te-Number(U[U.length-1]),le=B.node.index,H===-1?le--:H===1&&le++,se.next=7,b({variables:{id:B.dragNode.key,input:{index:Math.max(le,0)+1}}});case 7:v();case 8:case"end":return se.stop()}},L)}));return function(L){return M.apply(this,arguments)}}(),[v,b]),ee=(0,a.useCallback)(function(M){var L;return((L=C.current.editing)===null||L===void 0?void 0:L.key)!==M.id},[]),Q=(0,a.useCallback)(function(M){return!isNaN(M.dropPosition)},[]),ue=(0,a.useCallback)(function(M){var L=C.current,B=L.calendars,te=L.activeKey,U=B.findIndex(function(H){return H.id===te});M==="PREVIOUS"?y(B[Math.max(U-1,0)].id):M==="NEXT"?m(B[Math.min(U+1,B.length-1)].id):M==="ENTER"?G({key:te,type:"inline"}):M==="EXIT"&&y()},[y]),q=(0,a.useCallback)(function(){y()},[y]),ve=(0,a.useCallback)(function(){var M=R()(S()().mark(function L(B,te){var U,H,le;return S()().wrap(function(se){for(;;)switch(se.prev=se.next){case 0:if(H=(U=C.current.calendarSet)===null||U===void 0?void 0:U.id,le=C.current.checkedKeys,console.log("handleChange",B,te,H),!te){se.next=9;break}return J([].concat(Re()(le),[B])),se.next=7,j({variables:{id:B,set:H}});case 7:se.next=12;break;case 9:return J(le.filter(function(ga){return ga!==B})),se.next=12,g({variables:{id:B,set:H}});case 12:s();case 13:case"end":return se.stop()}},L)}));return function(L,B){return M.apply(this,arguments)}}(),[s,j,g]);return(0,a.useEffect)(function(){J((n==null?void 0:n.calendars.map(function(M){return M.id}))||[])},[n==null?void 0:n.calendars]),(0,e.jsxs)(De.fQ,{tag:(0,e.jsx)("div",{ref:Y,className:ae()("calendar-list",{editing:!!T})}),handler:ue,name:"CALENDAR_PREFERENCES",children:[(0,e.jsxs)("div",{className:"calendar-list-notes",children:["\u201C",n==null?void 0:n.name,"\u201D\u65E5\u5386\u96C6\u7684\u65E5\u5386\u548C\u4EFB\u52A1\u5217\u8868\u3002"]}),(0,e.jsxs)("div",{className:"calendar-list-content",children:[(0,e.jsx)("div",{className:"calendars-header",children:"\u6211\u7684\u65E5\u5386"}),(0,e.jsx)("div",{className:"calendars-body scroll-y",children:x.map(function(M){return(0,e.jsxs)("div",{className:"calendars-group",children:[(0,e.jsx)("div",{className:"calendars-group-header",children:"\u6211\u7684\u65E5\u5386"}),(0,e.jsx)("div",{className:"calendars-group-body",children:(0,e.jsx)(we.ZP,{onChange:$,tag:"ul",mode:"indicator",onDrop:Z,draggable:ee,allowDrop:Q,className:"calendar-sets-list",items:M.calendars,rerender:!1,itemRender:function(B,te){var U=B.data,H=B.index;return(0,a.createElement)(aa,z()(z()({},B),{},{ref:te,actived:U.actived,editing:U.editing,checked:U.checked,onCheck:ve,key:U.id,data:U,index:H,onSelect:k,onEdit:O,onShortcut:ue}))}})})]},M.id)})}),(0,e.jsx)(ea,{onSuccess:d,selectedItem:C.current.calendars.find(function(M){return M.id===N}),onEdit:O})]}),(0,e.jsx)(na,{data:C.current.calendars.find(function(M){return M.id===N}),visible:(T==null?void 0:T.type)==="modal",onClose:q})]})}var ta=ra;function la(l){var s=l.onSuccess,n=l.selectedKey,i=(0,X.Xy)(),t=F()(i,1),b=t[0],h=(0,X.yM)(),f=F()(h,1),j=f[0],P=(0,a.useCallback)(R()(S()().mark(function g(){var A,r;return S()().wrap(function(K){for(;;)switch(K.prev=K.next){case 0:return K.next=2,b();case 2:A=K.sent,r=A.data,s(r==null?void 0:r.createCalendarSet);case 5:case"end":return K.stop()}},g)})),[b,s]),p=(0,a.useCallback)(R()(S()().mark(function g(){return S()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,j({variables:{id:n}});case 2:s();case 3:case"end":return r.stop()}},g)})),[j,n,s]);return(0,e.jsxs)("div",{className:"calendar-sets-footer",children:[(0,e.jsx)("a",{onClick:P,children:(0,e.jsx)(ie.ZP,{name:"Duotune/arr087",className:"svg-icon-2"})}),(0,e.jsx)("a",{onClick:p,children:(0,e.jsx)(ie.ZP,{name:"Duotune/arr089",className:"svg-icon-2"})})]})}var sa=la,He=c(34155),ia=a.forwardRef(function(l,s){var n=l.data,i=l.editing,t=l.actived,b=l.onSelect,h=l.onEdit,f=l.drag,j=l.indicator,P=(0,X.f4)(),p=F()(P,1),g=p[0],A=(0,a.useState)(n.name),r=F()(A,2),v=r[0],K=r[1],D=(0,a.useRef)(null),N=(0,a.useCallback)(function(){b(n.id)},[n.id,b]),m=(0,a.useCallback)(function(){h(n.id)},[n.id,h]),u=(0,a.useMemo)(function(){return(0,Pe.debounce)(function(){var W=R()(S()().mark(function E(w){return S()().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return Y.next=2,g({variables:{id:n.id,input:{name:w}}});case 2:case"end":return Y.stop()}},E)}));return function(E){return W.apply(this,arguments)}}(),250)},[g,n.id]),V=(0,a.useCallback)(R()(S()().mark(function W(){return S()().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(h(),n.name===v){w.next=4;break}return w.next=4,u(v);case 4:case"end":return w.stop()}},W)})),[n.name,h,u,v]),T=(0,a.useCallback)(function(W){K(W.target.value)},[]);(0,a.useEffect)(function(){var W;i&&((W=D.current)===null||W===void 0||W.focus(),He.nextTick(function(){var E;(E=D.current)===null||E===void 0||E.select()}))},[i]);var G=(0,a.useCallback)(function(){var W=R()(S()().mark(function E(w){return S()().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:if(w!=="EXIT"){Y.next=5;break}h(),K(n.name),Y.next=10;break;case 5:if(w!=="ENTER"){Y.next=10;break}if(h(),n.name===v){Y.next=10;break}return Y.next=10,u(v);case 10:case"end":return Y.stop()}},E)}));return function(E){return W.apply(this,arguments)}}(),[n.name,h,u,v]);return(0,e.jsx)(De.fQ,{tag:(0,e.jsx)("li",{ref:f(s),onClick:N,onDoubleClick:m,className:ae()("calendarset-item",{active:t,"indicator-drag-over-bottom":j>0,"indicator-drag-over-top":j<0})}),name:"CALENDAR_PREFERENCES",handler:G,children:(0,e.jsxs)("div",{className:"calendarset-item-btn",children:[(0,e.jsx)("span",{className:"input-state-view",children:v}),(0,e.jsx)("input",{className:"input-state-edit",ref:D,onChange:T,onBlur:V,value:v})]})})});function ua(l){var s=l.data,n=s===void 0?[]:s,i=l.refresh,t=l.onSelect,b=(0,X.f4)(),h=F()(b,1),f=h[0],j=(0,_.useModel)("calendar",function(C){return C.state.calendarSet}),P=(0,a.useRef)(null),p=(0,a.useRef)({calendarSets:[]}),g=(0,a.useState)(),A=F()(g,2),r=A[0],v=A[1],K=(0,a.useState)(),D=F()(K,2),N=D[0],m=D[1];p.current.activeKey=r,p.current.editing=N,p.current.calendarSets=n;var u=(0,a.useCallback)(function(C){C!==p.current.activeKey&&(v(C),He.nextTick(function(){var y;(y=P.current)===null||y===void 0||y.focus()}))},[]),V=(0,a.useCallback)(function(){var C=R()(S()().mark(function y(k){return S()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,i();case 2:k?(v(k.id),m(k.id)):n.length&&v(n[0].id);case 3:case"end":return x.stop()}},y)}));return function(y){return C.apply(this,arguments)}}(),[n,i]),T=(0,a.useCallback)(function(){var C=R()(S()().mark(function y(k){return S()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:m(k),k||He.nextTick(function(){var d;(d=P.current)===null||d===void 0||d.focus()});case 2:case"end":return x.stop()}},y)}));return function(y){return C.apply(this,arguments)}}(),[]);(0,a.useEffect)(function(){if(n.length&&!n.some(function(y){return y.id===r})){var C=j==="all"?n[0].id:String(j);v(C)}},[r,n,j]),(0,a.useEffect)(function(){r&&t(r)},[r,t]);var G=(0,a.useCallback)(function(C){var y=p.current,k=y.calendarSets,O=y.activeKey,x=k.findIndex(function(d){return d.id===O});C==="PREVIOUS"?v(k[Math.max(x-1,0)].id):C==="NEXT"?v(k[Math.min(x+1,k.length-1)].id):C==="ENTER"?m(r):C==="EXIT"&&m(void 0)},[r]),W=(0,a.useCallback)(function(){},[]),E=(0,a.useMemo)(function(){return n.map(function(C){return z()(z()({},C),{},{key:C.id,actived:r===C.id,editing:N===C.id})})},[r,n,N]),w=(0,a.useCallback)(function(){var C=R()(S()().mark(function y(k){var O,x,d,$;return S()().wrap(function(ee){for(;;)switch(ee.prev=ee.next){case 0:return O=(0,Ye.y)(k.node._rect,k.node,k.dragNode,k.dropPosition,k.node.index),x=k.node.pos,d=O-Number(x[x.length-1]),$=k.node.index,d===-1?$--:d===1&&$++,ee.next=7,f({variables:{id:k.dragNode.key,input:{index:Math.max($,0)+1}}});case 7:i();case 8:case"end":return ee.stop()}},y)}));return function(y){return C.apply(this,arguments)}}(),[i,f]),J=(0,a.useCallback)(function(C){return p.current.editing!==C.id},[]),Y=(0,a.useCallback)(function(C){return!isNaN(C.dropPosition)},[]);return(0,e.jsxs)(De.fQ,{tag:(0,e.jsx)("div",{ref:P,className:ae()("flex-left calendar-sets",{editing:!!N})}),name:"CALENDAR_PREFERENCES",handler:G,children:[(0,e.jsx)("div",{className:"calendar-sets-header",children:"\u65E5\u5386\u96C6"}),(0,e.jsx)("div",{className:"calendar-sets-body scroll-y",children:(0,e.jsx)(we.ZP,{onChange:W,tag:"ul",mode:"indicator",draggable:J,onDrop:w,allowDrop:Y,className:"calendar-sets-list",items:E,rerender:!1,itemRender:function(y,k){var O=y.data,x=y.index;return(0,a.createElement)(ia,z()(z()({},y),{},{ref:k,actived:O.actived,editing:O.editing,key:O.id,data:O,index:x,onSelect:u,onEdit:T}))}})}),(0,e.jsx)(sa,{onSuccess:V,selectedKey:r})]})}var ca=ua;function da(){var l,s=(0,X.f4)(),n=F()(s,1),i=n[0],t=(0,X.Dn)({fetchPolicy:"cache-and-network"}),b=t.data,h=t.refetch,f=b==null?void 0:b.calendarSets,j=o.Form.useForm(),P=(0,a.useState)(),p=F()(P,2),g=p[0],A=p[1],r=(0,a.useCallback)(function(D){A(D)},[]),v=(f||[]).find(function(D){return D.id===g});(0,a.useEffect)(function(){var D;j.setFieldsValue({defaultCalendar:v==null||(D=v.defaultCalendar)===null||D===void 0?void 0:D.id})},[v,j]);var K=(0,a.useCallback)(R()(S()().mark(function D(){var N;return S()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(N=j.getFieldsValue(),v){u.next=3;break}return u.abrupt("return");case 3:return console.log("handleChange calendarSet",N),u.next=6,i({variables:{id:v.id,input:N}});case 6:case"end":return u.stop()}},D)})),[v,j,i]);return(0,e.jsxs)("div",{className:"settings-calendars",children:[(0,e.jsx)("div",{className:"settings-calendars-notes",children:"\u901A\u8FC7\u521B\u5EFA\u591A\u4E2A\u65E5\u5386\u96C6\u5FEB\u901F\u66F4\u6539\u663E\u793A\u7684\u65E5\u5386\u548C\u4EFB\u52A1\u5217\u8868\u3002\u4F8B\u5982\uFF0C\u60A8\u53EF\u80FD\u6709\u5355\u72EC\u7684\u5BB6\u5EAD\u548C\u5DE5\u4F5C\u65E5\u5386\u96C6\u3002"}),(0,e.jsxs)("div",{className:"d-flex",children:[(0,e.jsx)(ca,{onSelect:r,data:f,refresh:h}),(0,e.jsxs)("div",{className:"settings-calendars-right flex-root",children:[(0,e.jsx)(ta,{refresh:h,calendarSet:v}),(0,e.jsx)("div",{className:"calendar-sets-settings",children:(0,e.jsx)(o.Form,{form:j,layout:"horizontal",size:"xs",initialValues:{defaultCalendar:v==null||(l=v.defaultCalendar)===null||l===void 0?void 0:l.id},onFieldsChange:K,children:(0,e.jsx)("div",{className:"d-flex flex-row flex-center",children:(0,e.jsx)(o.Form.Item,{name:"defaultCalendar",label:"\u9ED8\u8BA4\u65E5\u5386",children:(0,e.jsx)(re,{solid:!0})})})})})]})]})]})}var oa=da;function va(l){var s=l.visible,n=l.onCancel,i=(0,a.useState)(!1),t=F()(i,2),b=t[0],h=t[1],f=(0,a.useState)("calendars"),j=F()(f,2),P=j[0],p=j[1],g=(0,a.useCallback)(function(){h(!0)},[]),A=(0,a.useCallback)(function(r){p(r)},[]);return(0,e.jsx)(o.Modal,{centered:!0,maskClosable:!1,visible:s,onCancel:n,onOk:g,scroll:!1,confirmLoading:b,dialogClassName:"mw-750px calendar-preferences",header:(0,e.jsx)(o.Modal.Header,{children:(0,e.jsxs)(o.Nav,{onSelect:A,selectedKey:P,children:[(0,e.jsx)(o.Nav.Item,{className:"me-2 mb-md-0",children:(0,e.jsxs)(o.Nav.Link,{className:"btn d-flex flex-column btn-active-light-primary",children:[(0,e.jsx)(ie.ZP,{name:"Duotune/cod001",className:"svg-icon-2 me-0"}),(0,e.jsx)("span",{className:"d-flex flex-column align-items-start pt-2",children:(0,e.jsx)("span",{className:"fs-7",children:"\u5E38\u89C4"})})]})},"general"),(0,e.jsx)(o.Nav.Item,{className:"me-2 mb-md-0",children:(0,e.jsxs)(o.Nav.Link,{className:"btn d-flex flex-column btn-active-light-success",children:[(0,e.jsx)(ie.ZP,{name:"Duotune/gen014",className:"svg-icon-2  me-0"}),(0,e.jsx)("span",{className:"d-flex flex-column align-items-start pt-2",children:(0,e.jsx)("span",{className:"fs-7",children:"\u65E5\u5386"})})]})},"calendars"),(0,e.jsx)(o.Nav.Item,{className:"me-2 mb-md-0",children:(0,e.jsxs)(o.Nav.Link,{className:"btn d-flex flex-column btn-active-light-info",children:[(0,e.jsx)(ie.ZP,{name:"Duotune/fil020",className:"svg-icon-2  me-0"}),(0,e.jsx)("span",{className:"d-flex flex-column align-items-start pt-2",children:(0,e.jsx)("span",{className:"fs-7",children:"\u5929\u6C14"})})]})},"weather")]})}),footer:!1,children:(0,e.jsx)(oa,{})})}var fa=va,ma={months:["1 \u6708","2 \u6708","3 \u6708","4 \u6708","5 \u6708","6 \u6708","7 \u6708","8 \u6708","9 \u6708","10 \u6708","11 \u6708","12 \u6708"],weekDays:[{name:"\u661F\u671F\u5929",short:"\u5468\u65E5",isWeekend:!0},{name:"\u661F\u671F\u4E00",short:"\u5468\u4E00"},{name:"\u661F\u671F\u4E8C",short:"\u5468\u4E8C"},{name:"\u661F\u671F\u4E09",short:"\u5468\u4E09"},{name:"\u661F\u671F\u56DB",short:"\u5468\u56DB"},{name:"\u661F\u671F\u4E94",short:"\u5468\u4E94"},{name:"\u661F\u671F\u516D",short:"\u5468\u516D",isWeekend:!0}],weekStartingIndex:0,getToday:function(s){return s},toNativeDate:function(s){return new Date(s.year,s.month-1,s.day)},getMonthLength:function(s){return new Date(s.year,s.month,0).getDate()},transformDigit:function(s){return s},nextMonth:"Next Month",previousMonth:"Previous Month",openMonthSelector:"Open Month Selector",openYearSelector:"Open Year Selector",closeMonthSelector:"Close Month Selector",closeYearSelector:"Close Year Selector",defaultPlaceholder:"Select...",from:"from",to:"to",digitSeparator:",",yearLetterSkip:0,isRtl:!1};function ha(l,s){for(var n=0;n<7;n++){var i=l.clone().add(n,"days"),t=i.format("YYYY-MM-DD");s.has(t)?s.get(t).isWeather=!0:s.set(t,{key:t,date:i,events:[],isToDay:i.isSame(l,"date"),isWeather:!1})}}function Je(l,s){var n=l.format("YYYY-MM-DD"),i=s.find(function(t){return t.isSelected});if(i){if(i.key===n)return s;i.isTemporary?s.splice(s.findIndex(function(t){return t.isTemporary}),1):s.find(function(t){return t.isSelected}).isSelected=!1}if(s.some(function(t){return t.key===n}))s.find(function(t){return t.key===n}).isSelected=!0;else return s.push({key:n,date:l,events:[],isToDay:l.isSame(ne()(),"date"),isWeather:!1,isSelected:!0,isTemporary:!0}),s.sort(function(t,b){return t.date.toDate().getTime()-b.date.toDate().getTime()});return s}function Ge(l,s){var n=ne()(),i=new Map,t=pe()(l),b;try{for(t.s();!(b=t.n()).done;){var h=b.value,f=pe()(h.dates),j;try{for(f.s();!(j=f.n()).done;){var P=j.value,p=ne()(P),g=p.format("YYYY-MM-DD");if(i.has(g)){var A;(A=i.get(g))===null||A===void 0||A.events.push(h)}else i.set(g,{key:g,date:p,isToDay:p.isSame(n,"date"),events:[h],isWeather:!1})}}catch(r){f.e(r)}finally{f.f()}}}catch(r){t.e(r)}finally{t.f()}return ha(n,i),Je(ne()(s),Array.from(i.values()).sort(function(r,v){return r.date.toDate().getTime()-v.date.toDate().getTime()}))}var qe=[];function Ca(){var l=(0,X.Dn)(),s=l.data,n=(0,_.useModel)("calendar",function(d){var $=d.state;return $.calendarSet}),i=(0,_.useModel)("calendar",function(d){return d.state.state==="new"}),t=(0,_.useModel)("calendar",function(d){var $=d.state;return $.selectedDay||new Date}),b=(0,_.useModel)("calendar",function(d){return d.setSelectedDay}),h=(0,_.useModel)("calendar",function(d){return d.changeState}),f=(0,_.useModel)("calendar",function(d){return d.state.fullCalendar}),j=(0,a.useState)(!1),P=F()(j,2),p=P[0],g=P[1],A=(0,a.useRef)(null),r=(0,a.useRef)({selectedDay:t,eventsWithDays:[]}),v=(0,a.useReducer)(function(d){return d+1},0),K=F()(v,2),D=K[1];r.current.calendarSet=n;var N=(0,X.Vk)({fetchPolicy:"cache-and-network"}),m=F()(N,2),u=m[0],V=m[1].refetch,T=(0,a.useCallback)(function(){g(!1)},[]),G=(0,a.useCallback)(function(d){d==="manage-calendars"&&g(!0)},[]),W=(0,a.useCallback)(function(d){d&&b(new Date(d.year,d.month-1,d.day))},[b]),E=(0,a.useCallback)(function(d){return function(){b(r.current.selectedDay=d)}},[b]),w=(0,a.useCallback)(function(d){if(A.current){var $=Array.from(document.getElementsByClassName("event-list-item")),Z=$.find(function(ue){return ne()(ue.dataset.date).isSame(ne()(d),"date")});if(Z){var ee=Z.getBoundingClientRect().top+A.current.scrollTop,Q=A.current.getBoundingClientRect();A.current.scrollTo({top:ee-Q.top-6.5}),r.current.skipNextScroll=!0,setTimeout(function(){clearTimeout(r.current.timer)},120),D()}}},[]);(0,a.useEffect)(function(){u({variables:{date:t,days:60,calendarSet:n==="all"?void 0:n}}).then(function(d){var $=d.data;r.current.eventsWithDays=Ge(($==null?void 0:$.events)||[],r.current.selectedDay),r.current.toDayOrNextEvent=r.current.eventsWithDays.find(function(Z){return Z.key===ne()(r.current.selectedDay).format("YYYY-MM-DD")}),r.current.skipNextScroll=!0,D(),w(t)})},[n,u]);var J=(0,a.useCallback)(function(){var d=R()(S()().mark(function $(Z){var ee,Q;return S()().wrap(function(q){for(;;)switch(q.prev=q.next){case 0:return r.current.selectedDay=Z,r.current.eventsWithDays=Je(ne()(Z),r.current.eventsWithDays),r.current.toDayOrNextEvent=r.current.eventsWithDays.find(function(ve){return ve.key===ne()(Z).format("YYYY-MM-DD")}),r.current.skipNextScroll=!0,D(),q.next=7,(0,Ee._v)(60);case 7:return w(Z),q.next=10,(0,Ee._v)(60);case 10:if(r.current.selectedDay===Z){q.next=12;break}return q.abrupt("return");case 12:return q.next=14,V({date:Z,days:60,calendarSet:r.current.calendarSet==="all"?void 0:r.current.calendarSet});case 14:return ee=q.sent,Q=ee.data,r.current.eventsWithDays=Ge(Q.events,r.current.selectedDay),r.current.skipNextScroll=!0,D(),q.next=21,(0,Ee._v)(60);case 21:r.current.selectedDay===Z&&w(Z);case 22:case"end":return q.stop()}},$)}));return function($){return d.apply(this,arguments)}}(),[]);(0,a.useEffect)(function(){r.current.selectedDay&&ne()(r.current.selectedDay).isSame(t,"date")||r.current.eventsWithDays.length&&J(t)},[t]);var Y=(0,a.useCallback)(function(){if(A.current){if(r.current.skipNextScroll){r.current.skipNextScroll=!1;return}var d=Array.from(document.getElementsByClassName("event-list-item")),$=A.current.getBoundingClientRect(),Z=d.find(function(Q){if(Q.dataset.temp==="true")return!1;var ue=Q.getBoundingClientRect(),q=Q.getElementsByClassName("event-list")[0].getBoundingClientRect().height,ve=ue.top-$.top+q+16;return ve>0&&ve<ue.height});if(Z){var ee=r.current.eventsWithDays.find(function(Q){return Q.key===Z.dataset.date});ee&&(r.current.eventsWithDays=r.current.eventsWithDays.filter(function(Q){return!Q.isTemporary}),r.current.eventsWithDays.forEach(function(Q){Q.isSelected=!1}),ee.isSelected=!0,r.current.skipNextScroll=!0,r.current.toDayOrNextEvent=ee,D(),clearTimeout(r.current.timer),r.current.timer=setTimeout(R()(S()().mark(function Q(){var ue,q;return S()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return M.next=2,V({date:ee.date.toDate(),days:60,calendarSet:r.current.calendarSet==="all"?void 0:r.current.calendarSet});case 2:ue=M.sent,q=ue.data,r.current.eventsWithDays=Ge(q.events,r.current.selectedDay),r.current.skipNextScroll=!0,D();case 7:case"end":return M.stop()}},Q)})),1e3),b(r.current.selectedDay=ne()(Z.dataset.date).toDate()))}}},[b]),C=(0,a.useCallback)(function(d){var $=document.getElementsByClassName("main-calendar")[0];$==null||$.focus(),h("none"),console.log("fullCalendar",f==null?void 0:f.getApi()),f==null||f.getApi().refetchEvents(),J(new Date(d.datetime.starts))},[f,h,J]),y=r.current,k=y.toDayOrNextEvent,O=y.eventsWithDays,x=O.find(function(d){return d.key===(k==null?void 0:k.key)});return(0,e.jsxs)(ce.GP,{width:325,collapsible:!1,resizeable:!0,className:ae()("calendar-sidebar-bg",{"state-new-event":i}),children:[(0,e.jsxs)("div",{className:"calendar-sidebar",children:[(0,e.jsx)(Ie,{}),(0,e.jsx)(Ne,{visible:i,onSuccess:C,calendarSets:(s==null?void 0:s.calendarSets)||qe}),(0,e.jsx)(Be.f,{locale:ma,value:{year:t.getFullYear(),month:t.getMonth()+1,day:t.getDate()},onChange:W,shouldHighlightWeekends:!0,colorPrimary:"#04c8c8"}),(0,e.jsxs)("div",{className:"calendar-day-list",children:[(0,e.jsxs)("div",{className:"event-list-header",children:[(0,e.jsxs)("h6",{children:[x!=null&&x.isToDay?"\u4ECA\u5929":(x==null?void 0:x.date.format("dddd"))||"\u4ECA\u5929",(0,e.jsx)("span",{className:"day-subtitle text-muted",children:(x==null?void 0:x.date.format("YYYY-MM-DD"))||ne()().format("YYYY-MM-DD")})]}),!(x!=null&&x.events.length)&&(x==null?void 0:x.isSelected)&&(0,e.jsx)("div",{className:"onday-no-events text-muted",children:"\u6CA1\u6709\u4E8B\u4EF6"})]}),(0,e.jsx)("div",{ref:A,onScrollCapture:Y,className:"event-list-body hover-scroll-y",children:O.map(function(d){var $=d.key,Z=d.date,ee=d.isToDay,Q=d.events,ue=d.isSelected,q=d.isTemporary;return(0,e.jsxs)("div",{className:"event-list-item","data-temp":q,"data-date":$,children:[(0,e.jsxs)("h6",{onClick:E(Z.toDate()),children:[ee?"\u4ECA\u5929":Z.format("dddd"),(0,e.jsx)("span",{className:"day-subtitle text-muted",children:Z.format("YYYY-MM-DD")})]}),(0,e.jsx)("div",{className:ae()("event-list",fe()(fe()({},"is-empty",!Q.length),"onday-no-events",!Q.length&&ue)),children:Q.map(function(ve){return(0,e.jsx)(o.Popover,{content:(0,e.jsx)("div",{children:"12312313"}),children:(0,e.jsx)("span",{style:{backgroundColor:ve.color},className:"event-day",children:ve.title},ve.id)},ve.id)})})]},$)})})]}),(0,e.jsx)(Ve,{calendarSets:(s==null?void 0:s.calendarSets)||qe,onAction:G})]}),(0,e.jsx)(fa,{visible:p,onCancel:T})]})}var pa=a.memo(Ca),xa=pa},38932:function(Qe,be,c){c.d(be,{f:function(){return Me},y:function(){return S}});var Ae=c(19755),fe=c.n(Ae);function Me(me){var R=parseInt(fe()(me).data("click-number")||0)+1;if(R===2)return clearTimeout(fe()(me).data("timer-reset")),fe()(me).data("click-number",0),!0;var he=setTimeout(function(){fe()(me).data("click-number",0),clearTimeout(he)},500);return fe()(me).data("click-number",R).data("timer-reset",he),!1}function S(me,R,he,F,ge){var pe=me.height/3/2,a=F<pe&&F>-pe&&(he==null?void 0:he.parentKey)!==R.id;return a?ge:F>0?ge+1:F<0?ge-1:NaN}}}]);

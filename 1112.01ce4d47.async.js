"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[1112],{41084:function(Ke,N,e){e.r(N);var ne=e(52677),te=e.n(ne),re=e(64599),se=e.n(re),le=e(13769),ue=e.n(le),oe=e(15009),p=e.n(oe),ie=e(99289),S=e.n(ie),de=e(97857),D=e.n(de),me=e(5574),w=e.n(me),r=e(67294),U=e(12845),ce=e(93967),Ee=e.n(ce),be=e(30381),H=e.n(be),ve=e(73588),s=e(2721),he=e(75981),V=e(12708),fe=e(70005),ye=e(25136),O=e(80596),G=e(42646),Le=e(34545),a=e(85893),Pe=["meta","category","publishedAt","content"];function pe(){var B,De=(0,U.useParams)(),I=De.cid,Q=(0,U.useOutletContext)(),v=Q.categories,A=Q.baseUrl,Z=(0,U.useNavigate)(),Oe=(0,G.WP)({variables:{id:I},fetchPolicy:"network-only"}),K=Oe.data,i=K==null?void 0:K.category,l=(0,r.useRef)({action:"draft",publishedAt:H()()}),Ae=(0,r.useReducer)(function(_){return _+1},0),Me=w()(Ae,2),z=Me[1],J=(0,r.useRef)(null),u=s.Form.useForm(),ge=(0,r.useMemo)(function(){return!v||!v.length?[]:(0,V.G_)(v.map(function(_){return D()(D()({},_),{},{value:_.id,title:_.name})}),{idKey:"id",childrenKey:"children",pidKey:"parent.id",sort:function(d,m){return d.index-m.index}})},[v]),Ce=(0,G.uw)(),X=w()(Ce,2),Y=X[0],L=X[1].loading,M=i==null||(B=i.storeTemplate)===null||B===void 0?void 0:B.contentType,je=(0,r.useCallback)(function(){var _=S()(p()().mark(function d(m){var c,n,E;return p()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=v.find(function(f){return f.id===m}),(n==null||(c=n.storeTemplate)===null||c===void 0?void 0:c.contentType)===M){t.next=8;break}return t.next=4,s.Modal.confirm({title:"\u4FEE\u6539\u680F\u76EE\u786E\u8BA4",content:"\u76EE\u6807\u680F\u76EE\u7684\u6B63\u6587\u7C7B\u578B\u4E0D\u4E00\u81F4\uFF0C\u662F\u5426\u786E\u5B9A\u5207\u6362 \uFF1F"});case 4:if(E=t.sent,E.isConfirmed){t.next=8;break}return u.setFieldValue(["category","id"],i==null?void 0:i.id),t.abrupt("return");case 8:Z("".concat(A,"/categories/").concat(n==null?void 0:n.id,"/articles/new"),{replace:!0});case 9:case"end":return t.stop()}},d)}));return function(d){return _.apply(this,arguments)}}(),[v,i]),g=(0,r.useCallback)(function(){var _=S()(p()().mark(function d(m){var c,n,E,C,t,f,W,ee,x,j,F,y,T,k,R,P,ae,b,h,_e,$;return p()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return l.current.action=m,o.next=3,(c=J.current)===null||c===void 0?void 0:c.uploadAll();case 3:return o.next=5,u.validateFields();case 5:for(n=o.sent,E=n.meta,C=n.category,t=n.publishedAt,f=n.content,W=ue()(n,Pe),ee={seo_title:"single_line_text_field",seo_description:"multi_line_text_field",seo_keywords:"list.single_line_text_field"},x=[],j=0,F=Object.keys(E);j<F.length;j++)for(y=F[j],T=0,k=Object.keys(E[y]);T<k.length;T++)R=k[T],x.push({namespace:y,key:R,value:E[y][R],type:ee[y+"_"+R]});if(M===he.zc.Image){P=se()(f.images);try{for(P.s();!(ae=P.n()).done;)b=ae.value,delete b.__typename,delete b.id,b.image&&te()(b.image)==="object"&&(b.image=b.image.id)}catch(Ie){P.e(Ie)}finally{P.f()}}return h=D()(D()({},W),{},{metafields:x,content:f,category:C.id}),m==="publish"?h.status="PUBLISHED":m==="schedule"?(h.status="SCHEDULED",h.publishedAt=t):h.status="DRAFT",_e=Y({variables:{input:h}}),o.next=20,s.Toast.promise((0,V.gw)(_e,350),{pending:"\u63D0\u4EA4\u4E2D...",success:"\u201C".concat(W.title,"\u201D \u4FEE\u6539\u6210\u529F"),error:"\u63D0\u4EA4\u51FA\u9519"},{duration:2e3,placement:"top-center"});case 20:$=o.sent,Z("".concat(A,"/categories/").concat(C.id,"/articles/").concat($.data.article.id),{replace:!0}),console.log("submit result set",$);case 23:case"end":return o.stop()}},d)}));return function(d){return _.apply(this,arguments)}}(),[A,Y,u,M]),Te=(0,r.useCallback)(function(){g("draft")},[g]),Re=(0,r.useCallback)(function(_){g(_)},[g]),q=l.current.publishedAt,Ue=(0,r.useCallback)(function(_){l.current.publishedAt=_,u.setFieldsValue({publishedAt:_}),z()},[u]),Be=(0,r.useCallback)(function(){l.current.publishedAt=H()(),z(),u.setFieldsValue({publishedAt:l.current.publishedAt})},[u]);return(0,a.jsx)(ve.vs,{header:{title:"\u65B0\u589E\u6587\u7AE0"},breadcrumb:(0,a.jsx)(fe.Z,{categoryId:I,append:(0,a.jsx)(s.Breadcrumb.Item,{className:"text-dark",children:"\u65B0\u589E\u6587\u7AE0"})}),children:(0,a.jsxs)(s.Form,{form:u,initialValues:{status:"DRAFT",publishedAt:q,category:{id:I}},className:"form d-flex flex-column flex-lg-row",children:[(0,a.jsxs)("div",{className:"d-flex flex-column flex-row-fluid gap-7 gap-lg-10  me-lg-10",children:[(0,a.jsxs)(s.Tabs,{type:"line-tabs",defaultActiveKey:"general",contentContainer:!1,className:"border-0 fs-4 fw-bold mb-n2 nav-line-tabs-2x",children:[(0,a.jsx)(s.Tabs.TabPane,{tab:"\u57FA\u672C\u4FE1\u606F",forceRender:!0,children:(0,a.jsx)(O.LQ,{contentType:M,queueUpload:J})},"general"),(0,a.jsx)(s.Tabs.TabPane,{tab:"\u9AD8\u7EA7\u8BBE\u7F6E",forceRender:!0,children:(0,a.jsx)(O.aE,{})},"advanced"),(0,a.jsx)(s.Tabs.TabPane,{tab:"\u5143\u6570\u636E",forceRender:!0,children:(0,a.jsx)(O.SF,{})},"meta")]}),(0,a.jsxs)("div",{className:Ee()("d-flex bg-body-color p-5 mx-4 tw-rounded-2xl justify-content-end"),children:[(0,a.jsx)(s.Button,{variant:"light",loading:l.current.action==="draft"&&L,onClick:Te,className:"me-5",children:!l.current.action&&L?"\u4FDD\u5B58\u4E2D...":"\u4FDD\u5B58\u8349\u7A3F"}),(0,a.jsx)(O.H5,{onPublish:Re,publishedAt:q,submitting:l.current.action!=="draft"&&L,setPublishedAt:Ue,onCancel:Be})]})]}),(0,a.jsx)(ye.Z,{baseUrl:A,categoryTreeData:ge,onChangeCategory:je})]})})}N.default=pe}}]);

(self.webpackChunkasany_admin=self.webpackChunkasany_admin||[]).push([[1521],{14843:function(le,K,t){"use strict";t.d(K,{u7:function(){return a.u7},pM:function(){return a.pM},dP:function(){return a.dP},zR:function(){return a.zR},bo:function(){return a.bo},CF:function(){return a.CF},hT:function(){return a.hT},X4:function(){return a.X4},rq:function(){return a.rq},qb:function(){return a.qb},a$:function(){return a.a$},mp:function(){return a.mp},WE:function(){return a.WE},HC:function(){return a.HC},cT:function(){return U},Hr:function(){return n},r3:function(){return a.r3},bI:function(){return a.bI},A6:function(){return a.A6},LV:function(){return a.LV}});var a=t(8305),N=t(39428),i=t(3182),y=t(2824),o=t(67294),S=t(38671),I=t(85893);function W(e,J){var R,z=(0,a.rz)({variables:{id:e==null?void 0:e.id},refetchQueries:[{query:a.dP,variables:{id:e==null||(R=e.application)===null||R===void 0?void 0:R.id}}]}),T=(0,y.Z)(z,1),P=T[0],Y=(0,o.useCallback)((0,i.Z)((0,N.Z)().mark(function O(){var V;return(0,N.Z)().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return k.next=2,S.u_.confirm({title:"\u4F60\u786E\u5B9A\u8981\u5220\u9664\u8BE5\u8DEF\u7531\u5417\uFF1F",content:(0,I.jsxs)(I.Fragment,{children:["\u60A8\u5373\u5C06\u5220\u9664\u201C",(0,I.jsx)("strong",{children:e.name}),"\u201D\u3002\u5220\u9664\u64CD\u4F5C\u4E0D\u53EF\u9006\u8F6C\uFF0C\u8BF7\u8C28\u614E\u64CD\u4F5C\uFF0C\u60A8\u786E\u5B9A\u5220\u9664\u5417\uFF1F"]}),okText:"\u5220 \u9664",okClassName:"btn-danger"});case 2:if(V=k.sent,!V.isConfirmed){k.next=8;break}return k.next=6,P();case 6:S.FN.success("\u5220\u9664\u6210\u529F"),J(e);case 8:case"end":return k.stop()}},O)})),[P,e,J]);return[Y]}var U=W,Q=t(11849),M=t(25496);function _(e,J){var R,z,T,P=S.l0.useForm(),Y=(0,o.useState)(!1),O=(0,y.Z)(Y,2),V=O[0],w=O[1],k=(0,a.X4)({fetchPolicy:"no-cache",refetchQueries:[{query:a.dP,variables:{id:e==null||(R=e.application)===null||R===void 0?void 0:R.id}}]}),ne=(0,y.Z)(k,1),ee=ne[0],ue=(0,a.LV)({fetchPolicy:"no-cache",refetchQueries:[{query:a.dP,variables:{id:e==null||(z=e.application)===null||z===void 0?void 0:z.id}}]}),u=(0,y.Z)(ue,1),l=u[0],v=(0,o.useMemo)(function(){return e!=null&&e.id?(0,i.Z)((0,N.Z)().mark(function h(){var b,x,F;return(0,N.Z)().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return w(!0),r.prev=1,r.next=4,P.validateFields();case 4:return b=r.sent,r.next=7,S.FN.promise((0,M.gw)(l({variables:{id:e.id,input:(0,Q.Z)({},b)}}),350),{pending:"\u63D0\u4EA4\u4E2D...",success:{render:function(){return(0,I.jsxs)(I.Fragment,{children:["\u8DEF\u7531 ",(0,I.jsx)("strong",{children:b.name})," \u4FDD\u5B58\u6210\u529F"]})}},error:"\u63D0\u4EA4\u51FA\u9519"},{duration:2e3,placement:"top-center"});case 7:x=r.sent,F=x.data,J(F.updateRoute),w(!1),r.next=16;break;case 13:r.prev=13,r.t0=r.catch(1),w(!1);case 16:case"end":return r.stop()}},h,null,[[1,13]])})):(0,i.Z)((0,N.Z)().mark(function h(){var b,x,F;return(0,N.Z)().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return w(!0),r.prev=1,r.next=4,P.validateFields();case 4:return b=r.sent,r.next=7,S.FN.promise((0,M.gw)(ee({variables:{input:(0,Q.Z)((0,Q.Z)({},b),{},{application:e.application.id})}}),350),{pending:"\u63D0\u4EA4\u4E2D...",success:{render:function(){return(0,I.jsxs)(I.Fragment,{children:["\u8DEF\u7531 ",(0,I.jsx)("strong",{children:b.name})," \u65B0\u589E\u6210\u529F"]})}},error:"\u63D0\u4EA4\u51FA\u9519"},{duration:2e3,placement:"top-center"});case 7:x=r.sent,F=x.data,J(F.createRoute),w(!1),r.next=16;break;case 13:r.prev=13,r.t0=r.catch(1),w(!1);case 16:case"end":return r.stop()}},h,null,[[1,13]])}))},[ee,e==null||(T=e.application)===null||T===void 0?void 0:T.id,e==null?void 0:e.id,P,J,l]);return[v,{form:P,submitting:V}]}var n=_},81521:function(le,K,t){"use strict";t.r(K),t.d(K,{default:function(){return ue}});var a=t(39428),N=t(3182),i=t(11849),y=t(2824),o=t(67294),S=t(28865),I=t(86582),W=t(93224),U=t(91220),Q=t(29102),M=t(14843),_=t(8305),n=t(38671),e=t(85893);function J(u,l){var v,h=(0,_.rq)({variables:{id:u==null?void 0:u.id},refetchQueries:[{query:_.pM,variables:{id:u==null||(v=u.application)===null||v===void 0?void 0:v.id}}]}),b=(0,y.Z)(h,1),x=b[0],F=(0,o.useCallback)((0,N.Z)((0,a.Z)().mark(function Z(){var r;return(0,a.Z)().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return D.next=2,n.u_.confirm({title:"\u4F60\u786E\u5B9A\u8981\u5220\u9664\u8BE5\u83DC\u5355\u5417\uFF1F",content:(0,e.jsxs)(e.Fragment,{children:["\u60A8\u5373\u5C06\u5220\u9664\u201C",(0,e.jsx)("strong",{children:u.name}),"\u201D\u3002\u5220\u9664\u64CD\u4F5C\u4E0D\u53EF\u9006\u8F6C\uFF0C\u8BF7\u8C28\u614E\u64CD\u4F5C\uFF0C\u60A8\u786E\u5B9A\u5220\u9664\u5417\uFF1F"]}),okText:"\u5220 \u9664",okClassName:"btn-danger"});case 2:if(r=D.sent,!r.isConfirmed){D.next=8;break}return D.next=6,x();case 6:n.FN.success("\u5220\u9664\u6210\u529F"),l(u);case 8:case"end":return D.stop()}},Z)})),[x,u,l]);return[F]}var R=J,z=t(2970),T=t(25496),P=["children","_rect","pos","parent"];function Y(u){var l,v=u.form,h=u.appId,b=u.libraryId,x=(0,M.a$)({variables:{id:h}}),F=x.data,Z=(0,M.qb)({variables:{id:b}}),r=Z.data,f=(F==null||(l=F.app)===null||l===void 0?void 0:l.menus)||[],D=(0,o.useMemo)(function(){return(0,T.$H)((0,T.G_)((f||[]).map(function(m){return(0,i.Z)({},m)}),{pidKey:"parent.id",sort:function(j,g){return j.index-g.index},converter:function(j,g){var $=g.parent;return(0,i.Z)((0,i.Z)({},j),{},{key:j.id,menuType:j.type,title:$?$.title+"/"+j.name:j.name})}}))},[f]),B=r==null?void 0:r.library,X=(0,o.useMemo)(function(){var m=[],j=(0,U.Z)((B==null?void 0:B.components)||[]),g;try{for(j.s();!(g=j.n()).done;){var $=g.value,C=(0,U.Z)($.tags),E;try{for(C.s();!(E=C.n()).done;){var L=E.value;(0,z.v)(L,m,$)}}catch(A){C.e(A)}finally{C.f()}}}catch(A){j.e(A)}finally{j.f()}return m},[B]);return(0,o.useEffect)(function(){var m=u.data,j=m.children,g=m._rect,$=m.pos,C=m.parent,E=(0,W.Z)(m,P);u.data.id||v.resetFields(),v.setFieldsValue((0,i.Z)((0,i.Z)({},E),{},{parentMenu:C?C.id:void 0}))},[v,u.data]),(0,e.jsxs)(n.l0,{form:v,children:[(0,e.jsx)(n.X2,{children:(0,e.jsx)(n.JX,{span:6,children:(0,e.jsx)(n.l0.Item,{name:"name",className:"d-flex flex-column mb-7",required:!0,label:"\u540D\u79F0",rules:[{required:!0,message:"\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A"}],children:(0,e.jsx)(n.II,{solid:!0})})})}),(0,e.jsxs)(n.X2,{children:[(0,e.jsx)(n.JX,{span:6,children:(0,e.jsx)(n.l0.Item,{name:"parentMenu",className:"d-flex flex-column mb-7",label:"\u4E0A\u7EA7\u83DC\u5355",children:(0,e.jsx)(n.ub,{solid:!0,options:[{value:"",label:"\u6839\u8282\u70B9"}].concat((0,I.Z)(D.map(function(m){return{value:m.id,label:m.title}})))})})}),(0,e.jsx)(n.JX,{span:6,children:(0,e.jsx)(n.l0.Item,{name:"type",className:"d-flex flex-column mb-7",label:"\u7C7B\u578B",children:(0,e.jsx)(n.Y8.Group,{solid:!0,options:[{value:"MENU",label:"\u83DC\u5355"},{value:"URL",label:"\u94FE\u63A5\u5730\u5740"},{value:"SECTION",label:"\u7AE0\u8282"}]})})})]}),(0,e.jsxs)(n.X2,{children:[(0,e.jsx)(n.JX,{span:6,children:(0,e.jsx)(n.l0.Item,{name:"icon",className:"d-flex flex-column mb-7",label:"\u56FE\u6807",children:(0,e.jsx)(n.II,{})})}),(0,e.jsx)(n.JX,{span:6,children:(0,e.jsx)(n.l0.Item,{className:"d-flex flex-column mb-7",name:"index",label:"\u6392\u5E8F\u4F4D\u7F6E",children:(0,e.jsx)(n.II,{solid:!0})})})]}),(0,e.jsxs)(n.X2,{children:[(0,e.jsx)(n.JX,{span:4,children:(0,e.jsx)(n.l0.Item,{valuePropName:"checked",className:"d-flex flex-column mb-7",name:"hideInMenu",children:(0,e.jsx)(n.rs,{solid:!0,label:"\u4E0D\u5728\u83DC\u5355\u4E2D\u663E\u793A"})})}),(0,e.jsx)(n.JX,{span:4,children:(0,e.jsx)(n.l0.Item,{valuePropName:"checked",className:"d-flex flex-column mb-7",name:"hideChildrenInMenu",children:(0,e.jsx)(n.rs,{solid:!0,label:"\u4E0D\u663E\u793A\u5B50\u83DC\u5355"})})}),(0,e.jsx)(n.JX,{span:4,children:(0,e.jsx)(n.l0.Item,{valuePropName:"checked",className:"d-flex flex-column mb-7",name:"hideInBreadcrumb",children:(0,e.jsx)(n.rs,{solid:!0,label:"\u4E0D\u5728\u9762\u5305\u5C51\u4E2D\u663E\u793A"})})})]}),(0,e.jsx)(n.X2,{children:(0,e.jsx)(n.l0.Item,{className:"d-flex flex-column mb-7",name:"authority",label:"\u8BBF\u95EE\u6743\u9650",children:(0,e.jsx)(n.II,{solid:!0})})}),(0,e.jsx)(n.l0.Item,{dependencies:["type"],noStyle:!0,children:function(){return(0,e.jsxs)(n.X2,{children:[" ",(0,e.jsx)(n.l0.Item,{className:"d-flex flex-column mb-7",name:"path",label:"\u94FE\u63A5",children:(0,e.jsx)(n.II,{solid:!0})})]})}}),(0,e.jsx)(n.l0.Item,{dependencies:["type","parentMenu"],noStyle:!0,children:function(){return v.getFieldValue("type")=="SECTION"||!!v.getFieldValue("parentMenu")?(0,e.jsx)(e.Fragment,{}):(0,e.jsx)(n.X2,{children:(0,e.jsx)(n.l0.Item,{className:"d-flex flex-column mb-7",name:"component",label:"\u7EC4\u4EF6",children:(0,e.jsx)(Q.zm,{treeDate:X,placeholder:"\u9009\u62E9\u7EC4\u4EF6\u6A21\u7248"})})})}})]})}function O(u,l){var v,h,b,x=n.l0.useForm(),F=(0,o.useState)(!1),Z=(0,y.Z)(F,2),r=Z[0],f=Z[1],D=(0,M.hT)({fetchPolicy:"no-cache",refetchQueries:[{query:M.pM,variables:{id:u==null||(v=u.application)===null||v===void 0?void 0:v.id}}]}),B=(0,y.Z)(D,1),X=B[0],m=(0,M.A6)({fetchPolicy:"no-cache",refetchQueries:[{query:M.pM,variables:{id:u==null||(h=u.application)===null||h===void 0?void 0:h.id}}]}),j=(0,y.Z)(m,1),g=j[0],$=(0,o.useMemo)(function(){return u!=null&&u.id?(0,N.Z)((0,a.Z)().mark(function C(){var E,L,A;return(0,a.Z)().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return f(!0),s.prev=1,s.next=4,x.validateFields();case 4:return E=s.sent,s.next=7,n.FN.promise((0,T.gw)(g({variables:{id:u.id,input:(0,i.Z)({},E)}}),350),{pending:"\u63D0\u4EA4\u4E2D...",success:{render:function(){return(0,e.jsxs)(e.Fragment,{children:["\u83DC\u5355 ",(0,e.jsx)("strong",{children:E.name})," \u4FDD\u5B58\u6210\u529F"]})}},error:"\u63D0\u4EA4\u51FA\u9519"},{duration:2e3,placement:"top-center"});case 7:L=s.sent,A=L.data,l(A.updateMenu),f(!1),s.next=16;break;case 13:s.prev=13,s.t0=s.catch(1),f(!1);case 16:case"end":return s.stop()}},C,null,[[1,13]])})):(0,N.Z)((0,a.Z)().mark(function C(){var E,L,A;return(0,a.Z)().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return f(!0),s.prev=1,s.next=4,x.validateFields();case 4:return E=s.sent,s.next=7,n.FN.promise((0,T.gw)(X({variables:{input:(0,i.Z)((0,i.Z)({},E),{},{application:u.application.id})}}),350),{pending:"\u63D0\u4EA4\u4E2D...",success:{render:function(){return(0,e.jsxs)(e.Fragment,{children:["\u83DC\u5355 ",(0,e.jsx)("strong",{children:E.name})," \u65B0\u589E\u6210\u529F"]})}},error:"\u63D0\u4EA4\u51FA\u9519"},{duration:2e3,placement:"top-center"});case 7:L=s.sent,A=L.data,l(A.createMenu),f(!1),s.next=16;break;case 13:s.prev=13,s.t0=s.catch(1),f(!1);case 16:case"end":return s.stop()}},C,null,[[1,13]])}))},[X,u==null||(b=u.application)===null||b===void 0?void 0:b.id,u==null?void 0:u.id,x,l,g]);return[$,{form:x,submitting:r}]}function V(u){var l=u.menu,v=u.visible,h=u.libraryId,b=u.onClose,x=u.onSuccess,F=u.onDeleteSuccess,Z=O(l,x),r=(0,y.Z)(Z,2),f=r[0],D=r[1],B=D.form,X=D.submitting,m=(0,o.useMemo)(function(){var C;return l?(0,i.Z)((0,i.Z)({},l),{},{component:(C=l.component)===null||C===void 0?void 0:C.id}):{type:"URL",index:0}},[l]),j=R(l,F),g=(0,y.Z)(j,1),$=g[0];return(0,e.jsx)(n.dy,{title:l!=null&&l.id?"\u7F16\u8F91\u83DC\u5355":"\u65B0\u589E\u83DC\u5355",placement:"right",width:640,mask:!1,onClose:b,visible:v,footer:(0,e.jsxs)(n.X2,{children:[(0,e.jsx)(n.JX,{span:6,children:(0,e.jsx)(n.zx,{style:{letterSpacing:"1rem"},className:"w-100",loading:X,onClick:f,children:"\u4FDD\u5B58"})}),(0,e.jsx)(n.JX,{span:6,children:(l==null?void 0:l.id)&&(0,e.jsx)(n.zx,{style:{letterSpacing:"1rem"},className:"w-100",variant:"light-danger",onClick:$,children:"\u5220\u9664"})})]}),children:l&&(0,e.jsx)(Y,{libraryId:h,submitting:X,data:m,appId:l.application.id,form:B,submit:f,onDeleteSuccess:F})})}var w=V,k=t(18071);function ne(u){var l=u.data,v=u.onDeleteSuccess,h=R(l,v),b=(0,y.Z)(h,1),x=b[0];return(0,e.jsx)("div",{className:"d-flex flex-row-fluid justify-content-center",onClick:function(Z){Z.stopPropagation(),Z.preventDefault()},children:(0,e.jsx)("div",{className:"ms-2",children:(0,e.jsx)(n.zx,{variant:"light-danger",icon:(0,e.jsx)(S.ZP,{className:"svg-icon-2",name:"Duotune/arr088"}),onClick:x})})})}function ee(u){var l,v,h=u.match.params.id,b=u.location.state.app,x=b.dependencies.find(function(p){return p.name=="component.library"}).value,F=(0,o.useState)({visible:!1}),Z=(0,y.Z)(F,2),r=Z[0],f=Z[1],D=(0,M.A6)({fetchPolicy:"no-cache",refetchQueries:[{query:M.pM,variables:{id:h}}]}),B=(0,y.Z)(D,1),X=B[0],m=(0,M.a$)({variables:{id:h}}),j=m.data,g=m.loading,$=j==null||(l=j.app)===null||l===void 0?void 0:l.menus,C=(0,o.useMemo)(function(){return(0,T.G_)(($||[]).map(function(p){return(0,i.Z)((0,i.Z)({},p),{},{children:[]})}),{pidKey:"parent.id",sort:function(c,d){return c.index-d.index},converter:function(c){return(0,i.Z)((0,i.Z)({},c),{},{key:c.id,title:c.name,menuType:c.type,type:"directory",application:{id:h}})}})},[h,$]),E=(0,o.useCallback)(function(){f(function(p){return(0,i.Z)((0,i.Z)({},p),{},{visible:!1})})},[]),L=(0,o.useCallback)(function(){f(function(p){return(0,i.Z)((0,i.Z)({},p),{},{visible:!0,menu:{index:0,icon:"Duotune/abs005",type:"MENU",application:{id:h}}})})},[h]),A=(0,o.useCallback)(function(p){f(function(c){var d;return((d=c.menu)===null||d===void 0?void 0:d.id)==p.node.id&&c.visible?(0,i.Z)((0,i.Z)({},c),{},{visible:!1}):(0,i.Z)((0,i.Z)({},c),{},{visible:!0,menu:(0,i.Z)((0,i.Z)({},p.node),{},{type:p.node.menuType,parentMenu:p.node.parentKey})})})},[]),re=(0,o.useCallback)(function(){var p=(0,N.Z)((0,a.Z)().mark(function c(d){var H,q,ie;return(0,a.Z)().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:if(console.log(d),!(((H=d.dragNode.parent)===null||H===void 0?void 0:H.id)==((q=d.node.parent)===null||q===void 0?void 0:q.id)&&d.dragNode.index==d.toIndex)){G.next=3;break}return G.abrupt("return");case 3:return G.next=5,n.FN.promise(X({variables:{id:d.dragNode.id,input:{parentMenu:(ie=d.node.parent)===null||ie===void 0?void 0:ie.id,index:d.toIndex}}}),{pending:"\u66F4\u65B0\u6392\u5E8F...",success:"\u6392\u5E8F\u8C03\u6574\u6210\u529F",error:"\u63D0\u4EA4\u51FA\u9519"},{duration:2e3,placement:"top-center"});case 5:case"end":return G.stop()}},c)}));return function(c){return p.apply(this,arguments)}}(),[X]),s=(0,o.useCallback)(function(p){f(function(c){var d;return((d=c.menu)===null||d===void 0?void 0:d.id)!=p.id?c:(0,i.Z)((0,i.Z)({},c),{},{visible:!1,menu:void 0})})},[f]),ae=(0,o.useCallback)(function(p){f(function(c){return(0,i.Z)((0,i.Z)({},c),{},{menu:p})})},[f]);return(0,e.jsxs)(k.vs,{header:{title:"\u83DC\u5355\u8BBE\u7F6E"},loading:g,children:[(0,e.jsxs)(n.Zb,{flush:!0,children:[(0,e.jsxs)(n.Zb.Header,{className:"pt-8",children:[(0,e.jsx)(n.Zb.Title,{}),(0,e.jsx)(n.Zb.Toolbar,{children:(0,e.jsx)("div",{className:"d-flex justify-content-end",children:(0,e.jsx)(n.zx,{onClick:L,variant:"primary",children:"\u65B0\u5EFA\u83DC\u5355"})})})]}),(0,e.jsx)(n.Zb.Body,{className:"pt-0",children:(0,e.jsx)(n.N4,{className:"app-treelist",rowKey:"id",draggable:!0,onSelect:A,selectedKeys:(v=r.menu)!==null&&v!==void 0&&v.id?[r.menu.id]:[],onDrop:re,columns:[{key:"title",title:"\u540D\u79F0",width:"auto",render:function(c,d){var H,q={SECTION:{color:"info"},URL:{color:"primary"},MENU:{color:"success"},SCRIPT:{color:"dark"}};return(0,e.jsxs)("div",{className:"d-flex flex-column py-5",children:[(0,e.jsx)("span",{className:"title text-gray-800 text-hover-primary mb-1 fs-6",children:d.title}),(0,e.jsxs)("div",{className:"d-flex flex-row col-stacked",children:[(0,e.jsx)(n.Ct,{color:(H=q[d.menuType])===null||H===void 0?void 0:H.color,children:d.menuType}),(0,e.jsx)("span",{className:"tw-pl-2",children:d.path})]})]})}},{key:"index",title:"\u6392\u5E8F",className:"w-100px"},{key:"enabled",title:"\u542F\u7528\u72B6\u6001",className:"w-100px",render:function(c){return c?"\u542F\u7528":"\u7981\u7528"}},{key:"component",title:"\u5B50\u9762\u677F\u6E32\u67D3\u7EC4\u4EF6",className:"w-150px",render:function(c,d){return d.component?"\u6709\u7EC4\u4EF6":"\u65E0\u7EC4\u4EF6"}},{key:"actions",title:"\u64CD\u4F5C",className:"min-w-125px text-center",render:function(c,d){return(0,e.jsx)(ne,{data:d,onDeleteSuccess:s})}}],dataSource:C})})]}),(0,e.jsx)(w,{menu:r.menu,libraryId:x,onClose:E,onSuccess:ae,onDeleteSuccess:s,visible:r.visible})]})}var ue=ee},2970:function(le,K,t){"use strict";t.d(K,{v:function(){return N}});var a=t(11849);function N(i,y,o){i.split("/").forEach(function(S,I,W){var U=y.find(function(Q){var M=Q.id;return M==="tag-".concat(S)});U||y.push(U={id:"tag-".concat(S),value:"tag-".concat(S),label:S,children:[]}),y=U.children,W.length===I+1&&y.push((0,a.Z)((0,a.Z)({},o),{},{value:o.id,label:o.title||o.name||o.id}))})}}}]);

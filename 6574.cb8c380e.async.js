(self.webpackChunkasany_admin=self.webpackChunkasany_admin||[]).push([[6574],{7347:function(ge,me,s){"use strict";s.d(me,{Z:function(){return Tt}});var J=s(2824),r=s(67294),Ne=s(54406),X=s(28865),ve=s(94184),_=s.n(ve),ue=s(25719),z=s(39428),te=s(3182),B=s(1861),R=s(51084),a=s(51186),e=s(85893),G=function(i,t){var l,n=i.data,h=i.fetchMoreData,o=i.hasMore,m=i.children,A=i.loading,j=i.holdHeight,S=j===void 0?30:j,O=(0,r.useRef)(null),b=(l=O.current)===null||l===void 0?void 0:l.osInstance(),U=(0,r.useRef)({scrollTop:0,contentHeight:0});(0,r.useImperativeHandle)(t,function(){return b},[b]);var P=(0,r.useCallback)(function(){var p=(0,te.Z)((0,z.Z)().mark(function T($){var E;return(0,z.Z)().wrap(function(H){for(;;)switch(H.prev=H.next){case 0:if(E=S!=null?S:30,U.current.contentHeight=$.target.scrollHeight,U.current.scrollTop=$.target.scrollTop,!($.target.scrollTop<E)){H.next=7;break}if(!(A||!o)){H.next=6;break}return H.abrupt("return");case 6:requestAnimationFrame(h);case 7:case"end":return H.stop()}},T)}));return function(T){return p.apply(this,arguments)}}(),[h,o,S,A]),V=(0,R.P)(500,P);return(0,e.jsxs)(B.E,{ref:O,className:"d-flex h-100 flex-column custom-scrollbar pe-9 pt-8",options:{scrollbars:{autoHide:"scroll"},callbacks:{onScroll:V,onContentSizeChanged:function(T){if(!!T){if(!b){setTimeout(function(){var E,y;(E=O.current)===null||E===void 0||(y=E.osInstance())===null||y===void 0||y.scroll({y:"100%"})});return}if(b.scroll().max.y==0)b.scroll({y:"100%"});else if(U.current.contentHeight){var $=T.height-U.current.contentHeight;b.scroll({y:$+U.current.scrollTop})}}}}},children:[m,o?(0,e.jsx)("div",{className:_()("scroll-view-spin","d-flex align-items-center justify-content-center","fs-6",{"flex-column-fluid":n.length===0,"h-40px":n.length!==0}),children:(0,e.jsx)(a.yC,{tip:"\u52A0\u8F7D\u4E2D...",indicator:"Loading",size:"small"})}):(0,e.jsx)("div",{className:"con_nomore",children:"\u6CA1\u6709\u66F4\u591A\u5566~"})]})},F=r.forwardRef(G),f=s(29044),M=s(77333),w=s(26490),se=s(70407),le=s(81117),d=s(52152),we=[d.Nw.TEXTMESSAGE,d.Nw.ATTEXTMESSAGE],ke=[d.Nw.PICTUREMESSAGE,d.Nw.VIDEOMESSAGE,d.Nw.FILEMESSAGE],Ze=function(i){var t,l,n,h,o=i.msg,m=i.isSelf,A=i.children,j=(0,r.useState)(!1),S=(0,J.Z)(j,2),O=S[0],b=S[1],U=["Copy","Translate","Reply","Forward"],P=(0,f.Z)(),V=(0,J.Z)(P,2),p=V[1],T=function(){M.Z.emit(w.Oo,"forward",JSON.stringify(o))},$=function(){M.Z.emit(w.rl,!0)},E=function(){M.Z.emit(w.cu,o)},y=(0,r.useCallback)(function(){se.im.revokeMessage(JSON.stringify(o)).then(function(I){M.Z.emit(w.rF,o.clientMsgID),console.log("res",I)}).catch(function(I){return a.FN.error("\u64A4\u56DE\u6D88\u606F\u5931\u8D25\uFF01",I)})},[o]),H=(0,r.useCallback)(function(){console.log("msg",o),se.im.deleteMessageFromLocalStorage(JSON.stringify(o)).then(function(I){M.Z.emit(w.Cd,o.clientMsgID),console.log("res",I)}).catch(function(I){return a.FN.error("\u5220\u9664\u6D88\u606F\u5931\u8D25\uFF01"+I.message)})},[o]),ae=(0,r.useCallback)((0,te.Z)((0,z.Z)().mark(function I(){var Z;return(0,z.Z)().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return b(!1),D.next=3,a.u_.confirm({title:"\u5220\u9664\u6D88\u606F",content:(0,e.jsx)(e.Fragment,{children:(0,e.jsx)("p",{className:"tip-confirm",children:"\u786E\u5B9A\u5220\u9664\u8BE5\u6D88\u606F\u5417\uFF1F"})}),icon:"info",okText:"\u5220\u9664"});case 3:Z=D.sent,Z.isConfirmed&&H();case 5:case"end":return D.stop()}},I)})),[H]),q=(0,r.useCallback)(function(){var I="";switch(o.contentType){case d.Nw.PICTUREMESSAGE:I=o.pictureElem.sourcePicture.url;break;case d.Nw.VIDEOMESSAGE:I=o.videoElem.videoUrl;break;case d.Nw.FILEMESSAGE:I=o.fileElem.sourceUrl;break;default:break}var Z=I.lastIndexOf("/"),fe=I.slice(Z+1);(0,le.$2)(I,fe)},[o.contentType,(t=o.fileElem)===null||t===void 0?void 0:t.sourceUrl,(l=o.pictureElem)===null||l===void 0||(n=l.sourcePicture)===null||n===void 0?void 0:n.url,(h=o.videoElem)===null||h===void 0?void 0:h.videoUrl]),oe=(0,r.useMemo)(function(){return[{id:"Translate",title:"\u7FFB\u8BD1",icon:"Bootstrap/translate",method:function(){},hidden:!0},{id:"Forward",title:"\u8F6C\u53D1",icon:"Bootstrap/arrow-up-right-square",method:T,hidden:!1},{id:"Copy",title:"\u590D\u5236",icon:"Bootstrap/clipboard2",method:function(){var Z=o.contentType===d.Nw.ATTEXTMESSAGE?o.atElem.text:o.content;p(Z),a.FN.success("\u590D\u5236\u6210\u529F\uFF01"),b(!1)},hidden:!1},{id:"Multiple",title:"\u591A\u9009",icon:"Bootstrap/list-check",method:$,hidden:!1},{id:"Reply",title:"\u5F15\u7528",icon:"Bootstrap/chat-quote",method:E,hidden:!1},{id:"Revoke",title:"\u64A4\u56DE",icon:"Bootstrap/arrow-90deg-down",method:y,hidden:!1},{id:"Delete",title:"\u5220\u9664",icon:"Bootstrap/trash",method:ae,hidden:!1},{id:"Download",title:"\u4E0B\u8F7D",icon:"Bootstrap/download",method:q,hidden:!1}]},[p,ae,q,T,o.atElem.text,o.content,o.contentType,E,y]),Ae=function(Z){return!we.includes(o.contentType)&&U.includes(Z.id)&&(Z.hidden=!0),Z.id==="Download"&&!ke.includes(o.contentType)&&(Z.hidden=!0),!m&&Z.id==="Revoke"&&(Z.hidden=!0),!Z.hidden&&(0,e.jsx)(a.v2.Item,{icon:(0,e.jsx)(X.JO,{name:Z.icon,className:"svg-icon-6"}),className:"px-3",onClick:Z.method,children:Z.title},Z.id)};return(0,e.jsx)(a.J2,{trigger:"contextMenu",visible:O,onVisibleChange:b,content:(0,e.jsx)(a.v2,{className:"menu-sub show menu-sub-dropdown show menu-gray-600 menu-state-bg-light-primary fw-bold fs-8 w-125px py-2",children:oe.map(Ae)}),overlayClassName:"overlay-no-arrow msg_item_menu_popover",children:(0,e.jsx)("div",{className:_()("chat_bg_msg_content py-3",{"ps-4 pe-8":!m,"ps-8 pe-4":m}),children:A})})},Me=Ze,ne=s(11849),ce=s(42532),he=s(96522),Re=s(12968),Ie=s(68356),Qe=s(6366),Le=s(7020),Pe=s(30381),Ke=s.n(Pe),ze=s(94335),Ye=s.n(ze);function Xe(g){var i=g.options;return console.log("options",i),(0,e.jsx)("div",{children:"VideoPlayer"})}var Ve=s(1787),We=s.n(Ve),Se=s(35792),Fe=[{context:"[\u6655]",src:""}],_e=function(i){var t=i.msg,l=i.audio,n=i.curCve,h=i.selfID,o=(0,r.useState)(!1),m=(0,J.Z)(o,2),A=m[0],j=m[1],S=(0,Le.tT)("open-im.contacts",function(D){var C=D.state;return C.groupMemberList}),O=(0,r.useRef)(null),b=(0,r.useState)({}),U=(0,J.Z)(b,2),P=U[0],V=U[1],p=(0,r.useRef)();(0,r.useEffect)(function(){var D;j(n?(0,Se.vJ)(n):!1),((D=O.current)===null||D===void 0?void 0:D.clientHeight)>60&&V({paddingBottom:"16px",paddingRight:"8px"})},[n]);var T=function(C){return h===C},$=function(C){return Ke()(t.sendTime).format(C?"HH:mm":"YYYY-MM-DD HH:mm")},E=function(C,c){M.Z.emit(w.a7,C,c)},y=function(){var C=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"chat_bg_msg_content_time";return(0,e.jsx)(a.u,{placement:"bottom",inverse:!0,title:$(0),children:(0,e.jsx)("div",{className:C,children:$(1)})})},H=function(C){var c=C;return Fe.map(function(K){var Q=c.indexOf(K.context);Q>-1&&(c=c.replaceAll(K.context,'<img style="padding-right:2px" width="24px" src='.concat(K.src," />")))}),c},ae=function(C){var c=C,K=/@\S+\s/g,Q=c.match(K);return Q==null||Q.map(function(L){var ie=S.find(function(pe){return pe.userID===L.slice(1,-1)});ie?c=c.replaceAll(L,`<span onclick='userClick("`.concat(ie.userID.replace(".","-"),`")' style="color:#428be5;cursor: pointer;"> @`).concat(ie.nickname," </span>")):c=c.replaceAll(L,`<span onclick="userClick('`.concat(L.slice(1,-1),`')" style="color:#428be5;cursor: pointer;"> `).concat(L,"</span>"))}),c},q=function(C){var c=C.replaceAll("\\n","<br>");return c.replaceAll(`
`,"<br>")},oe=function(C){var c=C,K=/[(http(s)?):\/\/(www\.)?a-zA-Z0-9@:._\+-~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:_\+.~#?&\/\/=]*)/g,Q=c.match(K);return Q==null||Q.map(function(L){c=c.replaceAll(L,`<a onclick="urlClick('`.concat(L,`')" href="javascript:;">`).concat(L,"</a>"))}),c},Ae=function(C){switch(C.contentType){case d.Nw.TEXTMESSAGE:var c=q(oe(ae(H(C.content))));return(0,e.jsx)("div",{className:"content",dangerouslySetInnerHTML:{__html:c}});case d.Nw.ATTEXTMESSAGE:return ae(C.atElem.text);case d.Nw.PICTUREMESSAGE:return(0,e.jsx)(Ie.Z,{width:60,src:C.pictureElem.sourcePicture.url});default:return""}},I=function(C){var c;l.current.src=C,(c=l.current)===null||c===void 0||c.play()},Z=function(C){p.current=C,C.on("waiting",function(){console.log("player is waiting")}),C.on("dispose",function(){console.log("player will dispose")})},fe=function(){var C,c;switch(t.contentType){case d.Nw.TEXTMESSAGE:var K=t.content;return K=H(K),K=oe(K),K=q(K),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{ref:O,style:P,className:"chat_bg_msg_content_text ".concat(A?"":"nick_magin"),children:(0,e.jsx)("div",{dangerouslySetInnerHTML:{__html:K}})}),y()]});case d.Nw.ATTEXTMESSAGE:var Q=t.atElem.text;return Q=H(Q),Q=ae(Q),Q=oe(Q),Q=q(Q),(0,e.jsxs)("div",{style:P,className:"chat_bg_msg_content_text ".concat(A?"":"nick_magin"),children:[(0,e.jsx)("div",{style:{display:"inline-block"},dangerouslySetInnerHTML:{__html:Q}}),y()]});case d.Nw.PICTUREMESSAGE:return(0,e.jsxs)("div",{className:"chat_bg_msg_content_pic ".concat(A?"":"nick_magin"),children:[(0,e.jsx)(Ie.Z,{placeholder:!0,height:200,src:(C=t.pictureElem.snapshotPicture.url)!==null&&C!==void 0?C:t.pictureElem.sourcePicture.url,preview:{visible:!1},fallback:"data:image/png;base64,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"}),y("pic_msg_time")]});case d.Nw.VOICEMESSAGE:var L=T(t.sendID),ie=L?{paddingLeft:"4px"}:{paddingRight:"4px"},pe=L?We():Ye();return(0,e.jsxs)("div",{style:P,className:"chat_bg_msg_content_text chat_bg_msg_content_voice ".concat(A?"":"nick_magin"),children:[(0,e.jsxs)("div",{style:{flexDirection:L?"row-reverse":"row"},onClick:function(){return I(t.soundElem.sourceUrl)},children:[(0,e.jsx)("img",{style:ie,src:pe,alt:""}),"".concat(t.soundElem.duration," ''")]}),y()]});case d.Nw.FILEMESSAGE:var de=t.fileElem,je=de.fileName.slice(de.fileName.lastIndexOf(".")+1);return(0,e.jsxs)("div",{className:"chat_bg_msg_content_text chat_bg_msg_content_file ".concat(A?"":"nick_magin"),children:[(0,e.jsxs)("div",{className:"file_container",children:[(0,e.jsx)("img",{src:(0,le.Sv)(je),alt:""}),(0,e.jsxs)("div",{className:"file_info",children:[(0,e.jsx)("div",{children:de.fileName}),(0,e.jsx)("div",{children:(0,le.RD)(de.fileSize)})]})]}),y()]});case d.Nw.VIDEOMESSAGE:var ye={width:240,controls:!0,playbackRates:[.5,1,1.25,1.5,2],responsive:!0,fluid:!0,sources:[{src:t.videoElem.videoUrl,type:"video/mp4"}]};return(0,e.jsxs)("div",{className:"chat_bg_msg_content_video ".concat(A?"":"nick_magin"),children:[(0,e.jsx)(Xe,{options:ye,onReady:Z}),y("video_msg_time")]});case d.Nw.QUOTEMESSAGE:var Be=t.quoteElem.quoteMessage,Ee=t.quoteElem.text;return Ee=q(oe(H(Ee))),(0,e.jsxs)("div",{style:P,className:"chat_bg_msg_content_text chat_bg_msg_content_qute ".concat(A?"":"nick_magin"),children:[(0,e.jsxs)("div",{className:"qute_content",children:[(0,e.jsx)("div",{children:"".concat("Reply"+t.quoteElem.quoteMessage.senderNickname,":")}),Ae(Be)]}),(0,e.jsx)("div",{dangerouslySetInnerHTML:{__html:Ee}}),y()]});case d.Nw.MERGERMESSAGE:var xe=t.mergeElem;return(0,e.jsxs)("div",{style:P,onClick:function(){return E(xe,t.sendID)},className:"chat_bg_msg_content_text chat_bg_msg_content_mer ".concat(A?"":"nick_magin"),children:[(0,e.jsx)("div",{className:"title",children:xe.title}),(0,e.jsx)("div",{className:"content",children:(c=xe.abstractList)===null||c===void 0?void 0:c.map(function(v){return(0,e.jsx)("div",{className:"item",children:v},v)})}),y()]});case d.Nw.CARDMESSAGE:var Ce=JSON.parse(t.content);return(0,e.jsxs)("div",{style:P,className:"chat_bg_msg_content_text chat_bg_msg_content_card ".concat(A?"":"nick_magin"),children:[(0,e.jsx)("div",{className:"title",children:"IDCard"}),(0,e.jsxs)("div",{className:"desc",children:[(0,e.jsx)(a.mN.Avatar,{src:Ce.faceURL,size:35}),(0,e.jsx)("div",{className:"card_nick",children:Ce.nickname})]}),y()]});case d.Nw.LOCATIONMESSAGE:var ee=t.locationElem,Te={longitude:ee.longitude,latitude:ee.latitude};return(0,e.jsxs)("div",{className:"chat_bg_msg_content_map ".concat(A?"":"nick_magin"),children:[(0,e.jsx)(Qe.D5,{protocol:"https",center:Te,amapkey:"dcdc861728801ee3410f67f6a487d3fa",children:(0,e.jsx)(Qe.Jx,{position:Te})}),y("pic_msg_time")]});default:return(0,e.jsx)("div",{className:"chat_bg_msg_content_text ".concat(A?"":"nick_magin"),children:"UnsupportedMessage"})}};return fe()},$e=_e,qe=[d.Nw.TEXTMESSAGE,d.Nw.ATTEXTMESSAGE,d.Nw.PICTUREMESSAGE,d.Nw.VIDEOMESSAGE,d.Nw.VOICEMESSAGE,d.Nw.CARDMESSAGE,d.Nw.FILEMESSAGE,d.Nw.LOCATIONMESSAGE],et=function(i){var t=i.msg,l=i.selfID,n=i.curCve,h=i.mutilSelect,o=i.className,m=(0,r.useState)(!1),A=(0,J.Z)(m,2),j=A[0],S=A[1],O=(0,r.useRef)(null),b=(0,r.useRef)(null),U=(0,ce.Z)(b),P=(0,J.Z)(U,1),V=P[0],p=(0,r.useMemo)(function(){return l==t.sendID},[l,t.sendID]),T=(0,r.useMemo)(function(){return!n||!(0,Se.vJ)(n)},[n]);(0,r.useEffect)(function(){j&&S(!1)},[h]);var $=function(q,oe){t.isRead=!0,se.im.markC2CMessageAsRead({userID:q,msgIDList:[oe]})};(0,r.useEffect)(function(){V&&n.userID===t.sendID&&!t.isRead&&$(t.sendID,t.clientMsgID)},[V,n]);var E=(0,r.useCallback)(function(){switch(t.status){case 1:return(0,e.jsx)(e.Fragment,{children:"loading..."});case 2:return n&&(0,Se.vJ)(n)?t.isRead?"\u5DF2\u8BFB":"\u672A\u8BFB":null;case 3:return(0,e.jsx)(e.Fragment,{});default:return null}},[n,t.isRead,t.status]),y=function(){h&&qe.includes(t.contentType)&&(M.Z.emit(w.Co,!j,t),S(function(q){return!q}))},H=function(){(0,Se.vJ)(n)||M.Z.emit(w.oJ,t.sendID,t.senderNickname)};return(0,he.Z)(H,O,{onClick:function(){},delay:500}),(0,e.jsx)("div",{ref:b,onClick:y,className:_()("msg-item d-flex mb-10",o,{"justify-content-start":!p,"justify-content-end":p,"mt-4":p}),children:(0,e.jsxs)("div",{className:_()("d-flex align-items-start",{"flex-column":T,"flex-row-reverse":p&&!T,"flex-row":!p&&!T}),children:[(0,e.jsxs)("div",{className:_()("d-flex align-items-center mb-2"),children:[(0,e.jsx)(a.mN.Avatar,{className:_()({"me-4":!p&&!T,"ms-4":p&&!T}),light:!0,size:40,alt:t.senderNickname,src:t.senderFaceUrl}),T&&(0,e.jsxs)("div",{className:"ms-3",children:[(0,e.jsx)("a",{href:"#",className:"fs-5 fw-bold text-gray-900 text-hover-primary me-1",children:t.senderNickname}),(0,e.jsx)("span",{className:"text-muted fs-7 mb-1",children:"2 mins"})]})]}),(0,e.jsxs)("div",{className:_()("msg-item-content rounded text-dark fw-semibold mw-lg-400px text-start",{"bg-light-info":!p,"bg-light-primary":p}),children:[(0,e.jsx)(Me,{msg:t,isSelf:p,children:(0,e.jsx)($e,(0,ne.Z)({},i))},t.clientMsgID),p&&(0,e.jsx)("div",{style:{color:t.isRead?"#999":"#428BE5"},className:"self_msg_chat_flag",children:E()})]})]})})},tt=et,nt=s(23761);function at(g){var i,t=(0,r.useRef)(null),l=g.merID,n=g.msgList,h=g.loadMore,o=g.hasMore,m=g.curCve,A=g.loading,j=(0,r.useState)(!1),S=(0,J.Z)(j,2),O=S[0],b=S[1],U=(i=(0,nt.o)().data)===null||i===void 0?void 0:i.uid,P=Object.values(d.j7),V=function(y){b(y)};(0,r.useEffect)(function(){return M.Z.on(w.rl,V),function(){M.Z.off(w.rl,V)}},[]);var p=(0,r.useCallback)(function(E){return E===U},[U]),T=(0,r.useCallback)(function(E){var y,H;if(E.contentType==d.j7.REVOKEMESSAGE||E.contentType==d.j7.ADVANCEREVOKEMESSAGE){var ae=E.sendID,q=(0,Se.vJ)(m)?m==null?void 0:m.showName:E.senderNickname;if(E.contentType==d.j7.ADVANCEREVOKEMESSAGE){var oe=JSON.parse(E.content);q=oe.revokerNickname,ae=oe.revokerID}return(0,e.jsxs)(e.Fragment,{children:[p(ae)?"\u4F60":(0,e.jsx)("b",{children:q}),"\u64A4\u56DE\u4E86\u4E00\u6761\u6D88\u606F"]})}switch(E.contentType){case d.j7.FRIENDADDED:return"AlreadyFriend";case d.j7.GROUPCREATED:var Ae=JSON.parse(E.notificationElem.detail),I=Ae.opUser;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("b",{children:p(I.userID)?"You":I.nickname}),"GroupCreated"]});case d.j7.GROUPINFOUPDATED:var Z=JSON.parse(E.notificationElem.detail),fe=Z.opUser;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("b",{children:p(fe.userID)?"You":fe.nickname}),"ModifiedGroup"]});case d.j7.GROUPOWNERTRANSFERRED:var D=JSON.parse(E.notificationElem.detail),C=D.opUser,c=D.newGroupOwner;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("b",{children:p(C.userID)?"You":C.nickname}),"TransferTo",(0,e.jsx)("b",{children:p(c.userID)?"You":c.nickname})]});case d.j7.MEMBERQUIT:var K=JSON.parse(E.notificationElem.detail),Q=K.quitUser;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("b",{children:p(Q.userID)?"You":Q.nickname}),"QuitedGroup"]});case d.j7.MEMBERINVITED:var L=JSON.parse(E.notificationElem.detail),ie=L.opUser,pe=(y=L.invitedUserList)!==null&&y!==void 0?y:[],de=[];return pe.forEach(function(ee){return de.push((0,e.jsx)("b",{children:p(ee.userID)?"You":ee.nickname+" "},ee.userID))}),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("b",{children:p(ie.userID)?"You":ie.nickname}),"Invited",de.map(function(ee){return ee}),"IntoGroup"]});case d.j7.MEMBERKICKED:var je=JSON.parse(E.notificationElem.detail),ye=je.opUser,Be=(H=je.kickedUserList)!==null&&H!==void 0?H:[],Ee=[];return Be.forEach(function(ee){return Ee.push((0,e.jsx)("b",{children:p(ee.userID)?"You":ee.nickname},ee.userID))}),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("b",{children:p(ye.userID)?"You":ye.nickname}),"Kicked",Ee.map(function(ee){return ee}),"OutGroup"]});case d.j7.MEMBERENTER:var xe=JSON.parse(E.notificationElem.detail),Ce=xe.entrantUser;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("b",{children:p(Ce.userID)?"You":Ce.nickname}),"JoinedGroup"]});default:return JSON.parse(E.content).defaultTips}},[m,p]),$=(0,r.useCallback)(function(){h(m==null?void 0:m.userID,m==null?void 0:m.groupID,n[n.length-1])},[m==null?void 0:m.groupID,m==null?void 0:m.userID,h,n]);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(F,{holdHeight:40,ref:g.scrollbar,loading:A,data:n,fetchMoreData:$,hasMore:o,children:n==null?void 0:n.map(function(E,y){return P.includes(E.contentType)?(0,e.jsx)("div",{className:_()("chat_bg_tips",{"mb-6":y==0}),children:T(E)},E.clientMsgID):(0,e.jsx)(tt,{audio:t,mutilSelect:O,msg:E,selfID:l!=null?l:U,curCve:m},E.clientMsgID)})}),(0,e.jsx)("audio",{ref:t})]})}var rt=at;function st(){return(0,e.jsx)("div",{className:"d-flex align-items-center justify-content-center h-100",children:(0,e.jsx)("img",{src:"/assets/media/illustrations/dozzy-1/12.png",className:"mw-100 h-200px h-sm-325px"})})}var it=st,be=s(86582),Je=s(3930),lt=s(93224),ot=s(69610),ct=s(54941),ut=s(81306),dt=s(6298),mt=s(64063),vt=s.n(mt),ft=["tagName","html","innerRef"];function Oe(g){return g&&g.replace(/&nbsp;|\u202F|\u00A0/g," ")}function gt(g){var i=document.createTextNode("");g.appendChild(i);var t=document.activeElement===g;if(i!==null&&i.nodeValue!==null&&t){var l=window.getSelection();if(l!==null){var n=document.createRange();n.setStart(i,i.nodeValue.length),n.collapse(!0),l.removeAllRanges(),l.addRange(n)}g instanceof HTMLElement&&g.focus()}}var ht=function(g){(0,ut.Z)(t,g);var i=(0,dt.Z)(t);function t(){var l;(0,ot.Z)(this,t);for(var n=arguments.length,h=new Array(n),o=0;o<n;o++)h[o]=arguments[o];return l=i.call.apply(i,[this].concat(h)),l.lastHtml=l.props.html,l.el=typeof l.props.innerRef=="function"?{current:null}:r.createRef(),l.getEl=function(){return(l.props.innerRef&&typeof l.props.innerRef!="function"?l.props.innerRef:l.el).current},l.emitChange=function(m){var A=l.getEl();if(!!A){var j=A.innerHTML;if(l.props.onChange&&j!==l.lastHtml){var S=Object.assign({},m,{target:{value:j}});l.props.onChange(S)}l.lastHtml=j}},l}return(0,ct.Z)(t,[{key:"render",value:function(){var n=this,h=this.props,o=h.tagName,m=h.html,A=h.innerRef,j=(0,lt.Z)(h,ft);return r.createElement(o||"div",(0,ne.Z)((0,ne.Z)({},j),{},{ref:typeof A=="function"?function(S){A(S),n.el.current=S}:A||this.el,onInput:this.emitChange,onBlur:this.props.onBlur||this.emitChange,onKeyUp:this.props.onKeyUp||this.emitChange,onKeyDown:this.props.onKeyDown||this.emitChange,contentEditable:!this.props.disabled,dangerouslySetInnerHTML:{__html:m}}),this.props.children)}},{key:"shouldComponentUpdate",value:function(n){var h=this.props,o=this.getEl();return!o||Oe(n.html)!==Oe(o.innerHTML)?!0:h.disabled!==n.disabled||h.tagName!==n.tagName||h.className!==n.className||h.innerRef!==n.innerRef||h.placeholder!==n.placeholder||!vt()(h.style,n.style)}},{key:"componentDidUpdate",value:function(){var n=this.getEl();!n||(this.props.html!==n.innerHTML&&(n.innerHTML=this.props.html),this.lastHtml=this.props.html,gt(n))}}]),t}(r.Component),At=function(i,t){var l=new FileReader;l.onload=function(n){var h,o=(h=n.target)===null||h===void 0?void 0:h.result;t(o)},l.readAsDataURL(i)},pt=function(i){var t=i,l=/\<img.*?\">/g,n=t.match(l);return n&&n.length>0&&n.map(function(h){t=t.replaceAll(h,"")}),t},He=function(i){var t=i,l=(0,be.Z)(Array.from(document.getElementsByClassName("face_el")));return l.length>0&&l.map(function(n){t=t.replaceAll(n.outerHTML,n.alt)}),t},Et=function(i){var t=i;return t.slice(-4)==="<br>"&&(t=t.slice(0,-4)),t=t.replaceAll("<br>",`
`),t},xt=function(){var i=(0,be.Z)(Array.from(document.getElementsByClassName("screenshot_el")));i.length>0&&(i[i.length-1].alt="last",i.map(function(){var t=(0,te.Z)((0,z.Z)().mark(function l(n){var h;return(0,z.Z)().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:h=(0,le._x)(n.src),console.log(h);case 2:case"end":return m.stop()}},l)}));return function(l){return t.apply(this,arguments)}}()))};function Ct(g){var i=g.curCve,t=g.sendMsg,l=(0,r.useRef)(null),n=(0,r.useRef)(null),h=(0,r.useState)(""),o=(0,J.Z)(h,2),m=o[0],A=o[1],j=(0,Je.Z)(m),S=(0,r.useState)(),O=(0,J.Z)(S,2),b=O[0],U=O[1],P=(0,r.useState)([]),V=(0,J.Z)(P,2),p=V[0],T=V[1],$=(0,Le.tT)("open-im.contacts",function(v){var u=v.state;return u.groupMemberList}),E=(0,r.useState)(!1),y=(0,J.Z)(E,2),H=y[0],ae=y[1],q=(0,Je.Z)(H),oe=(0,r.useState)([]),Ae=(0,J.Z)(oe,2),I=Ae[0],Z=Ae[1],fe=function(u,N){se.im.typingStatusUpdate({recvID:u,msgTip:N})},D=(0,r.useCallback)(function(){(0,Se.vJ)(i)&&(l.current&&clearTimeout(l.current),l.current=setTimeout(function(){fe(i.userID,"yes")},2e3))},[i]),C=function(){var v=(0,te.Z)((0,z.Z)().mark(function u(N){var x,k,Y;return(0,z.Z)().wrap(function(re){for(;;)switch(re.prev=re.next){case 0:x=(N.originalEvent||N).clipboardData,x&&x.items[0].type.indexOf("image")===-1?(N.preventDefault(),k=x.getData("text/plain")||"",document.execCommand("insertText",!1,k)):x&&x.items[0].type.indexOf("image")>-1&&(N.preventDefault(),Y=x.items[0].getAsFile(),At(Y,function(De){var Ue='<img style="vertical-align:bottom" class="screenshot_el" src="'.concat(De,'" alt="" >');document.execCommand("insertHTML",!1,Ue)}));case 2:case"end":return re.stop()}},u)}));return function(N){return v.apply(this,arguments)}}(),c=(0,r.useRef)({curCve:i,msgContent:m,latestContent:j,atList:p,groupMemberList:$,replyMsg:b,draftSaved:!1});c.current.msgContent=m,c.current.curCve=i,c.current.latestContent=j,c.current.atList=p,c.current.groupMemberList=$,c.current.replyMsg=b;var K=(0,r.useCallback)(function(v,u){var N=c.current.atList,x=c.current.latestContent,k=c.current.replyMsg;if(k&&U(void 0),N.findIndex(function(W){return W.id===v})===-1){var Y='<b class="at_el" data_id="'.concat(v,'" data_name="').concat(u,'" contenteditable="false" style="color:#428be5"> @').concat(u,"</b>");T([].concat((0,be.Z)(N),[{id:v,name:u,tag:Y}])),A(x.current+Y),(0,le.RT)(n.current.el)}},[]),Q=(0,r.useCallback)(function(v){var u=v,N=c.current.atList;return N.map(function(x){u=u.replaceAll(x.tag,"@".concat(x.id," "))}),u},[]),L=(0,r.useCallback)(function(v){var u=c.current.latestContent,N=c.current.atList;if(v.draftText!=u.current&&(v.draftText!==""||u.current!=="")){c.current.draftSaved=!0;var x=u.current;x=He(x);var k={conversationID:v.conversationID,draftText:N.length>0?Q(x):x};se.im.setConversationDraft(k).then(function(Y){console.warn(Y)}).catch(function(Y){console.warn(Y)}).finally(function(){A("")})}},[Q]),ie=(0,r.useCallback)(function(){c.current.latestContent.current="",A(""),U(void 0),T([]),ae(!1),L(i)},[i,L]),pe=(0,r.useCallback)(function(){var v=(0,te.Z)((0,z.Z)().mark(function u(N){var x,k;return(0,z.Z)().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:return W.next=2,se.im.createTextMessage(N);case 2:x=W.sent,k=x.data,t(k,d.Nw.TEXTMESSAGE),ie();case 6:case"end":return W.stop()}},u)}));return function(u){return v.apply(this,arguments)}}(),[ie,t]),de=(0,r.useCallback)(function(){var v=(0,te.Z)((0,z.Z)().mark(function u(N){var x,k,Y;return(0,z.Z)().wrap(function(re){for(;;)switch(re.prev=re.next){case 0:return x={text:N,atUserIDList:p.map(function(De){return De.id})},re.next=3,se.im.createTextAtMessage(x);case 3:k=re.sent,Y=k.data,t(Y,d.Nw.ATTEXTMESSAGE),ie();case 7:case"end":return re.stop()}},u)}));return function(u){return v.apply(this,arguments)}}(),[p,ie,t]),je=(0,r.useCallback)(function(){var v=(0,te.Z)((0,z.Z)().mark(function u(N){var x,k;return(0,z.Z)().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:return W.next=2,se.im.createQuoteMessage({text:N,message:JSON.stringify(b)});case 2:x=W.sent,k=x.data,t(k,d.Nw.QUOTEMESSAGE),ie();case 6:case"end":return W.stop()}},u)}));return function(u){return v.apply(this,arguments)}}(),[ie,b,t]),ye=(0,r.useCallback)(function(v){var u=j.current;if(u=pt(He(u)),u=Et(u),xt(),u!=="")switch(v){case"text":pe(u);break;case"at":de(Q(u));break;case"quote":je(u);break;default:break}},[j,Q,je,de,pe]),Be=(0,r.useCallback)(function(v){v.key==="Enter"&&v.metaKey&&(v.preventDefault(),(0,le.Tf)(),(0,le.RT)(n.current.el)),v.key==="Enter"&&!v.metaKey&&(v.preventDefault(),j.current&&!q.current&&(ae(!0),ye(b?"quote":p.length>0?"at":"text")))},[p.length,j,q,b,ye]),Ee=(0,r.useCallback)(function(v){A(v.target.value);var u=(0,be.Z)(Array.from(document.getElementsByClassName("at_el"))),N=[];u.map(function(x){var k,Y;return N.push({id:(k=x.attributes.getNamedItem("data_id"))===null||k===void 0?void 0:k.value,name:(Y=x.attributes.getNamedItem("data_name"))===null||Y===void 0?void 0:Y.value,tag:x.outerHTML})}),T(N),D()},[D]),xe=(0,r.useCallback)(function(v){var u=v;return Fe.map(function(N){var x=u.indexOf(N.context);if(x>-1){var k='<img class="face_el" alt="'.concat(N.context,'" style="padding-right:2px" width="24px" src="').concat(N.src,'">');u=u.replaceAll(N.context,k)}}),u},[]),Ce=(0,r.useCallback)(function(v){var u=v,N=/@\S+\s/g,x=u.match(N),k=[],Y=c.current.groupMemberList;return x==null||x.map(function(W){var re=Y.find(function(Ue){return Ue.userID===W.slice(1,-1)});if(re){var De='<b class="at_el" data_id="'.concat(re.userID,'" data_name="').concat(re.nickname,'" contenteditable="false" style="color:#428be5"> @').concat(re.nickname,"</b>");u=u.replaceAll(W,De),k.push({id:re.userID,name:re.nickname,tag:De})}}),T(k),u},[]),ee=(0,r.useCallback)(function(v){A(xe(Ce(v)))},[Ce,xe]);(0,r.useEffect)(function(){c.current.draftSaved=!1;var v=c.current.atList;return v.length>0&&T([]),i.draftText!==""?ee(i.draftText):A(""),Z([]),function(){c.current.draftSaved||L(i)}},[i,ee,L]);var Te=(0,r.useCallback)(function(v,u){var N=(0,be.Z)(I);if(v)N=[].concat((0,be.Z)(N),[u]);else{var x=N.findIndex(function(k){return k.clientMsgID===u.clientMsgID});N.splice(x,1)}Z(N)},[I]);return(0,r.useEffect)(function(){return M.Z.on(w.Co,Te),function(){M.Z.off(w.Co,Te)}},[Te]),(0,r.useEffect)(function(){return M.Z.on(w.oJ,K),M.Z.on(w.jf,L),function(){M.Z.off(w.oJ,K),M.Z.off(w.jf,L)}},[K,L]),(0,e.jsxs)("div",{className:"pt-4 ps-8 h-100 d-flex flex-column",children:[(0,e.jsxs)("div",{className:"d-flex flex-row mb-2",children:[(0,e.jsx)(a.u,{placement:"bottom",inverse:!0,title:"\u8868\u60C5",children:(0,e.jsx)(a.zx,{variant:!1,icon:(0,e.jsx)(X.JO,{name:"Bootstrap/emoji-smile",className:"svg-icon-2"}),activeColor:"secondary",className:"me-1"})}),(0,e.jsx)(a.u,{placement:"bottom",inverse:!0,title:"\u53D1\u9001\u540D\u7247",children:(0,e.jsx)(a.zx,{variant:!1,icon:(0,e.jsx)(X.JO,{name:"Bootstrap/person-badge",className:"svg-icon-2"}),activeColor:"secondary",className:"me-1"})}),(0,e.jsx)(a.u,{placement:"bottom",inverse:!0,title:"\u53D1\u9001\u6587\u4EF6",children:(0,e.jsx)(a.zx,{variant:!1,icon:(0,e.jsx)(X.JO,{name:"Bootstrap/folder-plus",className:"svg-icon-2"}),activeColor:"secondary",className:"me-1"})}),(0,e.jsx)(a.u,{placement:"bottom",inverse:!0,title:"\u53D1\u9001\u56FE\u7247",children:(0,e.jsx)(a.zx,{variant:!1,icon:(0,e.jsx)(X.JO,{name:"Bootstrap/card-image",className:"svg-icon-2"}),activeColor:"secondary",className:"me-1"})}),(0,e.jsx)(a.u,{placement:"bottom",inverse:!0,title:"\u53D1\u9001\u89C6\u9891",children:(0,e.jsx)(a.zx,{variant:!1,icon:(0,e.jsx)(X.JO,{name:"Bootstrap/film",className:"svg-icon-2"}),activeColor:"secondary",className:"me-1"})})]}),(0,e.jsxs)("div",{className:"ps-3 flex-row-fluid position-relative",children:[(0,e.jsx)(ht,{style:{paddingTop:b?"32px":"4px"},placeholder:"\u53D1\u9001\u7ED9 ".concat(i.showName),className:"h-100",ref:n,html:m,onChange:Ee,onKeyDown:Be,onPaste:C}),(0,e.jsxs)("div",{className:"chat-msg-actions d-flex flex-row position-absolute",children:[(0,e.jsxs)("div",{className:"d-flex flex-row align-items-center fs-10 text-gray-500 me-6",children:[(0,e.jsx)(X.JO,{name:"Bootstrap/arrow-return-left",className:"svg-icon-7 me-2"})," \u53D1\u9001",(0,e.jsx)("span",{className:"mx-3",children:"/"}),(0,e.jsx)(X.JO,{name:"Bootstrap/command",className:"svg-icon-7 me-2"})," \u6362\u884C"]}),(0,e.jsx)(a.zx,{className:"px-5",children:"\u53D1\u9001"})]})]})]})}var Nt=Ct,St=s(18071),jt=function(i){var t=i.userId,l=i.typing,n=(0,ue.ED)({variables:{id:t},fetchPolicy:"cache-and-network"}),h=(0,J.Z)(n,2),o=h[0],m=h[1],A=m.data,j=m.refetch,S=A==null?void 0:A.user.onlineStatus.status,O=A==null?void 0:A.user.onlineStatus.detailPlatformStatus,b=(0,r.useMemo)(function(){if(S=="online"){var P="";return O==null||O.map(function(V){V.status==="online"&&(P+="".concat(V.platform,"/"))}),"".concat(P.slice(0,-1)," \u5728\u7EBF")}return"\u79BB\u7EBF"},[S,O]),U=(0,r.useRef)(S);return U.current=S,(0,r.useEffect)(function(){U.current!="online"&&j()},[o,j,l]),(0,e.jsxs)("div",{className:"mb-0 lh-1 d-flex flex-row align-items-center",children:[(0,e.jsx)(a.Ct,{color:S=="online"?"primary":"secondary",shape:"circle",className:"w-10px h-10px me-1"}),(0,e.jsx)("span",{className:"fs-7 fw-semibold text-muted",children:b})]})},yt=function(){return(0,e.jsx)(e.Fragment,{})},Mt=105,It=350;function Ge(g){return Math.min(It,Math.max(Mt,g))}function bt(g){var i=g.msgList,t=g.loadMore,l=g.hasMore,n=g.curCve,h=g.loading,o=g.sendMsg,m=g.scrollbar,A=g.typing,j=g.onBack,S=(0,r.useRef)({height:200}),O=(0,r.useReducer)(function(T){return T+1},0),b=(0,J.Z)(O,2),U=b[1],P=(0,r.useMemo)(function(){return n&&(0,Se.vJ)(n)},[n]),V=(0,r.useCallback)(function(T){S.current.height+=T,U()},[]),p=(0,r.useCallback)(function(){S.current.height=Ge(S.current.height)},[]);return(0,e.jsx)(St.v,{className:"app-chat-main background-transparent",contentClassName:"px-0",footer:!1,header:!1,children:(0,e.jsxs)(a.Zb,{className:"card chat_messenger",id:"kt_chat_messenger",children:[n&&(0,e.jsxs)(a.Zb.Header,{id:"kt_chat_messenger_header",children:[(0,e.jsxs)(a.Zb.Title,{className:"d-flex align-items-center",children:[(0,e.jsx)(a.mN.Avatar,{light:!0,size:45,alt:n==null?void 0:n.showName,src:n==null?void 0:n.faceURL}),(0,e.jsxs)("div",{className:"ms-5 d-flex justify-content-center flex-column me-3",children:[(0,e.jsx)("a",{href:"#",className:"fs-4 fw-bold text-gray-900 text-hover-primary me-1 mb-2 lh-1",children:n.showName}),(0,e.jsxs)("div",{className:"d-flex flex-row align-items-center",children:[P?(0,e.jsx)(jt,{userId:n.userID,typing:!!A}):(0,e.jsx)(yt,{}),A&&(0,e.jsx)("span",{className:"mb-0 lh-1 ms-4 fs-7 fw-semibold text-muted",children:"\u6B63\u5728\u8F93\u5165..."})]})]})]}),(0,e.jsxs)(a.Zb.Toolbar,{children:[(0,e.jsx)(a.u,{placement:"bottom",inverse:!0,title:"\u6587\u4EF6",children:(0,e.jsx)(a.zx,{className:"me-4",icon:(0,e.jsx)(X.JO,{name:"Bootstrap/folder",className:"svg-icon-2"}),variant:!1,activeColor:"light-primary"})}),(0,e.jsx)(a.u,{placement:"bottom",inverse:!0,title:"\u804A\u5929\u8BB0\u5F55",children:(0,e.jsx)(a.zx,{className:"me-4",icon:(0,e.jsx)(X.JO,{name:"Bootstrap/list-ul",className:"svg-icon-2"}),variant:!1,activeColor:"light-primary"})}),(0,e.jsx)(a.u,{placement:"bottom",inverse:!0,title:"\u6DFB\u52A0\u6210\u5458",children:(0,e.jsx)(a.zx,{className:"me-4",icon:(0,e.jsx)(X.JO,{name:"Bootstrap/person-plus",className:"svg-icon-2"}),variant:!1,activeColor:"light-primary"})}),(0,e.jsx)(a.u,{placement:"bottom",inverse:!0,title:"\u804A\u5929\u8BBE\u7F6E",children:(0,e.jsx)(a.zx,{className:_()({"me-4":!!j}),icon:(0,e.jsx)(X.JO,{name:"Bootstrap/gear",className:"svg-icon-2"}),variant:!1,activeColor:"light-primary"})}),j&&(0,e.jsx)(a.u,{placement:"bottom",inverse:!0,title:"\u8FD4\u56DE\u6D88\u606F\u5217\u8868",children:(0,e.jsx)(a.zx,{onClick:j,icon:(0,e.jsx)(X.JO,{name:"Bootstrap/arrow-return-left",className:"svg-icon-2"}),variant:!1,activeColor:"light-primary"})})]})]}),(0,e.jsx)(a.Zb.Body,{className:"pe-0 py-0 overflow-hidden",id:"kt_chat_messenger_body",children:n?(0,e.jsx)(rt,{loadMore:t,loading:h,msgList:i,hasMore:l,curCve:n,scrollbar:m}):(0,e.jsx)(it,{})}),n&&(0,e.jsx)(a.Zb.Footer,{className:"p-0",id:"kt_chat_messenger_footer",children:(0,e.jsx)(Ne.w_,{style:{height:Ge(S.current.height)},direction:"y",onResize:V,onResizeEnd:p,children:(0,e.jsx)(Nt,{curCve:n,sendMsg:o})})})]})})}var Tt=bt},17554:function(ge,me,s){"use strict";s.d(me,{Z:function(){return J.Z}});var J=s(7347)},26603:function(ge,me,s){"use strict";s.d(me,{Z:function(){return G}});var J=s(1861),r=s(67294),Ne=s(7020),X=s(94184),ve=s.n(X),_=s(81117),ue=s(35792),z=s(90711),te=s(51186),B=s(85893);function R(F){var f=F.data,M=F.onClick,w=F.curCve,se=(0,Ne.tT)("@@initialState",function(Me){var ne,ce;return(ne=Me.initialState)===null||ne===void 0||(ce=ne.currentUser)===null||ce===void 0?void 0:ce.uid}),le=function(ne){if(ne==="")return ne;var ce=JSON.parse(ne);if(f.draftText!==""){var he=f.draftText,Re=/\<img.*?\">/g,Ie=he.match(Re);return Ie&&Ie.length>0&&Ie.map(function(Qe){he=he.replaceAll(Qe,"Picture")}),(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)("span",{className:"text-warning me-1",children:"[\u8349\u7A3F]"}),he]})}return(0,ue.LF)(ce,se)},d=function(ne){return ne===z.VP.Nomal},we=d(f==null?void 0:f.recvMsgOpt)?le(f.latestMsg):f.unreadCount>0?"[".concat(f.unreadCount+"Piece","] ").concat(le(f.latestMsg)):le(f.latestMsg),ke=function(ne){var ce=(0,_.p6)(ne),he=(0,_.p6)(ne+864e5),Re=(0,_.p6)(new Date().getTime());return ce[3]===Re[3]?ce[4]:he[3]===Re[3]?"\u6628\u5929":ce[3]},Ze=(0,r.useCallback)(function(){M(f)},[f,M]);return(0,B.jsxs)("div",{className:ve()("cve-item d-flex flex-stack py-4 mb-1",{active:(w==null?void 0:w.conversationID)==f.conversationID}),onClick:Ze,children:[(0,B.jsxs)("div",{className:"d-flex align-items-center",children:[(0,B.jsx)(te.mN.Avatar,{size:45,alt:f.showName,light:!0,badge:(0,B.jsx)(te.Ct,{dot:!d(f==null?void 0:f.recvMsgOpt)&&f.unreadCount>0,color:"danger",shape:"circle",className:"start-100",count:d(f==null?void 0:f.recvMsgOpt)?f.unreadCount:null})}),(0,B.jsxs)("div",{className:"ms-5",children:[(0,B.jsx)("a",{href:"#",className:"fs-5 fw-bold text-gray-900 text-hover-primary mb-2",children:f.showName}),(0,B.jsx)("div",{className:"fw-semibold text-muted cve_msg",children:we})]})]}),(0,B.jsx)("div",{className:"d-flex flex-column align-items-end ms-2",children:(0,B.jsx)("span",{className:"text-muted fs-7 mb-1",children:ke(f.latestMsgSendTime)})})]})}var a=R;function e(F){var f=F.curCve,M=F.cves,w=F.onItemClick;return(0,B.jsx)(J.E,{className:"d-flex flex-column custom-scrollbar px-2 cve-list",options:{scrollbars:{autoHide:"scroll"}},children:(0,B.jsx)(te.Zb,{flush:!0,className:"py-0 px-2 background-transparent",bodyClassName:"pt-5 pb-0 px-1 cve-list",children:M.map(function(se){return(0,B.jsx)(a,{onClick:w,cveList:M,data:se,curCve:f},se.conversationID)})})})}var G=e},67491:function(ge,me,s){"use strict";var J=s(2824),r=s(67294),Ne=s(28865),X=s(94184),ve=s.n(X),_=s(51186),ue=s(85893);function z(te){var B=te.onSearch,R=te.className,a=(0,r.useState)(""),e=(0,J.Z)(a,2),G=e[0],F=e[1],f=(0,r.useCallback)(function(M){F(M.target.value),B(M.target.value)},[B]);return(0,ue.jsxs)("div",{className:ve()("cve-searchbar ps-6 pe-6 d-flex align-items-center",R),children:[(0,ue.jsx)(_.II.Search,{solid:!0,size:"lg",boxClassName:"flex-row-fluid",value:G,onChange:f,placeholder:"\u641C\u7D22..."}),(0,ue.jsx)("a",{className:ve()("cve-searchbar-actions ms-4"),children:(0,ue.jsx)(Ne.JO,{className:ve()("svg-icon-2x svg-icon-dark"),name:"Duotune/arr087"})})]})}me.Z=z},81117:function(ge,me,s){"use strict";s.d(me,{RT:function(){return Ne},p6:function(){return X},$2:function(){return ve},RD:function(){return _},Sv:function(){return ue},Tf:function(){return z},_x:function(){return te}});var J=s(9669),r=s.n(J),Ne=function(R){var a=window.getSelection(),e=document.createRange();e.selectNodeContents(R.current),e.collapse(!1),a==null||a.removeAllRanges(),a==null||a.addRange(e)},X=function(R){var a=new Date(R),e=a.getFullYear(),G=a.getMonth()+1,F=a.getDate(),f=a.getHours(),M=a.getMinutes();M.toString().length===1&&(M="0"+M);var w=a.getSeconds();w.toString().length===1&&(w="0"+w);var se=e+"-"+G+"-"+F,le=f+":"+M;return[e,G,F,se,le]},ve=function(R,a){r().get(R,{headers:{"Content-Type":"application/x-www-form-urlencoded"},responseType:"blob"}).then(function(e){var G=new Blob([e.data]),F=a,f=document.createElement("a");f.download=F,f.style.display="none",f.href=URL.createObjectURL(G),document.body.appendChild(f),f.click(),URL.revokeObjectURL(f.href),document.body.removeChild(f)}).catch(function(e){console.log(e)})},_=function(R){if(R===0)return"0 B";var a=1024,e=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],G=Math.floor(Math.log(R)/Math.log(a));return(R/Math.pow(a,G)).toPrecision(3)+" "+e[G]},ue=function(R){var a=["jpeg","tiff","png","gif","jpg","gif"],e=["ppt","pptx"],G=["xlsx","xls"],F=["doc","docx"],f=["rar","zip"];return a.includes(R)?"file_pic":e.includes(R)?"file_ppt":G.includes(R)?"file_xslx":F.includes(R)?"file_world":f.includes(R)?"file_zip":R==="pdf"?"file_pdf":"file_unknow"},z=function(){var R=window.getSelection(),a=R.getRangeAt(0),e=document.createElement("br"),G=document.createTextNode("\xA0");a.deleteContents(),a.insertNode(e),a.collapse(!1),a.insertNode(G),a.selectNodeContents(G),R.removeAllRanges(),R.addRange(a),document.execCommand("delete")},te=function(R){for(var a=R.split(","),e=a[0].match(/:(.*?);/)[1],G=atob(a[1]),F=G.length,f=new Uint8Array(F);F--;)f[F]=G.charCodeAt(F);return new File([f],"screenshot".concat(Date.now(),".png"),{type:e})}},1787:function(ge){ge.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAAUCAYAAABWMrcvAAAAAXNSR0IArs4c6QAAAk5JREFUOE+N081LFHEYB/Dvd9wMk0p3dsid1fIkduhUl0jIoDckDx2MOnSKPCU6o5KBkCG9ic4u1CUr6FQHQyqK3CCMBAPpXwjsZWdNZ3YxJXHNeWLH3HZTqzk+z3z4/p7fPEP8+dSPBvS9ezoo/JCw1KE1fQDML5Y3p7ZvKfWegKgXoM+2Qhf/iiqNzyWCklEh9wnQkbTU2HogW8sl6ebMXQrPeSLNyZh2byOQQ3pb6gDojYFy37a08/mgwkgfpAJJDpS/Xa37SRHTfSGQukBxoPrTjbL0ajNiuqaI9BMykohqDTlU0TKnKZsWbQB3bCt0YbWht7pHUIQRQF4vzCtN6cHgbA6FDeekQgx75PHkgBrPS5kApHJhibWpW+q3/CMzbDqXFODaYkYizm0tmwi9NbWTRTIp9HrtAe1ythZuc3aT0gSv6AF1w7lOokvmM6X2oP7dR4Z7lJQ4oDQmrOBzf27DGQexH8JhRgynG0TvD2Xzjq/9W6cLkTQmLM1HuuH2gdJOsJO6kTpNeo+WPTk0FdPe+EdpT+9SZHlSwCu2pfbk5mmSYgwxQ910qyDyEfTXpit3e+bMe4LhxYDUOn3aXMFF+NGmOwZ4NYqEqr9EubCS5h6jJy9BxjMB71Q+9D+ubsw0knwG4GrCCnXn0oxUJ+HdFMi4HdXqCjZiBTpZ1CDgiWRUHfkNncOesGwqpj5egyqN2aAwM5H1IjxjR0NP/7nlv2arAvAKQA2EZ+1o8OF6sOAnzL4QbHG3lQS8niVRhqZj6rv/QhsdKb/+E7En8byRi/iIAAAAAElFTkSuQmCC"},94335:function(ge){ge.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAATCAYAAABLN4eXAAAAAXNSR0IArs4c6QAAAiBJREFUOE+Fk0toU1EQhv+5oVINKrgIJAQtuCgkEHLPCQaFiiLYik+KXehKUHErIhWUYgUXFR8rV4orF4LFlaX4AhUqLpIzN5vEIgFfKZKNaEBKQ3JGTkkgMaQ9y5/5ZuafmUPo87TWEwB2GmPuAGh0hlE/SCl1i4gmAbwDcMIY86cd2xdyAUqpi0TkKuWr1er+SqWy7PQ1IRegtT4H4AGAR8aY8z2Q7/t7XaIgCN53tq21figiZ621I4VC4UNXJaXUPIAxEbkcBMG9NphMJrcNDg5+AbBgjDncBWmttwKYFZEDnueN5fP5121QKXWfiC5Ya2M9nrLZ7JZGo7EoIhVm3tUBjRLRCxEZJ631dgBnRGSWmT+1zN8AMAVgyBjz3Wm+78c8z1sCcJWUUs+IaFxEPjLzntaojxDRcwCjxphXTovFYpui0ehfADOu0iURuQ3gLjO7Zbr99ECpVCoyMDBQtdZOrXpKJBIbSqVSvaP/aSK6bq0dCoLgm9PT6fS+UCj01lp7qmcQw8PDm8Ph8CKAn8ycaSfSWs+IyGS9Xt/RBbWAp84LgEPM/NJB8Xh8YyQS+UpEn40xI//vaUFE3DCuMLPzufqUUjeJ6JqIHGXmuS4ok8mcbDabv4MgeNMBjBHRnIjMM/OxdQ82nU4fD4VCT0RkaWVlJVssFn+tCWmtT4vIY+fD87yDuVzux7r/yff93UQ0UavVpsvlcq3z6v8BSUzmcN/zXjIAAAAASUVORK5CYII="}}]);

"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[6412],{9566:function(X,w,a){var N=a(12845),L=a(38018);function T(){var h=(0,N.useLocation)();return L.parse(h.search)}w.Z=T},26651:function(X,w,a){a.r(w),a.d(w,{default:function(){return de}});var N=a(19632),L=a.n(N),T=a(15009),h=a.n(T),q=a(97857),M=a.n(q),_=a(99289),S=a.n(_),ee=a(5574),Q=a.n(ee),v=a(62435),O=a(96974),V=a(84059),G=a(38018),re=a(64763),ae=a(9566),ne=a(73588),t=a(79817),k=a(91726),te=a(84730),ue=a(92592);function se(C){return R.apply(this,arguments)}function R(){return R=S()(h()().mark(function C(y){var f,g,i;return h()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,fetch(y);case 2:return f=o.sent,o.next=5,f.blob();case 5:return g=o.sent,i=new FileReader,o.abrupt("return",new Promise(function(F,j){i.onloadend=function(){F(i.result)},i.onerror=j,i.readAsDataURL(g)}));case 8:case"end":return o.stop()}},C)})),R.apply(this,arguments)}var le=se("/assets/images/qrcode_logo.png");function U(C){return Y.apply(this,arguments)}function Y(){return Y=S()(h()().mark(function C(y){var f,g,i,x,o,F;return h()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return f=80,g=40,i=new te.ZP("l","mm",[f,g]),p.next=4,Promise.all(y.map(function(E){return ue.toDataURL(E.qrcode,{width:40,height:40,errorCorrectionLevel:"H",quality:.92})}));case 4:x=p.sent,o=0;case 6:if(!(o<y.length)){p.next=16;break}return i.addImage(x[o],"JPEG",0,0,40,40,"","FAST"),p.next=10,le;case 10:F=p.sent,i.addImage(F,"JPEG",40,0,40,40,"","FAST"),o<x.length-1&&i.addPage([f,g],"l");case 13:o++,p.next=6;break;case 16:window.open(i.output("bloburl"),"_blank");case 17:case"end":return p.stop()}},C)})),Y.apply(this,arguments)}var e=a(86074);function oe(C,y){var f=new Date,g=f.getFullYear().toString(),i=(f.getMonth()+1).toString().padStart(2,"0"),x=f.getDate().toString().padStart(2,"0"),o=C.replace("{YYYY}",g).replace("{MM}",i).replace("{DD}",x),F=C.match(/{SEQ:(\d+)}/);if(F){var j=parseInt(F[1],10),p=y.toString().padStart(j,"0");o=o.replace(F[0],p)}return o}function ie(){var C,y,f=(0,O.TH)(),g=(0,O.s0)(),i=(0,ae.Z)(),x=(0,v.useState)(!1),o=Q()(x,2),F=o[0],j=o[1],p=t.Form.useForm(),E=(0,v.useMemo)(function(){return i.q&&(i.filter={name_contains:i.q},delete i.q),i},[i]),ce=(0,k.BC)({refetchQueries:[k.aT]}),ve=Q()(ce,1),Z=ve[0],P=(0,k.Vh)({fetchPolicy:"cache-and-network",variables:E}),d=P.data,B=P.loading,c=P.previousData,me=(0,k.Fm)({refetchQueries:[k.aT]}),H=Q()(me,2),fe=H[0],he=H[1].loading,pe=(0,v.useCallback)(function(){j(!0)},[]),Ce=(0,v.useCallback)(S()(h()().mark(function r(){var n,u,l,m;return h()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,p.validateFields();case 2:return n=b.sent,console.log(n),b.next=6,fe({variables:{links:Array.from({length:n.count}).map(function(I,D){return{category:"wxb",metadata:{no:oe(n.numberRule,D+1)}}})}});case 6:u=b.sent,l=u.data,m=(l==null?void 0:l.result.map(function(I){return M()(M()({},I),{},{qrcode:"https://api.asany.cn/s/"+I.code})}))||[],U(m),t.Toast.success("\u4E8C\u7EF4\u7801\u6279\u91CF\u5220\u9664\u6210\u529F",2e3,{placement:"bottom-left",progressBar:!0}),j(!1);case 12:case"end":return b.stop()}},r)})),[]),A=(0,v.useMemo)(function(){if(!E.orderBy)return{order:"descend",field:"createdAt"};var r=E.orderBy.split("_"),n=Q()(r,2),u=n[0],l=n[1];return{order:l==="desc"?"descend":"ascend",field:u}},[E.orderBy]),ge=(0,v.useMemo)(function(){return B?(c==null?void 0:c.deviceQrCodes.pageInfo.total)||0:(d==null?void 0:d.deviceQrCodes.pageInfo.total)||0},[d==null?void 0:d.deviceQrCodes.pageInfo.total,B,c==null?void 0:c.deviceQrCodes.pageInfo.total]),ye=(0,v.useMemo)(function(){return B?(c==null?void 0:c.deviceQrCodes.pageInfo)||{total:0,current:1}:(d==null?void 0:d.deviceQrCodes.pageInfo)||{total:0,current:1}},[d==null?void 0:d.deviceQrCodes,B,c==null?void 0:c.deviceQrCodes]),Fe=(0,v.useMemo)(function(){var r;if(B){var n;return((c==null||(n=c.deviceQrCodes)===null||n===void 0?void 0:n.edges)||[]).map(function(u){return u.node})}return((d==null||(r=d.deviceQrCodes)===null||r===void 0?void 0:r.edges)||[]).map(function(u){return u.node})},[d==null?void 0:d.deviceQrCodes,B,c==null?void 0:c.deviceQrCodes]),Ee=(0,v.useCallback)(function(r){g(f.pathname+"?"+G.stringify({q:r}),{replace:!0})},[g,f.pathname]),be=(0,v.useCallback)(function(r,n,u){var l,m={};if((l=E.filter)!==null&&l!==void 0&&l.name_contains){var s;m.q=(s=E.filter)===null||s===void 0?void 0:s.name_contains}u&&(m.orderBy=u.field+"_"+(u.order==="ascend"?"asc":"desc")),m.page=r.current,g(f.pathname+"?"+G.stringify(m),{replace:!0})},[history,f.pathname,(C=E.filter)===null||C===void 0?void 0:C.name_contains]),z=(0,v.useCallback)(S()(h()().mark(function r(){var n,u,l,m,s,b=arguments;return h()().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:for(n=b.length,u=new Array(n),l=0;l<n;l++)u[l]=b[l];return D.next=3,Z({variables:{where:{id_in:u}}});case 3:return m=D.sent,s=m.data,D.abrupt("return",(s==null?void 0:s.result.count)||0);case 6:case"end":return D.stop()}},r)})),[Z]),J=(0,v.useCallback)(function(r){return S()(h()().mark(function n(){var u,l;return h()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return u="\u786E\u5B9A\u5220\u9664\u9009\u4E2D\u7684, \u5171 ".concat(r.length," \u4E2A\u4E8C\u7EF4\u7801\u5417\uFF1F"),s.next=3,t.Modal.confirm({title:"\u786E\u5B9A\u5220\u9664",content:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("p",{className:"tip-confirm",children:u}),(0,e.jsx)("p",{children:"\u5220\u9664\u7684\u64CD\u4F5C\u4E0D\u53EF\u9006,\u8BF7\u8C28\u614E\u64CD\u4F5C"})]}),okClassName:"btn-danger",okText:"\u5220\u9664"});case 3:if(l=s.sent,l.isConfirmed){s.next=6;break}return s.abrupt("return");case 6:return s.next=8,z.apply(void 0,L()(r));case 8:t.Toast.success("\u4E8C\u7EF4\u7801\u6279\u91CF\u5220\u9664\u6210\u529F",2e3,{placement:"bottom-left",progressBar:!0});case 9:case"end":return s.stop()}},n)}))},[z]),xe=(0,v.useCallback)(function(r,n){return S()(h()().mark(function u(){return h()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:U(n.map(function(s){return M()(M()({},s),{},{qrcode:"https://api.asany.cn/s/"+s.code})}));case 1:case"end":return m.stop()}},u)}))},[]),je=(0,v.useMemo)(function(){return function(r,n){return(0,e.jsxs)("div",{children:[(0,e.jsx)(t.Button,{color:"success",onClick:J(r),variant:!1,children:"\u6279\u91CF\u5220\u9664"}),(0,e.jsx)(t.Button,{color:"success",onClick:xe(r,n),variant:!1,children:"\u6253\u5370\u4E8C\u7EF4\u7801"})]})}},[J]),Be=(0,v.useState)(),K=Q()(Be,2),$=K[0],W=K[1],De=(0,v.useCallback)(function(r){console.log(r),W(r)},[]),Se=(0,v.useCallback)(function(){W(void 0)},[]);return(0,e.jsxs)(ne.vs,{header:{title:"\u8BBE\u5907\u4E8C\u7EF4\u7801"},children:[(0,e.jsxs)(t.Modal,{width:640,centered:!0,onOk:Ce,confirmLoading:he,okText:"\u4FDD\u5B58",visible:F,onCancel:function(){return j(!1)},children:[(0,e.jsx)(t.Modal.Header,{closable:!0,className:"ms-5 border-0",children:(0,e.jsx)("h1",{className:"modal-title pt-6 pb-4",children:"\u751F\u6210\u8BBE\u5907\u4E8C\u7EF4\u7801"})}),(0,e.jsx)(t.Modal.Body,{children:(0,e.jsxs)(t.Form,{form:p,initialValues:{numberRule:"NV-{YYYY}{MM}{DD}-{SEQ:3}",count:1},children:[(0,e.jsx)(t.Form.Item,{className:"d-flex flex-column mb-7",name:"numberRule",label:"\u8BBE\u5907\u7F16\u53F7\u89C4\u5219",help:"\u7F16\u53F7\u89C4\u5219\u652F\u6301\u53D8\u91CF\uFF1A{YYYY} {MM} {DD} {SEQ:3}",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u7F16\u53F7\u89C4\u5219"}],children:(0,e.jsx)(t.Input,{solid:!0,placeholder:"INV-{YYYY}{MM}{DD}-{SEQ:3}"})}),(0,e.jsx)(t.Form.Item,{className:"d-flex flex-column mb-7",name:"count",label:"\u751F\u6210\u6570\u91CF",children:(0,e.jsx)(t.Input,{solid:!0})})]})})]}),(0,e.jsxs)(t.Modal,{title:"\u9884\u89C8\u4E8C\u7EF4\u7801",dialogClassName:"w-250px",onCancel:Se,visible:!!$,centered:!0,okButtonProps:{style:{display:"none"}},children:[(0,e.jsx)("div",{className:"d-inline-block",children:!!$&&(0,e.jsx)(V.Qd,{size:200,value:$})}),(0,e.jsx)("span",{children:"\u4F7F\u7528\u624B\u673A\u626B\u7801\u4E8C\u7EF4\u7801\u9884\u89C8"})]}),(0,e.jsxs)("div",{className:"d-flex flex-wrap flex-stack pb-7",children:[(0,e.jsxs)("div",{className:"d-flex flex-wrap align-items-center",children:[(0,e.jsx)("h3",{className:"fw-bolder me-5",children:"\u8BBE\u5907\u4E8C\u7EF4\u7801"}),(0,e.jsx)(t.Input.Search,{onSearch:Ee,defaultValue:(y=E.filter)===null||y===void 0?void 0:y.name_contains,placeholder:"\u641C\u7D22",className:"border-body bg-body w-250px"})]}),(0,e.jsx)(re.ZX,{children:(0,e.jsx)("div",{className:"d-flex my-0",children:(0,e.jsx)(t.Button,{onClick:pe,children:"\u751F\u6210\u4E8C\u7EF4\u7801"})})})]}),!ge&&!B?(0,e.jsx)(t.Card,{className:"mb-5 mb-xl-10",children:(0,e.jsx)(t.Empty,{title:"\u8FD8\u6CA1\u6709\u8BBE\u5907\u4E8C\u7EF4\u7801",description:"\u9A6C\u4E0A\u6DFB\u52A0\u8BBE\u5907\u4E8C\u7EF4\u7801",image:"/assets/media/illustrations/sigma-1/4.png",children:(0,e.jsx)(t.Button,{variant:"primary",children:"\u751F\u6210\u4E8C\u7EF4\u7801"})})}):(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(t.Card,{className:"mb-5 mb-xl-10",children:(0,e.jsx)(t.Card.Body,{children:(0,e.jsx)(t.BlockUI,{overlayClassName:"bg-white bg-opacity-25",loading:B,children:(0,e.jsx)(t.Table,{hover:!0,rowKey:"id",rowSelection:{type:"checkbox",renderTitle:function(n){return(0,e.jsxs)(e.Fragment,{children:["\u5DF2\u9009\u4E2D",(0,e.jsx)("span",{className:"mx-2",children:n}),"\u4E2A\u4E8C\u7EF4\u7801"]})},toolbar:je},noRowsRenderer:function(){return(0,e.jsx)(t.Empty,{description:"\u5217\u8868\u6570\u636E\u4E3A\u7A7A",image:"/assets/media/illustrations/sigma-1/5.png"})},columns:[{key:"code",title:"\u7F16\u53F7",sorter:!0,sortOrder:A.field==="code"?A.order:void 0,width:80},{key:"url",title:"\u4E8C\u7EF4\u7801\u94FE\u63A5",sorter:!0,sortOrder:A.field==="url"?A.order:void 0,render:function(n){return(0,e.jsx)("div",{className:"text-gray-700",children:n})}},{key:"createdAt",title:"\u521B\u5EFA\u65F6\u95F4",width:200},{key:"accessCount",title:"\u8BBF\u95EE\u6B21\u6570",width:120},{key:"qrCode",title:"\u4E8C\u7EF4\u7801",width:180,render:function(n,u){var l="https://api.asany.cn/s/"+u.code;return(0,e.jsx)(V.Qd,{onClick:function(s){s.preventDefault(),s.stopPropagation(),De("https://api.asany.cn/s/"+u.code)},size:30,value:l})}}],pagination:ye,onChange:be,dataSource:Fe})})})})})]})}var de=ie}}]);

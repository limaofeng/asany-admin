"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[489],{60489:function(Ee,Q,t){var Z=t(19632),H=t.n(Z),z=t(5574),C=t.n(z),G=t(97857),b=t.n(G),X=t(15009),j=t.n(X),Y=t(64599),J=t.n(Y),q=t(99289),S=t.n(q),d=t(62435),T=t(46027),A=t(5618),n=t(79817),ee=t(8606),U=t(32115),ae=t(12708),x=t(74600),e=t(86074),N={validator:function(g,v){return S()(j()().mark(function r(){var f,P,o;return j()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:f=J()(v),i.prev=1,f.s();case 3:if((P=f.n()).done){i.next=9;break}if(o=P.value,!(0,A.Le)(o)){i.next=7;break}throw new Error("\u7535\u5B50\u90AE\u4EF6\u5730\u5740\u65E0\u6548");case 7:i.next=3;break;case 9:i.next=14;break;case 11:i.prev=11,i.t0=i.catch(1),f.e(i.t0);case 14:return i.prev=14,f.f(),i.finish(14);case 17:case"end":return i.stop()}},r,null,[[1,11,14,17]])}))()}};function I(u){return(0,e.jsx)(A.ZP,b()({className:"email-tags-input border-0 form-control form-control-transparent",validate:A.Le,parseTag:A.N8},u))}function re(u){return(0,e.jsx)(n.QuillEditor,b()({},u))}function L(u){var g;if(!u)return{sending:!1,mode:"plain",disabled:!0,autoSaveState:"default",recipients:[],title:""};var v=[];return u.cc.length&&v.push("cc"),u.bcc.length&&v.push("bcc"),{message:u,sending:!1,disabled:!u.to||!u.to.length,autoSaveState:"default",title:u.subject,recipients:v,mode:(g=u.mimeType)!==null&&g!==void 0&&g.endsWith("html")?"html":"plain"}}function se(u){var g=u.onAutoSave,v=u.onSend,r=(0,d.useRef)(L(u.message)),f=(0,d.useReducer)(function(s){return s+1},0),P=C()(f,2),o=P[1],w=(0,x.gi)({refetchQueries:[x.Nd]}),i=C()(w,1),ne=i[0],ue=(0,x.qX)({refetchQueries:[x.Nd]}),te=C()(ue,1),le=te[0],ie=(0,x.do)({refetchQueries:[x.Nd]}),de=C()(ie,1),K=de[0],oe=(0,ee.useAutoSave)(function(){var s=S()(j()().mark(function l(m,h){var y,D,E,p,c;return j()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(y=r.current.message,y){a.next=9;break}return a.next=4,ne({variables:{input:h}});case 4:D=a.sent,E=D.data,r.current.message=E==null?void 0:E.message,a.next=14;break;case 9:return a.next=11,le({variables:{id:y.id,input:h}});case 11:p=a.sent,c=p.data,r.current.message=c==null?void 0:c.message;case 14:g(r.current.message);case 15:case"end":return a.stop()}},l)}));return function(l,m){return s.apply(this,arguments)}}(),r.current.message||{}),W=C()(oe,2),O=W[0],R=W[1],_=n.Form.useForm(),k=(0,d.useRef)(null),F=(0,d.useCallback)(function(s){return function(){r.current.recipients.includes(s)?r.current.recipients=r.current.recipients.filter(function(l){return l!==s}):r.current.recipients=[].concat(H()(r.current.recipients),[s]),o()}},[]),_e=(0,d.useCallback)(function(){var s=r.current.mode==="plain"?"html":"plain",l=_.getFieldValue("body");s==="plain"?_.setFieldsValue({body:(0,U.Kv)(l,{text:"format"})}):_.setFieldsValue({body:(0,U.vb)(l)}),r.current.mode=s;var m=_.getFieldsValue();O(b()(b()({},m),{},{mimeType:"text/".concat(r.current.mode)}))},[_,O]);(0,d.useEffect)(function(){if(r.current.mode!=="plain"){var s=document.querySelector(".ql-toolbar");s==null||s.classList.add("px-5","border-top-0","border-start-0","border-end-0");var l=document.querySelector(".ql-container");l==null||l.classList.add("bg-transparent","border-0","px-3","ql-snow")}},[r.current.mode]);var ce=(0,d.useCallback)(function(s){var l;(l=k.current)===null||l===void 0||l.browse(s)},[]),me=(0,d.useCallback)(function(s,l){console.log("changedValues",s),s.hasOwnProperty("subject")&&(r.current.title=s.subject,o()),s.hasOwnProperty("to")&&(!s.to||!s.to.length?r.current.disabled||(r.current.disabled=!0,o()):r.current.disabled&&(r.current.disabled=!1,o())),O(b()(b()({},l),{},{mimeType:"text/".concat(r.current.mode)}))},[O]),be=(0,d.useCallback)(S()(j()().mark(function s(){var l,m,h,y,D,E,p,c;return j()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,(l=k.current)===null||l===void 0?void 0:l.uploadAll();case 2:return a.prev=2,a.next=5,_.validateFields();case 5:if(m=a.sent,!(!m.subject||!m.body)){a.next=15;break}return h=[],m.subject||h.push("\u4E3B\u9898"),m.body||h.push("\u6B63\u6587"),a.next=12,n.Modal.confirm({title:"\u6B64\u90AE\u4EF6\u6CA1\u6709"+h.join("\u548C"),content:"\u662F\u5426\u4ECD\u8981\u53D1\u9001\u90AE\u4EF6\uFF1F",okText:"\u4ECD\u7136\u53D1\u9001"});case 12:if(y=a.sent,y.isConfirmed){a.next=15;break}return a.abrupt("return");case 15:return r.current.sending=!0,o(),a.prev=17,a.next=20,(0,ae.gw)(K({variables:{id:r.current.message.id}}),350);case 20:D=a.sent,n.Modal.success({title:"\u64CD\u4F5C\u6210\u529F",content:"\u90AE\u4EF6\u5DF2\u6210\u529F\u53D1\u9001",timer:3e3}),v(D.data.message),a.next=30;break;case 25:a.prev=25,a.t0=a.catch(17),r.current.sending=!1,o(),n.Modal.error({title:"\u9519\u8BEF",content:a.t0.message});case 30:a.next=38;break;case 32:a.prev=32,a.t1=a.catch(2),E=a.t1,p=E.errorFields[0],p.name.includes("to")?c="\u201C\u6536\u4EF6\u4EBA\uFF1A\u201D\u5B57\u6BB5\u4E2D\u7684\u4E00\u4E2A\u6216\u591A\u4E2A\u5730\u5740\u65E0\u6548\u3002\u8BF7\u5728\u7EA0\u6B63\u540E\u91CD\u8BD5\u3002":p.name.includes("cc")?c="\u201C\u6284\u9001\uFF1A\u201D\u5B57\u6BB5\u4E2D\u7684\u4E00\u4E2A\u6216\u591A\u4E2A\u5730\u5740\u65E0\u6548\u3002\u8BF7\u5728\u7EA0\u6B63\u540E\u91CD\u8BD5\u3002":p.name.includes("bcc")?c="\u201C\u5BC6\u9001\uFF1A\u201D\u5B57\u6BB5\u4E2D\u7684\u4E00\u4E2A\u6216\u591A\u4E2A\u5730\u5740\u65E0\u6548\u3002\u8BF7\u5728\u7EA0\u6B63\u540E\u91CD\u8BD5\u3002":c="\u8BF7\u5728\u7EA0\u6B63\u540E\u91CD\u8BD5\u3002",n.Modal.error({title:p.errors[0],content:c});case 38:case"end":return a.stop()}},s,null,[[2,32],[17,25]])})),[_,v,K]);(0,d.useMemo)(function(){return R?r.current.autoSaveState="saving":r.current.autoSaveState!=="default"?r.current.autoSaveState="saved":r.current.autoSaveState},[R]),(0,d.useEffect)(function(){var s;!u.message||u.message.id===((s=r.current.message)===null||s===void 0?void 0:s.id)||(r.current=L(u.message),_.setFieldsValue(b()({},u.message)),o())},[_,u.message]);var M=r.current,ve=M.message,B=M.recipients,pe=M.mode,$=M.autoSaveState,fe=M.disabled,V=M.sending;return console.log("recipients",B),(0,e.jsxs)(n.Card,{className:"email-compose-editor",children:[(0,e.jsxs)(n.Card.Header,{children:[(0,e.jsx)(n.Card.Title,{children:r.current.title||"\u65B0\u4FE1\u606F"}),(0,e.jsxs)(n.Card.Toolbar,{className:"text-gray-600",children:[$==="saving"&&"\u6B63\u5728\u5B58\u50A8\u8349\u7A3F...",$==="saved"&&"\u5DF2\u5B58\u50A8"]})]}),(0,e.jsx)(n.Card.Body,{className:"p-0",children:(0,e.jsxs)(n.Form,{form:_,initialValues:b()({},ve||{}),onValuesChange:me,id:"kt_inbox_compose_form",children:[(0,e.jsxs)("div",{className:"email-compose-editor-body",children:[(0,e.jsxs)("div",{className:"d-flex align-items-center border-bottom px-8 min-h-45px",children:[(0,e.jsx)("div",{className:"text-dark fw-bolder w-75px",children:"\u6536\u4EF6\u4EBA:"}),(0,e.jsx)(n.Form.Item,{noStyle:!0,name:"to",rules:[N],children:(0,e.jsx)(I,{placeholder:"\u8F93\u5165\u6536\u4EF6\u4EBA\u90AE\u7BB1"})}),(0,e.jsxs)("div",{className:"ms-auto w-75px text-end",children:[!B.includes("cc")&&(0,e.jsx)("span",{onClick:F("cc"),className:"text-muted fs-bold cursor-pointer text-hover-primary me-2",children:"\u6284\u9001"}),!B.includes("bcc")&&(0,e.jsx)("span",{onClick:F("bcc"),className:"text-muted fs-bold cursor-pointer text-hover-primary",children:"\u5BC6\u9001"})]})]}),B.includes("cc")&&(0,e.jsxs)("div",{className:"align-items-center border-bottom ps-8 pe-5 min-h-45px d-flex",children:[(0,e.jsx)("div",{className:"text-dark fw-bolder w-75px",children:"\u6284\u9001:"}),(0,e.jsx)(n.Form.Item,{noStyle:!0,name:"cc",rules:[N],children:(0,e.jsx)(I,{placeholder:"\u8F93\u5165\u6284\u9001\u90AE\u7BB1"})}),(0,e.jsx)("span",{className:"btn btn-clean btn-xs btn-icon",onClick:F("cc"),children:(0,e.jsx)("i",{className:"la la-close"})})]}),B.includes("bcc")&&(0,e.jsxs)("div",{className:"align-items-center border-bottom inbox-to-bcc ps-8 pe-5 min-h-45px d-flex",children:[(0,e.jsx)("div",{className:"text-dark fw-bolder w-75px",children:"\u5BC6\u9001:"}),(0,e.jsx)(n.Form.Item,{noStyle:!0,name:"bcc",rules:[N],children:(0,e.jsx)(I,{placeholder:"\u8F93\u5165\u5BC6\u9001\u90AE\u7BB1"})}),(0,e.jsx)("span",{className:"btn btn-clean btn-xs btn-icon",onClick:F("bcc"),children:(0,e.jsx)("i",{className:"la la-close"})})]}),(0,e.jsxs)("div",{className:"d-flex align-items-center border-bottom px-8 min-h-45px",children:[(0,e.jsx)("div",{className:"text-dark fw-bolder w-75px",children:"\u4E3B\u9898:"}),(0,e.jsx)(n.Form.Item,{noStyle:!0,name:"subject",children:(0,e.jsx)(n.Input,{className:"border-0 min-h-45px",placeholder:"\u8F93\u5165\u4E3B\u9898",transparent:!0})})]}),(0,e.jsx)(n.Form.Item,{noStyle:!0,name:"body",children:(0,e.jsx)(re,{mode:pe})}),(0,e.jsx)(n.Form.Item,{noStyle:!0,name:"attachments",children:(0,e.jsx)(n.Upload.Queue,{className:"px-8 py-4",auto:!0,ref:k,namespace:"email"})})]}),(0,e.jsxs)("div",{className:"d-flex flex-stack flex-wrap gap-2 py-5 ps-8 pe-5 border-top",children:[(0,e.jsx)("div",{className:"d-flex align-items-center me-3",children:(0,e.jsx)("div",{className:"btn-group me-4",children:(0,e.jsx)(n.Button,{htmlType:"button",loading:V,size:"lg",className:"rounded-2 fs-bold px-10",variant:"primary",icon:(0,e.jsx)(T.ZP,{name:"Duotune/gen016",className:"svg-icon-1 ms-n4 me-4"}),disabled:R||fe,onClick:be,children:V?"\u53D1\u9001\u4E2D...":"\u53D1\u9001"})})}),(0,e.jsxs)("div",{className:"d-flex align-items-center",children:[(0,e.jsx)(n.Tooltip,{title:"\u6DFB\u52A0\u9644\u4EF6",placement:"top",children:(0,e.jsx)("span",{onClick:ce,className:"btn btn-icon btn-sm btn-clean btn-active-light-primary me-2 dz-clickable",children:(0,e.jsx)(T.ZP,{className:"svg-icon-2 m-0",name:"Duotune/com008"})})}),(0,e.jsx)(n.Tooltip,{title:"\u5207\u6362\u7F16\u8F91\u5668",placement:"top",children:(0,e.jsx)(n.Button,{as:"span",variant:"clean",activeColor:"light-primary",className:"btn-clean",icon:(0,e.jsx)(T.ZP,{className:"svg-icon-2",name:"Duotune/art001"}),onClick:_e})})]})]})]})})]})}Q.Z=se}}]);

(self.webpackChunkasany_admin=self.webpackChunkasany_admin||[]).push([[2015],{2015:function(Ye,ke,v){"use strict";v.d(ke,{Z:function(){return Oe}});var g=v(93224),m=v(39428),D=v(3182),B=v(2824),Q=v(11849),le=v(86582),r=v(67294),P=v(28865),xe=v(94184),G=v.n(xe),ye=v(13356),je=v(51615),ue=v(7020),e=v(85893);function be(l){var n=l.paths,a=l.onClick;console.log("FolderPath",n);var y=(0,r.useCallback)(function(F){return function(h){h.preventDefault(),h.stopPropagation(),a(F)}},[a]);return(0,e.jsx)("div",{className:"folder-path badge badge-lg badge-white",children:(0,e.jsx)("div",{className:"d-flex align-items-center flex-wrap",children:n.map(function(F,h){var p=h==0,$=h==n.length-1;return(0,e.jsxs)(r.Fragment,{children:[!p&&(0,e.jsx)(P.ZP,{name:p?"Duotune/abs039":"Duotune/arr071",className:G()("svg-icon-2 svg-icon-primary",{"mx-1":!p,"me-3":p})}),$?F.name:(0,e.jsx)("a",{href:h==0?"/drive/my-drive":"/drive/folders/".concat(F.id),onClick:y(F),children:F.name})]},F.id)})})})}var De=be,H=v(14928),he=v(1861),M=v(73727),s=v(17818),Se=v(54108);function Pe(){return(0,e.jsx)(e.Fragment,{children:"\u65E5\u5FD7"})}function Me(l){var n=(0,r.useState)(l.file),a=(0,B.Z)(n,2),y=a[0],F=a[1],h=(0,H.lK)({fetchPolicy:"cache-and-network",variables:{id:l.file.id}}),p=h.data,$=h.loading;return(0,r.useEffect)(function(){(p==null?void 0:p.file)&&F(p==null?void 0:p.file)},[p==null?void 0:p.file]),(0,e.jsxs)(s.bH,{overlayClassName:"bg-white bg-opacity-25",className:"pt-5",loading:$,children:[!y.isDirectory&&(0,e.jsx)("div",{className:"file-preview mb-6",children:(0,e.jsx)(s.mN,{src:"https://api.asany.cn/graphql"+"/thumbnail/".concat(y.id,"?size=120x120")})}),!1,(0,e.jsx)("div",{className:"fs-6 text-gray-800 mb-4",children:"\u7CFB\u7EDF\u5C5E\u6027"}),(0,e.jsxs)("div",{className:"row mb-4",children:[(0,e.jsx)("label",{className:"col-lg-3 fw-bold text-muted",children:"\u7C7B\u578B"}),(0,e.jsx)("div",{className:"col-lg-9",children:(0,e.jsx)("span",{className:"fs-7 text-gray-800",children:y.isDirectory?"\u6587\u4EF6\u5939":y.mimeType})})]}),!y.isDirectory&&(0,e.jsxs)("div",{className:"row mb-4",children:[(0,e.jsx)("label",{className:"col-lg-3 fw-bold text-muted",children:"\u5927\u5C0F"}),(0,e.jsx)("div",{className:"col-lg-9 fv-row",children:(0,e.jsx)("span",{className:"fs-7 text-gray-800",children:(0,Se.jb)(y.size)})})]}),(0,e.jsxs)("div",{className:"row mb-4",children:[(0,e.jsx)("label",{className:"col-lg-3 fw-bold text-muted",children:"\u4F4D\u7F6E"}),(0,e.jsxs)("div",{className:"col-lg-9 d-flex align-items-center flex-wrap",children:[(0,e.jsx)(M.Link,{className:"tw-truncate mw-90px",to:"/drive/my-drive",children:"\u5168\u90E8\u6587\u4EF6"}),(y.parents||[]).map(function(z){return(0,e.jsxs)(r.Fragment,{children:[(0,e.jsx)(P.ZP,{name:"Duotune/arr071",className:G()("svg-icon-5 svg-icon-primary")}),(0,e.jsx)(M.Link,{className:"tw-truncate mw-90px",to:"/drive/folders/".concat(z.id),children:z.name})]},z.id)})]})]}),(0,e.jsxs)("div",{className:"row mb-4",children:[(0,e.jsx)("label",{className:"col-lg-3 fw-bold text-muted",children:"\u4FEE\u6539\u65F6\u95F4"}),(0,e.jsx)("div",{className:"col-lg-9",children:(0,e.jsx)("span",{className:"fs-7 text-gray-800",children:y.lastModified})})]}),(0,e.jsxs)("div",{className:"row mb-4",children:[(0,e.jsx)("label",{className:"col-lg-3 fw-bold text-muted",children:"\u521B\u5EFA\u65F6\u95F4"}),(0,e.jsx)("div",{className:"col-lg-9",children:(0,e.jsx)("span",{className:"fs-7 text-gray-800",children:y.createdAt})})]}),(0,e.jsxs)("div",{className:"row mb-4",children:[(0,e.jsx)("label",{className:"col-lg-3 fw-bold text-muted",children:"\u8BF4\u660E"}),(0,e.jsx)("div",{className:"col-lg-9",children:(0,e.jsx)("span",{className:"fs-7 text-gray-800",children:y.description})})]})]})}function $e(l){var n=l.file;return(0,e.jsxs)(s.mQ,{className:"nav-line-tabs-2x",children:[(0,e.jsx)(s.mQ.TabPane,{tab:"\u6587\u4EF6\u8BE6\u60C5",children:(0,e.jsx)(he.E,{className:"flex-column-fluid custom-scrollbar",options:{scrollbars:{autoHide:"scroll"}},children:(0,e.jsx)(Me,{file:n})})},"file-details"),(0,e.jsx)(s.mQ.TabPane,{tab:"\u64CD\u4F5C\u8BB0\u5F55",children:(0,e.jsx)(he.E,{className:"flex-column-fluid custom-scrollbar",options:{scrollbars:{autoHide:"scroll"}},children:(0,e.jsx)(Pe,{})})},"action-records")]})}function ze(l){var n=l.files,a=l.currentFolder,y=(0,r.useMemo)(function(){return n.length==1?"file_details":n.length>1?"many_file_details":"current_folder"},[n]),F=(0,r.useMemo)(function(){return y==="file_details"?n[0].name:y==="many_file_details"?"\u591A\u4E2A\u6587\u4EF6":(a==null?void 0:a.name)||""},[a==null?void 0:a.name,n,y]),h=(0,r.useMemo)(function(){var K=F.lastIndexOf(".");return K==-1?[F,void 0]:[F.substring(0,K),F.substring(K+1)]},[F]),p=(0,B.Z)(h,2),$=p[0],z=p[1];return(0,e.jsxs)("div",{className:"preview-container",children:[(0,e.jsx)("div",{className:"preview-header",children:(0,e.jsx)("h4",{className:G()({"tw-truncate":!z,"d-flex":z}),children:z?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("span",{className:"file-title shrink tw-truncate",children:$}),(0,e.jsxs)("span",{className:"file-suffix",children:[".",z]})]}):$})}),(0,e.jsx)("div",{className:"preview-body",children:y=="file_details"&&(0,e.jsx)($e,{file:n[0]})})]})}var Be=ze,oe=v(25496);function We(l){var n=l.data,a=l.editable,y=l.onClick,F=l.onCancelRename,h=l.onSuccess,p=(0,r.useRef)(null),$=(0,r.useState)(!1),z=(0,B.Z)($,2),K=z[0],b=z[1],ce=(0,r.useState)(n.name),J=(0,B.Z)(ce,2),I=J[0],W=J[1],q=(0,H.Ep)(),ne=(0,B.Z)(q,1),Z=ne[0],u=(0,r.useCallback)(function(f){W(f.target.value)},[]),t=(0,r.useCallback)(function(){var f=(0,D.Z)((0,m.Z)().mark(function O(E){var ae,ee,N;return(0,m.Z)().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return E.stopPropagation(),A.prev=1,b(!0),A.next=5,(0,oe.gw)(Z({variables:{id:n.id,name:I}}),350);case 5:return ae=A.sent,ee=ae.data,h(ee.file),A.next=10,(0,oe._v)(350);case 10:b(!1),F(),A.next=22;break;case 14:return A.prev=14,A.t0=A.catch(1),b(!1),A.next=19,s.FN.error(A.t0.message,2e5,{progressBar:!0,placement:"middle-center"});case 19:return A.next=21,(0,oe._v)(300);case 21:(N=p.current)===null||N===void 0||N.select();case 22:case"end":return A.stop()}},O,null,[[1,14]])}));return function(O){return f.apply(this,arguments)}}(),[n.id,I,F,h,Z]),L=(0,r.useCallback)(function(f){f.preventDefault(),t(f)},[t]),_=(0,r.useCallback)(function(f){f.stopPropagation(),f.preventDefault(),F()},[F]),R=(0,r.useCallback)(function(f){y(n),f.preventDefault(),f.stopPropagation()},[n,y]);(0,r.useEffect)(function(){var f;W(function(){return n.name}),!!a&&((f=p.current)===null||f===void 0||f.select(0,n.name.length-(n.extension?n.extension.length+1:0)))},[n.extension,n.name,a]);var j=(0,r.useCallback)(function(f){a&&(f.stopPropagation(),f.preventDefault())},[a]),V=(0,r.useMemo)(function(){var f,O;return((f=n.mimeType)===null||f===void 0?void 0:f.startsWith("image/"))||((O=n.mimeType)===null||O===void 0?void 0:O.startsWith("video/"))},[n.mimeType]);return(0,e.jsxs)("div",{onClick:j,className:G()("d-flex align-items-center",{"no-selecto-drag":a}),children:[(0,e.jsxs)("div",{className:"title-icon-container position-relative me-1 d-flex align-items-center justify-content-center",children:[V?(0,e.jsx)(s.mN,{alt:(0,e.jsx)(P.ZP,{name:"Duotune/".concat(n.isDirectory?"fil012":"fil003"),className:"svg-icon-2x svg-icon-primary"}),src:"https://api.asany.cn/graphql"+"/thumbnail/".concat(n.id,"?size=120x120")}):(0,e.jsx)(P.ZP,{name:"Duotune/".concat(n.isDirectory?"fil012":"fil003"),className:"svg-icon-2x svg-icon-primary"}),n.starred&&(0,e.jsx)(P.ZP,{name:"Bootstrap/star-fill",className:"position-absolute starred-flag"})]}),a?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(s.II,{ref:p,value:I,onChange:u,onPressEnter:L,placeholder:"\u8F93\u5165\u65B0\u6587\u4EF6\u5939\u540D\u79F0",size:"sm",className:"mw-250px me-3"}),(0,e.jsx)(s.zx,{as:"button",loading:K,variant:"light-primary",size:"sm",icon:(0,e.jsx)(P.ZP,{name:"Duotune/arr085",className:"svg-icon-1"}),className:"me-3",onClick:t}),(0,e.jsx)(s.zx,{as:"button",size:"sm",variant:"light-danger",icon:(0,e.jsx)(P.ZP,{name:"Duotune/arr088",className:"svg-icon-1"}),className:"svg-icon-1",onClick:_})]}):(0,e.jsx)("a",{className:"text-gray-800 text-hover-primary no-selecto-drag",onClick:R,href:n.isDirectory?"/drive/folders/".concat(n.id):"/preview/".concat(n.id),children:n.name})]})}var Ae=We;function Te(l){var n=l.visible,a=l.onCancel,y=l.onSuccess,F=l.parentFolder,h=(0,r.useState)("\u672A\u547D\u540D\u6587\u4EF6\u5939"),p=(0,B.Z)(h,2),$=p[0],z=p[1],K=(0,r.useState)(!1),b=(0,B.Z)(K,2),ce=b[0],J=b[1],I=(0,H.we)(),W=(0,B.Z)(I,2),q=W[0],ne=W[1].loading,Z=(0,r.useRef)(null),u=(0,r.useCallback)(function(){a()},[a]),t=(0,r.useCallback)(function(R){z(R.target.value),J(!R.target.value)},[]),L=(0,r.useCallback)((0,D.Z)((0,m.Z)().mark(function R(){var j,V,f;return(0,m.Z)().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:if($){E.next=2;break}return E.abrupt("return");case 2:return E.prev=2,E.next=5,q({variables:{name:$,parentFolder:F}});case 5:j=E.sent,V=j.data,a&&a(),(V==null?void 0:V.folder)&&y(V.folder),s.FN.success("\u6587\u4EF6\u5939\u65B0\u589E\u6210\u529F",2e3,{progressBar:!0,placement:"bottom-start"}),E.next=19;break;case 12:return E.prev=12,E.t0=E.catch(2),E.next=16,s.FN.error(E.t0.message,2e3,{progressBar:!0});case 16:return E.next=18,(0,oe._v)(300);case 18:(f=Z.current)===null||f===void 0||f.select();case 19:case"end":return E.stop()}},R,null,[[2,12]])})),[q,a,y,F,$]),_=(0,r.useCallback)(function(){L()},[L]);return(0,r.useEffect)(function(){if(n){var R;(R=Z.current)===null||R===void 0||R.select()}else z("\u672A\u547D\u540D\u6587\u4EF6\u5939"),J(!1)},[n]),(0,e.jsx)(s.u_,{centered:!0,visible:n,dialogClassName:"modal-dialog-small w-400px",onCancel:u,onOk:L,title:"\u65B0\u5EFA\u6587\u4EF6\u5939",closable:!1,okButtonProps:{loading:ne,className:G()({disabled:ce})},headerClassName:"border-bottom-0",bodyClassName:"py-2",footerClassName:"border-top-0",children:(0,e.jsx)(s.II,{ref:Z,onPressEnter:_,onChange:t,value:$})})}var Re=Te,Ie=["role","tabIndex","onClick"];function Ce(l,n){var a=l?[{id:l.id,name:l.name,isDirectory:!0,isRootFolder:!0,path:"/"}]:[];return!!n&&n.id!==(l==null?void 0:l.id)&&(n.parents&&a.push.apply(a,(0,le.Z)(n.parents)),n.isRootFolder||a.push((0,Q.Z)({},n))),a}function Le(l){var n=l.folder,a=l.rootFolder,y=l.filter,F=l.toolbar,h=F===void 0?"default":F,p=(0,je.k6)(),$=(0,ue.tT)("cloud-drive.index",function(i){var d=i.state;return d.cloudDrive}),z=(0,ue.tT)("cloud-drive.index",function(i){return i.upload}),K=(0,ue.tT)("cloud-drive.index",function(i){return i.download}),b=(0,r.useRef)({sorter:l.orderBy||{field:"name",order:"ascend"},rootFolder:a,newFolderVisible:!1,currentFolder:l.currentFolder}),ce=(0,r.useReducer)(function(i){return i+1},0),J=(0,B.Z)(ce,2),I=J[1],W=(0,r.useCallback)(function(){b.current.newFolderVisible=!0,I()},[]),q=(0,r.useCallback)(function(){b.current.newFolderVisible=!1,I()},[]),ne=(0,H.rn)({fetchPolicy:"cache-and-network",variables:{folder:n}}),Z=ne.data,u=(0,H.tz)(),t=(0,B.Z)(u,1),L=t[0],_=(0,H._D)(),R=(0,B.Z)(_,1),j=R[0],V=(0,H.HD)(),f=(0,B.Z)(V,1),O=f[0],E=(0,H.fX)(),ae=(0,B.Z)(E,1),ee=ae[0],N=b.current.sorter,Ze=(0,r.useMemo)(function(){return N?"isDirectory_desc,"+N.field+"_"+(N.order=="ascend"?"asc":"desc"):"isDirectory_desc,name_asc"},[N]),A=(0,H.Eo)(a==null?void 0:a.id,y,Ze),Y=(0,B.Z)(A,4),U=Y[0],de=Y[1],Ue=Y[2],Fe=Y[3],se=Fe.loadedCount,te=Fe.allItems,Ne=Fe.refetch,pe=Fe.refetchForObjects,me=Fe.refetchWithRemoveForObjects,ve=(0,r.useMemo)(function(){return{loadedCount:se,rowCount:U.totalCount,get items(){return te()},useItem:Ue}},[te,se,U.totalCount,Ue]),qe=(0,r.useState)([]),Xe=(0,B.Z)(qe,2),k=Xe[0],ie=Xe[1],fe=(0,r.useMemo)(function(){return l.currentFolder&&Z!==null&&Z!==void 0&&Z.currentFolder&&l.currentFolder.id!=Z.currentFolder.id&&l.currentFolder.path.startsWith(Z.currentFolder.path)?b.current.currentFolder=l.currentFolder:Z!=null&&Z.currentFolder?b.current.currentFolder=Z==null?void 0:Z.currentFolder:b.current.currentFolder},[Z==null?void 0:Z.currentFolder,l.currentFolder]),_e=(0,r.useCallback)(function(i){ie(i)},[ie]),er=(0,r.useCallback)(function(){var i=(0,D.Z)((0,m.Z)().mark(function d(o){return(0,m.Z)().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.next=2,pe([o],function(C,x){return C.id==x.id});case 2:case"end":return w.stop()}},d)}));return function(d){return i.apply(this,arguments)}}(),[pe]),T=(0,r.useMemo)(function(){if(k.length==1)return te().find(function(i){return i&&i.id==k[0]})},[te,k]),rr=(0,r.useCallback)(function(){b.current.renameFile=void 0,I()},[]),nr=(0,r.useMemo)(function(){return Ce(a,fe)},[a,fe]),Ge=(0,r.useCallback)(function(){var i=(0,D.Z)((0,m.Z)().mark(function d(o){var c,w,C;return(0,m.Z)().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:if(h!="trash"){S.next=4;break}return S.next=3,s.u_.confirm({title:(0,e.jsxs)(e.Fragment,{children:["\u6B64\u6587\u4EF6",o.isDirectory&&"\u5939","\u4F4D\u4E8E\u60A8\u7684\u56DE\u6536\u7AD9\u4E2D"]}),content:(0,e.jsxs)(e.Fragment,{children:["\u8981\u67E5\u770B\u8BE5\u6587\u4EF6",o.isDirectory&&"\u5939","\uFF0C\u60A8\u9700\u8981\u5C06\u5176\u4ECE\u56DE\u6536\u7AD9\u8FD8\u539F\u3002"]}),okText:"\u8FD8\u539F"});case 3:return S.abrupt("return");case 4:if(!o.isDirectory){S.next=9;break}return c=(0,Q.Z)({},o),o.isRootFolder||(w=[].concat((0,le.Z)(Ce(b.current.rootFolder,b.current.currentFolder)),[c]),c.parents=w.slice(1,w.length-1),C=c.parents.findIndex(function(X){return X.path==o.path}),C!=-1&&(c.parents=c.parents.slice(0,C))),o.isRootFolder?p.push("/drive/my-drive",{rootFolder:a,currentFolder:c,orderBy:b.current.sorter}):p.push("/drive/folders/".concat(o.id),{rootFolder:a,currentFolder:c,orderBy:b.current.sorter}),S.abrupt("return");case 9:case"end":return S.stop()}},d)}));return function(d){return i.apply(this,arguments)}}(),[h,p,a]),ar=(0,r.useCallback)(function(){return(0,e.jsxs)("div",{className:"clouddrive-listfiles-no-rows d-flex flex-column flex-center",children:[(0,e.jsx)("img",{src:"/assets/media/illustrations/sketchy-1/5.png",className:"mw-200px"}),(0,e.jsx)("div",{className:"fs-1 fw-bolder text-dark mb-4",children:"\u5C06\u6587\u4EF6\u62D6\u62FD\u5230\u6B64\u5904"}),(0,e.jsxs)("div",{className:"fs-6",children:["\u6216\u70B9\u51FB \u201C",(0,e.jsx)("span",{className:"text-success",children:"\u4E0A\u4F20"}),"\u201D \u6309\u94AE"]})]})},[]),sr=(0,r.useCallback)(function(){return U.totalCount==se&&se==0?de?(0,e.jsx)(e.Fragment,{children:"\u52A0\u8F7D\u4E2D...."}):(0,e.jsx)(e.Fragment,{}):(0,e.jsxs)(e.Fragment,{children:[U.totalCount==se?(0,e.jsx)(e.Fragment,{children:"\u5DF2\u5168\u90E8\u52A0\u8F7D"}):(0,e.jsxs)(e.Fragment,{children:["\u5DF2\u52A0\u8F7D ",se," \u4E2A"]}),"\uFF0C\u5171 ",U.totalCount," \u4E2A"]})},[se,de,U.totalCount]),Qe=te().filter(function(i){return k.includes(i.id)}).every(function(i){return i.starred}),tr=(0,r.useCallback)(function(i,d,o){b.current.sorter=o,I()},[]),ir=(0,r.useMemo)(function(){return ve.items.filter(function(i){return k.some(function(d){return d==i.id})})},[ve,k]),lr=(0,r.useCallback)(function(){var i=(0,D.Z)((0,m.Z)().mark(function d(o){var c;return(0,m.Z)().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return C.next=2,Ne(1);case 2:c=te(),c.some(function(x){return x&&x.id==o.id})&&ie([o.id]);case 4:case"end":return C.stop()}},d)}));return function(d){return i.apply(this,arguments)}}(),[Ne,te]),we=(fe==null?void 0:fe.id)||(a==null?void 0:a.id);(0,r.useEffect)(function(){ie([])},[we,a==null?void 0:a.name]);var ur=(0,r.useCallback)(function(i){z(i,{space:$.space,folder:we})},[$,we,z]),He=(0,ye.uI)({onDrop:ur}),or=He.getRootProps,cr=He.getInputProps,dr=He.isDragActive;console.log("isDragActive",dr);var Ee=or(),xr=Ee.role,yr=Ee.tabIndex,Ve=Ee.onClick,mr=(0,g.Z)(Ee,Ie),vr=(0,r.useCallback)(function(i){Ve&&Ve(i)},[Ve]),fr=(0,r.useCallback)((0,D.Z)((0,m.Z)().mark(function i(){var d,o,c;return(0,m.Z)().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:d=ve.items,o=d.filter(function(x){return k.includes(x.id)}),c=o.length==1?o[0].name:"\u3010\u6279\u91CF\u4E0B\u8F7D\u3011".concat(o[0].name," \u7B49 (").concat(o.length,").zip"),K(o,c);case 4:case"end":return C.stop()}},i)})),[ve,K,k]),hr=(0,r.useCallback)((0,D.Z)((0,m.Z)().mark(function i(){var d,o,c,w;return(0,m.Z)().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return d=T?T!=null&&T.isDirectory?"\u6587\u4EF6\u5939":"\u6587\u4EF6":k.length+" \u9879\u5185\u5BB9",x.next=3,s.u_.confirm({title:"\u786E\u5B9A\u5220\u9664",content:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("p",{className:"tip-confirm",children:"\u786E\u5B9A\u5220\u9664\u6240\u9009\u7684\u6587\u4EF6\u5417\uFF1F"}),(0,e.jsx)("p",{children:"\u5220\u9664\u7684\u6587\u4EF6\u53EF\u5728 10\u5929 \u5185\u901A\u8FC7\u56DE\u6536\u7AD9\u8FD8\u539F"})]}),icon:"info",okText:"\u5220\u9664"});case 3:if(o=x.sent,o.isConfirmed){x.next=6;break}return x.abrupt("return");case 6:return x.next=8,j({variables:{ids:k}});case 8:c=x.sent,w=c.data,ie([]),me(w==null?void 0:w.files,function(S,X){return S.id==X.id}),s.FN.success(d+" \u5DF2\u79FB\u81F3\u56DE\u6536\u7AD9",2e3,{placement:"bottom-start",progressBar:!0});case 13:case"end":return x.stop()}},i)})),[j,me,T,k]),Fr=(0,r.useCallback)((0,D.Z)((0,m.Z)().mark(function i(){var d;return(0,m.Z)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,s.u_.confirm({title:"\u6E05\u7A7A\u56DE\u6536\u7AD9",content:"\u7CFB\u7EDF\u5C06\u6C38\u4E45\u5220\u9664\u56DE\u6536\u7AD9\u4E2D\u7684\u5185\u5BB9\uFF0C\u6B64\u64CD\u4F5C\u65E0\u6CD5\u6062\u590D \uFF1F"});case 2:if(d=c.sent,d.isConfirmed){c.next=5;break}return c.abrupt("return");case 5:return c.next=7,O({variables:{folder:n}});case 7:Ne(1),s.FN.success("\u56DE\u6536\u7AD9\u5DF2\u88AB\u6E05\u7A7A",2e3,{placement:"bottom-start",progressBar:!0});case 9:case"end":return c.stop()}},i)})),[O,n,Ne]),Je=(0,r.useCallback)((0,D.Z)((0,m.Z)().mark(function i(){var d,o,c,w;return(0,m.Z)().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return d=T?T!=null&&T.isDirectory?"\u6587\u4EF6\u5939":"\u6587\u4EF6":k.length+" \u9879\u5185\u5BB9",x.next=3,s.u_.confirm({title:"\u786E\u5B9A\u8FD8\u539F",content:"\u786E\u8BA4\u8FD8\u539F\u9009\u4E2D\u7684 "+d+" \uFF1F"});case 3:if(o=x.sent,o.isConfirmed){x.next=6;break}return x.abrupt("return");case 6:return x.next=8,ee({variables:{ids:k}});case 8:c=x.sent,w=c.data,ie([]),me(w==null?void 0:w.files,function(S,X){return S.id==X.id}),s.FN.success(d+" \u8FD8\u539F\u6210\u529F",2e3,{placement:"bottom-start",progressBar:!0});case 13:case"end":return x.stop()}},i)})),[me,ee,T,k]),Ke=(0,r.useCallback)((0,D.Z)((0,m.Z)().mark(function i(){var d,o,c,w,C;return(0,m.Z)().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:if(d=T?T!=null&&T.isDirectory?"\u6587\u4EF6\u5939":"\u6587\u4EF6":k.length+" \u9879\u5185\u5BB9",!Qe){S.next=10;break}return S.next=4,L({variables:{ids:k,mode:"REMOVE"}});case 4:o=S.sent,c=o.data,pe(c==null?void 0:c.files,function(X,ge){return X.id==ge.id}),s.FN.success(d+"\u5DF2\u4ECE\u6536\u85CF\u4E2D\u79FB\u9664",2e3,{placement:"bottom-start",progressBar:!0}),S.next=16;break;case 10:return S.next=12,L({variables:{ids:k,mode:"ADD"}});case 12:w=S.sent,C=w.data,h=="starred"?(ie([]),me(C==null?void 0:C.files,function(X,ge){return X.id==ge.id})):pe(C==null?void 0:C.files,function(X,ge){return X.id==ge.id}),s.FN.success(d+" \u5DF2\u6DFB\u52A0\u5230\u6536\u85CF",2e3,{placement:"bottom-start",progressBar:!0});case 16:I();case 17:case"end":return S.stop()}},i)})),[pe,me,T,k,L,Qe,h]),pr=(0,r.useCallback)((0,D.Z)((0,m.Z)().mark(function i(){return(0,m.Z)().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:b.current.renameFile=T,I();case 2:case"end":return o.stop()}},i)})),[T]),re=(0,r.useMemo)(function(){return k.length?k.length==1?"row":"multi-row":"no_rows"},[k.length]),gr=(0,r.useMemo)(function(){if(h=="starred")return function(){return(0,e.jsx)("div",{children:(0,e.jsx)(s.zx,{color:"success",variant:!1,className:"trash-restore",onClick:Ke,icon:(0,e.jsx)(P.ZP,{name:"Duotune/arr029",className:"svg-icon-4 svg-icon-success"}),children:"\u53D6\u6D88\u6536\u85CF"})})};if(h=="trash")return function(){return(0,e.jsx)("div",{children:(0,e.jsx)(s.zx,{color:"success",variant:!1,className:"trash-restore",onClick:Je,icon:(0,e.jsx)(P.ZP,{name:"Duotune/arr029",className:"svg-icon-4 svg-icon-success"}),children:"\u8FD8\u539F"})})}},[Je,Ke,h]);return(0,e.jsxs)(s.Zb,{flush:!0,children:[h=="default"&&(0,e.jsxs)(s.Zb.Header,{className:"pt-8 flex-row-reverse",children:[(0,e.jsx)(s.Zb.Title,{children:(0,e.jsx)(s.II.Search,{size:"lg",solid:!0,className:"rounded-2 w-300px",placeholder:"\u641C\u7D22 \u6587\u4EF6 & \u6587\u4EF6\u5939"})}),(0,e.jsx)(s.Zb.Toolbar,{children:(0,e.jsxs)("div",{className:G()("d-flex justify-content-end",{"file-action-group gap-2":["row","multi-row"].includes(re)}),children:[re=="no_rows"&&(0,e.jsxs)(e.Fragment,{children:[h=="default"&&(0,e.jsx)(s.zx,{variant:"primary",className:"rounded-2 me-3",icon:(0,e.jsx)(P.ZP,{className:"svg-icon-2",name:"Duotune/fil018"}),onClick:vr,children:"\u4E0A\u4F20\u6587\u4EF6"}),h=="default"&&(a==null?void 0:a.isRootFolder)&&(0,e.jsx)(s.zx,{variant:"light-primary",className:"rounded-2",icon:(0,e.jsx)(P.ZP,{className:"svg-icon-2",name:"Duotune/fil013"}),onClick:W,children:"\u65B0\u5EFA\u6587\u4EF6\u5939"})]}),["row","multi-row"].includes(re)&&(0,e.jsx)(s.zx,{variant:"light-primary",className:"rounded-2",icon:(0,e.jsx)(P.ZP,{className:"svg-icon-2",name:"Duotune/arr095"}),children:"\u5206\u4EAB"}),["row","multi-row"].includes(re)&&(0,e.jsx)(s.zx,{variant:"light-primary",className:"rounded-2",icon:(0,e.jsx)(P.ZP,{className:"svg-icon-2",style:{transform:"rotateZ(90deg)"},name:"Duotune/arr076"}),onClick:fr,children:"\u4E0B\u8F7D"}),["row","multi-row"].includes(re)&&(0,e.jsx)(s.zx,{variant:"light-primary",className:"rounded-2",icon:(0,e.jsx)(P.ZP,{className:"svg-icon-2",name:"Duotune/gen027"}),onClick:hr,children:"\u5220\u9664"}),re=="row"&&(0,e.jsx)(s.zx,{as:"button",variant:"light-primary",className:"rounded-2",icon:(0,e.jsx)(P.ZP,{className:"svg-icon-2",name:"Duotune/gen055"}),onClick:pr,children:"\u91CD\u547D\u540D"}),["row","multi-row"].includes(re)&&(0,e.jsx)(s.zx,{variant:"light-primary",className:"rounded-2",icon:(0,e.jsx)(P.ZP,{className:"svg-icon-2",name:"Duotune/arr033"}),children:"\u79FB\u52A8"}),["row","multi-row"].includes(re)&&(0,e.jsx)(s.zx,{variant:"light-primary",className:"rounded-2",icon:(0,e.jsx)(P.ZP,{className:"svg-icon-2",name:"Duotune/abs024"}),onClick:Ke,children:Qe?"\u53D6\u6D88\u6536\u85CF":"\u6536\u85CF"})]})})]}),(0,e.jsxs)(s.Zb.Body,{className:"d-flex flex-row",children:[(0,e.jsxs)("div",(0,Q.Z)((0,Q.Z)({className:"flex-row-fluid"},mr),{},{children:[(0,e.jsxs)("div",{className:"d-flex flex-stack",children:[(0,e.jsx)(De,{onClick:Ge,paths:nr}),(0,e.jsx)(s.Ct,{size:"lg",color:"white",children:sr()})]}),h=="trash"&&!!ve.rowCount&&(0,e.jsx)(s.bZ,{theme:"Light",type:"primary",action:(0,e.jsx)(s.zx,{onClick:Fr,variant:"light-primary",className:"me-3 ls-1",children:"\u6E05\u7A7A\u56DE\u6536\u7AD9"}),message:"\u5185\u5BB9\u79FB\u81F3\u56DE\u6536\u7AD9\u540E\u4F1A\u5728 10 \u5929\u540E\u88AB\u6C38\u4E45\u5220\u9664"}),(0,e.jsx)("input",(0,Q.Z)({},cr())),(0,e.jsx)(s.bH,{overlayClassName:"bg-white bg-opacity-25",loading:de,children:!U.totalCount&&!de?ar():(0,e.jsx)(s.iA,{rowKey:"id",hover:!0,rowSelection:{type:"checkbox",selectedRowKeys:k,renderTitle:function(d){return(0,e.jsxs)(e.Fragment,{children:["\u5DF2\u9009\u4E2D",(0,e.jsx)("span",{className:"mx-2",children:d}),"\u4E2A\u6587\u4EF6/\u6587\u4EF6\u5939"]})},toolbar:gr,onChange:_e},rowHeight:50,columns:[{key:"name",title:(0,e.jsx)("span",{className:"ps-2",children:"\u6587\u4EF6\u540D"}),className:"min-w-250px",sorter:!0,sortOrder:(N==null?void 0:N.field)=="name"?N.order:void 0,render:function(d,o){var c;return(0,e.jsx)(Ae,{onClick:Ge,onSuccess:er,onCancelRename:rr,data:o,editable:o.id==((c=b.current.renameFile)===null||c===void 0?void 0:c.id)})}},{key:"lastModified",title:"\u66F4\u65B0\u65F6\u95F4",sorter:!0,className:"min-w-125px",sortOrder:(N==null?void 0:N.field)=="lastModified"?N.order:void 0},{key:"size",title:"\u6587\u4EF6\u5927\u5C0F",sorter:!0,className:"min-w-100px",sortOrder:(N==null?void 0:N.field)=="size"?N.order:void 0,render:function(d,o){return o.isDirectory?"-":(0,Se.jb)(d)}}],dataSource:ve,onChange:tr})})]})),(0,e.jsx)("div",{className:"file-details-quick-preview pb-7",children:(0,e.jsx)(Be,{files:ir,currentFolder:fe})}),(0,e.jsx)(Re,{onCancel:q,visible:b.current.newFolderVisible,parentFolder:we,onSuccess:lr})]})]})}var Oe=Le},14928:function(Ye,ke,v){"use strict";v.d(ke,{tz:function(){return Be},HD:function(){return Ie},f4:function(){return Pe},dH:function(){return a},we:function(){return $e},lK:function(){return h},rn:function(){return z},Eo:function(){return Z},_D:function(){return Te},Ep:function(){return l},fX:function(){return Le}});var g=v(11849),m=v(20310),D=v(49704),B=v(38460),Q=v(21919),le=v(64718),r,P,xe,G,ye,je,ue,e,be,De,H,he,M={},s=(0,D.Ps)(r||(r=(0,m.Z)([`
    query cloudDrive($id: ID!) {
  cloudDrive(id: $id) {
    id
    name
    type
    space
    rootFolder
    recycleBin
  }
}
    `])));function Se(u){var t=_objectSpread(_objectSpread({},M),u);return Apollo.useQuery(s,t)}function Pe(u){var t=(0,g.Z)((0,g.Z)({},M),u);return B.t(s,t)}var Me=(0,D.Ps)(P||(P=(0,m.Z)([`
    mutation createFolder($name: String!, $parentFolder: ID!) {
  folder: createFolder(name: $name, parentFolder: $parentFolder) {
    id
    name
  }
}
    `])));function $e(u){var t=(0,g.Z)((0,g.Z)({},M),u);return Q.D(Me,t)}var ze=(0,D.Ps)(xe||(xe=(0,m.Z)([`
    mutation addStarForFiles($ids: [ID!]!, $mode: UpdateMode) {
  files: addStarForFiles(ids: $ids, mode: $mode) {
    id
    starred
  }
}
    `])));function Be(u){var t=(0,g.Z)((0,g.Z)({},M),u);return Q.D(ze,t)}var oe=(0,D.Ps)(G||(G=(0,m.Z)([`
    mutation deleteFiles($ids: [ID!]!) {
  files: deleteFiles(ids: $ids) {
    id
  }
}
    `])));function We(u){var t=_objectSpread(_objectSpread({},M),u);return Apollo.useMutation(oe,t)}var Ae=(0,D.Ps)(ye||(ye=(0,m.Z)([`
    mutation moveFilesToTrash($ids: [ID!]!) {
  files: moveFilesToTrash(ids: $ids) {
    id
  }
}
    `])));function Te(u){var t=(0,g.Z)((0,g.Z)({},M),u);return Q.D(Ae,t)}var Re=(0,D.Ps)(je||(je=(0,m.Z)([`
    mutation clearFilesInTrash($folder: ID!) {
  clearFilesInTrash(folder: $folder)
}
    `])));function Ie(u){var t=(0,g.Z)((0,g.Z)({},M),u);return Q.D(Re,t)}var Ce=(0,D.Ps)(ue||(ue=(0,m.Z)([`
    mutation restoreFiles($ids: [ID!]!) {
  files: restoreFiles(ids: $ids) {
    id
    path
  }
}
    `])));function Le(u){var t=(0,g.Z)((0,g.Z)({},M),u);return Q.D(Ce,t)}var Oe=(0,D.Ps)(e||(e=(0,m.Z)([`
    mutation renameFile($id: ID!, $name: String!) {
  file: renameFile(id: $id, name: $name) {
    id
    name
    lastModified(format: "yyyy-MM-dd HH:mm")
  }
}
    `])));function l(u){var t=(0,g.Z)((0,g.Z)({},M),u);return Q.D(Oe,t)}var n=(0,D.Ps)(be||(be=(0,m.Z)([`
    query cloudDrives {
  cloudDrives {
    id
    name
    type
    space
    quota {
      id
      count
      usage
      size
      usageStr: usage(format: true)
      sizeStr: size(format: true)
    }
    rootFolder
  }
}
    `])));function a(u){var t=(0,g.Z)((0,g.Z)({},M),u);return le.a(n,t)}function y(u){var t=_objectSpread(_objectSpread({},M),u);return Apollo.useLazyQuery(n,t)}var F=(0,D.Ps)(De||(De=(0,m.Z)([`
    query file($id: ID!) {
  file(id: $id) {
    id
    name
    path
    starred
    size
    sizeFormat: size(format: true)
    mimeType
    extension
    isDirectory
    isRootFolder
    lastModified(format: "yyyy-MM-dd HH:mm")
    createdAt(format: "yyyy-MM-dd HH:mm")
    description
    parents {
      id
      isDirectory
      isRootFolder
      name
      path
    }
  }
}
    `])));function h(u){var t=(0,g.Z)((0,g.Z)({},M),u);return le.a(F,t)}function p(u){var t=_objectSpread(_objectSpread({},M),u);return Apollo.useLazyQuery(F,t)}var $=(0,D.Ps)(H||(H=(0,m.Z)([`
    query folder($folder: ID!) {
  currentFolder: file(id: $folder) {
    id
    name
    path
    isDirectory
    isRootFolder
    parents {
      id
      isDirectory
      isRootFolder
      name
      path
    }
  }
}
    `])));function z(u){var t=(0,g.Z)((0,g.Z)({},M),u);return le.a($,t)}function K(u){var t=_objectSpread(_objectSpread({},M),u);return Apollo.useLazyQuery($,t)}var b=(0,D.Ps)(he||(he=(0,m.Z)([`
    query listFiles($rootFolder: ID!, $filter: FileFilter, $page: Int = 1, $pageSize: Int = 30, $orderBy: OrderBy) {
  listFiles(
    rootFolder: $rootFolder
    filter: $filter
    page: $page
    pageSize: $pageSize
    orderBy: $orderBy
  ) {
    pageSize
    currentPage
    totalPage
    totalCount
    edges {
      node {
        id
        name
        path
        size
        starred
        mimeType
        extension
        isDirectory
        lastModified(format: "yyyy-MM-dd HH:mm")
      }
    }
  }
}
    `])));function ce(u){var t=_objectSpread(_objectSpread({},M),u);return Apollo.useQuery(b,t)}function J(u){var t=(0,g.Z)((0,g.Z)({},M),u);return B.t(b,t)}var I=v(2824),W=v(67294),q=v(71447),ne=function(){var t=J({fetchPolicy:"cache-and-network"}),L=(0,I.Z)(t,2),_=L[0],R=L[1],j=R.data,V=R.loading,f=R.refetch,O=(j==null?void 0:j.listFiles.pageSize)||0,E=(j==null?void 0:j.listFiles.currentPage)||0,ae=(j==null?void 0:j.listFiles.totalCount)||0,ee=(j==null?void 0:j.listFiles.totalPage)||0,N=(0,W.useMemo)(function(){return{totalCount:ae,currentPage:E,pageSize:O,totalPage:ee}},[E,O,ae,ee]),Ze=(0,W.useMemo)(function(){return function(Y,U){_({variables:(0,g.Z)((0,g.Z)({},Y),{},{page:U})})}},[_]),A=(0,W.useMemo)(function(){return{pagination:N,items:(j==null?void 0:j.listFiles.edges.map(function(Y){return Y.node}))||[],loading:V,refetch:function(U,de){return f((0,g.Z)((0,g.Z)({},U),{},{page:de}))}}},[V,N,j==null?void 0:j.listFiles.edges,f]);return[Ze,A]};function Z(u,t,L){return(0,q.RM)(ne,{rootFolder:u,filter:t,orderBy:L})}}}]);

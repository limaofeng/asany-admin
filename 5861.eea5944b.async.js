"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[5861],{85861:function(Ee,T,n){n.r(T);var Q=n(15009),p=n.n(Q),H=n(97857),m=n.n(H),X=n(13769),B=n.n(X),J=n(99289),A=n.n(J),Y=n(5574),g=n.n(Y),x=n(67294),R=n(96974),Z=n(73588),a=n(2721),q=n(30773),D=n(19975),e=n(85893),ee=["detailedAddress","address"],ae=["__typename"],se=["__typename","detailedAddress"];function re(){var M,j=(0,R.UO)(),f=(0,R.s0)(),ne=(0,q.GR)(),de=g()(ne,2),N=de[1].loadRegion,ue=(0,D.eU)({fetchPolicy:"cache-and-network"}),U=g()(ue,2),k=U[0],S=U[1],O=S.data,W=S.loading,le=(0,D.Sj)({fetchPolicy:"cache-and-network"}),K=g()(le,2),P=K[0],w=K[1].loading,te=(0,D.j6)({}),G=g()(te,2),$=G[0],ie=G[1].loading,oe=(0,D.mt)({}),z=g()(oe,2),V=z[0],_e=z[1].loading,h=j.id==="new",t=a.Form.useForm(),me=(0,x.useCallback)(A()(p()().mark(function E(){var d,i,o,u;return p()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,t.validateFields();case 2:if(d=s.sent,i=d.detailedAddress,o=d.address,u=B()(d,ee),!h){s.next=11;break}return s.next=9,$({variables:{input:m()(m()({},u),{},{address:m()(m()({},o),{},{detailedAddress:i})})}});case 9:s.next=13;break;case 11:return s.next=13,V({variables:{id:j.id,input:m()(m()({},u),{},{address:m()(m()({},o),{},{detailedAddress:i})})}});case 13:a.Toast.success("\u95E8\u5E97 \u201C".concat(u.name,"\u201D ").concat(h?"\u65B0\u589E":"\u4FEE\u6539","\u6210\u529F"),2e3,{placement:"bottom-left",progressBar:!0}),history.length?f(-1):f("/website/landing/stores",{replace:!0});case 15:case"end":return s.stop()}},E)})),[$,j.id,t,f,h,V]);(0,x.useEffect)(function(){if(j.id!=="new"){var E=new AbortController;return k({variables:{id:j.id},context:{fetchOptions:{signal:E.signal}}}).then(function(){var d=A()(p()().mark(function i(o){var u,r,s,c,b,l,v,I,C,y;return p()().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:if(r=o.data,console.log("loadStore",r==null?void 0:r.store),s=r==null?void 0:r.store,s){F.next=8;break}return F.next=6,a.Modal.error({content:"\u95E8\u5E97\u4E0D\u5B58\u5728,\u53EF\u80FD\u5DF2\u7ECF\u88AB\u5220\u9664\u4E86",timer:3e3,timerProgressBar:!0});case 6:return!history.length||h?f("/website/landing/stores",{replace:!0}):f(-1),F.abrupt("return");case 8:c=s.location||{},b=c.__typename,l=B()(c,ae),v=s.address||{},I=v.__typename,C=v.detailedAddress,y=B()(v,se),t.setFieldsValue(m()(m()({},s),{},{address:y,location:l,detailedAddress:C,qrCode:(u=s.qrCode)===null||u===void 0?void 0:u.id}));case 11:case"end":return F.stop()}},i)}));return function(i){return d.apply(this,arguments)}}()),function(){E.abort()}}},[t,k,history,j.id,h]);var ce=(0,x.useCallback)(function(){var E=A()(p()().mark(function d(i){var o,u,r,s,c,b,l,v,I,C,y,L;return p()().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(o=t.getFieldValue("address"),u=t.getFieldValue("location"),!o){_.next=4;break}return _.abrupt("return");case 4:if(r=i.clipboardData.getData("text/plain"),["\u7701","\u5E02","\u533A","\u53BF"].some(function(he){return r.includes(he)})){_.next=7;break}return _.abrupt("return");case 7:return _.next=9,P({variables:{address:r}});case 9:return s=_.sent,c=s.data,b=c.amapOpenAPI.geocodes[0],_.next=14,N(b.adcode);case 14:l=_.sent,v=r.indexOf(b.district),v!==-1&&(r=r.substring(v+b.district.length)),u?t.setFieldsValue({address:l,detailedAddress:r}):(I=b.location.split(","),C=g()(I,2),y=C[0],L=C[1],t.setFieldsValue({address:l,detailedAddress:r,location:{longitude:y,latitude:L}}));case 18:case"end":return _.stop()}},d)}));return function(d){return E.apply(this,arguments)}}(),[t,N,P]),pe=(0,x.useCallback)(A()(p()().mark(function E(){var d,i,o,u,r,s,c;return p()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(d=t.getFieldsValue(),!(!d.address||!d.detailedAddress)){l.next=4;break}return a.Modal.warning({content:"\u8BF7\u786E\u4FDD\u5730\u533A\u4E0E\u8BE6\u7EC6\u5730\u5740\u5DF2\u7ECF\u5F55\u5165",timer:3e3,timerProgressBar:!0}),l.abrupt("return");case 4:return l.next=6,P({variables:{city:d.address[d.address.length-1],address:d.detailedAddress}});case 6:i=l.sent,o=i.data,u=o.amapOpenAPI.geocodes[0].location.split(","),r=g()(u,2),s=r[0],c=r[1],t.setFieldsValue({location:{longitude:s,latitude:c}});case 10:case"end":return l.stop()}},E)})),[t,P]);return(0,e.jsx)(Z.vs,{header:h?{title:"\u65B0\u589E\u95E8\u5E97"}:void 0,footer:!1,children:(0,e.jsxs)(a.Card,{className:"mb-5 mb-xl-10",children:[(0,e.jsx)(a.Card.Header,{children:(0,e.jsx)(a.Card.Title,{children:h?"\u65B0\u589E\u95E8\u5E97":O==null||(M=O.store)===null||M===void 0?void 0:M.name})}),(0,e.jsxs)(a.Card.Body,{children:[(0,e.jsx)(a.BlockUI,{overlayClassName:"bg-white bg-opacity-25",loading:W,children:(0,e.jsxs)(a.Form,{form:t,className:"w-800px row d-flex flex-shrink-0 flex-column-reverse flex-md-row",children:[(0,e.jsxs)("div",{className:"col-12 col-md-8",children:[(0,e.jsx)(a.Form.Item,{className:"mb-5",name:"code",label:"\u5E97\u53F7",rules:[{required:!0,message:"\u5E97\u53F7\u4E0D\u80FD\u4E3A\u7A7A"}],help:"\u8BF7\u5C3D\u91CF\u4FDD\u8BC1\u5E97\u94FA\u7F16\u53F7\u7684\u552F\u4E00\u6027",children:(0,e.jsx)(a.Input,{solid:!0,className:"w-400px"})}),(0,e.jsx)(a.Form.Item,{className:"mb-5",name:"name",label:"\u540D\u79F0",rules:[{required:!0,message:"\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A"}],children:(0,e.jsx)(a.Input,{solid:!0,className:"w-400px"})}),(0,e.jsx)(a.Form.Item,{className:"my-5",name:"address",label:"\u6240\u5728\u5730\u533A",children:(0,e.jsx)(a.RegionPicker,{solid:!0,resultType:"object",className:"w-400px",ends:"district",placeholder:"--\u8BF7\u9009\u62E9--"})}),(0,e.jsx)(a.Form.Item,{className:"my-5",name:"detailedAddress",label:"\u8BE6\u7EC6\u5730\u5740",help:"\u76F4\u63A5\u7C98\u8D34\u5B8C\u6574\u5730\u5740,\u4F1A\u81EA\u52A8\u8BC6\u522B\u6240\u5728\u5730\u533A\u4E0E\u5730\u7406\u4F4D\u7F6E",children:(0,e.jsx)(a.Input.TextArea,{solid:!0,className:"w-400px",onPaste:ce})}),(0,e.jsx)(a.Form.Item,{className:"my-5",labelClassName:"d-inline-flex align-items-center",label:(0,e.jsxs)(e.Fragment,{children:["\u5730\u7406\u4F4D\u7F6E",(0,e.jsx)("a",{onClick:w?void 0:pe,className:"ps-2 cursor-pointer",children:w?"\u8BC6\u522B\u4E2D,\u8BF7\u7A0D\u7B49...":"\u901A\u8FC7\u5730\u5740\u8BC6\u522B"}),(0,e.jsx)(a.Spin,{className:"text-primary d-inline-flex align-items-center ms-2",size:"small",spinning:w})]}),help:"\u9AD8\u5FB7\u5750\u6807\u7CFB\u7ECF\u7EAC\u5EA6\uFF0C\u4E14\u4E0D\u8D85\u8FC76\u4F4D\u5C0F\u6570\uFF0C\u5747\u4E0D\u586B\u5219\u81EA\u52A8\u8BC6\u522B",children:(0,e.jsxs)(a.Input.Group,{solid:!0,className:"w-400px",children:[(0,e.jsx)(a.Input.Group.Text,{children:"\u7ECF\u5EA6"}),(0,e.jsx)(a.Form.Item,{noStyle:!0,name:["location","longitude"],children:(0,e.jsx)(a.Input,{})}),(0,e.jsx)(a.Input.Group.Text,{children:"\u7EAC\u5EA6"}),(0,e.jsx)(a.Form.Item,{noStyle:!0,name:["location","latitude"],children:(0,e.jsx)(a.Input,{})})]})}),(0,e.jsx)(a.Form.Item,{className:"my-5",name:"leader",label:"\u8D1F\u8D23\u4EBA",children:(0,e.jsx)(a.Input,{solid:!0,className:"w-400px"})}),(0,e.jsx)(a.Form.Item,{className:"my-5",name:"description",label:"\u63CF\u8FF0",help:"\u8BF7\u7528\u5C11\u4E8E250\u5B57\u7B26\u63CF\u8FF0",children:(0,e.jsx)(a.Input.TextArea,{solid:!0,autoSize:{minRows:4,maxRows:8},showCount:!0,maxLength:250,className:"w-400px"})})]}),(0,e.jsx)("div",{className:"col-12 col-md-4",children:(0,e.jsx)(a.Form.Item,{className:"mb-5",name:"qrCode",label:"\u95E8\u5E97\u4E8C\u7EF4\u7801",children:(0,e.jsx)(a.Upload.Image,{width:250,height:250,space:"orX8kLOV",crop:{height:450,zoomable:!1,aspectRatio:1},background:"/assets/media/background/qrcode_icon.png"})})})]})}),(0,e.jsx)(a.Button,{loading:W||ie||_e,onClick:me,children:h?(0,e.jsx)(e.Fragment,{children:"\u6DFB\u52A0\u95E8\u5E97"}):(0,e.jsx)(e.Fragment,{children:"\u4FEE\u6539\u95E8\u5E97\u4FE1\u606F"})})]})]})})}T.default=re}}]);

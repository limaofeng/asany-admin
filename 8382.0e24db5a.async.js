"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[8382],{85947:function(fe,Z,u){u.d(Z,{u7:function(){return s.u7},pM:function(){return s.pM},dP:function(){return s.dP},zR:function(){return s.zR},bo:function(){return s.bo},CF:function(){return s.CF},hT:function(){return s.hT},X4:function(){return s.X4},rq:function(){return s.rq},qb:function(){return s.qb},a$:function(){return s.a$},mp:function(){return s.mp},WE:function(){return s.WE},HC:function(){return s.HC},cT:function(){return _},Hr:function(){return ie},r3:function(){return s.r3},bI:function(){return s.bI},A6:function(){return s.A6},LV:function(){return s.LV}});var s=u(10557),N=u(15009),P=u.n(N),K=u(99289),w=u.n(K),l=u(5574),R=u.n(l),D=u(62435),p=u(2721),F=u(86074);function q(i,V){var L,W=(0,s.rz)({variables:{id:i==null?void 0:i.id},refetchQueries:[{query:s.dP,variables:{id:i==null||(L=i.application)===null||L===void 0?void 0:L.id}}]}),M=R()(W,1),U=M[0],e=(0,D.useCallback)(w()(P()().mark(function J(){var z;return P()().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return A.next=2,p.Modal.confirm({title:"\u4F60\u786E\u5B9A\u8981\u5220\u9664\u8BE5\u8DEF\u7531\u5417\uFF1F",content:(0,F.jsxs)(F.Fragment,{children:["\u60A8\u5373\u5C06\u5220\u9664\u201C",(0,F.jsx)("strong",{children:i.name}),"\u201D\u3002\u5220\u9664\u64CD\u4F5C\u4E0D\u53EF\u9006\u8F6C\uFF0C\u8BF7\u8C28\u614E\u64CD\u4F5C\uFF0C\u60A8\u786E\u5B9A\u5220\u9664\u5417\uFF1F"]}),okText:"\u5220 \u9664",okClassName:"btn-danger"});case 2:if(z=A.sent,!z.isConfirmed){A.next=8;break}return A.next=6,U();case 6:p.Toast.success("\u5220\u9664\u6210\u529F"),V(i);case 8:case"end":return A.stop()}},J)})),[U,i,V]);return[e]}var _=q,n=u(97857),O=u.n(n),re=u(12708);function le(i,V){var L,W,M,U=p.Form.useForm(),e=(0,D.useState)(!1),J=R()(e,2),z=J[0],Q=J[1],A=(0,s.X4)({fetchPolicy:"no-cache",refetchQueries:[{query:s.dP,variables:{id:i==null||(L=i.application)===null||L===void 0?void 0:L.id}}]}),se=R()(A,1),ue=se[0],oe=(0,s.LV)({fetchPolicy:"no-cache",refetchQueries:[{query:s.dP,variables:{id:i==null||(W=i.application)===null||W===void 0?void 0:W.id}}]}),de=R()(oe,1),ae=de[0],ce=(0,D.useMemo)(function(){return i!=null&&i.id?w()(P()().mark(function ee(){var r,t,c;return P()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return Q(!0),a.prev=1,a.next=4,U.validateFields();case 4:return r=a.sent,a.next=7,p.Toast.promise((0,re.gw)(ae({variables:{id:i.id,input:O()({},r)}}),350),{pending:"\u63D0\u4EA4\u4E2D...",success:{render:function(){return(0,F.jsxs)(F.Fragment,{children:["\u8DEF\u7531 ",(0,F.jsx)("strong",{children:r.name})," \u4FDD\u5B58\u6210\u529F"]})}},error:"\u63D0\u4EA4\u51FA\u9519"},{duration:2e3,placement:"top-center"});case 7:t=a.sent,c=t.data,V(c.updateRoute),Q(!1),a.next=16;break;case 13:a.prev=13,a.t0=a.catch(1),Q(!1);case 16:case"end":return a.stop()}},ee,null,[[1,13]])})):w()(P()().mark(function ee(){var r,t,c;return P()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return Q(!0),a.prev=1,a.next=4,U.validateFields();case 4:return r=a.sent,a.next=7,p.Toast.promise((0,re.gw)(ue({variables:{input:O()(O()({},r),{},{application:i.application.id})}}),350),{pending:"\u63D0\u4EA4\u4E2D...",success:{render:function(){return(0,F.jsxs)(F.Fragment,{children:["\u8DEF\u7531 ",(0,F.jsx)("strong",{children:r.name})," \u65B0\u589E\u6210\u529F"]})}},error:"\u63D0\u4EA4\u51FA\u9519"},{duration:2e3,placement:"top-center"});case 7:t=a.sent,c=t.data,V(c.createRoute),Q(!1),a.next=16;break;case 13:a.prev=13,a.t0=a.catch(1),Q(!1);case 16:case"end":return a.stop()}},ee,null,[[1,13]])}))},[ue,i==null||(M=i.application)===null||M===void 0?void 0:M.id,i==null?void 0:i.id,U,V,ae]);return[ce,{form:U,submitting:z}]}var ie=le},68382:function(fe,Z,u){u.r(Z),u.d(Z,{default:function(){return ee}});var s=u(15009),N=u.n(s),P=u(99289),K=u.n(P),w=u(97857),l=u.n(w),R=u(5574),D=u.n(R),p=u(62435),F=u(96974),q=u(46027),_=u(73588),n=u(2721),O=u(12708),re=u(19632),le=u.n(re),ie=u(13769),i=u.n(ie),V=u(64599),L=u.n(V),W=u(35090),M=u(85947),U=u(10557),e=u(86074);function J(r,t){var c,g=(0,U.rq)({variables:{id:r==null?void 0:r.id},refetchQueries:[{query:U.pM,variables:{id:r==null||(c=r.application)===null||c===void 0?void 0:c.id}}]}),a=D()(g,1),h=a[0],T=(0,p.useCallback)(K()(N()().mark(function $(){var E;return N()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,n.Modal.confirm({title:"\u4F60\u786E\u5B9A\u8981\u5220\u9664\u8BE5\u83DC\u5355\u5417\uFF1F",content:(0,e.jsxs)(e.Fragment,{children:["\u60A8\u5373\u5C06\u5220\u9664\u201C",(0,e.jsx)("strong",{children:r.name}),"\u201D\u3002\u5220\u9664\u64CD\u4F5C\u4E0D\u53EF\u9006\u8F6C\uFF0C\u8BF7\u8C28\u614E\u64CD\u4F5C\uFF0C\u60A8\u786E\u5B9A\u5220\u9664\u5417\uFF1F"]}),okText:"\u5220 \u9664",okClassName:"btn-danger"});case 2:if(E=x.sent,!E.isConfirmed){x.next=8;break}return x.next=6,h();case 6:n.Toast.success("\u5220\u9664\u6210\u529F"),t(r);case 8:case"end":return x.stop()}},$)})),[h,r,t]);return[T]}var z=J,Q=u(17754),A=["children","_rect","pos","parent"];function se(r){var t,c=r.form,g=r.appId,a=r.libraryId,h=(0,M.a$)({variables:{id:g}}),T=h.data,$=(0,M.qb)({variables:{id:a}}),E=$.data,j=(T==null||(t=T.app)===null||t===void 0?void 0:t.menus)||[],x=(0,p.useMemo)(function(){return(0,O.$H)((0,O.G_)((j||[]).map(function(v){return l()({},v)}),{pidKey:"parent.id",sort:function(b,y){return b.index-y.index},converter:function(b,y){var I=y.parent;return l()(l()({},b),{},{key:b.id,menuType:b.type,title:I?I.title+"/"+b.name:b.name})}}))},[j]),k=E==null?void 0:E.library,G=(0,p.useMemo)(function(){var v=[],b=L()((k==null?void 0:k.components)||[]),y;try{for(b.s();!(y=b.n()).done;){var I=y.value,C=L()(I.tags),S;try{for(C.s();!(S=C.n()).done;){var H=S.value;(0,Q.v)(H,v,I)}}catch(B){C.e(B)}finally{C.f()}}}catch(B){b.e(B)}finally{b.f()}return v},[k]);return(0,p.useEffect)(function(){var v=r.data,b=v.children,y=v._rect,I=v.pos,C=v.parent,S=i()(v,A);r.data.id||c.resetFields(),c.setFieldsValue(l()(l()({},S),{},{parentMenu:C?C.id:void 0}))},[c,r.data]),(0,e.jsxs)(n.Form,{form:c,children:[(0,e.jsx)(n.Row,{children:(0,e.jsx)(n.Col,{span:6,children:(0,e.jsx)(n.Form.Item,{name:"name",className:"d-flex flex-column mb-7",required:!0,label:"\u540D\u79F0",rules:[{required:!0,message:"\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A"}],children:(0,e.jsx)(n.Input,{solid:!0})})})}),(0,e.jsxs)(n.Row,{children:[(0,e.jsx)(n.Col,{span:6,children:(0,e.jsx)(n.Form.Item,{name:"parentMenu",className:"d-flex flex-column mb-7",label:"\u4E0A\u7EA7\u83DC\u5355",children:(0,e.jsx)(n.Select2,{solid:!0,options:[{value:"",label:"\u6839\u8282\u70B9"}].concat(le()(x.map(function(v){return{value:v.id,label:v.title}})))})})}),(0,e.jsx)(n.Col,{span:6,children:(0,e.jsx)(n.Form.Item,{name:"type",className:"d-flex flex-column mb-7",label:"\u7C7B\u578B",children:(0,e.jsx)(n.Radio.Group,{solid:!0,options:[{value:"MENU",label:"\u83DC\u5355"},{value:"URL",label:"\u94FE\u63A5\u5730\u5740"},{value:"SECTION",label:"\u7AE0\u8282"}]})})})]}),(0,e.jsxs)(n.Row,{children:[(0,e.jsx)(n.Col,{span:6,children:(0,e.jsx)(n.Form.Item,{name:"icon",className:"d-flex flex-column mb-7",label:"\u56FE\u6807",children:(0,e.jsx)(n.Input,{})})}),(0,e.jsx)(n.Col,{span:6,children:(0,e.jsx)(n.Form.Item,{className:"d-flex flex-column mb-7",name:"index",label:"\u6392\u5E8F\u4F4D\u7F6E",children:(0,e.jsx)(n.Input,{solid:!0})})})]}),(0,e.jsxs)(n.Row,{children:[(0,e.jsx)(n.Col,{span:4,children:(0,e.jsx)(n.Form.Item,{valuePropName:"checked",className:"d-flex flex-column mb-7",name:"hideInMenu",children:(0,e.jsx)(n.Switch,{solid:!0,label:"\u4E0D\u5728\u83DC\u5355\u4E2D\u663E\u793A"})})}),(0,e.jsx)(n.Col,{span:4,children:(0,e.jsx)(n.Form.Item,{valuePropName:"checked",className:"d-flex flex-column mb-7",name:"hideChildrenInMenu",children:(0,e.jsx)(n.Switch,{solid:!0,label:"\u4E0D\u663E\u793A\u5B50\u83DC\u5355"})})}),(0,e.jsx)(n.Col,{span:4,children:(0,e.jsx)(n.Form.Item,{valuePropName:"checked",className:"d-flex flex-column mb-7",name:"hideInBreadcrumb",children:(0,e.jsx)(n.Switch,{solid:!0,label:"\u4E0D\u5728\u9762\u5305\u5C51\u4E2D\u663E\u793A"})})})]}),(0,e.jsx)(n.Row,{children:(0,e.jsx)(n.Form.Item,{className:"d-flex flex-column mb-7",name:"authority",label:"\u8BBF\u95EE\u6743\u9650",children:(0,e.jsx)(n.Input,{solid:!0})})}),(0,e.jsx)(n.Form.Item,{dependencies:["type"],noStyle:!0,children:function(){return(0,e.jsxs)(n.Row,{children:[" ",(0,e.jsx)(n.Form.Item,{className:"d-flex flex-column mb-7",name:"path",label:"\u94FE\u63A5",children:(0,e.jsx)(n.Input,{solid:!0})})]})}}),(0,e.jsx)(n.Form.Item,{dependencies:["type","parentMenu"],noStyle:!0,children:function(){return c.getFieldValue("type")==="SECTION"||c.getFieldValue("parentMenu")?(0,e.jsx)(e.Fragment,{}):(0,e.jsx)(n.Row,{children:(0,e.jsx)(n.Form.Item,{className:"d-flex flex-column mb-7",name:"component",label:"\u7EC4\u4EF6",children:(0,e.jsx)(W.zm,{treeDate:G,placeholder:"\u9009\u62E9\u7EC4\u4EF6\u6A21\u7248"})})})}})]})}function ue(r,t){var c,g,a,h=n.Form.useForm(),T=(0,p.useState)(!1),$=D()(T,2),E=$[0],j=$[1],x=(0,M.hT)({fetchPolicy:"no-cache",refetchQueries:[{query:M.pM,variables:{id:r==null||(c=r.application)===null||c===void 0?void 0:c.id}}]}),k=D()(x,1),G=k[0],v=(0,M.A6)({fetchPolicy:"no-cache",refetchQueries:[{query:M.pM,variables:{id:r==null||(g=r.application)===null||g===void 0?void 0:g.id}}]}),b=D()(v,1),y=b[0],I=(0,p.useMemo)(function(){return r!=null&&r.id?K()(N()().mark(function C(){var S,H,B;return N()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return j(!0),o.prev=1,o.next=4,h.validateFields();case 4:return S=o.sent,o.next=7,n.Toast.promise((0,O.gw)(y({variables:{id:r.id,input:l()({},S)}}),350),{pending:"\u63D0\u4EA4\u4E2D...",success:{render:function(){return(0,e.jsxs)(e.Fragment,{children:["\u83DC\u5355 ",(0,e.jsx)("strong",{children:S.name})," \u4FDD\u5B58\u6210\u529F"]})}},error:"\u63D0\u4EA4\u51FA\u9519"},{duration:2e3,placement:"top-center"});case 7:H=o.sent,B=H.data,t(B.updateMenu),j(!1),o.next=16;break;case 13:o.prev=13,o.t0=o.catch(1),j(!1);case 16:case"end":return o.stop()}},C,null,[[1,13]])})):K()(N()().mark(function C(){var S,H,B;return N()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return j(!0),o.prev=1,o.next=4,h.validateFields();case 4:return S=o.sent,o.next=7,n.Toast.promise((0,O.gw)(G({variables:{input:l()(l()({},S),{},{application:r.application.id})}}),350),{pending:"\u63D0\u4EA4\u4E2D...",success:{render:function(){return(0,e.jsxs)(e.Fragment,{children:["\u83DC\u5355 ",(0,e.jsx)("strong",{children:S.name})," \u65B0\u589E\u6210\u529F"]})}},error:"\u63D0\u4EA4\u51FA\u9519"},{duration:2e3,placement:"top-center"});case 7:H=o.sent,B=H.data,t(B.createMenu),j(!1),o.next=16;break;case 13:o.prev=13,o.t0=o.catch(1),j(!1);case 16:case"end":return o.stop()}},C,null,[[1,13]])}))},[G,r==null||(a=r.application)===null||a===void 0?void 0:a.id,r==null?void 0:r.id,h,t,y]);return[I,{form:h,submitting:E}]}function oe(r){var t=r.menu,c=r.visible,g=r.libraryId,a=r.onClose,h=r.onSuccess,T=r.onDeleteSuccess,$=ue(t,h),E=D()($,2),j=E[0],x=E[1],k=x.form,G=x.submitting,v=(0,p.useMemo)(function(){var C;return t?l()(l()({},t),{},{component:(C=t.component)===null||C===void 0?void 0:C.id}):{type:"URL",index:0}},[t]),b=z(t,T),y=D()(b,1),I=y[0];return(0,e.jsx)(n.Drawer,{title:t!=null&&t.id?"\u7F16\u8F91\u83DC\u5355":"\u65B0\u589E\u83DC\u5355",placement:"right",width:640,mask:!1,onClose:a,visible:c,footer:(0,e.jsxs)(n.Row,{children:[(0,e.jsx)(n.Col,{span:6,children:(0,e.jsx)(n.Button,{style:{letterSpacing:"1rem"},className:"w-100",loading:G,onClick:j,children:"\u4FDD\u5B58"})}),(0,e.jsx)(n.Col,{span:6,children:(t==null?void 0:t.id)&&(0,e.jsx)(n.Button,{style:{letterSpacing:"1rem"},className:"w-100",variant:"light-danger",onClick:I,children:"\u5220\u9664"})})]}),children:t&&(0,e.jsx)(se,{libraryId:g,submitting:G,data:v,appId:t.application.id,form:k,submit:j,onDeleteSuccess:T})})}var de=oe;function ae(r){var t=r.data,c=r.onDeleteSuccess,g=z(t,c),a=D()(g,1),h=a[0];return(0,e.jsx)("div",{className:"d-flex flex-row-fluid justify-content-center",onClick:function($){$.stopPropagation(),$.preventDefault()},children:(0,e.jsx)("div",{className:"ms-2",children:(0,e.jsx)(n.Button,{variant:"light-danger",icon:(0,e.jsx)(q.ZP,{className:"svg-icon-2",name:"Duotune/arr088"}),onClick:h})})})}function ce(){var r,t,c=(0,F.bx)(),g=c.app,a=(0,F.UO)(),h=a.id,T=g.dependencies.find(function(f){return f.name==="component.library"}).value,$=(0,p.useState)({visible:!1}),E=D()($,2),j=E[0],x=E[1],k=(0,M.A6)({fetchPolicy:"no-cache",refetchQueries:[{query:M.pM,variables:{id:h}}]}),G=D()(k,1),v=G[0],b=(0,M.a$)({variables:{id:h}}),y=b.data,I=b.loading,C=y==null||(r=y.app)===null||r===void 0?void 0:r.menus,S=(0,p.useMemo)(function(){return(0,O.G_)((C||[]).map(function(f){return l()(l()({},f),{},{children:[]})}),{pidKey:"parent.id",sort:function(m,d){return m.index-d.index},converter:function(m){return l()(l()({},m),{},{key:m.id,title:m.name,menuType:m.type,type:"directory",application:{id:h}})}})},[h,C]),H=(0,p.useCallback)(function(){x(function(f){return l()(l()({},f),{},{visible:!1})})},[]),B=(0,p.useCallback)(function(){x(function(f){return l()(l()({},f),{},{visible:!0,menu:{index:0,icon:"Duotune/abs005",type:"MENU",application:{id:h}}})})},[h]),me=(0,p.useCallback)(function(f){x(function(m){var d;return((d=m.menu)===null||d===void 0?void 0:d.id)===f.node.id&&m.visible?l()(l()({},m),{},{visible:!1}):l()(l()({},m),{},{visible:!0,menu:l()(l()({},f.node),{},{type:f.node.menuType,parentMenu:f.node.parentKey})})})},[]),o=(0,p.useCallback)(function(){var f=K()(N()().mark(function m(d){var X,ne,ve;return N()().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:if(console.log(d),!(((X=d.dragNode.parent)===null||X===void 0?void 0:X.id)===((ne=d.node.parent)===null||ne===void 0?void 0:ne.id)&&d.dragNode.index===d.toIndex)){Y.next=3;break}return Y.abrupt("return");case 3:return Y.next=5,n.Toast.promise(v({variables:{id:d.dragNode.id,input:{parentMenu:(ve=d.node.parent)===null||ve===void 0?void 0:ve.id,index:d.toIndex}}}),{pending:"\u66F4\u65B0\u6392\u5E8F...",success:"\u6392\u5E8F\u8C03\u6574\u6210\u529F",error:"\u63D0\u4EA4\u51FA\u9519"},{duration:2e3,placement:"top-center"});case 5:case"end":return Y.stop()}},m)}));return function(m){return f.apply(this,arguments)}}(),[v]),te=(0,p.useCallback)(function(f){x(function(m){var d;return((d=m.menu)===null||d===void 0?void 0:d.id)!==f.id?m:l()(l()({},m),{},{visible:!1,menu:void 0})})},[x]),pe=(0,p.useCallback)(function(f){x(function(m){return l()(l()({},m),{},{menu:f})})},[x]);return(0,e.jsxs)(_.vs,{header:{title:"\u83DC\u5355\u8BBE\u7F6E"},loading:I,children:[(0,e.jsxs)(n.Card,{flush:!0,children:[(0,e.jsxs)(n.Card.Header,{className:"pt-8",children:[(0,e.jsx)(n.Card.Title,{}),(0,e.jsx)(n.Card.Toolbar,{children:(0,e.jsx)("div",{className:"d-flex justify-content-end",children:(0,e.jsx)(n.Button,{onClick:B,variant:"primary",children:"\u65B0\u5EFA\u83DC\u5355"})})})]}),(0,e.jsx)(n.Card.Body,{className:"pt-0",children:(0,e.jsx)(n.TreeList,{className:"app-treelist",rowKey:"id",draggable:!0,onSelect:me,selectedKeys:(t=j.menu)!==null&&t!==void 0&&t.id?[j.menu.id]:[],onDrop:o,columns:[{key:"title",title:"\u540D\u79F0",width:"auto",render:function(m,d){var X,ne={SECTION:{color:"info"},URL:{color:"primary"},MENU:{color:"success"},SCRIPT:{color:"dark"}};return(0,e.jsxs)("div",{className:"d-flex flex-column py-5",children:[(0,e.jsx)("span",{className:"title text-gray-800 text-hover-primary mb-1 fs-6",children:d.title}),(0,e.jsxs)("div",{className:"d-flex flex-row col-stacked",children:[(0,e.jsx)(n.Badge,{className:"me-2",color:(X=ne[d.menuType])===null||X===void 0?void 0:X.color,children:d.menuType}),(0,e.jsx)("span",{className:"tw-pl-2",children:d.path})]})]})}},{key:"index",title:"\u6392\u5E8F",className:"w-100px"},{key:"enabled",title:"\u542F\u7528\u72B6\u6001",className:"w-100px",render:function(m){return m?"\u542F\u7528":"\u7981\u7528"}},{key:"component",title:"\u5B50\u9762\u677F\u6E32\u67D3\u7EC4\u4EF6",className:"w-150px",render:function(m,d){return d.component?"\u6709\u7EC4\u4EF6":"\u65E0\u7EC4\u4EF6"}},{key:"actions",title:"\u64CD\u4F5C",className:"min-w-125px text-center",render:function(m,d){return(0,e.jsx)(ae,{data:d,onDeleteSuccess:te})}}],dataSource:S})})]}),(0,e.jsx)(de,{menu:j.menu,libraryId:T,onClose:H,onSuccess:pe,onDeleteSuccess:te,visible:j.visible})]})}var ee=ce},17754:function(fe,Z,u){u.d(Z,{v:function(){return P}});var s=u(97857),N=u.n(s);function P(K,w,l){K.split("/").forEach(function(R,D,p){var F=w.find(function(q){var _=q.id;return _==="tag-".concat(R)});F||w.push(F={id:"tag-".concat(R),value:"tag-".concat(R),label:R,children:[]}),w=F.children,p.length===D+1&&w.push(N()(N()({},l),{},{value:l.id,label:l.title||l.name||l.id}))})}}}]);

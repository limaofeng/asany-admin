(self.webpackChunkasany_admin=self.webpackChunkasany_admin||[]).push([[1521],{81521:function(ne,J,f){"use strict";f.r(J),f.d(J,{default:function(){return ee}});var A=f(3182),l=f(11849),M=f(2824),Q=f(94043),D=f.n(Q),h=f(67294),K=f(28865),z=f(86582),G=f(93224),Z=f(14843),P=f(8305),n=f(53704),e=f(85893);function R(u,r){var d,p=(0,P.rq)({variables:{id:u==null?void 0:u.id},refetchQueries:[{query:P.pM,variables:{id:u==null||(d=u.application)===null||d===void 0?void 0:d.id}}]}),j=(0,M.Z)(p,1),m=j[0],x=(0,h.useCallback)((0,A.Z)(D().mark(function c(){var t;return D().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,n.u_.confirm({title:"\u4F60\u786E\u5B9A\u8981\u5220\u9664\u8BE5\u83DC\u5355\u5417\uFF1F",content:(0,e.jsxs)(e.Fragment,{children:["\u60A8\u5373\u5C06\u5220\u9664\u201C",(0,e.jsx)("strong",{children:u.name}),"\u201D\u3002\u5220\u9664\u64CD\u4F5C\u4E0D\u53EF\u9006\u8F6C\uFF0C\u8BF7\u8C28\u614E\u64CD\u4F5C\uFF0C\u60A8\u786E\u5B9A\u5220\u9664\u5417\uFF1F"]}),okText:"\u5220 \u9664",okClassName:"btn-danger"});case 2:if(t=v.sent,!t.isConfirmed){v.next=8;break}return v.next=6,m();case 6:n.FN.success("\u5220\u9664\u6210\u529F"),r(u);case 8:case"end":return v.stop()}},c)})),[m,u,r]);return[x]}var L=R,T=f(25496);function V(u){var r,d=u.form,p=u.appId,j=(0,Z.a$)({variables:{id:p}}),m=j.data,x=(m==null||(r=m.app)===null||r===void 0?void 0:r.menus)||[],c=(0,h.useMemo)(function(){return(0,T.$H)((0,T.G_)((x||[]).map(function(t){return(0,l.Z)({},t)}),{pidKey:"parent.id",sort:function(o,v){return o.index-v.index},converter:function(o,v){var b=v.parent;return(0,l.Z)((0,l.Z)({},o),{},{key:o.id,menuType:o.type,title:b?b.title+"/"+o.name:o.name})}}))},[x]);return(0,h.useEffect)(function(){var t=u.data,o=t.children,v=t._rect,b=t.pos,y=t.parent,g=(0,G.Z)(t,["children","_rect","pos","parent"]);u.data.id||d.resetFields(),d.setFieldsValue((0,l.Z)((0,l.Z)({},g),{},{parentMenu:y?y.id:void 0}))},[d,u.data]),(0,e.jsxs)(n.l0,{form:d,children:[(0,e.jsx)(n.X2,{children:(0,e.jsx)(n.JX,{span:6,children:(0,e.jsx)(n.l0.Item,{name:"name",className:"d-flex flex-column mb-7",required:!0,label:"\u540D\u79F0",rules:[{required:!0,message:"\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A"}],children:(0,e.jsx)(n.II,{solid:!0})})})}),(0,e.jsxs)(n.X2,{children:[(0,e.jsx)(n.JX,{span:6,children:(0,e.jsx)(n.l0.Item,{name:"parentMenu",className:"d-flex flex-column mb-7",label:"\u4E0A\u7EA7\u83DC\u5355",children:(0,e.jsx)(n.ub,{solid:!0,options:[{value:"",label:"\u6839\u8282\u70B9"}].concat((0,z.Z)(c.map(function(t){return{value:t.id,label:t.title}})))})})}),(0,e.jsx)(n.JX,{span:6,children:(0,e.jsx)(n.l0.Item,{name:"type",className:"d-flex flex-column mb-7",label:"\u7C7B\u578B",children:(0,e.jsx)(n.Y8.Group,{solid:!0,options:[{value:"MENU",label:"\u83DC\u5355"},{value:"URL",label:"\u94FE\u63A5\u5730\u5740"},{value:"SECTION",label:"\u7AE0\u8282"}]})})})]}),(0,e.jsxs)(n.X2,{children:[(0,e.jsx)(n.JX,{span:6,children:(0,e.jsx)(n.l0.Item,{name:"icon",className:"d-flex flex-column mb-7",label:"\u56FE\u6807",children:(0,e.jsx)(n.II,{})})}),(0,e.jsx)(n.JX,{span:6,children:(0,e.jsx)(n.l0.Item,{className:"d-flex flex-column mb-7",name:"index",label:"\u6392\u5E8F\u4F4D\u7F6E",children:(0,e.jsx)(n.II,{solid:!0})})})]}),(0,e.jsxs)(n.X2,{children:[(0,e.jsx)(n.JX,{span:4,children:(0,e.jsx)(n.l0.Item,{valuePropName:"checked",className:"d-flex flex-column mb-7",name:"hideInMenu",children:(0,e.jsx)(n.rs,{solid:!0,label:"\u4E0D\u5728\u83DC\u5355\u4E2D\u663E\u793A"})})}),(0,e.jsx)(n.JX,{span:4,children:(0,e.jsx)(n.l0.Item,{valuePropName:"checked",className:"d-flex flex-column mb-7",name:"hideChildrenInMenu",children:(0,e.jsx)(n.rs,{solid:!0,label:"\u4E0D\u663E\u793A\u5B50\u83DC\u5355"})})}),(0,e.jsx)(n.JX,{span:4,children:(0,e.jsx)(n.l0.Item,{valuePropName:"checked",className:"d-flex flex-column mb-7",name:"hideInBreadcrumb",children:(0,e.jsx)(n.rs,{solid:!0,label:"\u4E0D\u5728\u9762\u5305\u5C51\u4E2D\u663E\u793A"})})})]}),(0,e.jsx)(n.X2,{children:(0,e.jsx)(n.l0.Item,{className:"d-flex flex-column mb-7",name:"authority",label:"\u8BBF\u95EE\u6743\u9650",children:(0,e.jsx)(n.II,{solid:!0})})}),(0,e.jsx)(n.l0.Item,{dependencies:["type"],noStyle:!0,children:function(){return(0,e.jsxs)(n.X2,{children:[" ",(0,e.jsx)(n.l0.Item,{className:"d-flex flex-column mb-7",name:"path",label:"\u94FE\u63A5",children:(0,e.jsx)(n.II,{solid:!0})})]})}}),(0,e.jsx)(n.l0.Item,{dependencies:["type","parentMenu"],noStyle:!0,children:function(){return d.getFieldValue("type")!=="MENU"||!!d.getFieldValue("parentMenu")?(0,e.jsx)(e.Fragment,{}):(0,e.jsx)(n.X2,{children:(0,e.jsx)(n.l0.Item,{className:"d-flex flex-column mb-7",name:"component",label:"\u7EC4\u4EF6",children:(0,e.jsx)(n.II,{solid:!0})})})}})]})}function H(u,r){var d,p,j,m=n.l0.useForm(),x=(0,h.useState)(!1),c=(0,M.Z)(x,2),t=c[0],o=c[1],v=(0,Z.hT)({fetchPolicy:"no-cache",refetchQueries:[{query:Z.pM,variables:{id:u==null||(d=u.application)===null||d===void 0?void 0:d.id}}]}),b=(0,M.Z)(v,1),y=b[0],g=(0,Z.A6)({fetchPolicy:"no-cache",refetchQueries:[{query:Z.pM,variables:{id:u==null||(p=u.application)===null||p===void 0?void 0:p.id}}]}),S=(0,M.Z)(g,1),$=S[0],F=(0,h.useMemo)(function(){return u!=null&&u.id?(0,A.Z)(D().mark(function X(){var C,I,N;return D().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return o(!0),a.prev=1,a.next=4,m.validateFields();case 4:return C=a.sent,a.next=7,n.FN.promise((0,T.gw)($({variables:{id:u.id,input:(0,l.Z)({},C)}}),350),{pending:"\u63D0\u4EA4\u4E2D...",success:{render:function(){return(0,e.jsxs)(e.Fragment,{children:["\u83DC\u5355 ",(0,e.jsx)("strong",{children:C.name})," \u4FDD\u5B58\u6210\u529F"]})}},error:"\u63D0\u4EA4\u51FA\u9519"},{duration:2e3,placement:"top-center"});case 7:I=a.sent,N=I.data,r(N.updateMenu),o(!1),a.next=16;break;case 13:a.prev=13,a.t0=a.catch(1),o(!1);case 16:case"end":return a.stop()}},X,null,[[1,13]])})):(0,A.Z)(D().mark(function X(){var C,I,N;return D().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return o(!0),a.prev=1,a.next=4,m.validateFields();case 4:return C=a.sent,a.next=7,n.FN.promise((0,T.gw)(y({variables:{input:(0,l.Z)((0,l.Z)({},C),{},{application:u.application.id})}}),350),{pending:"\u63D0\u4EA4\u4E2D...",success:{render:function(){return(0,e.jsxs)(e.Fragment,{children:["\u83DC\u5355 ",(0,e.jsx)("strong",{children:C.name})," \u65B0\u589E\u6210\u529F"]})}},error:"\u63D0\u4EA4\u51FA\u9519"},{duration:2e3,placement:"top-center"});case 7:I=a.sent,N=I.data,r(N.createMenu),o(!1),a.next=16;break;case 13:a.prev=13,a.t0=a.catch(1),o(!1);case 16:case"end":return a.stop()}},X,null,[[1,13]])}))},[y,u==null||(j=u.application)===null||j===void 0?void 0:j.id,u==null?void 0:u.id,m,r,$]);return[F,{form:m,submitting:t}]}function O(u){var r=u.menu,d=u.visible,p=u.onClose,j=u.onSuccess,m=u.onDeleteSuccess,x=H(r,j),c=(0,M.Z)(x,2),t=c[0],o=c[1],v=o.form,b=o.submitting,y=(0,h.useMemo)(function(){var F;return r?(0,l.Z)((0,l.Z)({},r),{},{component:(F=r.component)===null||F===void 0?void 0:F.id}):{type:"URL",index:0}},[r]),g=L(r,m),S=(0,M.Z)(g,1),$=S[0];return(0,e.jsx)(n.dy,{title:r!=null&&r.id?"\u7F16\u8F91\u83DC\u5355":"\u65B0\u589E\u83DC\u5355",placement:"right",width:640,mask:!1,onClose:p,visible:d,footer:(0,e.jsxs)(n.X2,{children:[(0,e.jsx)(n.JX,{span:6,children:(0,e.jsx)(n.zx,{style:{letterSpacing:"1rem"},className:"w-100",loading:b,onClick:t,children:"\u4FDD\u5B58"})}),(0,e.jsx)(n.JX,{span:6,children:(r==null?void 0:r.id)&&(0,e.jsx)(n.zx,{style:{letterSpacing:"1rem"},className:"w-100",variant:"danger",variantStyle:"light",onClick:$,children:"\u5220\u9664"})})]}),children:r&&(0,e.jsx)(V,{submitting:b,data:y,appId:r.application.id,form:v,submit:t,onDeleteSuccess:m})})}var W=O,Y=f(75468);function q(u){var r=u.data,d=u.onDeleteSuccess,p=L(r,d),j=(0,M.Z)(p,1),m=j[0];return(0,e.jsx)("div",{className:"d-flex flex-row-fluid justify-content-center",onClick:function(c){c.stopPropagation(),c.preventDefault()},children:(0,e.jsx)("div",{className:"ms-2",children:(0,e.jsx)(n.zx,{variant:"danger",variantStyle:"light",icon:(0,e.jsx)(K.ZP,{className:"svg-icon-2",name:"Duotune/arr088"}),onClick:m})})})}function _(u){var r,d,p=u.match.params.id,j=(0,h.useState)({visible:!1}),m=(0,M.Z)(j,2),x=m[0],c=m[1],t=(0,Z.A6)({fetchPolicy:"no-cache",refetchQueries:[{query:Z.pM,variables:{id:p}}]}),o=(0,M.Z)(t,1),v=o[0],b=(0,Z.a$)({variables:{id:p}}),y=b.data,g=b.loading,S=y==null||(r=y.app)===null||r===void 0?void 0:r.menus,$=(0,h.useMemo)(function(){return(0,T.G_)((S||[]).map(function(a){return(0,l.Z)((0,l.Z)({},a),{},{children:[]})}),{pidKey:"parent.id",sort:function(i,s){return i.index-s.index},converter:function(i){return(0,l.Z)((0,l.Z)({},i),{},{key:i.id,title:i.name,menuType:i.type,type:"directory",application:{id:p}})}})},[p,S]),F=(0,h.useCallback)(function(){c(function(a){return(0,l.Z)((0,l.Z)({},a),{},{visible:!1})})},[]),X=(0,h.useCallback)(function(){c(function(a){return(0,l.Z)((0,l.Z)({},a),{},{visible:!0,menu:{index:0,icon:"Duotune/abs005",type:"MENU",application:{id:p}}})})},[p]),C=(0,h.useCallback)(function(a){c(function(i){var s;return((s=i.menu)===null||s===void 0?void 0:s.id)==a.node.id&&i.visible?(0,l.Z)((0,l.Z)({},i),{},{visible:!1}):(0,l.Z)((0,l.Z)({},i),{},{visible:!0,menu:(0,l.Z)((0,l.Z)({},a.node),{},{type:a.node.menuType,parentMenu:a.node.parentKey})})})},[]),I=(0,h.useCallback)(function(){var a=(0,A.Z)(D().mark(function i(s){var E,w,U;return D().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:if(console.log(s),!(((E=s.dragNode.parent)===null||E===void 0?void 0:E.id)==((w=s.node.parent)===null||w===void 0?void 0:w.id)&&s.dragNode.index==s.toIndex)){k.next=3;break}return k.abrupt("return");case 3:return k.next=5,n.FN.promise(v({variables:{id:s.dragNode.id,input:{parentMenu:(U=s.node.parent)===null||U===void 0?void 0:U.id,index:s.toIndex}}}),{pending:"\u66F4\u65B0\u6392\u5E8F...",success:"\u6392\u5E8F\u8C03\u6574\u6210\u529F",error:"\u63D0\u4EA4\u51FA\u9519"},{duration:2e3,placement:"top-center"});case 5:case"end":return k.stop()}},i)}));return function(i){return a.apply(this,arguments)}}(),[v]),N=(0,h.useCallback)(function(a){c(function(i){var s;return((s=i.menu)===null||s===void 0?void 0:s.id)!=a.id?i:(0,l.Z)((0,l.Z)({},i),{},{visible:!1,menu:void 0})})},[c]),B=(0,h.useCallback)(function(a){c(function(i){return(0,l.Z)((0,l.Z)({},i),{},{menu:a})})},[c]);return(0,e.jsxs)(Y.v,{header:{title:"\u83DC\u5355\u8BBE\u7F6E"},loading:g,children:[(0,e.jsxs)(n.Zb,{flush:!0,children:[(0,e.jsxs)(n.Zb.Header,{className:"pt-8",children:[(0,e.jsx)(n.Zb.Title,{}),(0,e.jsx)(n.Zb.Toolbar,{children:(0,e.jsx)("div",{className:"d-flex justify-content-end",children:(0,e.jsx)(n.zx,{onClick:X,variant:"primary",children:"\u65B0\u5EFA\u83DC\u5355"})})})]}),(0,e.jsx)(n.Zb.Body,{className:"pt-0",children:(0,e.jsx)(n.N4,{className:"app-treelist",rowKey:"id",draggable:!0,onSelect:C,selectedKeys:(d=x.menu)!==null&&d!==void 0&&d.id?[x.menu.id]:[],onDrop:I,columns:[{key:"title",title:"\u540D\u79F0",width:"auto",render:function(i,s){var E,w={SECTION:{color:"info"},URL:{color:"primary"},MENU:{color:"success"},SCRIPT:{color:"dark"}};return(0,e.jsxs)("div",{className:"d-flex flex-column py-5",children:[(0,e.jsx)("span",{className:"title text-gray-800 text-hover-primary mb-1 fs-6",children:s.title}),(0,e.jsxs)("div",{className:"d-flex flex-row col-stacked",children:[(0,e.jsx)(n.Ct,{color:(E=w[s.menuType])===null||E===void 0?void 0:E.color,children:s.menuType}),(0,e.jsx)("span",{className:"tw-pl-2",children:s.path})]})]})}},{key:"index",title:"\u6392\u5E8F",className:"w-100px"},{key:"enabled",title:"\u542F\u7528\u72B6\u6001",className:"w-100px",render:function(i){return i?"\u542F\u7528":"\u7981\u7528"}},{key:"component",title:"\u5B50\u9762\u677F\u6E32\u67D3\u7EC4\u4EF6",className:"w-150px",render:function(i,s){return s.component?"\u6709\u7EC4\u4EF6":"\u65E0\u7EC4\u4EF6"}},{key:"actions",title:"\u64CD\u4F5C",className:"min-w-125px text-center",render:function(i,s){return(0,e.jsx)(q,{data:s,onDeleteSuccess:N})}}],dataSource:$})})]}),(0,e.jsx)(W,{menu:x.menu,onClose:F,onSuccess:B,onDeleteSuccess:N,visible:x.visible})]})}var ee=_}}]);

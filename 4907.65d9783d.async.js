"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[4907],{64907:function(he,ee,i){i.r(ee),i.d(ee,{default:function(){return ze}});var se=i(15009),u=i.n(se),te=i(99289),b=i.n(te),Y=i(5574),w=i.n(Y),xe=i(97857),G=i.n(xe),n=i(67294),ie=i(96974),pe=i(17187),be=i.n(pe),H=i(46027),Me=i(35090),ue=i(12845),ye=i(93967),le=i.n(ye),Ce=i(96486),ke=i(73588),T=i(89717),Z=i(12708),Ne=i(24561),we=i(30381),fe=i.n(we),je=i(32115),S=i(74600),C=i(92623),a=i(85893);function De(t){return t.mimeType==="text/html"?(0,je.Kv)(t.body||""):t.body}function Re(t){var g=fe()(t.date),e=fe()().diff(g,"days");return e===0?g.format("A HH:mm"):e===1?g.fromNow():g.format("YYYY-MM-DD")}function Ie(t){return t.mailboxName===C.LJ.INBOX.id?t.from.map(C.ss).join("\u3001"):(t.mailboxName===C.LJ.Sent.id,t.to.map(C.ss).join("\u3001"))}function Ae(t){var g=t.index,e=t.data,h=t.refresh,x=t.forwardNextMessage,E=(0,S.Rh)({refetchQueries:[S.f_,S.Nd]}),s=w()(E,1),A=s[0],O=(0,S.aB)({refetchQueries:[S.f_]}),d=w()(O,1),M=d[0],z=(0,S.k0)({refetchQueries:[S.Nd]}),W=w()(z,1),U=W[0],F=(0,n.useCallback)(b()(u()().mark(function j(){return u()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,M({variables:{id:e.id,flags:["seen"],mode:e.seen?"REMOVE":"ADD"}});case 2:h({type:"updateFlags",key:e.id,index:g});case 3:case"end":return l.stop()}},j)})),[e.id,e.seen,g,h,M]),$=(0,n.useCallback)(b()(u()().mark(function j(){return u()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,A({variables:{id:e.id,mailbox:"archive"}});case 2:x(),h({type:"toFolder",key:e.id,index:g});case 4:case"end":return l.stop()}},j)})),[e.id,x,h,A,g]),L=(0,n.useCallback)(b()(u()().mark(function j(){var D;return u()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!(e.mailboxName===C.LJ.Drafts.id||e.mailboxName===C.LJ.Trash.id)){r.next=11;break}return r.next=3,T.Modal.confirm({title:"\u8B66\u544A",content:e.mailboxName===C.LJ.Trash.id?"\u786E\u5B9A\u6C38\u4E45\u5220\u9664\u4FE1\u606F\uFF1F":"\u786E\u5B9A\u6C38\u4E45\u5220\u9664\u8349\u7A3F\uFF1F"});case 3:if(D=r.sent,D.isConfirmed){r.next=6;break}return r.abrupt("return");case 6:return r.next=8,U({variables:{id:e.id}});case 8:h({type:"delete",key:e.id,index:g}),r.next=14;break;case 11:return r.next=13,A({variables:{id:e.id,mailbox:"trash"}});case 13:h({type:"toFolder",key:e.id,index:g});case 14:x();case 15:case"end":return r.stop()}},j)})),[e.mailboxName,e.id,x,U,h,g,A]);return(0,a.jsxs)("div",{className:le()("d-flex flex-column email-message-actions",{"message-unread":!e.seen}),onClick:function(D){return D.stopPropagation()},children:[(0,a.jsx)("a",{onClick:F,className:"flags-read",children:(0,a.jsx)(H.JO,{className:"svg-icon-7 svg-icon-success",name:e.seen?"Duotune/abs009":"Duotune/abs050"})}),![C.LJ.Archive.id,C.LJ.Drafts.id,C.LJ.Trash.id].includes(e.mailboxName)&&(0,a.jsx)("a",{onClick:$,children:(0,a.jsx)(H.JO,{className:"svg-icon-6",name:C.LJ.Archive.icon})}),(0,a.jsx)("a",{onClick:L,children:(0,a.jsx)(H.JO,{className:"svg-icon-5",name:"Duotune/gen027"})})]})}function Le(t){var g=t.useMessage,e=t.style,h=t.forwardNextMessage,x=t.active,E=t.index,s=t.onClick,A=t.refresh,O=(0,ie.s0)(),d=g(E),M=(0,n.useCallback)(function(){s(G()(G()({},d),{},{index:E}))},[d,E,s]),z=(0,n.useCallback)(function(){d.mailboxName===C.LJ.Drafts.id&&O("/mail/compose/".concat(d.id),{state:{message:d}})},[d,history]);return(0,a.jsx)("div",{style:e,onClick:d&&M,onDoubleClick:d&&z,className:le()("email-message d-flex flex-row",{active:x}),children:d?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Ae,{forwardNextMessage:h,index:E,refresh:A,data:d}),(0,a.jsxs)("div",{className:"email-message-body d-flex flex-column",children:[(0,a.jsxs)("div",{className:"email-message-attrs",children:[(0,a.jsx)(H.JO,{className:"svg-icon-4 smart-type",name:"Duotune/abs018"}),(0,a.jsx)("span",{className:"email-user",children:Ie(d)||"(\u65E0\u6536\u4EF6\u4EBA)"}),(0,a.jsx)("span",{className:"inbox-time",children:Re(d)})]}),(0,a.jsx)("div",{className:"email-message-title",children:d.subject||"(\u65E0\u4E3B\u9898)"}),(0,a.jsx)("div",{className:"email-message-summary",children:De(d)||"\u6B64\u90AE\u4EF6\u4E2D\u6CA1\u6709\u6587\u672C\u5185\u5BB9\u3002"})]})]}):(0,a.jsx)("div",{className:"email-message-loading",children:(0,a.jsxs)(Ne.ZP,{speed:2,width:500,height:69,viewBox:"0 0 500 69",backgroundColor:"#f3f3f3",foregroundColor:"#ecebeb",children:[(0,a.jsx)("rect",{x:"24",y:"3",rx:"0",ry:"0",width:"476",height:"18"}),(0,a.jsx)("rect",{x:"0",y:"50",rx:"0",ry:"0",width:"500",height:"16"}),(0,a.jsx)("rect",{x:"0",y:"3",rx:"2",ry:"2",width:"18",height:"18"}),(0,a.jsx)("rect",{x:"0",y:"27",rx:"0",ry:"0",width:"500",height:"16"})]})})})}var Te=Le,ce=320,ve=500,ae={totalCount:0,pageSize:0,totalPage:0,currentPage:0},Se=80;function Ee(t){var g=(0,n.useRef)(new(be())),e=(0,n.useRef)({page:1,mailbox:t,loading:!1,messages:[],pagination:G()({},ae)}),h=(0,n.useReducer)(function(l){return l+1},0),x=w()(h,2),E=x[1],s=(0,S.YD)({fetchPolicy:"cache-and-network"}),A=w()(s,2),O=A[0],d=A[1],M=d.data,z=d.loading,W=d.refetch;e.current.loading=z;var U=(0,n.useCallback)(function(l){l.edges.map(function(r){return r.node}).forEach(function(r,f){var p=l.pageSize*(l.currentPage-1)+f;e.current.messages[p]=r}),g.current.emit("messages")},[]),F=(0,n.useCallback)(function(){var l=b()(u()().mark(function r(f){return u()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(!(e.current.loading&&e.current.page===f)){o.next=2;break}return o.abrupt("return");case 2:if(!e.current.loading){o.next=7;break}return o.next=5,(0,Z._v)(120);case 5:o.next=2;break;case 7:e.current.page=f,W({where:{mailbox:e.current.mailbox},page:e.current.page});case 9:case"end":return o.stop()}},r)}));return function(r){return l.apply(this,arguments)}}(),[W]),$=(0,n.useCallback)(function(){var l=b()(u()().mark(function r(f){var p,o;return u()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:p=e.current.pagination.pageSize,e.current.pagination.totalCount%e.current.pagination.pageSize===1&&e.current.pagination.totalPage--,e.current.pagination.totalCount--,e.current.messages.splice(f,1),o=Math.ceil((f+1)/p),F(o);case 6:case"end":return P.stop()}},r)}));return function(r){return l.apply(this,arguments)}}(),[F]),L=(0,n.useCallback)(function(){var l=b()(u()().mark(function r(f){return u()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(!e.current.loading){o.next=5;break}return o.next=3,(0,Z._v)(120);case 3:o.next=0;break;case 5:if(!(e.current.page===f||f>e.current.pagination.totalPage)){o.next=7;break}return o.abrupt("return");case 7:e.current.page=f,O({variables:{where:{mailbox:e.current.mailbox},page:e.current.page}});case 9:case"end":return o.stop()}},r)}));return function(r){return l.apply(this,arguments)}}(),[O]),j=(0,n.useCallback)(function(){var l=b()(u()().mark(function r(f){var p;return u()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(p=e.current.messages[f],p){m.next=12;break}case 2:if(p=e.current.messages[f],p){m.next=8;break}return m.next=6,L(Math.ceil((f+1)/e.current.pagination.pageSize));case 6:return m.next=8,(0,Z._v)(30);case 8:if(!(f>=e.current.messages.length)){m.next=11;break}return console.log("\u7D22\u5F15\u8D85\u51FA\u6700\u5927\u957F\u5EA6 [".concat(f,"/").concat(e.current.messages.length,"]")),m.abrupt("return",e.current.messages[f-1]);case 11:if(!p){m.next=2;break}case 12:return m.abrupt("return",p);case 13:case"end":return m.stop()}},r)}));return function(r){return l.apply(this,arguments)}}(),[L]);(0,n.useEffect)(function(){g.current.setMaxListeners(1e3)},[]),(0,n.useEffect)(function(){e.current.mailbox!==t&&(e.current.mailbox=t,e.current.pagination=G()({},ae),e.current.messages.length=0,e.current.page=1),O({variables:{where:{mailbox:t},page:e.current.page}})},[O,t]),(0,n.useEffect)(function(){z||!(M!=null&&M.mailboxMessages)||(e.current.pagination=M.mailboxMessages?G()({},M.mailboxMessages):e.current.pagination,U(M.mailboxMessages),E())},[U,M==null?void 0:M.mailboxMessages,z]);var D=function(r){var f=(0,n.useReducer)(function(B){return B+1},0),p=w()(f,2),o=p[1],m=(0,n.useRef)({index:r});m.current.index=r,m.current.message=e.current.messages[r],(0,n.useEffect)(function(){if(r!==-1){var B=r+1,X,re=function(){var K=b()(u()().mark(function ne(){return u()().wrap(function(J){for(;;)switch(J.prev=J.next){case 0:if(!e.current.loading){J.next=5;break}return J.next=3,(0,Z._v)(300);case 3:J.next=0;break;case 5:if(!m.current.message){J.next=8;break}return m.current.timer&&clearTimeout(m.current.timer),J.abrupt("return");case 8:L(Math.ceil(B/e.current.pagination.pageSize)),X=setTimeout(re,300);case 10:case"end":return J.stop()}},ne)}));return function(){return K.apply(this,arguments)}}();return X=setTimeout(re,300),function(){X&&clearTimeout(X)}}},[r]);var P=(0,n.useCallback)(function(){var B=e.current.messages[m.current.index];B!==m.current.message&&(m.current.message=B,o())},[]);return(0,n.useEffect)(function(){return g.current.addListener("messages",P),function(){g.current.removeListener("messages",P)}},[P]),m.current.message};return[e.current.pagination,z,D,{loadMessage:j,refetch:F,refetchWithRemove:$}]}function Oe(){var t=(0,ie.bS)({path:"/mail/:folder/:id",end:!1}),g=t==null?void 0:t.params.id,e=(0,ue.useParams)(),h=e.folder,x=(0,ie.s0)(),E=(0,n.useRef)(null),s=(0,n.useRef)({width:ce,folder:h,activeIndex:-1,loading:!1,pagination:ae}),A=(0,n.useReducer)(function(v){return v+1},0),O=w()(A,2),d=O[1];s.current.folder=h,s.current.activeId=g;var M=(0,S.nE)({refetchQueries:[S.Nd]}),z=w()(M,1),W=z[0],U=Ee(h),F=w()(U,4),$=F[0],L=F[1],j=F[2],D=F[3],l=D.loadMessage,r=D.refetch,f=D.refetchWithRemove;s.current.loading=L,s.current.pagination=$;var p=(0,n.useMemo)(function(){return(0,Ce.debounce)(function(){d()},10)},[]),o=(0,n.useCallback)(function(v){s.current.activeIndex=v.index,x("/mail/".concat(v.mailboxName.toLowerCase(),"/").concat(v.id))},[x]);s.current.message=j(s.current.activeIndex);var m=(0,n.useCallback)(function(){var v=b()(u()().mark(function y(k){var N;return u()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(s.current.activeIndex!==k.index){c.next=2;break}return c.abrupt("return");case 2:return c.next=4,l(k.index);case 4:if(N=c.sent,s.current.activeIndex=k.index,s.current.activeId!==N.id){c.next=9;break}return d(),c.abrupt("return");case 9:x("/mail/".concat(N.mailboxName.toLowerCase(),"/").concat(N.id));case 10:case"end":return c.stop()}},y)}));return function(y){return v.apply(this,arguments)}}(),[history,l]),P=(0,n.useCallback)(function(v){s.current.width+=v,p()},[p]),B=(0,n.useCallback)(function(){s.current.width=Math.min(ve,Math.max(ce,s.current.width))},[]),X=Math.min(ve,Math.max(ce,s.current.width));(0,n.useMemo)(function(){s.current.pagination=G()({},ae),s.current.activeIndex=-1,s.current.folder=h},[h]);var re=(0,n.useCallback)(function(){var v=b()(u()().mark(function y(k){var N;return u()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,l(k);case 2:N=c.sent,s.current.activeIndex=k,x("/mail/".concat(N.mailboxName.toLowerCase(),"/").concat(N.id));case 5:case"end":return c.stop()}},y)}));return function(y){return v.apply(this,arguments)}}(),[x,l]),K=(0,n.useCallback)(function(){var v=b()(u()().mark(function y(k){var N;return u()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(N=Math.ceil((k.index+1)/s.current.pagination.pageSize),!["toFolder","delete"].includes(k.type)){c.next=6;break}return c.next=4,f(k.index);case 4:c.next=8;break;case 6:return c.next=8,r(N);case 8:case"end":return c.stop()}},y)}));return function(y){return v.apply(this,arguments)}}(),[r,f]),ne=(0,n.useCallback)(b()(u()().mark(function v(){var y,k;return u()().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return y=0,R.next=3,T.Modal.confirm({title:"\u6E05\u7A7A&nbsp;&nbsp;\u56DE\u6536\u7AD9",content:"\u786E\u5B9A\u6C38\u4E45\u5220\u9664 \u56DE\u6536\u7AD9 \u6587\u4EF6\u5939\u5185\u7684\u5168\u90E8\u90AE\u4EF6\uFF1F",preConfirm:function(){var c=b()(u()().mark(function de(){var q,Q,me;return u()().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return q=document.querySelector(".swal2-confirm"),q.textContent="\u6E05\u7406\u4E2D...",Q=document.createElement("span"),Q.classList.add("spinner-border-sm","ms-2","spinner-border","align-middle"),q.appendChild(Q),_.next=7,(0,Z.gw)(W(),350);case 7:me=_.sent,y=me.data.clearMailboxMessagesInTrashMailbox;case 9:case"end":return _.stop()}},de)}));function oe(){return c.apply(this,arguments)}return oe}()});case 3:if(k=R.sent,k.isConfirmed){R.next=6;break}return R.abrupt("return");case 6:s.current.activeIndex=-1,d(),r(1),x("/mail/".concat(s.current.folder)),T.Modal.success({title:"\u64CD\u4F5C\u6210\u529F",content:"\u56DE\u6536\u7AD9\u5DF2\u88AB\u6E05\u7A7A, \u5171\u5220\u9664 ".concat(y," \u5C01\u90AE\u4EF6"),timer:3e3});case 11:case"end":return R.stop()}},v)})),[W,x,r]),V=(0,n.useMemo)(function(){var v=C.GG.find(function(y){return y.id.toLowerCase()===h});return v||{id:h,name:h,icon:void 0}},[h]),J=(0,n.useCallback)(function(){},[]),Fe=(0,n.useCallback)(function(){return(0,a.jsxs)("div",{className:"mailbox-is-empty",style:{height:"100%"},children:[(0,a.jsx)("img",{src:"/assets/media/illustrations/dozzy-1/4.png"}),(0,a.jsx)("span",{className:"empty-title",children:L?"\u52A0\u8F7D\u4E2D...":"\u6B64\u6587\u4EF6\u5939\u4E3A\u7A7A"}),(0,a.jsx)("span",{className:"empty-subtitle",children:L?"\u7A0D\u7B49\u4E00\u4F1A,\u6B63\u5728\u83B7\u53D6\u6570\u636E":"\u8BF7\u67E5\u770B\u5176\u4ED6\u6587\u4EF6\u5939"})]})},[L]),Je=(0,n.useCallback)(function(v){var y=v.key,k=v.style,N=v.index,R=v.isActive,c=s.current,oe=c.folder,de=c.pagination;return(0,a.jsx)(Te,{index:N,style:G()({},k),onClick:o,useMessage:j,refresh:K,forwardNextMessage:b()(u()().mark(function q(){var Q;return u()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(s.current.activeIndex!==-1){I.next=2;break}return I.abrupt("return");case 2:if(de.totalCount!==0){I.next=6;break}x("/mail/".concat(s.current.folder)),I.next=15;break;case 6:if(!(N<s.current.activeIndex)){I.next=11;break}s.current.activeIndex-=1,d(),I.next=15;break;case 11:return I.next=13,l(s.current.activeIndex);case 13:Q=I.sent,x("/mail/".concat(s.current.folder,"/").concat(Q.id));case 15:case"end":return I.stop()}},q)})),mailbox:oe,active:!!R},y)},[o,history,l,K,j]),ge=s.current,Pe=ge.activeIndex,$e=ge.message,Be=(0,ue.useOutlet)();return console.log("Mailbox render",Be),(0,a.jsxs)(ke.vs,{className:"apps-email-mailbox",contentClassName:"ms-0 me-0 mw-100",header:!1,footer:!1,children:[(0,a.jsxs)(Me.w_,{className:le()("mailbox-resizer d-flex flex-column flex-lg-row"),style:{width:X},onResize:P,onResizeEnd:B,children:[(0,a.jsx)("div",{className:"flex-column flex-lg-row-auto w-100 mb-10 mb-lg-0",children:(0,a.jsxs)(T.Card,{flush:!0,className:"mailbox-card border-left-0 border-top-0 border-bottom-0",children:[(0,a.jsx)(T.Card.Header,{className:"px-4",children:(0,a.jsxs)("form",{className:"d-flex align-items-center position-relative w-100",autoComplete:"off",children:[(0,a.jsx)(H.ZP,{name:"Duotune/gen021",className:"svg-icon-2 svg-icon-lg-1 svg-icon-gray-500 position-absolute top-50 ms-2 translate-middle-y"}),(0,a.jsx)(T.Input,{solid:!0,className:"px-10",placeholder:"\u641C\u7D22\u90AE\u4EF6\u2026"})]})}),(0,a.jsxs)(T.Card.Body,{children:[(0,a.jsxs)("div",{className:"mailbox-list-header",children:[V.icon&&(0,a.jsx)(H.ZP,{className:"svg-icon-5 svg-icon-primary",name:V.icon}),(0,a.jsx)("span",{className:"box-name",children:V.name}),V.id===C.LJ.Trash.id&&!!$.totalCount&&(0,a.jsx)("div",{className:"box-actions",children:(0,a.jsx)(T.Button,{className:"trash-clear",variant:"light-danger",size:"sm",activeColor:"light-danger",onClick:ne,children:"\u6E05\u7A7A\xA0\xA0\u56DE\u6536\u7AD9"})})]}),(0,a.jsxs)("div",{className:"infinite-scroll-container",children:[(0,a.jsx)(T.NProgress,{isAnimating:!!L,position:"top"}),(0,a.jsx)(T.InfiniteScroll,{ref:E,rowCount:$.totalCount,rowHeight:Se,scrollToIndex:s.current.activeIndex,onScrollToIndex:m,onScroll:J,rowRenderer:Je,noRowsRenderer:Fe,className:"mailbox-list"})]})]})]})}),(0,a.jsx)("div",{className:"flex-lg-row-fluid ms-lg-7 ms-xl-10"})]}),g?(0,a.jsx)(ue.Outlet,{context:{pagination:$,activeIndex:Pe,goto:re,refresh:K,message:$e}}):(0,a.jsx)("div",{className:"mail-message-details mailbox-message-is-empty",children:(0,a.jsx)("img",{src:"/assets/media/illustrations/sketchy-1/16.png"})})]})}var ze=Oe},92623:function(he,ee,i){i.d(ee,{GG:function(){return te},LJ:function(){return u},ss:function(){return b}});var se=i(5618),u={INBOX:{id:"INBOX",name:"\u6536\u4EF6\u7BB1",icon:"Duotune/com010",badge:"success"},Sent:{id:"Sent",name:"\u5DF2\u53D1\u9001",icon:"Duotune/gen016"},Drafts:{id:"Drafts",name:"\u8349\u7A3F",icon:"Duotune/gen009",badge:"primary"},Archive:{id:"Archive",name:"\u5F52\u6863",icon:"Duotune/lay010"},Spam:{id:"Spam",name:"\u5783\u573E\u90AE\u4EF6",icon:"Duotune/gen044"},Trash:{id:"Trash",name:"\u56DE\u6536\u7AD9",icon:"Duotune/gen027",badge:"warning"},Outbox:{id:"Outbox",name:"\u53D1\u4EF6\u7BB1",icon:"Duotune/gen027"},Later:{id:"Later",name:"\u5F85\u529E",icon:"Duotune/gen027"},Blocked:{id:"Blocked",name:"\u5DF2\u5C4F\u853D",icon:"Duotune/gen027"}},te=Object.keys(u).map(function(Y){return u[Y]});function b(Y){var w=(0,se.N8)(Y);return w.name||w.address&&w.address.substring(0,w.address.indexOf("@"))}}}]);

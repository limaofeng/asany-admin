"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[2542,1201],{51253:function(Ze,je,i){i.d(je,{GP:function(){return se.Z},Hk:function(){return ee},xx:function(){return Ae.x}});var we=i(74958),se=i(5166),Ae=i(19260),o=i(68400),Q=i.n(o),T=i(62435),oe=i(93967),A=i.n(oe),Ee=i(94589),Ce=i(97857),a=i.n(Ce),Ye=i(46027),Ke=i(10582),ae=i(42687),Ve=i(79817),ne=i(5574),G=i.n(ne),F=i(96486),R=i(86074),l={aside:{minimize:!1,width:280}},ye=T.createContext({state:l,dispatch:function(){}}),ke=function(B){return B.AsideToggle="ASIDE_TOGGLE",B.AsideWidth="ASIDE_WIDTH",B}({});function De(B,ie){switch(ie.type){case"ASIDE_TOGGLE":return B.aside.minimize=!B.aside.minimize,a()({},B);case"ASIDE_WIDTH":return B.aside.width=ie.payload,a()({},B);default:throw new Error}}var e=function(ie){var me=(0,T.useReducer)(De,(0,F.cloneDeep)(l)),be=G()(me,2),he=be[0],Me=be[1];return(0,R.jsx)(ye.Provider,{value:{state:he,dispatch:Me},children:ie.children})},Ne=function(){return(0,T.useContext)(ye)},xe=i(65495);function ve(B){var ie=Ne(),me=ie.dispatch,be=ie.state.aside.minimize,he=(0,T.useCallback)(function(){me({type:ke.AsideToggle})},[me]);return(0,R.jsx)(Ve.Button,{style:a()({marginBottom:"1.35rem",zIndex:105},B.style),onClick:he,activeColor:"primary",className:A()("micro-app-aside-toggle","btn-icon bg-body btn-color-gray-700 rounded-2 position-absolute translate-middle bottom-0 shadow-sm d-none d-lg-flex",B.className,{active:be}),children:(0,R.jsx)(Ye.JO,{name:"Duotune/arr063",className:"svg-icon-2 rotate-180"})})}var Oe={"drawer drawer-start":{maxWidth:992}};function Re(B){var ie=B.className,me=B.header,be=B.children,he=B.collapsible,Me=he===void 0?!0:he,Ie=B.width,Fe=Ie===void 0?280:Ie,Te=(0,ae.$Y)(),Pe=Ne(),Ue=Pe.dispatch;(0,T.useEffect)(function(){Te.aside.width(Fe+100),Ue({type:ke.AsideWidth,payload:Fe})},[Te.aside,Ue,Fe]);var $e=(0,Ke.CN)(Oe),ze=(0,ae.BK)(function(He){return He.aside.drawer});return(0,R.jsxs)("div",{className:A()("app-aside aside",ie,$e,{"drawer-on":ze}),children:[(0,R.jsx)(xe.Z,{children:(0,R.jsx)(se.Z,{header:me,resizeable:!0,className:"app-sidebar",children:be})}),Me&&(0,R.jsx)(ve,{className:"start-100 end-0"})]})}Re.Toggle=ve;var We=Re,z,Se=Ee.ZP.div(z||(z=Q()([`
  --root-aside-width: `,`;
  --met-aside-width: `,`;
`])),function(B){return B.minimize?"100px":"".concat(B.width,"px")},function(B){return B.minimize?"100px":"".concat(B.width,"px")});function Le(B){var ie=B.children,me=B.className,be=Ne(),he=be.state.aside,Me=he.minimize,Ie=he.width,Fe=(0,T.useCallback)(function(Te){Te.preventDefault()},[]);return(0,R.jsx)(Se,{minimize:Me,width:Ie,className:A()("micro-app-container page-full-content",me,{"aside-minimize":Me}),onContextMenu:Fe,children:ie})}function ge(B){var ie=B.children,me=B.className;return(0,R.jsx)(e,{children:(0,R.jsx)(Le,{className:me,children:ie})})}ge.Sidebar=We;var ee=ge},42687:function(Ze,je,i){i.d(je,{$Y:function(){return Ye},BK:function(){return ae},aM:function(){return ne}});var we=i(5574),se=i.n(we),Ae=i(97857),o=i.n(Ae),Q=i(62435),T=i(86074),oe=Q.createContext({getState:function(){return{routes:[]}},subscribe:function(){},dispatch:function(){}}),A=function(F,R){return R?R.type==="ASIDE_MINIMIZE"?o()(o()({},F),{},{aside:o()(o()({},F.aside),{},{minimize:!!R.payload})}):R.type==="ASIDE_WIDTH"?o()(o()({},F),{},{aside:o()(o()({},F.aside),{},{width:R.payload})}):R.type==="ASIDE_COLLAPSIBLE"?o()(o()({},F),{},{aside:o()(o()({},F.aside),{},{collapsible:R.payload})}):R.type==="ASIDE_DRAWER"?o()(o()({},F),{},{aside:o()(o()({},F.aside),{},{drawer:R.payload})}):F:F},Ee=function(F){return o()({},F)};function Ce(G){var F=(0,Q.useReducer)(A,G,Ee),R=se()(F,2),l=R[0],ye=R[1],ke=(0,Q.useState)([]),De=se()(ke,1),e=De[0],Ne=function(Le){return function(){var ge=e.indexOf(Le);ge>-1&&e.splice(ge,1)}},xe=(0,Q.useCallback)(function(Se){return e.unshift(Se),Ne(Se)},[e]),ve=(0,Q.useCallback)(function(){e.forEach(function(Se){return Se()})},[e]),Oe={getState:function(){return l},dispatch:ye,subscribe:xe},Re=(0,Q.useState)(Oe),We=se()(Re,1),z=We[0];return(0,Q.useEffect)(function(){z.getState=function(){return l},ve()},[l]),z}var a=function(F,R){return F===R};function Ye(){var G=(0,Q.useContext)(oe),F=(0,Q.useRef)({aside:{get state(){return G.getState().aside},width:function(l){G.dispatch({type:"ASIDE_WIDTH",payload:l})},minimize:function(l){G.dispatch({type:"ASIDE_MINIMIZE",payload:l})},collapsible:function(l){G.dispatch({type:"ASIDE_COLLAPSIBLE",payload:l})},drawer:function(l){G.dispatch({type:"ASIDE_DRAWER",payload:l})}}});return F.current}function Ke(G){var F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:a,R=(0,Q.useContext)(oe),l=(0,Q.useReducer)(function(xe){return xe+1},0),ye=se()(l,2),ke=ye[1],De=(0,Q.useRef)(),e=G(R.getState());function Ne(){var xe=G(R.getState());F(xe,De.current)||(De.current=xe,ke())}return(0,Q.useEffect)(function(){return R.subscribe(Ne)},[]),e}function ae(G){var F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:a;return Ke(G,F)}function Ve(){var G=useContext(oe);return G.dispatch}function ne(G){var F=G.children,R=G.state,l=Ce(R);return(0,Q.useMemo)(function(){return(0,T.jsx)(oe.Provider,{value:l,children:F})},[F,l])}},48943:function(Ze,je,i){i.r(je),i.d(je,{default:function(){return ya}});var we=i(9783),se=i.n(we),Ae=i(15009),o=i.n(Ae),Q=i(99289),T=i.n(Q),oe=i(5574),A=i.n(oe),Ee=i(64599),Ce=i.n(Ee),a=i(62435),Ye=i(49972),Ke=i(24689),ae=i(12845),Ve=i(93967),ne=i.n(Ve),G=i(30381),F=i.n(G),R=i(51253),l=i(79817),ye=i(12708),ke=i(19632),De=i.n(ke),e=i(86074);function Ne(s){var u=s.calendarSets,n=s.onAction,c=(0,ae.useModel)("calendar",function(m){return m.state.calendarSet}),t=(0,ae.useModel)("calendar",function(m){return m.setCalendarSet}),b=(0,a.useCallback)(function(m){if(m.startsWith("calendar-set-"))t(m.substring(13));else return n(m),!1;return!0},[n,t]),p=(0,a.useMemo)(function(){return[{value:"calendar-set-all",label:"\u5168\u90E8\u65E5\u5386"}].concat(De()(u.map(function(m){return{value:"calendar-set-".concat(m.id),label:m.name}})),[{type:"separator"},{value:"manage-calendars",label:"\u7BA1\u7406\u65E5\u5386"}])},[u]);return(0,e.jsx)("div",{className:"calendar-sidebar-footer",children:(0,e.jsx)(l.Select,{onChange:b,placement:"topCenter",value:"calendar-set-".concat(c),options:p})})}var xe=Ne,ve=i(46027);function Oe(){var s=(0,a.useRef)(null),u=(0,a.useState)(!1),n=A()(u,2),c=n[0],t=n[1],b=(0,a.useState)(""),p=A()(b,2),m=p[0],N=p[1],Y=(0,ae.useModel)("calendar",function(h){var d=h.state;return d.selectedDay||new Date}),y=(0,ae.useModel)("calendar",function(h){return h.state.state==="new"}),S=(0,ae.useModel)("calendar",function(h){return h.changeState}),I=(0,a.useCallback)(function(){var h;(h=s.current)===null||h===void 0||h.focus()},[]),r=(0,a.useCallback)(function(){t(!0)},[]),f=(0,a.useCallback)(function(){var h=document.getElementsByClassName("main-calendar")[0];h==null||h.focus(),S("none"),N(""),t(!1)},[S]),$=(0,a.useCallback)(function(h){h.key==="Escape"&&f()},[f]),j=(0,a.useCallback)(function(h){if(N(h.target.value),!h.target.value){S("none");return}!y&&S("new",Y)},[S,y,Y]),D=(0,a.useCallback)(function(){var h;(h=s.current)!==null&&h!==void 0&&h.value||f()},[f]);return(0,a.useEffect)(function(){var h;if(!y){N(""),t(!1);return}var d=document.activeElement,K=!!d&&(d.tagName==="INPUT"||d.tagName==="SELECT"||d.tagName==="TEXTAREA"||d.contentEditable&&d.contentEditable==="true");K||((h=s.current)===null||h===void 0||h.focus(),N(F()(Y).format("YYYY-MM-DD")))},[y,Y]),(0,e.jsxs)("div",{className:ne()("calendar-event-header",{"event-header-state-new":y}),children:[(0,e.jsx)("div",{className:ne()("calendar-event-header-left"),children:(0,e.jsx)(l.Input,{onFocus:r,onBlur:D,ref:s,value:m,onChange:j,solid:!0,placeholder:"\u65B0\u5EFA\u65E5\u7A0B",onKeyUp:$})}),(0,e.jsx)("a",{className:ne()("calendar-event-header-right",{"calendar-event-new-icon":!(c||y)}),onClick:c||y?f:I,children:(0,e.jsx)(ve.ZP,{className:ne()({"svg-icon-1":c||y,"svg-icon-2x svg-icon-dark":!(c||y)}),name:c||y?"Duotune/arr088":"Duotune/arr087"})})]})}var Re=Oe,We=i(97857),z=i.n(We),Se=i(13769),Le=i.n(Se),ge=i(52035),ee=i(55760);function B(s){var u=(0,ee.V7)({fetchPolicy:"cache-and-network"}),n=u.data,c=(0,a.useMemo)(function(){return n!=null&&n.calendars?n.calendars.filter(function(t){return t.type==="SUNRISE"}).map(function(t){return z()(z()({},t),{},{label:t.name,value:t.id})}):[]},[n==null?void 0:n.calendars]);return(0,e.jsx)(l.Select,z()(z()({},s),{},{options:c,itemRender:function(b,p){var m=b.color,N=(0,e.jsx)("div",{style:{backgroundColor:m,width:12,height:12,marginRight:8,border:"1px solid ".concat((0,ge.r5)(m)),borderRadius:6,display:"inline-block"}});return p?(0,e.jsxs)(e.Fragment,{children:[a.cloneElement(N,{style:z()(z()({},N.props.style),{},{marginRight:5})}),b.label]}):(0,e.jsxs)(e.Fragment,{children:[N,b.label]})}}))}var ie=B,me=["calendar","alert"],be=l.Input.TextArea,he=[{label:"\u65E0",value:"none",scope:["all-day","general"],remind:{alert:"NONE"}},{type:"separator",scope:["all-day","general"]},{label:"\u65E5\u7A0B\u5F53\u5929 (\u4E0A\u5348 8:00)",value:"on time of event",scope:["all-day"],remind:{alert:"ON_TIME_OF_EVENT"}},{label:"1 \u5929\u524D (\u4E0A\u5348 8:00)",value:"1 day before 8:00",scope:["all-day"],remind:{alert:"DAYS_BEFORE",times:1}},{label:"2 \u5929\u524D (\u4E0A\u5348 8:00)",value:"2 day before 8:00",scope:["all-day"],remind:{alert:"DAYS_BEFORE",times:2}},{label:"\u65E5\u7A0B\u53D1\u751F\u65F6",value:"at time of event",scope:["general"],remind:{alert:"AT_TIME_OF_EVENT"}},{label:"1 \u5206\u949F\u524D",value:"1 minute before",scope:["general"],remind:{alert:"MINUTES_BEFORE",times:1}},{label:"5 \u5206\u949F\u524D",value:"5 minute before",scope:["general"],remind:{alert:"MINUTES_BEFORE",times:5}},{label:"10 \u5206\u949F\u524D",value:"10 minute before",scope:["general"],remind:{alert:"MINUTES_BEFORE",times:10}},{label:"15 \u5206\u949F\u524D",value:"15 minute before",scope:["general"],remind:{alert:"MINUTES_BEFORE",times:15}},{label:"30 \u5206\u949F\u524D",value:"30 minute before",scope:["general"],remind:{alert:"MINUTES_BEFORE",times:30}},{label:"45 \u5206\u949F\u524D",value:"45 minute before",scope:["general"],remind:{alert:"MINUTES_BEFORE",times:45}},{label:"1 \u5C0F\u65F6\u524D",value:"1 hour before",scope:["general"],remind:{alert:"HOURS_BEFORE",times:1}},{label:"2 \u5C0F\u65F6\u524D",value:"2 hour before",scope:["general"],remind:{alert:"HOURS_BEFORE",times:2}},{label:"1 \u5929\u524D",value:"1 day before",scope:["general"],remind:{alert:"DAYS_BEFORE",times:1}},{label:"2 \u5929\u524D",value:"2 day before",scope:["general"],remind:{alert:"DAYS_BEFORE",times:2}},{type:"separator",scope:["all-day","general"]},{label:"\u81EA\u5B9A\u4E49",value:"custom",scope:[]}];function Me(s){var u=s.visible,n=s.calendarSets,c=s.onSuccess,t=(0,a.useRef)({title:"\u6D4B\u8BD5",allDay:!0,color:"none",alert:"none",starts:"2022-01-19",ends:"2022-01-19"}),b=(0,a.useState)(!1),p=A()(b,2),m=p[0],N=p[1],Y=(0,ae.useModel)("calendar",function(d){var K=d.state;return F()(K.selectedDay||new Date).format("YYYY-MM-DD")}),y=(0,ae.useModel)("calendar",function(d){return d.state.state==="new"}),S=(0,ae.useModel)("calendar",function(d){return d.state.calendarSet}),I=(0,ee.wO)(),r=A()(I,1),f=r[0];t.current.starts=Y,t.current.ends=Y;var $=(0,a.useCallback)(function(){N(function(d){return!d})},[]),j=(0,a.useCallback)(function(d){if(d.key==="Escape"){var K;(K=document.querySelector(".calendar-event-header input"))===null||K===void 0||K.focus()}},[]),D=l.Form.useForm();(0,a.useEffect)(function(){if(!t.current.calendar)if(S==="all")t.current.calendar=null;else{var d;t.current.calendar=(d=n.find(function(K){return K.id===S}))===null||d===void 0||(d=d.defaultCalendar)===null||d===void 0?void 0:d.id}D.setFieldsValue(t.current)},[S,n,D]);var h=(0,a.useCallback)(function(){var d=T()(o()().mark(function K(P){var _,U,E,w,re,O,C;return o()().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return U=P.calendar,E=P.alert,w=Le()(P,me),re=(_=he.find(function(L){return L.value===E}))===null||_===void 0?void 0:_.remind,k.next=4,f({variables:{calendar:U,input:z()(z()({},w),{},{remind:re||{alert:"NONE"}})}});case 4:O=k.sent,C=O.data,c(C==null?void 0:C.event);case 7:case"end":return k.stop()}},K)}));return function(K){return d.apply(this,arguments)}}(),[f,c]);return(0,a.useEffect)(function(){y&&D.setFieldsValue(t.current)},[y,D]),(0,e.jsx)("div",{className:ne()("calendar-new-event-container",{invisible:!u}),children:(0,e.jsx)("div",{className:"calendar-new-event",children:(0,e.jsx)(l.Form,{onFinish:h,form:D,onKeyUp:j,layout:"horizontal",initialValues:t.current,children:(0,e.jsxs)("ul",{children:[(0,e.jsx)("li",{children:(0,e.jsx)(l.Form.Item,{name:"title",noStyle:!0,children:(0,e.jsx)(l.Input,{solid:!0,placeholder:"\u65B0\u5EFA\u65E5\u7A0B"})})}),(0,e.jsx)("li",{children:(0,e.jsx)(l.Form.Item,{name:"allDay",valuePropName:"checked",label:"\u5168\u5929",children:(0,e.jsx)(l.Checkbox,{})})}),(0,e.jsx)("li",{children:(0,e.jsx)(l.Form.Item,{noStyle:!0,dependencies:["allDay"],children:function(){return(0,e.jsx)(l.Form.Item,{name:"starts",label:"\u5F00\u59CB\u65F6\u95F4",children:(0,e.jsx)(l.DatePicker,{solid:!0,timePicker:!D.getFieldValue("allDay"),format:D.getFieldValue("allDay")?"YYYY-MM-DD":"YYYY-MM-DD A HH:mm"})})}})}),(0,e.jsx)("li",{children:(0,e.jsx)(l.Form.Item,{noStyle:!0,dependencies:["allDay","starts"],children:function(){return(0,e.jsx)(l.Form.Item,{name:"ends",label:"\u7ED3\u675F\u65F6\u95F4",children:(0,e.jsx)(l.DatePicker,{solid:!0,minDate:D.getFieldValue("starts"),timePicker:!D.getFieldValue("allDay"),format:D.getFieldValue("allDay")?"YYYY-MM-DD":"YYYY-MM-DD A HH:mm"})})}})}),(0,e.jsx)("li",{children:(0,e.jsx)(l.Form.Item,{name:"calendar",label:"\u65E5\u5386",children:(0,e.jsx)(ie,{solid:!0})})}),(0,e.jsx)("li",{children:(0,e.jsx)(l.Form.Item,{noStyle:!0,dependencies:["allDay"],children:function(){return(0,e.jsx)(l.Form.Item,{name:"alert",label:"\u63D0\u9192",children:(0,e.jsx)(l.Select,{solid:!0,options:he.filter(function(K){return K.scope.includes(D.getFieldValue("allDay")?"all-day":"general")})})})}})}),(0,e.jsx)("li",{className:ne()({invisible:!m}),children:(0,e.jsx)(l.Form.Item,{noStyle:!0,children:(0,e.jsx)(l.Input,{solid:!0,placeholder:"\u8BBE\u7F6E\u94FE\u63A5"})})}),(0,e.jsx)("li",{className:ne()({invisible:!m}),children:(0,e.jsx)(l.Form.Item,{noStyle:!0,children:(0,e.jsx)(be,{autoSize:!0,solid:!0,placeholder:"\u5907\u6CE8"})})}),(0,e.jsxs)("li",{className:"event-actions",children:[(0,e.jsx)(ve.ZP,{onClick:$,className:"toggle-more svg-icon-1",name:m?"Bootstrap/chevron-compact-up":"Bootstrap/chevron-compact-down"}),(0,e.jsx)(l.Form.Item,{noStyle:!0,dependencies:["title"],children:function(){return(0,e.jsx)(l.Button,{htmlType:"submit",disabled:!D.getFieldValue("title"),className:"event-btn-add rounded-2",children:"\u6DFB\u52A0\u65E5\u7A0B"})}})]})]})})})})}var Ie=Me,Fe=i(16085),Te=i(69293),Pe=i(75275),Ue=i(59197),$e=i(96486),ze=i(38932),He=a.forwardRef(function(s,u){var n=s.closeDropdown,c=s.onAction,t=s.accounts,b=(0,a.useCallback)(function(p){n(),p.keyPath.startsWith("new-calendar")?c("new",p.key):p.keyPath.startsWith("new-calendar-subscription")&&c("subscribe")},[n,c]);return(0,e.jsxs)(l.Menu,{className:"menu-gray-600 menu-state-bg-light-primary fw-bold fs-7 w-150px py-2",ref:u,dropdown:!0,onSelect:b,selectedKeys:[],children:[(0,e.jsx)(l.Menu.SubMenu,{title:"\u65B0\u589E\u65E5\u5386",className:"px-2",bodyClassName:"py-2 w-150px",offset:[-6.5,0],children:t.map(function(p){return(0,e.jsx)(l.Menu.Item,{title:p.name,className:"px-2"},p.id)})},"new-calendar"),(0,e.jsx)(l.Menu.Separator,{className:"mx-1"}),(0,e.jsx)(l.Menu.Item,{className:"px-2",children:"\u65B0\u589E\u65E5\u5386\u8BA2\u9605"},"new-calendar-subscription")]})});function qe(s){var u=s.onSuccess,n=s.selectedItem,c=s.onEdit,t=(0,ee.Bo)(),b=A()(t,1),p=b[0],m=(0,ee.Cn)(),N=A()(m,1),Y=N[0],y=(0,ee.e)({fetchPolicy:"cache-and-network"}),S=y.data,I=(0,a.useMemo)(function(){return S!=null&&S.calendarAccounts?S.calendarAccounts||[]:[]},[S==null?void 0:S.calendarAccounts]),r=(0,a.useCallback)(function(){var j=T()(o()().mark(function D(h,d){var K,P;return o()().wrap(function(U){for(;;)switch(U.prev=U.next){case 0:if(console.log(h,d),h!=="new"){U.next=7;break}return U.next=4,p({variables:{input:{account:d}}});case 4:K=U.sent,P=K.data,u(P==null?void 0:P.createCalendar);case 7:case"end":return U.stop()}},D)}));return function(D,h){return j.apply(this,arguments)}}(),[p,u]),f=(0,a.useCallback)(function(){n&&c(n.id,"modal")},[c,n]),$=(0,a.useCallback)(T()(o()().mark(function j(){var D;return o()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(n){d.next=2;break}return d.abrupt("return");case 2:return d.next=4,l.Modal.confirm({title:"\u4F60\u786E\u5B9A\u8981\u5220\u9664\u65E5\u5386\u5417\uFF1F",content:"\u60A8\u786E\u5B9A\u8981\u5220\u9664\u65E5\u5386\u201C<strong>".concat(n.name,"</strong>\u201D\u5417\uFF1F\u8FD9\u4E5F\u5C06\u5220\u9664\u6B64\u65E5\u5386\u4E0A\u7684\u6240\u6709\u4E8B\u4EF6\u3002"),okText:"\u5220 \u9664",cancelClassName:"btn btn-secondary btn-sm",okClassName:"btn btn-danger btn-sm"});case 4:if(D=d.sent,D.isConfirmed){d.next=7;break}return d.abrupt("return");case 7:return d.next=9,Y({variables:{id:n.id}});case 9:u();case 10:case"end":return d.stop()}},j)})),[Y,n,u]);return(0,e.jsxs)("div",{className:"calendars-footer",children:[(0,e.jsx)(l.Dropdown,{overlay:(0,e.jsx)(He,{onAction:r,accounts:I}),placement:"bottomLeft",children:(0,e.jsx)("a",{children:(0,e.jsx)(ve.ZP,{name:"Duotune/arr087",className:"svg-icon-2"})})}),(0,e.jsx)("a",{onClick:$,className:ne()({disabled:!n}),children:(0,e.jsx)(ve.ZP,{name:"Duotune/arr089",className:"svg-icon-2"})}),(0,e.jsx)("a",{onClick:f,className:ne()({disabled:!n}),children:(0,e.jsx)(ve.ZP,{name:"Bootstrap/gear-fill",className:"svg-icon-7"})})]})}var ea=qe,Ge=i(34155),aa=a.forwardRef(function(s,u){var n=s.data,c=s.onSelect,t=s.onEdit,b=s.onCheck,p=s.editing,m=s.actived,N=s.checked,Y=s.drag,y=s.indicator,S=s.onShortcut,I=(0,a.useState)(n.name),r=A()(I,2),f=r[0],$=r[1],j=(0,a.useRef)(null),D=(0,ee.wg)(),h=A()(D,1),d=h[0],K=(0,a.useCallback)(function(){c(n.id)},[n.id,c]),P=(0,a.useCallback)(function(g){$(g.target.value)},[]),_=(0,a.useMemo)(function(){return(0,$e.debounce)(function(){var g=T()(o()().mark(function k(L){return o()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,d({variables:{id:n.id,input:{name:L}}});case 2:case"end":return v.stop()}},k)}));return function(k){return g.apply(this,arguments)}}(),250)},[d,n.id]),U=(0,a.useCallback)(T()(o()().mark(function g(){return o()().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:t(),n.name!==f&&_(f);case 2:case"end":return L.stop()}},g)})),[n.name,t,_,f]),E=(0,a.useCallback)(function(g,k){if(k){var L;(L=j.current)===null||L===void 0||L.focus(),Ge.nextTick(function(){var v;(v=j.current)===null||v===void 0||v.select()})}else if(g){var x;(x=j.current)===null||x===void 0||(x=x.offsetParent)===null||x===void 0||(x=x.parentElement)===null||x===void 0||(x=x.parentElement)===null||x===void 0||x.focus()}},[]);(0,a.useEffect)(function(){p&&E(m,p)},[m,p,E]);var w=(0,a.useCallback)(function(g){g.stopPropagation(),E(!0)},[E]),re=(0,a.useCallback)(function(g){b(n.id,g.target.checked)},[n,b]),O=(0,a.useCallback)(function(){t(n.id,"modal")},[n.id,t]),C=(0,a.useCallback)(function(){var g=T()(o()().mark(function k(L){return o()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:L==="EXIT"?(t(),$(n.name)):L==="ENTER"?(t(),n.name!==f&&_(f)):S(L);case 1:case"end":return v.stop()}},k)}));return function(k){return g.apply(this,arguments)}}(),[n.name,t,S,_,f]);return(0,e.jsxs)(Pe.fQ,{tag:(0,e.jsx)("li",{ref:Y(u),onClick:K,onDoubleClick:O,className:ne()("calendar-list-item",{active:m,editing:p,"indicator-drag-over-bottom":y>0,"indicator-drag-over-top":y<0})}),name:"CALENDAR_PREFERENCES",handler:C,children:[(0,e.jsx)(l.Checkbox,{style:{backgroundColor:n.color,borderColor:m?(0,ge.tG)(n.color,80):(0,ge.r5)(n.color)},checked:N,onClick:w,onChange:re,className:"calendar-check",size:"sm"}),(0,e.jsxs)("div",{className:"calendar-list-item-btn",children:[(0,e.jsx)("span",{className:"input-state-view",children:f}),(0,e.jsx)("input",{className:"input-state-edit calendar-name",ref:j,onChange:P,onBlur:U,value:f}),n._type==="SUBSCRIPTION"&&(0,e.jsx)("span",{className:"calendar-type",children:"\u8BA2\u9605"})]})]})});function na(s){var u=s.onClose,n=s.visible,c=s.data,t=(0,ee.wg)(),b=A()(t,1),p=b[0],m=l.Form.useForm(),N=(0,a.useState)(c==null?void 0:c.color),Y=A()(N,2),y=Y[0],S=Y[1],I=(0,a.useState)(!1),r=A()(I,2),f=r[0],$=r[1],j=(0,a.useRef)(null),D=(0,a.useRef)(null),h=(0,a.useMemo)(function(){return[{value:"#ff3d33",label:"\u7EA2\u8272"},{value:"#fc8328",label:"\u6A59\u8272"},{value:"#ffcc00",label:"\u9EC4\u8272"},{value:"#63da38",label:"\u7EFF\u8272"},{value:"#1badf8",label:"\u84DD\u8272"},{value:"#cc73e1",label:"\u7D2B\u8272"},{value:"#a67a63",label:"\u68D5\u8272"},{type:"separator"},{value:"other",label:"\u5176\u4ED6"}]},[]),d=(0,a.useMemo)(function(){return y&&h.some(function(E){return E.value===y})?y:"other"},[h,y]);(0,a.useEffect)(function(){var E;n&&(S(c==null?void 0:c.color),m.setFieldsValue(c),(E=j.current)===null||E===void 0||E.focus(),Ge.nextTick(function(){var w;(w=j.current)===null||w===void 0||w.select()}))},[n]),(0,Te.Z)(D,function(){$(!1)});var K=(0,a.useCallback)(function(E){E==="other"?$(!0):S(E)},[S]),P=(0,a.useCallback)(T()(o()().mark(function E(){var w;return o()().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return w=m.getFieldsValue(),O.next=3,p({variables:{id:c.id,input:z()({color:y},w)}});case 3:u();case 4:case"end":return O.stop()}},E)})),[y,c,m,u,p]),_=(0,a.useCallback)(function(){u(),$(!1)},[u]),U=(0,a.useCallback)(function(E){var w=E.hex;S(w)},[]);return(0,e.jsx)(l.Modal,{centered:!0,visible:n,dialogClassName:"modal-dialog-concise-style modal-dialog-small w-400px",onCancel:_,onOk:P,header:!1,closable:!1,okButtonProps:{className:"btn-xs"},cancelButtonProps:{className:"btn-xs"},children:(0,e.jsxs)(l.Form,{form:m,layout:"horizontal",initialValues:z()({},c),size:"xs",children:[(0,e.jsxs)("div",{className:"d-flex flex-row flex-center",children:[(0,e.jsx)("div",{className:"d-flex flex-column-fluid",children:(0,e.jsx)(l.Form.Item,{name:"name",label:"\u540D\u79F0",children:(0,e.jsx)(l.Input,{ref:j,className:"calendar-name"})})}),(0,e.jsx)("div",{className:"d-flex flex-column-auto flex-center",children:(0,e.jsxs)("div",{className:"asany-form-item",children:[(0,e.jsx)(l.Select,{value:d,size:"xs",onChange:K,placement:"bottomCenter",itemRender:function(w,re){var O=w.value==="other"?y||(c==null?void 0:c.color):w.value;if(!O)return(0,e.jsx)(e.Fragment,{});var C=(0,e.jsx)("div",{style:{backgroundColor:O,width:20,height:14,marginRight:8,border:"1px solid ".concat((0,ge.r5)(O)),display:"inline-block"}});return re?a.cloneElement(C,{style:z()(z()({},C.props.style),{},{marginRight:5})}):(0,e.jsxs)(e.Fragment,{children:[C,w.label]})},options:h}),(0,e.jsx)(l.Popover,{visible:f,overlayClassName:"popover-content-body",content:(0,e.jsx)("div",{ref:D,children:(0,e.jsx)(Fe.xS,{presetColors:h.filter(function(E){return E.value!=="other"&&E.type!=="separator"}).map(function(E){return{color:E.value,title:E.label}}),color:y,onChangeComplete:U,onChange:U,width:"220px"})}),children:(0,e.jsx)("div",{})})]})})]}),(c==null?void 0:c.type)==="SUBSCRIPTION"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"d-flex flex-row flex-center",children:(0,e.jsx)(l.Form.Item,{name:"url",label:"\u5730\u5740",children:(0,e.jsx)(l.Input,{})})}),(0,e.jsx)("div",{className:"d-flex flex-row flex-center",children:(0,e.jsx)(l.Form.Item,{name:"refresh",label:"\u5237\u65B0",children:(0,e.jsx)(l.Select,{className:"w-100px",placement:"bottomCenter",options:[{value:"NEVER",label:"\u4ECE\u4E0D"},{value:"EVERY_5_MINUTES",label:"\u6BCF5\u5206\u949F"},{value:"EVERY_15_MINUTES",label:"\u6BCF15\u5206\u949F"},{value:"EVERY_HOVER",label:"\u6BCF\u5C0F\u65F6"},{value:"EVERY_DAY",label:"\u6BCF\u5929"},{value:"EVERY_WEEK",label:"\u6BCF\u5468"}]})})})]}),(0,e.jsxs)("div",{className:"d-flex flex-row flex-center",children:[(0,e.jsx)("div",{className:"d-flex flex-column-auto flex-center",style:{width:56}}),(0,e.jsx)("div",{className:"d-flex flex-column-fluid",children:(0,e.jsx)(l.Form.Item,{name:"ignoreAlerts",valuePropName:"checked",children:(0,e.jsx)(l.Checkbox,{label:"\u5FFD\u7565\u63D0\u9192"})})})]})]})})}function ra(s){var u=s.refresh,n=s.calendarSet,c=(0,ee.wg)(),t=A()(c,1),b=t[0],p=(0,ee.wN)(),m=A()(p,1),N=m[0],Y=(0,ee.DM)(),y=A()(Y,1),S=y[0],I=(0,ee.V7)({fetchPolicy:"cache-and-network"}),r=I.data,f=I.refetch,$=(0,a.useState)(),j=A()($,2),D=j[0],h=j[1],d=(0,a.useState)(),K=A()(d,2),P=K[0],_=K[1],U=(0,a.useState)((n==null?void 0:n.calendars.map(function(M){return M.id}))||[]),E=A()(U,2),w=E[0],re=E[1],O=(0,a.useRef)(null),C=(0,a.useRef)({checkedKeys:[],calendars:[]});C.current.checkedKeys=w,C.current.activeKey=D,C.current.editing=P,C.current.calendarSet=n,C.current.calendars=(r==null?void 0:r.calendars)||[];var g=(0,a.useCallback)(function(M){M&&h(M),_(void 0),Ge.nextTick(function(){var H;(H=O.current)===null||H===void 0||H.focus()})},[]),k=(0,a.useCallback)(function(M){M!==C.current.activeKey&&g(M)},[g]),L=(0,a.useCallback)(function(){var M=T()(o()().mark(function H(W){var ue,V=arguments;return o()().wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:ue=V.length>1&&V[1]!==void 0?V[1]:"modal",W?_({key:W,type:ue}):g();case 2:case"end":return ce.stop()}},H)}));return function(H){return M.apply(this,arguments)}}(),[g]),x=(0,a.useMemo)(function(){if(!(r!=null&&r.calendars))return[];var M=[],H=Ce()(r.calendars),W;try{var ue=function(){var J=W.value,ce=z()(z()({},J),{},{key:J.id,actived:D===J.id,editing:(P==null?void 0:P.key)===J.id&&(P==null?void 0:P.type)==="inline",checked:w.some(function(de){return de===J.id}),_type:J.type});delete ce.type;var Be=M.find(function(de){return de.id===J.account.id});Be?Be==null||Be.calendars.push(ce):M.push(z()(z()({},J.account),{},{calendars:[ce]}))};for(H.s();!(W=H.n()).done;)ue()}catch(V){H.e(V)}finally{H.f()}return M.sort(function(V,J){return V.index-J.index})},[D,w,r==null?void 0:r.calendars,P==null?void 0:P.key,P==null?void 0:P.type]),v=(0,a.useCallback)(function(){var M=T()(o()().mark(function H(W){return o()().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:return V.next=2,f();case 2:W&&(h(W.id),_({type:"inline",key:W.id}));case 3:case"end":return V.stop()}},H)}));return function(H){return M.apply(this,arguments)}}(),[f]),Z=(0,a.useCallback)(function(){},[]),X=(0,a.useCallback)(function(){var M=T()(o()().mark(function H(W){var ue,V,J,ce;return o()().wrap(function(de){for(;;)switch(de.prev=de.next){case 0:return ue=(0,ze.y)(W.node._rect,W.node,W.dragNode,W.dropPosition,W.node.index),V=W.node.pos,J=ue-Number(V[V.length-1]),ce=W.node.index,J===-1?ce--:J===1&&ce++,de.next=7,b({variables:{id:W.dragNode.key,input:{index:Math.max(ce,0)+1}}});case 7:f();case 8:case"end":return de.stop()}},H)}));return function(H){return M.apply(this,arguments)}}(),[f,b]),le=(0,a.useCallback)(function(M){var H;return((H=C.current.editing)===null||H===void 0?void 0:H.key)!==M.id},[]),q=(0,a.useCallback)(function(M){return!isNaN(M.dropPosition)},[]),fe=(0,a.useCallback)(function(M){var H=C.current,W=H.calendars,ue=H.activeKey,V=W.findIndex(function(J){return J.id===ue});M==="PREVIOUS"?g(W[Math.max(V-1,0)].id):M==="NEXT"?h(W[Math.min(V+1,W.length-1)].id):M==="ENTER"?_({key:ue,type:"inline"}):M==="EXIT"&&g()},[g]),te=(0,a.useCallback)(function(){g()},[g]),pe=(0,a.useCallback)(function(){var M=T()(o()().mark(function H(W,ue){var V,J,ce;return o()().wrap(function(de){for(;;)switch(de.prev=de.next){case 0:if(J=(V=C.current.calendarSet)===null||V===void 0?void 0:V.id,ce=C.current.checkedKeys,console.log("handleChange",W,ue,J),!ue){de.next=9;break}return re([].concat(De()(ce),[W])),de.next=7,N({variables:{id:W,set:J}});case 7:de.next=12;break;case 9:return re(ce.filter(function(xa){return xa!==W})),de.next=12,S({variables:{id:W,set:J}});case 12:u();case 13:case"end":return de.stop()}},H)}));return function(H,W){return M.apply(this,arguments)}}(),[u,N,S]);return(0,a.useEffect)(function(){re((n==null?void 0:n.calendars.map(function(M){return M.id}))||[])},[n==null?void 0:n.calendars]),(0,e.jsxs)(Pe.fQ,{tag:(0,e.jsx)("div",{ref:O,className:ne()("calendar-list",{editing:!!P})}),handler:fe,name:"CALENDAR_PREFERENCES",children:[(0,e.jsxs)("div",{className:"calendar-list-notes",children:["\u201C",n==null?void 0:n.name,"\u201D\u65E5\u5386\u96C6\u7684\u65E5\u5386\u548C\u4EFB\u52A1\u5217\u8868\u3002"]}),(0,e.jsxs)("div",{className:"calendar-list-content",children:[(0,e.jsx)("div",{className:"calendars-header",children:"\u6211\u7684\u65E5\u5386"}),(0,e.jsx)("div",{className:"calendars-body scroll-y",children:x.map(function(M){return(0,e.jsxs)("div",{className:"calendars-group",children:[(0,e.jsx)("div",{className:"calendars-group-header",children:"\u6211\u7684\u65E5\u5386"}),(0,e.jsx)("div",{className:"calendars-group-body",children:(0,e.jsx)(Ue.ZP,{onChange:Z,tag:"ul",mode:"indicator",onDrop:X,draggable:le,allowDrop:q,className:"calendar-sets-list",items:M.calendars,rerender:!1,itemRender:function(W,ue){var V=W.data,J=W.index;return(0,a.createElement)(aa,z()(z()({},W),{},{ref:ue,actived:V.actived,editing:V.editing,checked:V.checked,onCheck:pe,key:V.id,data:V,index:J,onSelect:k,onEdit:L,onShortcut:fe}))}})})]},M.id)})}),(0,e.jsx)(ea,{onSuccess:v,selectedItem:C.current.calendars.find(function(M){return M.id===D}),onEdit:L})]}),(0,e.jsx)(na,{data:C.current.calendars.find(function(M){return M.id===D}),visible:(P==null?void 0:P.type)==="modal",onClose:te})]})}var ta=ra;function la(s){var u=s.onSuccess,n=s.selectedKey,c=(0,ee.Xy)(),t=A()(c,1),b=t[0],p=(0,ee.yM)(),m=A()(p,1),N=m[0],Y=(0,a.useCallback)(T()(o()().mark(function S(){var I,r;return o()().wrap(function($){for(;;)switch($.prev=$.next){case 0:return $.next=2,b();case 2:I=$.sent,r=I.data,u(r==null?void 0:r.createCalendarSet);case 5:case"end":return $.stop()}},S)})),[b,u]),y=(0,a.useCallback)(T()(o()().mark(function S(){return o()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,N({variables:{id:n}});case 2:u();case 3:case"end":return r.stop()}},S)})),[N,n,u]);return(0,e.jsxs)("div",{className:"calendar-sets-footer",children:[(0,e.jsx)("a",{onClick:Y,children:(0,e.jsx)(ve.ZP,{name:"Duotune/arr087",className:"svg-icon-2"})}),(0,e.jsx)("a",{onClick:y,children:(0,e.jsx)(ve.ZP,{name:"Duotune/arr089",className:"svg-icon-2"})})]})}var sa=la,Qe=i(34155),ia=a.forwardRef(function(s,u){var n=s.data,c=s.editing,t=s.actived,b=s.onSelect,p=s.onEdit,m=s.drag,N=s.indicator,Y=(0,ee.f4)(),y=A()(Y,1),S=y[0],I=(0,a.useState)(n.name),r=A()(I,2),f=r[0],$=r[1],j=(0,a.useRef)(null),D=(0,a.useCallback)(function(){b(n.id)},[n.id,b]),h=(0,a.useCallback)(function(){p(n.id)},[n.id,p]),d=(0,a.useMemo)(function(){return(0,$e.debounce)(function(){var U=T()(o()().mark(function E(w){return o()().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return O.next=2,S({variables:{id:n.id,input:{name:w}}});case 2:case"end":return O.stop()}},E)}));return function(E){return U.apply(this,arguments)}}(),250)},[S,n.id]),K=(0,a.useCallback)(T()(o()().mark(function U(){return o()().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(p(),n.name===f){w.next=4;break}return w.next=4,d(f);case 4:case"end":return w.stop()}},U)})),[n.name,p,d,f]),P=(0,a.useCallback)(function(U){$(U.target.value)},[]);(0,a.useEffect)(function(){var U;c&&((U=j.current)===null||U===void 0||U.focus(),Qe.nextTick(function(){var E;(E=j.current)===null||E===void 0||E.select()}))},[c]);var _=(0,a.useCallback)(function(){var U=T()(o()().mark(function E(w){return o()().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:if(w!=="EXIT"){O.next=5;break}p(),$(n.name),O.next=10;break;case 5:if(w!=="ENTER"){O.next=10;break}if(p(),n.name===f){O.next=10;break}return O.next=10,d(f);case 10:case"end":return O.stop()}},E)}));return function(E){return U.apply(this,arguments)}}(),[n.name,p,d,f]);return(0,e.jsx)(Pe.fQ,{tag:(0,e.jsx)("li",{ref:m(u),onClick:D,onDoubleClick:h,className:ne()("calendarset-item",{active:t,"indicator-drag-over-bottom":N>0,"indicator-drag-over-top":N<0})}),name:"CALENDAR_PREFERENCES",handler:_,children:(0,e.jsxs)("div",{className:"calendarset-item-btn",children:[(0,e.jsx)("span",{className:"input-state-view",children:f}),(0,e.jsx)("input",{className:"input-state-edit",ref:j,onChange:P,onBlur:K,value:f})]})})});function ua(s){var u=s.data,n=u===void 0?[]:u,c=s.refresh,t=s.onSelect,b=(0,ee.f4)(),p=A()(b,1),m=p[0],N=(0,ae.useModel)("calendar",function(C){return C.state.calendarSet}),Y=(0,a.useRef)(null),y=(0,a.useRef)({calendarSets:[]}),S=(0,a.useState)(),I=A()(S,2),r=I[0],f=I[1],$=(0,a.useState)(),j=A()($,2),D=j[0],h=j[1];y.current.activeKey=r,y.current.editing=D,y.current.calendarSets=n;var d=(0,a.useCallback)(function(C){C!==y.current.activeKey&&(f(C),Qe.nextTick(function(){var g;(g=Y.current)===null||g===void 0||g.focus()}))},[]),K=(0,a.useCallback)(function(){var C=T()(o()().mark(function g(k){return o()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,c();case 2:k?(f(k.id),h(k.id)):n.length&&f(n[0].id);case 3:case"end":return x.stop()}},g)}));return function(g){return C.apply(this,arguments)}}(),[n,c]),P=(0,a.useCallback)(function(){var C=T()(o()().mark(function g(k){return o()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:h(k),k||Qe.nextTick(function(){var v;(v=Y.current)===null||v===void 0||v.focus()});case 2:case"end":return x.stop()}},g)}));return function(g){return C.apply(this,arguments)}}(),[]);(0,a.useEffect)(function(){if(n.length&&!n.some(function(g){return g.id===r})){var C=N==="all"?n[0].id:String(N);f(C)}},[r,n,N]),(0,a.useEffect)(function(){r&&t(r)},[r,t]);var _=(0,a.useCallback)(function(C){var g=y.current,k=g.calendarSets,L=g.activeKey,x=k.findIndex(function(v){return v.id===L});C==="PREVIOUS"?f(k[Math.max(x-1,0)].id):C==="NEXT"?f(k[Math.min(x+1,k.length-1)].id):C==="ENTER"?h(r):C==="EXIT"&&h(void 0)},[r]),U=(0,a.useCallback)(function(){},[]),E=(0,a.useMemo)(function(){return n.map(function(C){return z()(z()({},C),{},{key:C.id,actived:r===C.id,editing:D===C.id})})},[r,n,D]),w=(0,a.useCallback)(function(){var C=T()(o()().mark(function g(k){var L,x,v,Z;return o()().wrap(function(le){for(;;)switch(le.prev=le.next){case 0:return L=(0,ze.y)(k.node._rect,k.node,k.dragNode,k.dropPosition,k.node.index),x=k.node.pos,v=L-Number(x[x.length-1]),Z=k.node.index,v===-1?Z--:v===1&&Z++,le.next=7,m({variables:{id:k.dragNode.key,input:{index:Math.max(Z,0)+1}}});case 7:c();case 8:case"end":return le.stop()}},g)}));return function(g){return C.apply(this,arguments)}}(),[c,m]),re=(0,a.useCallback)(function(C){return y.current.editing!==C.id},[]),O=(0,a.useCallback)(function(C){return!isNaN(C.dropPosition)},[]);return(0,e.jsxs)(Pe.fQ,{tag:(0,e.jsx)("div",{ref:Y,className:ne()("flex-left calendar-sets",{editing:!!D})}),name:"CALENDAR_PREFERENCES",handler:_,children:[(0,e.jsx)("div",{className:"calendar-sets-header",children:"\u65E5\u5386\u96C6"}),(0,e.jsx)("div",{className:"calendar-sets-body scroll-y",children:(0,e.jsx)(Ue.ZP,{onChange:U,tag:"ul",mode:"indicator",draggable:re,onDrop:w,allowDrop:O,className:"calendar-sets-list",items:E,rerender:!1,itemRender:function(g,k){var L=g.data,x=g.index;return(0,a.createElement)(ia,z()(z()({},g),{},{ref:k,actived:L.actived,editing:L.editing,key:L.id,data:L,index:x,onSelect:d,onEdit:P}))}})}),(0,e.jsx)(sa,{onSuccess:K,selectedKey:r})]})}var ca=ua;function da(){var s,u=(0,ee.f4)(),n=A()(u,1),c=n[0],t=(0,ee.Dn)({fetchPolicy:"cache-and-network"}),b=t.data,p=t.refetch,m=b==null?void 0:b.calendarSets,N=l.Form.useForm(),Y=(0,a.useState)(),y=A()(Y,2),S=y[0],I=y[1],r=(0,a.useCallback)(function(j){I(j)},[]),f=(m||[]).find(function(j){return j.id===S});(0,a.useEffect)(function(){var j;N.setFieldsValue({defaultCalendar:f==null||(j=f.defaultCalendar)===null||j===void 0?void 0:j.id})},[f,N]);var $=(0,a.useCallback)(T()(o()().mark(function j(){var D;return o()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(D=N.getFieldsValue(),f){d.next=3;break}return d.abrupt("return");case 3:return console.log("handleChange calendarSet",D),d.next=6,c({variables:{id:f.id,input:D}});case 6:case"end":return d.stop()}},j)})),[f,N,c]);return(0,e.jsxs)("div",{className:"settings-calendars",children:[(0,e.jsx)("div",{className:"settings-calendars-notes",children:"\u901A\u8FC7\u521B\u5EFA\u591A\u4E2A\u65E5\u5386\u96C6\u5FEB\u901F\u66F4\u6539\u663E\u793A\u7684\u65E5\u5386\u548C\u4EFB\u52A1\u5217\u8868\u3002\u4F8B\u5982\uFF0C\u60A8\u53EF\u80FD\u6709\u5355\u72EC\u7684\u5BB6\u5EAD\u548C\u5DE5\u4F5C\u65E5\u5386\u96C6\u3002"}),(0,e.jsxs)("div",{className:"d-flex",children:[(0,e.jsx)(ca,{onSelect:r,data:m,refresh:p}),(0,e.jsxs)("div",{className:"settings-calendars-right flex-root",children:[(0,e.jsx)(ta,{refresh:p,calendarSet:f}),(0,e.jsx)("div",{className:"calendar-sets-settings",children:(0,e.jsx)(l.Form,{form:N,layout:"horizontal",size:"xs",initialValues:{defaultCalendar:f==null||(s=f.defaultCalendar)===null||s===void 0?void 0:s.id},onFieldsChange:$,children:(0,e.jsx)("div",{className:"d-flex flex-row flex-center",children:(0,e.jsx)(l.Form.Item,{name:"defaultCalendar",label:"\u9ED8\u8BA4\u65E5\u5386",children:(0,e.jsx)(ie,{solid:!0})})})})})]})]})]})}var oa=da;function va(s){var u=s.visible,n=s.onCancel,c=(0,a.useState)(!1),t=A()(c,2),b=t[0],p=t[1],m=(0,a.useState)("calendars"),N=A()(m,2),Y=N[0],y=N[1],S=(0,a.useCallback)(function(){p(!0)},[]),I=(0,a.useCallback)(function(r){y(r)},[]);return(0,e.jsx)(l.Modal,{centered:!0,maskClosable:!1,visible:u,onCancel:n,onOk:S,scroll:!1,confirmLoading:b,dialogClassName:"mw-750px calendar-preferences",header:(0,e.jsx)(l.Modal.Header,{children:(0,e.jsxs)(l.Nav,{onSelect:I,selectedKey:Y,children:[(0,e.jsx)(l.Nav.Item,{className:"me-2 mb-md-0",children:(0,e.jsxs)(l.Nav.Link,{className:"btn d-flex flex-column btn-active-light-primary",children:[(0,e.jsx)(ve.ZP,{name:"Duotune/cod001",className:"svg-icon-2 me-0"}),(0,e.jsx)("span",{className:"d-flex flex-column align-items-start pt-2",children:(0,e.jsx)("span",{className:"fs-7",children:"\u5E38\u89C4"})})]})},"general"),(0,e.jsx)(l.Nav.Item,{className:"me-2 mb-md-0",children:(0,e.jsxs)(l.Nav.Link,{className:"btn d-flex flex-column btn-active-light-success",children:[(0,e.jsx)(ve.ZP,{name:"Duotune/gen014",className:"svg-icon-2  me-0"}),(0,e.jsx)("span",{className:"d-flex flex-column align-items-start pt-2",children:(0,e.jsx)("span",{className:"fs-7",children:"\u65E5\u5386"})})]})},"calendars"),(0,e.jsx)(l.Nav.Item,{className:"me-2 mb-md-0",children:(0,e.jsxs)(l.Nav.Link,{className:"btn d-flex flex-column btn-active-light-info",children:[(0,e.jsx)(ve.ZP,{name:"Duotune/fil020",className:"svg-icon-2  me-0"}),(0,e.jsx)("span",{className:"d-flex flex-column align-items-start pt-2",children:(0,e.jsx)("span",{className:"fs-7",children:"\u5929\u6C14"})})]})},"weather")]})}),footer:!1,children:(0,e.jsx)(oa,{})})}var fa=va,ma={months:["1 \u6708","2 \u6708","3 \u6708","4 \u6708","5 \u6708","6 \u6708","7 \u6708","8 \u6708","9 \u6708","10 \u6708","11 \u6708","12 \u6708"],weekDays:[{name:"\u661F\u671F\u5929",short:"\u5468\u65E5",isWeekend:!0},{name:"\u661F\u671F\u4E00",short:"\u5468\u4E00"},{name:"\u661F\u671F\u4E8C",short:"\u5468\u4E8C"},{name:"\u661F\u671F\u4E09",short:"\u5468\u4E09"},{name:"\u661F\u671F\u56DB",short:"\u5468\u56DB"},{name:"\u661F\u671F\u4E94",short:"\u5468\u4E94"},{name:"\u661F\u671F\u516D",short:"\u5468\u516D",isWeekend:!0}],weekStartingIndex:0,getToday:function(u){return u},toNativeDate:function(u){return new Date(u.year,u.month-1,u.day)},getMonthLength:function(u){return new Date(u.year,u.month,0).getDate()},transformDigit:function(u){return u},nextMonth:"Next Month",previousMonth:"Previous Month",openMonthSelector:"Open Month Selector",openYearSelector:"Open Year Selector",closeMonthSelector:"Close Month Selector",closeYearSelector:"Close Year Selector",defaultPlaceholder:"Select...",from:"from",to:"to",digitSeparator:",",yearLetterSkip:0,isRtl:!1};function ha(s,u){for(var n=0;n<7;n++){var c=s.clone().add(n,"days"),t=c.format("YYYY-MM-DD");u.has(t)?u.get(t).isWeather=!0:u.set(t,{key:t,date:c,events:[],isToDay:c.isSame(s,"date"),isWeather:!1})}}function Je(s,u){var n=s.format("YYYY-MM-DD"),c=u.find(function(t){return t.isSelected});if(c){if(c.key===n)return u;c.isTemporary?u.splice(u.findIndex(function(t){return t.isTemporary}),1):u.find(function(t){return t.isSelected}).isSelected=!1}if(u.some(function(t){return t.key===n}))u.find(function(t){return t.key===n}).isSelected=!0;else return u.push({key:n,date:s,events:[],isToDay:s.isSame(F()(),"date"),isWeather:!1,isSelected:!0,isTemporary:!0}),u.sort(function(t,b){return t.date.toDate().getTime()-b.date.toDate().getTime()});return u}function Xe(s,u){var n=F()(),c=new Map,t=Ce()(s),b;try{for(t.s();!(b=t.n()).done;){var p=b.value,m=Ce()(p.dates),N;try{for(m.s();!(N=m.n()).done;){var Y=N.value,y=F()(Y),S=y.format("YYYY-MM-DD");if(c.has(S)){var I;(I=c.get(S))===null||I===void 0||I.events.push(p)}else c.set(S,{key:S,date:y,isToDay:y.isSame(n,"date"),events:[p],isWeather:!1})}}catch(r){m.e(r)}finally{m.f()}}}catch(r){t.e(r)}finally{t.f()}return ha(n,c),Je(F()(u),Array.from(c.values()).sort(function(r,f){return r.date.toDate().getTime()-f.date.toDate().getTime()}))}var _e=[];function pa(){var s=(0,ee.Dn)(),u=s.data,n=(0,ae.useModel)("calendar",function(v){var Z=v.state;return Z.calendarSet}),c=(0,ae.useModel)("calendar",function(v){return v.state.state==="new"}),t=(0,ae.useModel)("calendar",function(v){var Z=v.state;return Z.selectedDay||new Date}),b=(0,ae.useModel)("calendar",function(v){return v.setSelectedDay}),p=(0,ae.useModel)("calendar",function(v){return v.changeState}),m=(0,ae.useModel)("calendar",function(v){return v.state.fullCalendar}),N=(0,a.useState)(!1),Y=A()(N,2),y=Y[0],S=Y[1],I=(0,a.useRef)(null),r=(0,a.useRef)({selectedDay:t,eventsWithDays:[]}),f=(0,a.useReducer)(function(v){return v+1},0),$=A()(f,2),j=$[1];r.current.calendarSet=n;var D=(0,ee.Vk)({fetchPolicy:"cache-and-network"}),h=A()(D,2),d=h[0],K=h[1].refetch,P=(0,a.useCallback)(function(){S(!1)},[]),_=(0,a.useCallback)(function(v){v==="manage-calendars"&&S(!0)},[]),U=(0,a.useCallback)(function(v){v&&b(new Date(v.year,v.month-1,v.day))},[b]),E=(0,a.useCallback)(function(v){return function(){b(r.current.selectedDay=v)}},[b]),w=(0,a.useCallback)(function(v){if(I.current){var Z=Array.from(document.getElementsByClassName("event-list-item")),X=Z.find(function(fe){return F()(fe.dataset.date).isSame(F()(v),"date")});if(X){var le=X.getBoundingClientRect().top+I.current.scrollTop,q=I.current.getBoundingClientRect();I.current.scrollTo({top:le-q.top-6.5}),r.current.skipNextScroll=!0,setTimeout(function(){clearTimeout(r.current.timer)},120),j()}}},[]);(0,a.useEffect)(function(){d({variables:{date:t,days:60,calendarSet:n==="all"?void 0:n}}).then(function(v){var Z=v.data;r.current.eventsWithDays=Xe((Z==null?void 0:Z.events)||[],r.current.selectedDay),r.current.toDayOrNextEvent=r.current.eventsWithDays.find(function(X){return X.key===F()(r.current.selectedDay).format("YYYY-MM-DD")}),r.current.skipNextScroll=!0,j(),w(t)})},[n,d]);var re=(0,a.useCallback)(function(){var v=T()(o()().mark(function Z(X){var le,q;return o()().wrap(function(te){for(;;)switch(te.prev=te.next){case 0:return r.current.selectedDay=X,r.current.eventsWithDays=Je(F()(X),r.current.eventsWithDays),r.current.toDayOrNextEvent=r.current.eventsWithDays.find(function(pe){return pe.key===F()(X).format("YYYY-MM-DD")}),r.current.skipNextScroll=!0,j(),te.next=7,(0,ye._v)(60);case 7:return w(X),te.next=10,(0,ye._v)(60);case 10:if(r.current.selectedDay===X){te.next=12;break}return te.abrupt("return");case 12:return te.next=14,K({date:X,days:60,calendarSet:r.current.calendarSet==="all"?void 0:r.current.calendarSet});case 14:return le=te.sent,q=le.data,r.current.eventsWithDays=Xe(q.events,r.current.selectedDay),r.current.skipNextScroll=!0,j(),te.next=21,(0,ye._v)(60);case 21:r.current.selectedDay===X&&w(X);case 22:case"end":return te.stop()}},Z)}));return function(Z){return v.apply(this,arguments)}}(),[]);(0,a.useEffect)(function(){r.current.selectedDay&&F()(r.current.selectedDay).isSame(t,"date")||r.current.eventsWithDays.length&&re(t)},[t]);var O=(0,a.useCallback)(function(){if(I.current){if(r.current.skipNextScroll){r.current.skipNextScroll=!1;return}var v=Array.from(document.getElementsByClassName("event-list-item")),Z=I.current.getBoundingClientRect(),X=v.find(function(q){if(q.dataset.temp==="true")return!1;var fe=q.getBoundingClientRect(),te=q.getElementsByClassName("event-list")[0].getBoundingClientRect().height,pe=fe.top-Z.top+te+16;return pe>0&&pe<fe.height});if(X){var le=r.current.eventsWithDays.find(function(q){return q.key===X.dataset.date});le&&(r.current.eventsWithDays=r.current.eventsWithDays.filter(function(q){return!q.isTemporary}),r.current.eventsWithDays.forEach(function(q){q.isSelected=!1}),le.isSelected=!0,r.current.skipNextScroll=!0,r.current.toDayOrNextEvent=le,j(),clearTimeout(r.current.timer),r.current.timer=setTimeout(T()(o()().mark(function q(){var fe,te;return o()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return M.next=2,K({date:le.date.toDate(),days:60,calendarSet:r.current.calendarSet==="all"?void 0:r.current.calendarSet});case 2:fe=M.sent,te=fe.data,r.current.eventsWithDays=Xe(te.events,r.current.selectedDay),r.current.skipNextScroll=!0,j();case 7:case"end":return M.stop()}},q)})),1e3),b(r.current.selectedDay=F()(X.dataset.date).toDate()))}}},[b]),C=(0,a.useCallback)(function(v){var Z=document.getElementsByClassName("main-calendar")[0];Z==null||Z.focus(),p("none"),console.log("fullCalendar",m==null?void 0:m.getApi()),m==null||m.getApi().refetchEvents(),re(new Date(v.datetime.starts))},[m,p,re]),g=r.current,k=g.toDayOrNextEvent,L=g.eventsWithDays,x=L.find(function(v){return v.key===(k==null?void 0:k.key)});return(0,e.jsxs)(R.GP,{width:325,collapsible:!1,resizeable:!0,className:ne()("calendar-sidebar-bg",{"state-new-event":c}),children:[(0,e.jsxs)("div",{className:"calendar-sidebar",children:[(0,e.jsx)(Re,{}),(0,e.jsx)(Ie,{visible:c,onSuccess:C,calendarSets:(u==null?void 0:u.calendarSets)||_e}),(0,e.jsx)(Ye.f,{locale:ma,value:{year:t.getFullYear(),month:t.getMonth()+1,day:t.getDate()},onChange:U,shouldHighlightWeekends:!0,colorPrimary:"#04c8c8"}),(0,e.jsxs)("div",{className:"calendar-day-list",children:[(0,e.jsxs)("div",{className:"event-list-header",children:[(0,e.jsxs)("h6",{children:[x!=null&&x.isToDay?"\u4ECA\u5929":(x==null?void 0:x.date.format("dddd"))||"\u4ECA\u5929",(0,e.jsx)("span",{className:"day-subtitle text-muted",children:(x==null?void 0:x.date.format("YYYY-MM-DD"))||F()().format("YYYY-MM-DD")})]}),!(x!=null&&x.events.length)&&(x==null?void 0:x.isSelected)&&(0,e.jsx)("div",{className:"onday-no-events text-muted",children:"\u6CA1\u6709\u4E8B\u4EF6"})]}),(0,e.jsx)("div",{ref:I,onScrollCapture:O,className:"event-list-body hover-scroll-y",children:L.map(function(v){var Z=v.key,X=v.date,le=v.isToDay,q=v.events,fe=v.isSelected,te=v.isTemporary;return(0,e.jsxs)("div",{className:"event-list-item","data-temp":te,"data-date":Z,children:[(0,e.jsxs)("h6",{onClick:E(X.toDate()),children:[le?"\u4ECA\u5929":X.format("dddd"),(0,e.jsx)("span",{className:"day-subtitle text-muted",children:X.format("YYYY-MM-DD")})]}),(0,e.jsx)("div",{className:ne()("event-list",se()(se()({},"is-empty",!q.length),"onday-no-events",!q.length&&fe)),children:q.map(function(pe){return(0,e.jsx)(l.Popover,{content:(0,e.jsx)("div",{children:"12312313"}),children:(0,e.jsx)("span",{style:{backgroundColor:pe.color},className:"event-day",children:pe.title},pe.id)},pe.id)})})]},Z)})})]}),(0,e.jsx)(xe,{calendarSets:(u==null?void 0:u.calendarSets)||_e,onAction:_})]}),(0,e.jsx)(fa,{visible:y,onCancel:P})]})}var Ca=a.memo(pa),ya=Ca},38932:function(Ze,je,i){i.d(je,{f:function(){return Ae},y:function(){return o}});var we=i(19755),se=i.n(we);function Ae(Q){var T=parseInt(se()(Q).data("click-number")||0)+1;if(T===2)return clearTimeout(se()(Q).data("timer-reset")),se()(Q).data("click-number",0),!0;var oe=setTimeout(function(){se()(Q).data("click-number",0),clearTimeout(oe)},500);return se()(Q).data("click-number",T).data("timer-reset",oe),!1}function o(Q,T,oe,A,Ee){var Ce=Q.height/3/2,a=A<Ce&&A>-Ce&&(oe==null?void 0:oe.parentKey)!==T.id;return a?Ee:A>0?Ee+1:A<0?Ee-1:NaN}}}]);

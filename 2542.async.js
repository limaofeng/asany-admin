"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[2542,1201],{51253:function(Ve,Ee,i){i.d(Ee,{GP:function(){return se.Z},Hk:function(){return Ye},xx:function(){return Ne.x}});var Fe=i(74958),se=i(5166),Ne=i(19260),v=i(68400),G=i.n(v),T=i(62435),de=i(93967),F=i.n(de),ge=i(94589),ye=i(97857),a=i.n(ye),Te=i(46027),Oe=i(42687),ae=i(10811),We=i(5574),ne=i.n(We),Q=i(96486),S=i(86074),X={aside:{minimize:!1,width:280}},l=T.createContext({state:X,dispatch:function(){}}),Se=function(w){return w.AsideToggle="ASIDE_TOGGLE",w.AsideWidth="ASIDE_WIDTH",w}({});function je(w,W){switch(W.type){case"ASIDE_TOGGLE":return w.aside.minimize=!w.aside.minimize,a()({},w);case"ASIDE_WIDTH":return w.aside.width=W.payload,a()({},w);default:throw new Error}}var be=function(W){var fe=(0,T.useReducer)(je,(0,Q.cloneDeep)(X)),Ce=ne()(fe,2),xe=Ce[0],De=Ce[1];return(0,S.jsx)(l.Provider,{value:{state:xe,dispatch:De},children:W.children})},e=function(){return(0,T.useContext)(l)},ke=i(65495);function he(w){var W=e(),fe=W.dispatch,Ce=W.state.aside.minimize,xe=(0,T.useCallback)(function(){fe({type:Se.AsideToggle})},[fe]);return(0,S.jsx)(ae.Button,{style:a()({marginBottom:"1.35rem",zIndex:105},w.style),onClick:xe,activeColor:"primary",className:F()("micro-app-aside-toggle","btn-icon bg-body btn-color-gray-700 rounded-2 position-absolute translate-middle bottom-0 shadow-sm d-none d-lg-flex",w.className,{active:Ce}),children:(0,S.jsx)(Te.JO,{name:"Duotune/arr063",className:"svg-icon-2 rotate-180"})})}function oe(w){var W=w.className,fe=w.header,Ce=w.children,xe=w.collapsible,De=xe===void 0?!0:xe,Me=w.width,Ae=Me===void 0?280:Me,Re=(0,Oe.$Y)(),Ke=e(),Le=Ke.dispatch;return(0,T.useEffect)(function(){Re.aside.width(Ae+100),Le({type:Se.AsideWidth,payload:Ae})},[Re.aside,Le,Ae]),(0,S.jsxs)("div",{className:F()("app-aside aside",W),children:[(0,S.jsx)(ke.Z,{children:(0,S.jsx)(se.Z,{header:fe,resizeable:!0,className:"app-sidebar",children:Ce})}),De&&(0,S.jsx)(he,{className:"start-100 end-0"})]})}oe.Toggle=he;var Pe=oe,we,Be=ge.ZP.div(we||(we=G()([`
  --root-aside-width: `,`;
  --met-aside-width: `,`;
`])),function(w){return w.minimize?"100px":"".concat(w.width,"px")},function(w){return w.minimize?"100px":"".concat(w.width,"px")});function H(w){var W=w.children,fe=w.className,Ce=e(),xe=Ce.state.aside,De=xe.minimize,Me=xe.width,Ae=(0,T.useCallback)(function(Re){Re.preventDefault()},[]);return(0,S.jsx)(Be,{minimize:De,width:Me,className:F()("micro-app-container page-full-content",fe,{"aside-minimize":De}),onContextMenu:Ae,children:W})}function pe(w){var W=w.children,fe=w.className;return(0,S.jsx)(be,{children:(0,S.jsx)(H,{className:fe,children:W})})}pe.Sidebar=Pe;var Ye=pe},42687:function(Ve,Ee,i){i.d(Ee,{$Y:function(){return Te},BK:function(){return ae},aM:function(){return ne}});var Fe=i(5574),se=i.n(Fe),Ne=i(97857),v=i.n(Ne),G=i(62435),T=i(86074),de=G.createContext({getState:function(){return{routes:[]}},subscribe:function(){},dispatch:function(){}}),F=function(S,X){return X?X.type==="ASIDE_MINIMIZE"?v()(v()({},S),{},{aside:v()(v()({},S.aside),{},{minimize:!!X.payload})}):X.type==="ASIDE_WIDTH"?v()(v()({},S),{},{aside:v()(v()({},S.aside),{},{width:X.payload})}):X.type==="ASIDE_COLLAPSIBLE"?v()(v()({},S),{},{aside:v()(v()({},S.aside),{},{collapsible:X.payload})}):S:S},ge=function(S){return v()({},S)};function ye(Q){var S=(0,G.useReducer)(F,Q,ge),X=se()(S,2),l=X[0],Se=X[1],je=(0,G.useState)([]),be=se()(je,1),e=be[0],ke=function(Ye){return function(){var w=e.indexOf(Ye);w>-1&&e.splice(w,1)}},he=(0,G.useCallback)(function(pe){return e.unshift(pe),ke(pe)},[e]),oe=(0,G.useCallback)(function(){e.forEach(function(pe){return pe()})},[e]),Pe={getState:function(){return l},dispatch:Se,subscribe:he},we=(0,G.useState)(Pe),Be=se()(we,1),H=Be[0];return(0,G.useEffect)(function(){H.getState=function(){return l},oe()},[l]),H}var a=function(S,X){return S===X};function Te(){var Q=(0,G.useContext)(de),S=(0,G.useRef)({aside:{get state(){return Q.getState().aside},width:function(l){Q.dispatch({type:"ASIDE_WIDTH",payload:l})},minimize:function(l){Q.dispatch({type:"ASIDE_MINIMIZE",payload:l})},collapsible:function(l){Q.dispatch({type:"ASIDE_COLLAPSIBLE",payload:l})}}});return S.current}function Oe(Q){var S=arguments.length>1&&arguments[1]!==void 0?arguments[1]:a,X=(0,G.useContext)(de),l=(0,G.useReducer)(function(he){return he+1},0),Se=se()(l,2),je=Se[1],be=(0,G.useRef)(),e=Q(X.getState());function ke(){var he=Q(X.getState());S(he,be.current)||(be.current=he,je())}return(0,G.useEffect)(function(){return X.subscribe(ke)},[]),e}function ae(Q){var S=arguments.length>1&&arguments[1]!==void 0?arguments[1]:a;return Oe(Q,S)}function We(){var Q=useContext(de);return Q.dispatch}function ne(Q){var S=Q.children,X=Q.state,l=ye(X);return(0,G.useMemo)(function(){return(0,T.jsx)(de.Provider,{value:l,children:S})},[S,l])}},48943:function(Ve,Ee,i){i.r(Ee),i.d(Ee,{default:function(){return xa}});var Fe=i(9783),se=i.n(Fe),Ne=i(15009),v=i.n(Ne),G=i(99289),T=i.n(G),de=i(5574),F=i.n(de),ge=i(64599),ye=i.n(ge),a=i(62435),Te=i(49972),Oe=i(24689),ae=i(12845),We=i(93967),ne=i.n(We),Q=i(30381),S=i.n(Q),X=i(51253),l=i(10811),Se=i(12708),je=i(19632),be=i.n(je),e=i(86074);function ke(s){var u=s.calendarSets,n=s.onAction,c=(0,ae.useModel)("calendar",function(m){return m.state.calendarSet}),t=(0,ae.useModel)("calendar",function(m){return m.setCalendarSet}),E=(0,a.useCallback)(function(m){if(m.startsWith("calendar-set-"))t(m.substring(13));else return n(m),!1;return!0},[n,t]),p=(0,a.useMemo)(function(){return[{value:"calendar-set-all",label:"\u5168\u90E8\u65E5\u5386"}].concat(be()(u.map(function(m){return{value:"calendar-set-".concat(m.id),label:m.name}})),[{type:"separator"},{value:"manage-calendars",label:"\u7BA1\u7406\u65E5\u5386"}])},[u]);return(0,e.jsx)("div",{className:"calendar-sidebar-footer",children:(0,e.jsx)(l.Select,{onChange:E,placement:"topCenter",value:"calendar-set-".concat(c),options:p})})}var he=ke,oe=i(46027);function Pe(){var s=(0,a.useRef)(null),u=(0,a.useState)(!1),n=F()(u,2),c=n[0],t=n[1],E=(0,a.useState)(""),p=F()(E,2),m=p[0],j=p[1],B=(0,ae.useModel)("calendar",function(h){var d=h.state;return d.selectedDay||new Date}),x=(0,ae.useModel)("calendar",function(h){return h.state.state==="new"}),g=(0,ae.useModel)("calendar",function(h){return h.changeState}),I=(0,a.useCallback)(function(){var h;(h=s.current)===null||h===void 0||h.focus()},[]),r=(0,a.useCallback)(function(){t(!0)},[]),f=(0,a.useCallback)(function(){var h=document.getElementsByClassName("main-calendar")[0];h==null||h.focus(),g("none"),j(""),t(!1)},[g]),$=(0,a.useCallback)(function(h){h.key==="Escape"&&f()},[f]),k=(0,a.useCallback)(function(h){if(j(h.target.value),!h.target.value){g("none");return}!x&&g("new",B)},[g,x,B]),N=(0,a.useCallback)(function(){var h;(h=s.current)!==null&&h!==void 0&&h.value||f()},[f]);return(0,a.useEffect)(function(){var h;if(!x){j(""),t(!1);return}var d=document.activeElement,V=!!d&&(d.tagName==="INPUT"||d.tagName==="SELECT"||d.tagName==="TEXTAREA"||d.contentEditable&&d.contentEditable==="true");V||((h=s.current)===null||h===void 0||h.focus(),j(S()(B).format("YYYY-MM-DD")))},[x,B]),(0,e.jsxs)("div",{className:ne()("calendar-event-header",{"event-header-state-new":x}),children:[(0,e.jsx)("div",{className:ne()("calendar-event-header-left"),children:(0,e.jsx)(l.Input,{onFocus:r,onBlur:N,ref:s,value:m,onChange:k,solid:!0,placeholder:"\u65B0\u5EFA\u65E5\u7A0B",onKeyUp:$})}),(0,e.jsx)("a",{className:ne()("calendar-event-header-right",{"calendar-event-new-icon":!(c||x)}),onClick:c||x?f:I,children:(0,e.jsx)(oe.ZP,{className:ne()({"svg-icon-1":c||x,"svg-icon-2x svg-icon-dark":!(c||x)}),name:c||x?"Duotune/arr088":"Duotune/arr087"})})]})}var we=Pe,Be=i(97857),H=i.n(Be),pe=i(13769),Ye=i.n(pe),w=i(52035),W=i(55760);function fe(s){var u=(0,W.V7)({fetchPolicy:"cache-and-network"}),n=u.data,c=(0,a.useMemo)(function(){return n!=null&&n.calendars?n.calendars.filter(function(t){return t.type==="SUNRISE"}).map(function(t){return H()(H()({},t),{},{label:t.name,value:t.id})}):[]},[n==null?void 0:n.calendars]);return(0,e.jsx)(l.Select,H()(H()({},s),{},{options:c,itemRender:function(E,p){var m=E.color,j=(0,e.jsx)("div",{style:{backgroundColor:m,width:12,height:12,marginRight:8,border:"1px solid ".concat((0,w.r5)(m)),borderRadius:6,display:"inline-block"}});return p?(0,e.jsxs)(e.Fragment,{children:[a.cloneElement(j,{style:H()(H()({},j.props.style),{},{marginRight:5})}),E.label]}):(0,e.jsxs)(e.Fragment,{children:[j,E.label]})}}))}var Ce=fe,xe=["calendar","alert"],De=l.Input.TextArea,Me=[{label:"\u65E0",value:"none",scope:["all-day","general"],remind:{alert:"NONE"}},{type:"separator",scope:["all-day","general"]},{label:"\u65E5\u7A0B\u5F53\u5929 (\u4E0A\u5348 8:00)",value:"on time of event",scope:["all-day"],remind:{alert:"ON_TIME_OF_EVENT"}},{label:"1 \u5929\u524D (\u4E0A\u5348 8:00)",value:"1 day before 8:00",scope:["all-day"],remind:{alert:"DAYS_BEFORE",times:1}},{label:"2 \u5929\u524D (\u4E0A\u5348 8:00)",value:"2 day before 8:00",scope:["all-day"],remind:{alert:"DAYS_BEFORE",times:2}},{label:"\u65E5\u7A0B\u53D1\u751F\u65F6",value:"at time of event",scope:["general"],remind:{alert:"AT_TIME_OF_EVENT"}},{label:"1 \u5206\u949F\u524D",value:"1 minute before",scope:["general"],remind:{alert:"MINUTES_BEFORE",times:1}},{label:"5 \u5206\u949F\u524D",value:"5 minute before",scope:["general"],remind:{alert:"MINUTES_BEFORE",times:5}},{label:"10 \u5206\u949F\u524D",value:"10 minute before",scope:["general"],remind:{alert:"MINUTES_BEFORE",times:10}},{label:"15 \u5206\u949F\u524D",value:"15 minute before",scope:["general"],remind:{alert:"MINUTES_BEFORE",times:15}},{label:"30 \u5206\u949F\u524D",value:"30 minute before",scope:["general"],remind:{alert:"MINUTES_BEFORE",times:30}},{label:"45 \u5206\u949F\u524D",value:"45 minute before",scope:["general"],remind:{alert:"MINUTES_BEFORE",times:45}},{label:"1 \u5C0F\u65F6\u524D",value:"1 hour before",scope:["general"],remind:{alert:"HOURS_BEFORE",times:1}},{label:"2 \u5C0F\u65F6\u524D",value:"2 hour before",scope:["general"],remind:{alert:"HOURS_BEFORE",times:2}},{label:"1 \u5929\u524D",value:"1 day before",scope:["general"],remind:{alert:"DAYS_BEFORE",times:1}},{label:"2 \u5929\u524D",value:"2 day before",scope:["general"],remind:{alert:"DAYS_BEFORE",times:2}},{type:"separator",scope:["all-day","general"]},{label:"\u81EA\u5B9A\u4E49",value:"custom",scope:[]}];function Ae(s){var u=s.visible,n=s.calendarSets,c=s.onSuccess,t=(0,a.useRef)({title:"\u6D4B\u8BD5",allDay:!0,color:"none",alert:"none",starts:"2022-01-19",ends:"2022-01-19"}),E=(0,a.useState)(!1),p=F()(E,2),m=p[0],j=p[1],B=(0,ae.useModel)("calendar",function(d){var V=d.state;return S()(V.selectedDay||new Date).format("YYYY-MM-DD")}),x=(0,ae.useModel)("calendar",function(d){return d.state.state==="new"}),g=(0,ae.useModel)("calendar",function(d){return d.state.calendarSet}),I=(0,W.wO)(),r=F()(I,1),f=r[0];t.current.starts=B,t.current.ends=B;var $=(0,a.useCallback)(function(){j(function(d){return!d})},[]),k=(0,a.useCallback)(function(d){if(d.key==="Escape"){var V;(V=document.querySelector(".calendar-event-header input"))===null||V===void 0||V.focus()}},[]),N=l.Form.useForm();(0,a.useEffect)(function(){if(!t.current.calendar)if(g==="all")t.current.calendar=null;else{var d;t.current.calendar=(d=n.find(function(V){return V.id===g}))===null||d===void 0||(d=d.defaultCalendar)===null||d===void 0?void 0:d.id}N.setFieldsValue(t.current)},[g,n,N]);var h=(0,a.useCallback)(function(){var d=T()(v()().mark(function V(P){var q,U,D,R,re,Y,C;return v()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return U=P.calendar,D=P.alert,R=Ye()(P,xe),re=(q=Me.find(function(L){return L.value===D}))===null||q===void 0?void 0:q.remind,M.next=4,f({variables:{calendar:U,input:H()(H()({},R),{},{remind:re||{alert:"NONE"}})}});case 4:Y=M.sent,C=Y.data,c(C==null?void 0:C.event);case 7:case"end":return M.stop()}},V)}));return function(V){return d.apply(this,arguments)}}(),[f,c]);return(0,a.useEffect)(function(){x&&N.setFieldsValue(t.current)},[x,N]),(0,e.jsx)("div",{className:ne()("calendar-new-event-container",{invisible:!u}),children:(0,e.jsx)("div",{className:"calendar-new-event",children:(0,e.jsx)(l.Form,{onFinish:h,form:N,onKeyUp:k,layout:"horizontal",initialValues:t.current,children:(0,e.jsxs)("ul",{children:[(0,e.jsx)("li",{children:(0,e.jsx)(l.Form.Item,{name:"title",noStyle:!0,children:(0,e.jsx)(l.Input,{solid:!0,placeholder:"\u65B0\u5EFA\u65E5\u7A0B"})})}),(0,e.jsx)("li",{children:(0,e.jsx)(l.Form.Item,{name:"allDay",valuePropName:"checked",label:"\u5168\u5929",children:(0,e.jsx)(l.Checkbox,{})})}),(0,e.jsx)("li",{children:(0,e.jsx)(l.Form.Item,{noStyle:!0,dependencies:["allDay"],children:function(){return(0,e.jsx)(l.Form.Item,{name:"starts",label:"\u5F00\u59CB\u65F6\u95F4",children:(0,e.jsx)(l.DatePicker,{solid:!0,timePicker:!N.getFieldValue("allDay"),format:N.getFieldValue("allDay")?"YYYY-MM-DD":"YYYY-MM-DD A HH:mm"})})}})}),(0,e.jsx)("li",{children:(0,e.jsx)(l.Form.Item,{noStyle:!0,dependencies:["allDay","starts"],children:function(){return(0,e.jsx)(l.Form.Item,{name:"ends",label:"\u7ED3\u675F\u65F6\u95F4",children:(0,e.jsx)(l.DatePicker,{solid:!0,minDate:N.getFieldValue("starts"),timePicker:!N.getFieldValue("allDay"),format:N.getFieldValue("allDay")?"YYYY-MM-DD":"YYYY-MM-DD A HH:mm"})})}})}),(0,e.jsx)("li",{children:(0,e.jsx)(l.Form.Item,{name:"calendar",label:"\u65E5\u5386",children:(0,e.jsx)(Ce,{solid:!0})})}),(0,e.jsx)("li",{children:(0,e.jsx)(l.Form.Item,{noStyle:!0,dependencies:["allDay"],children:function(){return(0,e.jsx)(l.Form.Item,{name:"alert",label:"\u63D0\u9192",children:(0,e.jsx)(l.Select,{solid:!0,options:Me.filter(function(V){return V.scope.includes(N.getFieldValue("allDay")?"all-day":"general")})})})}})}),(0,e.jsx)("li",{className:ne()({invisible:!m}),children:(0,e.jsx)(l.Form.Item,{noStyle:!0,children:(0,e.jsx)(l.Input,{solid:!0,placeholder:"\u8BBE\u7F6E\u94FE\u63A5"})})}),(0,e.jsx)("li",{className:ne()({invisible:!m}),children:(0,e.jsx)(l.Form.Item,{noStyle:!0,children:(0,e.jsx)(De,{autoSize:!0,solid:!0,placeholder:"\u5907\u6CE8"})})}),(0,e.jsxs)("li",{className:"event-actions",children:[(0,e.jsx)(oe.ZP,{onClick:$,className:"toggle-more svg-icon-1",name:m?"Bootstrap/chevron-compact-up":"Bootstrap/chevron-compact-down"}),(0,e.jsx)(l.Form.Item,{noStyle:!0,dependencies:["title"],children:function(){return(0,e.jsx)(l.Button,{htmlType:"submit",disabled:!N.getFieldValue("title"),className:"event-btn-add rounded-2",children:"\u6DFB\u52A0\u65E5\u7A0B"})}})]})]})})})})}var Re=Ae,Ke=i(16085),Le=i(69293),Ue=i(75275),He=i(59197),Ge=i(96486),Qe=i(38932),_e=a.forwardRef(function(s,u){var n=s.closeDropdown,c=s.onAction,t=s.accounts,E=(0,a.useCallback)(function(p){n(),p.keyPath.startsWith("new-calendar")?c("new",p.key):p.keyPath.startsWith("new-calendar-subscription")&&c("subscribe")},[n,c]);return(0,e.jsxs)(l.Menu,{className:"menu-gray-600 menu-state-bg-light-primary fw-bold fs-7 w-150px py-2",ref:u,dropdown:!0,onSelect:E,selectedKeys:[],children:[(0,e.jsx)(l.Menu.SubMenu,{title:"\u65B0\u589E\u65E5\u5386",className:"px-2",bodyClassName:"py-2 w-150px",offset:[-6.5,0],children:t.map(function(p){return(0,e.jsx)(l.Menu.Item,{title:p.name,className:"px-2"},p.id)})},"new-calendar"),(0,e.jsx)(l.Menu.Separator,{className:"mx-1"}),(0,e.jsx)(l.Menu.Item,{className:"px-2",children:"\u65B0\u589E\u65E5\u5386\u8BA2\u9605"},"new-calendar-subscription")]})});function qe(s){var u=s.onSuccess,n=s.selectedItem,c=s.onEdit,t=(0,W.Bo)(),E=F()(t,1),p=E[0],m=(0,W.Cn)(),j=F()(m,1),B=j[0],x=(0,W.e)({fetchPolicy:"cache-and-network"}),g=x.data,I=(0,a.useMemo)(function(){return g!=null&&g.calendarAccounts?g.calendarAccounts||[]:[]},[g==null?void 0:g.calendarAccounts]),r=(0,a.useCallback)(function(){var k=T()(v()().mark(function N(h,d){var V,P;return v()().wrap(function(U){for(;;)switch(U.prev=U.next){case 0:if(console.log(h,d),h!=="new"){U.next=7;break}return U.next=4,p({variables:{input:{account:d}}});case 4:V=U.sent,P=V.data,u(P==null?void 0:P.createCalendar);case 7:case"end":return U.stop()}},N)}));return function(N,h){return k.apply(this,arguments)}}(),[p,u]),f=(0,a.useCallback)(function(){n&&c(n.id,"modal")},[c,n]),$=(0,a.useCallback)(T()(v()().mark(function k(){var N;return v()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(n){d.next=2;break}return d.abrupt("return");case 2:return d.next=4,l.Modal.confirm({title:"\u4F60\u786E\u5B9A\u8981\u5220\u9664\u65E5\u5386\u5417\uFF1F",content:"\u60A8\u786E\u5B9A\u8981\u5220\u9664\u65E5\u5386\u201C<strong>".concat(n.name,"</strong>\u201D\u5417\uFF1F\u8FD9\u4E5F\u5C06\u5220\u9664\u6B64\u65E5\u5386\u4E0A\u7684\u6240\u6709\u4E8B\u4EF6\u3002"),okText:"\u5220 \u9664",cancelClassName:"btn btn-secondary btn-sm",okClassName:"btn btn-danger btn-sm"});case 4:if(N=d.sent,N.isConfirmed){d.next=7;break}return d.abrupt("return");case 7:return d.next=9,B({variables:{id:n.id}});case 9:u();case 10:case"end":return d.stop()}},k)})),[B,n,u]);return(0,e.jsxs)("div",{className:"calendars-footer",children:[(0,e.jsx)(l.Dropdown,{overlay:(0,e.jsx)(_e,{onAction:r,accounts:I}),placement:"bottomLeft",children:(0,e.jsx)("a",{children:(0,e.jsx)(oe.ZP,{name:"Duotune/arr087",className:"svg-icon-2"})})}),(0,e.jsx)("a",{onClick:$,className:ne()({disabled:!n}),children:(0,e.jsx)(oe.ZP,{name:"Duotune/arr089",className:"svg-icon-2"})}),(0,e.jsx)("a",{onClick:f,className:ne()({disabled:!n}),children:(0,e.jsx)(oe.ZP,{name:"Bootstrap/gear-fill",className:"svg-icon-7"})})]})}var ea=qe,$e=i(34155),aa=a.forwardRef(function(s,u){var n=s.data,c=s.onSelect,t=s.onEdit,E=s.onCheck,p=s.editing,m=s.actived,j=s.checked,B=s.drag,x=s.indicator,g=s.onShortcut,I=(0,a.useState)(n.name),r=F()(I,2),f=r[0],$=r[1],k=(0,a.useRef)(null),N=(0,W.wg)(),h=F()(N,1),d=h[0],V=(0,a.useCallback)(function(){c(n.id)},[n.id,c]),P=(0,a.useCallback)(function(b){$(b.target.value)},[]),q=(0,a.useMemo)(function(){return(0,Ge.debounce)(function(){var b=T()(v()().mark(function M(L){return v()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,d({variables:{id:n.id,input:{name:L}}});case 2:case"end":return o.stop()}},M)}));return function(M){return b.apply(this,arguments)}}(),250)},[d,n.id]),U=(0,a.useCallback)(T()(v()().mark(function b(){return v()().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:t(),n.name!==f&&q(f);case 2:case"end":return L.stop()}},b)})),[n.name,t,q,f]),D=(0,a.useCallback)(function(b,M){if(M){var L;(L=k.current)===null||L===void 0||L.focus(),$e.nextTick(function(){var o;(o=k.current)===null||o===void 0||o.select()})}else if(b){var y;(y=k.current)===null||y===void 0||(y=y.offsetParent)===null||y===void 0||(y=y.parentElement)===null||y===void 0||(y=y.parentElement)===null||y===void 0||y.focus()}},[]);(0,a.useEffect)(function(){p&&D(m,p)},[m,p,D]);var R=(0,a.useCallback)(function(b){b.stopPropagation(),D(!0)},[D]),re=(0,a.useCallback)(function(b){E(n.id,b.target.checked)},[n,E]),Y=(0,a.useCallback)(function(){t(n.id,"modal")},[n.id,t]),C=(0,a.useCallback)(function(){var b=T()(v()().mark(function M(L){return v()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:L==="EXIT"?(t(),$(n.name)):L==="ENTER"?(t(),n.name!==f&&q(f)):g(L);case 1:case"end":return o.stop()}},M)}));return function(M){return b.apply(this,arguments)}}(),[n.name,t,g,q,f]);return(0,e.jsxs)(Ue.fQ,{tag:(0,e.jsx)("li",{ref:B(u),onClick:V,onDoubleClick:Y,className:ne()("calendar-list-item",{active:m,editing:p,"indicator-drag-over-bottom":x>0,"indicator-drag-over-top":x<0})}),name:"CALENDAR_PREFERENCES",handler:C,children:[(0,e.jsx)(l.Checkbox,{style:{backgroundColor:n.color,borderColor:m?(0,w.tG)(n.color,80):(0,w.r5)(n.color)},checked:j,onClick:R,onChange:re,className:"calendar-check",size:"sm"}),(0,e.jsxs)("div",{className:"calendar-list-item-btn",children:[(0,e.jsx)("span",{className:"input-state-view",children:f}),(0,e.jsx)("input",{className:"input-state-edit calendar-name",ref:k,onChange:P,onBlur:U,value:f}),n._type==="SUBSCRIPTION"&&(0,e.jsx)("span",{className:"calendar-type",children:"\u8BA2\u9605"})]})]})});function na(s){var u=s.onClose,n=s.visible,c=s.data,t=(0,W.wg)(),E=F()(t,1),p=E[0],m=l.Form.useForm(),j=(0,a.useState)(c==null?void 0:c.color),B=F()(j,2),x=B[0],g=B[1],I=(0,a.useState)(!1),r=F()(I,2),f=r[0],$=r[1],k=(0,a.useRef)(null),N=(0,a.useRef)(null),h=(0,a.useMemo)(function(){return[{value:"#ff3d33",label:"\u7EA2\u8272"},{value:"#fc8328",label:"\u6A59\u8272"},{value:"#ffcc00",label:"\u9EC4\u8272"},{value:"#63da38",label:"\u7EFF\u8272"},{value:"#1badf8",label:"\u84DD\u8272"},{value:"#cc73e1",label:"\u7D2B\u8272"},{value:"#a67a63",label:"\u68D5\u8272"},{type:"separator"},{value:"other",label:"\u5176\u4ED6"}]},[]),d=(0,a.useMemo)(function(){return x&&h.some(function(D){return D.value===x})?x:"other"},[h,x]);(0,a.useEffect)(function(){var D;n&&(g(c==null?void 0:c.color),m.setFieldsValue(c),(D=k.current)===null||D===void 0||D.focus(),$e.nextTick(function(){var R;(R=k.current)===null||R===void 0||R.select()}))},[n]),(0,Le.Z)(N,function(){$(!1)});var V=(0,a.useCallback)(function(D){D==="other"?$(!0):g(D)},[g]),P=(0,a.useCallback)(T()(v()().mark(function D(){var R;return v()().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return R=m.getFieldsValue(),Y.next=3,p({variables:{id:c.id,input:H()({color:x},R)}});case 3:u();case 4:case"end":return Y.stop()}},D)})),[x,c,m,u,p]),q=(0,a.useCallback)(function(){u(),$(!1)},[u]),U=(0,a.useCallback)(function(D){var R=D.hex;g(R)},[]);return(0,e.jsx)(l.Modal,{centered:!0,visible:n,dialogClassName:"modal-dialog-concise-style modal-dialog-small w-400px",onCancel:q,onOk:P,header:!1,closable:!1,okButtonProps:{className:"btn-xs"},cancelButtonProps:{className:"btn-xs"},children:(0,e.jsxs)(l.Form,{form:m,layout:"horizontal",initialValues:H()({},c),size:"xs",children:[(0,e.jsxs)("div",{className:"d-flex flex-row flex-center",children:[(0,e.jsx)("div",{className:"d-flex flex-column-fluid",children:(0,e.jsx)(l.Form.Item,{name:"name",label:"\u540D\u79F0",children:(0,e.jsx)(l.Input,{ref:k,className:"calendar-name"})})}),(0,e.jsx)("div",{className:"d-flex flex-column-auto flex-center",children:(0,e.jsxs)("div",{className:"asany-form-item",children:[(0,e.jsx)(l.Select,{value:d,size:"xs",onChange:V,placement:"bottomCenter",itemRender:function(R,re){var Y=R.value==="other"?x||(c==null?void 0:c.color):R.value;if(!Y)return(0,e.jsx)(e.Fragment,{});var C=(0,e.jsx)("div",{style:{backgroundColor:Y,width:20,height:14,marginRight:8,border:"1px solid ".concat((0,w.r5)(Y)),display:"inline-block"}});return re?a.cloneElement(C,{style:H()(H()({},C.props.style),{},{marginRight:5})}):(0,e.jsxs)(e.Fragment,{children:[C,R.label]})},options:h}),(0,e.jsx)(l.Popover,{visible:f,overlayClassName:"popover-content-body",content:(0,e.jsx)("div",{ref:N,children:(0,e.jsx)(Ke.xS,{presetColors:h.filter(function(D){return D.value!=="other"&&D.type!=="separator"}).map(function(D){return{color:D.value,title:D.label}}),color:x,onChangeComplete:U,onChange:U,width:"220px"})}),children:(0,e.jsx)("div",{})})]})})]}),(c==null?void 0:c.type)==="SUBSCRIPTION"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"d-flex flex-row flex-center",children:(0,e.jsx)(l.Form.Item,{name:"url",label:"\u5730\u5740",children:(0,e.jsx)(l.Input,{})})}),(0,e.jsx)("div",{className:"d-flex flex-row flex-center",children:(0,e.jsx)(l.Form.Item,{name:"refresh",label:"\u5237\u65B0",children:(0,e.jsx)(l.Select,{className:"w-100px",placement:"bottomCenter",options:[{value:"NEVER",label:"\u4ECE\u4E0D"},{value:"EVERY_5_MINUTES",label:"\u6BCF5\u5206\u949F"},{value:"EVERY_15_MINUTES",label:"\u6BCF15\u5206\u949F"},{value:"EVERY_HOVER",label:"\u6BCF\u5C0F\u65F6"},{value:"EVERY_DAY",label:"\u6BCF\u5929"},{value:"EVERY_WEEK",label:"\u6BCF\u5468"}]})})})]}),(0,e.jsxs)("div",{className:"d-flex flex-row flex-center",children:[(0,e.jsx)("div",{className:"d-flex flex-column-auto flex-center",style:{width:56}}),(0,e.jsx)("div",{className:"d-flex flex-column-fluid",children:(0,e.jsx)(l.Form.Item,{name:"ignoreAlerts",valuePropName:"checked",children:(0,e.jsx)(l.Checkbox,{label:"\u5FFD\u7565\u63D0\u9192"})})})]})]})})}function ra(s){var u=s.refresh,n=s.calendarSet,c=(0,W.wg)(),t=F()(c,1),E=t[0],p=(0,W.wN)(),m=F()(p,1),j=m[0],B=(0,W.DM)(),x=F()(B,1),g=x[0],I=(0,W.V7)({fetchPolicy:"cache-and-network"}),r=I.data,f=I.refetch,$=(0,a.useState)(),k=F()($,2),N=k[0],h=k[1],d=(0,a.useState)(),V=F()(d,2),P=V[0],q=V[1],U=(0,a.useState)((n==null?void 0:n.calendars.map(function(A){return A.id}))||[]),D=F()(U,2),R=D[0],re=D[1],Y=(0,a.useRef)(null),C=(0,a.useRef)({checkedKeys:[],calendars:[]});C.current.checkedKeys=R,C.current.activeKey=N,C.current.editing=P,C.current.calendarSet=n,C.current.calendars=(r==null?void 0:r.calendars)||[];var b=(0,a.useCallback)(function(A){A&&h(A),q(void 0),$e.nextTick(function(){var Z;(Z=Y.current)===null||Z===void 0||Z.focus()})},[]),M=(0,a.useCallback)(function(A){A!==C.current.activeKey&&b(A)},[b]),L=(0,a.useCallback)(function(){var A=T()(v()().mark(function Z(O){var ie,K=arguments;return v()().wrap(function(ue){for(;;)switch(ue.prev=ue.next){case 0:ie=K.length>1&&K[1]!==void 0?K[1]:"modal",O?q({key:O,type:ie}):b();case 2:case"end":return ue.stop()}},Z)}));return function(Z){return A.apply(this,arguments)}}(),[b]),y=(0,a.useMemo)(function(){if(!(r!=null&&r.calendars))return[];var A=[],Z=ye()(r.calendars),O;try{var ie=function(){var _=O.value,ue=H()(H()({},_),{},{key:_.id,actived:N===_.id,editing:(P==null?void 0:P.key)===_.id&&(P==null?void 0:P.type)==="inline",checked:R.some(function(ce){return ce===_.id}),_type:_.type});delete ue.type;var Ie=A.find(function(ce){return ce.id===_.account.id});Ie?Ie==null||Ie.calendars.push(ue):A.push(H()(H()({},_.account),{},{calendars:[ue]}))};for(Z.s();!(O=Z.n()).done;)ie()}catch(K){Z.e(K)}finally{Z.f()}return A.sort(function(K,_){return K.index-_.index})},[N,R,r==null?void 0:r.calendars,P==null?void 0:P.key,P==null?void 0:P.type]),o=(0,a.useCallback)(function(){var A=T()(v()().mark(function Z(O){return v()().wrap(function(K){for(;;)switch(K.prev=K.next){case 0:return K.next=2,f();case 2:O&&(h(O.id),q({type:"inline",key:O.id}));case 3:case"end":return K.stop()}},Z)}));return function(Z){return A.apply(this,arguments)}}(),[f]),z=(0,a.useCallback)(function(){},[]),J=(0,a.useCallback)(function(){var A=T()(v()().mark(function Z(O){var ie,K,_,ue;return v()().wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:return ie=(0,Qe.y)(O.node._rect,O.node,O.dragNode,O.dropPosition,O.node.index),K=O.node.pos,_=ie-Number(K[K.length-1]),ue=O.node.index,_===-1?ue--:_===1&&ue++,ce.next=7,E({variables:{id:O.dragNode.key,input:{index:Math.max(ue,0)+1}}});case 7:f();case 8:case"end":return ce.stop()}},Z)}));return function(Z){return A.apply(this,arguments)}}(),[f,E]),le=(0,a.useCallback)(function(A){var Z;return((Z=C.current.editing)===null||Z===void 0?void 0:Z.key)!==A.id},[]),ee=(0,a.useCallback)(function(A){return!isNaN(A.dropPosition)},[]),ve=(0,a.useCallback)(function(A){var Z=C.current,O=Z.calendars,ie=Z.activeKey,K=O.findIndex(function(_){return _.id===ie});A==="PREVIOUS"?b(O[Math.max(K-1,0)].id):A==="NEXT"?h(O[Math.min(K+1,O.length-1)].id):A==="ENTER"?q({key:ie,type:"inline"}):A==="EXIT"&&b()},[b]),te=(0,a.useCallback)(function(){b()},[b]),me=(0,a.useCallback)(function(){var A=T()(v()().mark(function Z(O,ie){var K,_,ue;return v()().wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:if(_=(K=C.current.calendarSet)===null||K===void 0?void 0:K.id,ue=C.current.checkedKeys,console.log("handleChange",O,ie,_),!ie){ce.next=9;break}return re([].concat(be()(ue),[O])),ce.next=7,j({variables:{id:O,set:_}});case 7:ce.next=12;break;case 9:return re(ue.filter(function(ya){return ya!==O})),ce.next=12,g({variables:{id:O,set:_}});case 12:u();case 13:case"end":return ce.stop()}},Z)}));return function(Z,O){return A.apply(this,arguments)}}(),[u,j,g]);return(0,a.useEffect)(function(){re((n==null?void 0:n.calendars.map(function(A){return A.id}))||[])},[n==null?void 0:n.calendars]),(0,e.jsxs)(Ue.fQ,{tag:(0,e.jsx)("div",{ref:Y,className:ne()("calendar-list",{editing:!!P})}),handler:ve,name:"CALENDAR_PREFERENCES",children:[(0,e.jsxs)("div",{className:"calendar-list-notes",children:["\u201C",n==null?void 0:n.name,"\u201D\u65E5\u5386\u96C6\u7684\u65E5\u5386\u548C\u4EFB\u52A1\u5217\u8868\u3002"]}),(0,e.jsxs)("div",{className:"calendar-list-content",children:[(0,e.jsx)("div",{className:"calendars-header",children:"\u6211\u7684\u65E5\u5386"}),(0,e.jsx)("div",{className:"calendars-body scroll-y",children:y.map(function(A){return(0,e.jsxs)("div",{className:"calendars-group",children:[(0,e.jsx)("div",{className:"calendars-group-header",children:"\u6211\u7684\u65E5\u5386"}),(0,e.jsx)("div",{className:"calendars-group-body",children:(0,e.jsx)(He.ZP,{onChange:z,tag:"ul",mode:"indicator",onDrop:J,draggable:le,allowDrop:ee,className:"calendar-sets-list",items:A.calendars,rerender:!1,itemRender:function(O,ie){var K=O.data,_=O.index;return(0,a.createElement)(aa,H()(H()({},O),{},{ref:ie,actived:K.actived,editing:K.editing,checked:K.checked,onCheck:me,key:K.id,data:K,index:_,onSelect:M,onEdit:L,onShortcut:ve}))}})})]},A.id)})}),(0,e.jsx)(ea,{onSuccess:o,selectedItem:C.current.calendars.find(function(A){return A.id===N}),onEdit:L})]}),(0,e.jsx)(na,{data:C.current.calendars.find(function(A){return A.id===N}),visible:(P==null?void 0:P.type)==="modal",onClose:te})]})}var ta=ra;function la(s){var u=s.onSuccess,n=s.selectedKey,c=(0,W.Xy)(),t=F()(c,1),E=t[0],p=(0,W.yM)(),m=F()(p,1),j=m[0],B=(0,a.useCallback)(T()(v()().mark(function g(){var I,r;return v()().wrap(function($){for(;;)switch($.prev=$.next){case 0:return $.next=2,E();case 2:I=$.sent,r=I.data,u(r==null?void 0:r.createCalendarSet);case 5:case"end":return $.stop()}},g)})),[E,u]),x=(0,a.useCallback)(T()(v()().mark(function g(){return v()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,j({variables:{id:n}});case 2:u();case 3:case"end":return r.stop()}},g)})),[j,n,u]);return(0,e.jsxs)("div",{className:"calendar-sets-footer",children:[(0,e.jsx)("a",{onClick:B,children:(0,e.jsx)(oe.ZP,{name:"Duotune/arr087",className:"svg-icon-2"})}),(0,e.jsx)("a",{onClick:x,children:(0,e.jsx)(oe.ZP,{name:"Duotune/arr089",className:"svg-icon-2"})})]})}var sa=la,ze=i(34155),ia=a.forwardRef(function(s,u){var n=s.data,c=s.editing,t=s.actived,E=s.onSelect,p=s.onEdit,m=s.drag,j=s.indicator,B=(0,W.f4)(),x=F()(B,1),g=x[0],I=(0,a.useState)(n.name),r=F()(I,2),f=r[0],$=r[1],k=(0,a.useRef)(null),N=(0,a.useCallback)(function(){E(n.id)},[n.id,E]),h=(0,a.useCallback)(function(){p(n.id)},[n.id,p]),d=(0,a.useMemo)(function(){return(0,Ge.debounce)(function(){var U=T()(v()().mark(function D(R){return v()().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return Y.next=2,g({variables:{id:n.id,input:{name:R}}});case 2:case"end":return Y.stop()}},D)}));return function(D){return U.apply(this,arguments)}}(),250)},[g,n.id]),V=(0,a.useCallback)(T()(v()().mark(function U(){return v()().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:if(p(),n.name===f){R.next=4;break}return R.next=4,d(f);case 4:case"end":return R.stop()}},U)})),[n.name,p,d,f]),P=(0,a.useCallback)(function(U){$(U.target.value)},[]);(0,a.useEffect)(function(){var U;c&&((U=k.current)===null||U===void 0||U.focus(),ze.nextTick(function(){var D;(D=k.current)===null||D===void 0||D.select()}))},[c]);var q=(0,a.useCallback)(function(){var U=T()(v()().mark(function D(R){return v()().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:if(R!=="EXIT"){Y.next=5;break}p(),$(n.name),Y.next=10;break;case 5:if(R!=="ENTER"){Y.next=10;break}if(p(),n.name===f){Y.next=10;break}return Y.next=10,d(f);case 10:case"end":return Y.stop()}},D)}));return function(D){return U.apply(this,arguments)}}(),[n.name,p,d,f]);return(0,e.jsx)(Ue.fQ,{tag:(0,e.jsx)("li",{ref:m(u),onClick:N,onDoubleClick:h,className:ne()("calendarset-item",{active:t,"indicator-drag-over-bottom":j>0,"indicator-drag-over-top":j<0})}),name:"CALENDAR_PREFERENCES",handler:q,children:(0,e.jsxs)("div",{className:"calendarset-item-btn",children:[(0,e.jsx)("span",{className:"input-state-view",children:f}),(0,e.jsx)("input",{className:"input-state-edit",ref:k,onChange:P,onBlur:V,value:f})]})})});function ua(s){var u=s.data,n=u===void 0?[]:u,c=s.refresh,t=s.onSelect,E=(0,W.f4)(),p=F()(E,1),m=p[0],j=(0,ae.useModel)("calendar",function(C){return C.state.calendarSet}),B=(0,a.useRef)(null),x=(0,a.useRef)({calendarSets:[]}),g=(0,a.useState)(),I=F()(g,2),r=I[0],f=I[1],$=(0,a.useState)(),k=F()($,2),N=k[0],h=k[1];x.current.activeKey=r,x.current.editing=N,x.current.calendarSets=n;var d=(0,a.useCallback)(function(C){C!==x.current.activeKey&&(f(C),ze.nextTick(function(){var b;(b=B.current)===null||b===void 0||b.focus()}))},[]),V=(0,a.useCallback)(function(){var C=T()(v()().mark(function b(M){return v()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,c();case 2:M?(f(M.id),h(M.id)):n.length&&f(n[0].id);case 3:case"end":return y.stop()}},b)}));return function(b){return C.apply(this,arguments)}}(),[n,c]),P=(0,a.useCallback)(function(){var C=T()(v()().mark(function b(M){return v()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:h(M),M||ze.nextTick(function(){var o;(o=B.current)===null||o===void 0||o.focus()});case 2:case"end":return y.stop()}},b)}));return function(b){return C.apply(this,arguments)}}(),[]);(0,a.useEffect)(function(){if(n.length&&!n.some(function(b){return b.id===r})){var C=j==="all"?n[0].id:String(j);f(C)}},[r,n,j]),(0,a.useEffect)(function(){r&&t(r)},[r,t]);var q=(0,a.useCallback)(function(C){var b=x.current,M=b.calendarSets,L=b.activeKey,y=M.findIndex(function(o){return o.id===L});C==="PREVIOUS"?f(M[Math.max(y-1,0)].id):C==="NEXT"?f(M[Math.min(y+1,M.length-1)].id):C==="ENTER"?h(r):C==="EXIT"&&h(void 0)},[r]),U=(0,a.useCallback)(function(){},[]),D=(0,a.useMemo)(function(){return n.map(function(C){return H()(H()({},C),{},{key:C.id,actived:r===C.id,editing:N===C.id})})},[r,n,N]),R=(0,a.useCallback)(function(){var C=T()(v()().mark(function b(M){var L,y,o,z;return v()().wrap(function(le){for(;;)switch(le.prev=le.next){case 0:return L=(0,Qe.y)(M.node._rect,M.node,M.dragNode,M.dropPosition,M.node.index),y=M.node.pos,o=L-Number(y[y.length-1]),z=M.node.index,o===-1?z--:o===1&&z++,le.next=7,m({variables:{id:M.dragNode.key,input:{index:Math.max(z,0)+1}}});case 7:c();case 8:case"end":return le.stop()}},b)}));return function(b){return C.apply(this,arguments)}}(),[c,m]),re=(0,a.useCallback)(function(C){return x.current.editing!==C.id},[]),Y=(0,a.useCallback)(function(C){return!isNaN(C.dropPosition)},[]);return(0,e.jsxs)(Ue.fQ,{tag:(0,e.jsx)("div",{ref:B,className:ne()("flex-left calendar-sets",{editing:!!N})}),name:"CALENDAR_PREFERENCES",handler:q,children:[(0,e.jsx)("div",{className:"calendar-sets-header",children:"\u65E5\u5386\u96C6"}),(0,e.jsx)("div",{className:"calendar-sets-body scroll-y",children:(0,e.jsx)(He.ZP,{onChange:U,tag:"ul",mode:"indicator",draggable:re,onDrop:R,allowDrop:Y,className:"calendar-sets-list",items:D,rerender:!1,itemRender:function(b,M){var L=b.data,y=b.index;return(0,a.createElement)(ia,H()(H()({},b),{},{ref:M,actived:L.actived,editing:L.editing,key:L.id,data:L,index:y,onSelect:d,onEdit:P}))}})}),(0,e.jsx)(sa,{onSuccess:V,selectedKey:r})]})}var ca=ua;function da(){var s,u=(0,W.f4)(),n=F()(u,1),c=n[0],t=(0,W.Dn)({fetchPolicy:"cache-and-network"}),E=t.data,p=t.refetch,m=E==null?void 0:E.calendarSets,j=l.Form.useForm(),B=(0,a.useState)(),x=F()(B,2),g=x[0],I=x[1],r=(0,a.useCallback)(function(k){I(k)},[]),f=(m||[]).find(function(k){return k.id===g});(0,a.useEffect)(function(){var k;j.setFieldsValue({defaultCalendar:f==null||(k=f.defaultCalendar)===null||k===void 0?void 0:k.id})},[f,j]);var $=(0,a.useCallback)(T()(v()().mark(function k(){var N;return v()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(N=j.getFieldsValue(),f){d.next=3;break}return d.abrupt("return");case 3:return console.log("handleChange calendarSet",N),d.next=6,c({variables:{id:f.id,input:N}});case 6:case"end":return d.stop()}},k)})),[f,j,c]);return(0,e.jsxs)("div",{className:"settings-calendars",children:[(0,e.jsx)("div",{className:"settings-calendars-notes",children:"\u901A\u8FC7\u521B\u5EFA\u591A\u4E2A\u65E5\u5386\u96C6\u5FEB\u901F\u66F4\u6539\u663E\u793A\u7684\u65E5\u5386\u548C\u4EFB\u52A1\u5217\u8868\u3002\u4F8B\u5982\uFF0C\u60A8\u53EF\u80FD\u6709\u5355\u72EC\u7684\u5BB6\u5EAD\u548C\u5DE5\u4F5C\u65E5\u5386\u96C6\u3002"}),(0,e.jsxs)("div",{className:"d-flex",children:[(0,e.jsx)(ca,{onSelect:r,data:m,refresh:p}),(0,e.jsxs)("div",{className:"settings-calendars-right flex-root",children:[(0,e.jsx)(ta,{refresh:p,calendarSet:f}),(0,e.jsx)("div",{className:"calendar-sets-settings",children:(0,e.jsx)(l.Form,{form:j,layout:"horizontal",size:"xs",initialValues:{defaultCalendar:f==null||(s=f.defaultCalendar)===null||s===void 0?void 0:s.id},onFieldsChange:$,children:(0,e.jsx)("div",{className:"d-flex flex-row flex-center",children:(0,e.jsx)(l.Form.Item,{name:"defaultCalendar",label:"\u9ED8\u8BA4\u65E5\u5386",children:(0,e.jsx)(Ce,{solid:!0})})})})})]})]})]})}var oa=da;function va(s){var u=s.visible,n=s.onCancel,c=(0,a.useState)(!1),t=F()(c,2),E=t[0],p=t[1],m=(0,a.useState)("calendars"),j=F()(m,2),B=j[0],x=j[1],g=(0,a.useCallback)(function(){p(!0)},[]),I=(0,a.useCallback)(function(r){x(r)},[]);return(0,e.jsx)(l.Modal,{centered:!0,maskClosable:!1,visible:u,onCancel:n,onOk:g,scroll:!1,confirmLoading:E,dialogClassName:"mw-750px calendar-preferences",header:(0,e.jsx)(l.Modal.Header,{children:(0,e.jsxs)(l.Nav,{onSelect:I,selectedKey:B,children:[(0,e.jsx)(l.Nav.Item,{className:"me-2 mb-md-0",children:(0,e.jsxs)(l.Nav.Link,{className:"btn d-flex flex-column btn-active-light-primary",children:[(0,e.jsx)(oe.ZP,{name:"Duotune/cod001",className:"svg-icon-2 me-0"}),(0,e.jsx)("span",{className:"d-flex flex-column align-items-start pt-2",children:(0,e.jsx)("span",{className:"fs-7",children:"\u5E38\u89C4"})})]})},"general"),(0,e.jsx)(l.Nav.Item,{className:"me-2 mb-md-0",children:(0,e.jsxs)(l.Nav.Link,{className:"btn d-flex flex-column btn-active-light-success",children:[(0,e.jsx)(oe.ZP,{name:"Duotune/gen014",className:"svg-icon-2  me-0"}),(0,e.jsx)("span",{className:"d-flex flex-column align-items-start pt-2",children:(0,e.jsx)("span",{className:"fs-7",children:"\u65E5\u5386"})})]})},"calendars"),(0,e.jsx)(l.Nav.Item,{className:"me-2 mb-md-0",children:(0,e.jsxs)(l.Nav.Link,{className:"btn d-flex flex-column btn-active-light-info",children:[(0,e.jsx)(oe.ZP,{name:"Duotune/fil020",className:"svg-icon-2  me-0"}),(0,e.jsx)("span",{className:"d-flex flex-column align-items-start pt-2",children:(0,e.jsx)("span",{className:"fs-7",children:"\u5929\u6C14"})})]})},"weather")]})}),footer:!1,children:(0,e.jsx)(oa,{})})}var fa=va,ma={months:["1 \u6708","2 \u6708","3 \u6708","4 \u6708","5 \u6708","6 \u6708","7 \u6708","8 \u6708","9 \u6708","10 \u6708","11 \u6708","12 \u6708"],weekDays:[{name:"\u661F\u671F\u5929",short:"\u5468\u65E5",isWeekend:!0},{name:"\u661F\u671F\u4E00",short:"\u5468\u4E00"},{name:"\u661F\u671F\u4E8C",short:"\u5468\u4E8C"},{name:"\u661F\u671F\u4E09",short:"\u5468\u4E09"},{name:"\u661F\u671F\u56DB",short:"\u5468\u56DB"},{name:"\u661F\u671F\u4E94",short:"\u5468\u4E94"},{name:"\u661F\u671F\u516D",short:"\u5468\u516D",isWeekend:!0}],weekStartingIndex:0,getToday:function(u){return u},toNativeDate:function(u){return new Date(u.year,u.month-1,u.day)},getMonthLength:function(u){return new Date(u.year,u.month,0).getDate()},transformDigit:function(u){return u},nextMonth:"Next Month",previousMonth:"Previous Month",openMonthSelector:"Open Month Selector",openYearSelector:"Open Year Selector",closeMonthSelector:"Close Month Selector",closeYearSelector:"Close Year Selector",defaultPlaceholder:"Select...",from:"from",to:"to",digitSeparator:",",yearLetterSkip:0,isRtl:!1};function ha(s,u){for(var n=0;n<7;n++){var c=s.clone().add(n,"days"),t=c.format("YYYY-MM-DD");u.has(t)?u.get(t).isWeather=!0:u.set(t,{key:t,date:c,events:[],isToDay:c.isSame(s,"date"),isWeather:!1})}}function Xe(s,u){var n=s.format("YYYY-MM-DD"),c=u.find(function(t){return t.isSelected});if(c){if(c.key===n)return u;c.isTemporary?u.splice(u.findIndex(function(t){return t.isTemporary}),1):u.find(function(t){return t.isSelected}).isSelected=!1}if(u.some(function(t){return t.key===n}))u.find(function(t){return t.key===n}).isSelected=!0;else return u.push({key:n,date:s,events:[],isToDay:s.isSame(S()(),"date"),isWeather:!1,isSelected:!0,isTemporary:!0}),u.sort(function(t,E){return t.date.toDate().getTime()-E.date.toDate().getTime()});return u}function Ze(s,u){var n=S()(),c=new Map,t=ye()(s),E;try{for(t.s();!(E=t.n()).done;){var p=E.value,m=ye()(p.dates),j;try{for(m.s();!(j=m.n()).done;){var B=j.value,x=S()(B),g=x.format("YYYY-MM-DD");if(c.has(g)){var I;(I=c.get(g))===null||I===void 0||I.events.push(p)}else c.set(g,{key:g,date:x,isToDay:x.isSame(n,"date"),events:[p],isWeather:!1})}}catch(r){m.e(r)}finally{m.f()}}}catch(r){t.e(r)}finally{t.f()}return ha(n,c),Xe(S()(u),Array.from(c.values()).sort(function(r,f){return r.date.toDate().getTime()-f.date.toDate().getTime()}))}var Je=[];function pa(){var s=(0,W.Dn)(),u=s.data,n=(0,ae.useModel)("calendar",function(o){var z=o.state;return z.calendarSet}),c=(0,ae.useModel)("calendar",function(o){return o.state.state==="new"}),t=(0,ae.useModel)("calendar",function(o){var z=o.state;return z.selectedDay||new Date}),E=(0,ae.useModel)("calendar",function(o){return o.setSelectedDay}),p=(0,ae.useModel)("calendar",function(o){return o.changeState}),m=(0,ae.useModel)("calendar",function(o){return o.state.fullCalendar}),j=(0,a.useState)(!1),B=F()(j,2),x=B[0],g=B[1],I=(0,a.useRef)(null),r=(0,a.useRef)({selectedDay:t,eventsWithDays:[]}),f=(0,a.useReducer)(function(o){return o+1},0),$=F()(f,2),k=$[1];r.current.calendarSet=n;var N=(0,W.Vk)({fetchPolicy:"cache-and-network"}),h=F()(N,2),d=h[0],V=h[1].refetch,P=(0,a.useCallback)(function(){g(!1)},[]),q=(0,a.useCallback)(function(o){o==="manage-calendars"&&g(!0)},[]),U=(0,a.useCallback)(function(o){o&&E(new Date(o.year,o.month-1,o.day))},[E]),D=(0,a.useCallback)(function(o){return function(){E(r.current.selectedDay=o)}},[E]),R=(0,a.useCallback)(function(o){if(I.current){var z=Array.from(document.getElementsByClassName("event-list-item")),J=z.find(function(ve){return S()(ve.dataset.date).isSame(S()(o),"date")});if(J){var le=J.getBoundingClientRect().top+I.current.scrollTop,ee=I.current.getBoundingClientRect();I.current.scrollTo({top:le-ee.top-6.5}),r.current.skipNextScroll=!0,setTimeout(function(){clearTimeout(r.current.timer)},120),k()}}},[]);(0,a.useEffect)(function(){d({variables:{date:t,days:60,calendarSet:n==="all"?void 0:n}}).then(function(o){var z=o.data;r.current.eventsWithDays=Ze((z==null?void 0:z.events)||[],r.current.selectedDay),r.current.toDayOrNextEvent=r.current.eventsWithDays.find(function(J){return J.key===S()(r.current.selectedDay).format("YYYY-MM-DD")}),r.current.skipNextScroll=!0,k(),R(t)})},[n,d]);var re=(0,a.useCallback)(function(){var o=T()(v()().mark(function z(J){var le,ee;return v()().wrap(function(te){for(;;)switch(te.prev=te.next){case 0:return r.current.selectedDay=J,r.current.eventsWithDays=Xe(S()(J),r.current.eventsWithDays),r.current.toDayOrNextEvent=r.current.eventsWithDays.find(function(me){return me.key===S()(J).format("YYYY-MM-DD")}),r.current.skipNextScroll=!0,k(),te.next=7,(0,Se._v)(60);case 7:return R(J),te.next=10,(0,Se._v)(60);case 10:if(r.current.selectedDay===J){te.next=12;break}return te.abrupt("return");case 12:return te.next=14,V({date:J,days:60,calendarSet:r.current.calendarSet==="all"?void 0:r.current.calendarSet});case 14:return le=te.sent,ee=le.data,r.current.eventsWithDays=Ze(ee.events,r.current.selectedDay),r.current.skipNextScroll=!0,k(),te.next=21,(0,Se._v)(60);case 21:r.current.selectedDay===J&&R(J);case 22:case"end":return te.stop()}},z)}));return function(z){return o.apply(this,arguments)}}(),[]);(0,a.useEffect)(function(){r.current.selectedDay&&S()(r.current.selectedDay).isSame(t,"date")||r.current.eventsWithDays.length&&re(t)},[t]);var Y=(0,a.useCallback)(function(){if(I.current){if(r.current.skipNextScroll){r.current.skipNextScroll=!1;return}var o=Array.from(document.getElementsByClassName("event-list-item")),z=I.current.getBoundingClientRect(),J=o.find(function(ee){if(ee.dataset.temp==="true")return!1;var ve=ee.getBoundingClientRect(),te=ee.getElementsByClassName("event-list")[0].getBoundingClientRect().height,me=ve.top-z.top+te+16;return me>0&&me<ve.height});if(J){var le=r.current.eventsWithDays.find(function(ee){return ee.key===J.dataset.date});le&&(r.current.eventsWithDays=r.current.eventsWithDays.filter(function(ee){return!ee.isTemporary}),r.current.eventsWithDays.forEach(function(ee){ee.isSelected=!1}),le.isSelected=!0,r.current.skipNextScroll=!0,r.current.toDayOrNextEvent=le,k(),clearTimeout(r.current.timer),r.current.timer=setTimeout(T()(v()().mark(function ee(){var ve,te;return v()().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return A.next=2,V({date:le.date.toDate(),days:60,calendarSet:r.current.calendarSet==="all"?void 0:r.current.calendarSet});case 2:ve=A.sent,te=ve.data,r.current.eventsWithDays=Ze(te.events,r.current.selectedDay),r.current.skipNextScroll=!0,k();case 7:case"end":return A.stop()}},ee)})),1e3),E(r.current.selectedDay=S()(J.dataset.date).toDate()))}}},[E]),C=(0,a.useCallback)(function(o){var z=document.getElementsByClassName("main-calendar")[0];z==null||z.focus(),p("none"),console.log("fullCalendar",m==null?void 0:m.getApi()),m==null||m.getApi().refetchEvents(),re(new Date(o.datetime.starts))},[m,p,re]),b=r.current,M=b.toDayOrNextEvent,L=b.eventsWithDays,y=L.find(function(o){return o.key===(M==null?void 0:M.key)});return(0,e.jsxs)(X.GP,{width:325,collapsible:!1,resizeable:!0,className:ne()("calendar-sidebar-bg",{"state-new-event":c}),children:[(0,e.jsxs)("div",{className:"calendar-sidebar",children:[(0,e.jsx)(we,{}),(0,e.jsx)(Re,{visible:c,onSuccess:C,calendarSets:(u==null?void 0:u.calendarSets)||Je}),(0,e.jsx)(Te.f,{locale:ma,value:{year:t.getFullYear(),month:t.getMonth()+1,day:t.getDate()},onChange:U,shouldHighlightWeekends:!0,colorPrimary:"#04c8c8"}),(0,e.jsxs)("div",{className:"calendar-day-list",children:[(0,e.jsxs)("div",{className:"event-list-header",children:[(0,e.jsxs)("h6",{children:[y!=null&&y.isToDay?"\u4ECA\u5929":(y==null?void 0:y.date.format("dddd"))||"\u4ECA\u5929",(0,e.jsx)("span",{className:"day-subtitle text-muted",children:(y==null?void 0:y.date.format("YYYY-MM-DD"))||S()().format("YYYY-MM-DD")})]}),!(y!=null&&y.events.length)&&(y==null?void 0:y.isSelected)&&(0,e.jsx)("div",{className:"onday-no-events text-muted",children:"\u6CA1\u6709\u4E8B\u4EF6"})]}),(0,e.jsx)("div",{ref:I,onScrollCapture:Y,className:"event-list-body hover-scroll-y",children:L.map(function(o){var z=o.key,J=o.date,le=o.isToDay,ee=o.events,ve=o.isSelected,te=o.isTemporary;return(0,e.jsxs)("div",{className:"event-list-item","data-temp":te,"data-date":z,children:[(0,e.jsxs)("h6",{onClick:D(J.toDate()),children:[le?"\u4ECA\u5929":J.format("dddd"),(0,e.jsx)("span",{className:"day-subtitle text-muted",children:J.format("YYYY-MM-DD")})]}),(0,e.jsx)("div",{className:ne()("event-list",se()(se()({},"is-empty",!ee.length),"onday-no-events",!ee.length&&ve)),children:ee.map(function(me){return(0,e.jsx)(l.Popover,{content:(0,e.jsx)("div",{children:"12312313"}),children:(0,e.jsx)("span",{style:{backgroundColor:me.color},className:"event-day",children:me.title},me.id)},me.id)})})]},z)})})]}),(0,e.jsx)(he,{calendarSets:(u==null?void 0:u.calendarSets)||Je,onAction:q})]}),(0,e.jsx)(fa,{visible:x,onCancel:P})]})}var Ca=a.memo(pa),xa=Ca},38932:function(Ve,Ee,i){i.d(Ee,{f:function(){return Ne},y:function(){return v}});var Fe=i(19755),se=i.n(Fe);function Ne(G){var T=parseInt(se()(G).data("click-number")||0)+1;if(T===2)return clearTimeout(se()(G).data("timer-reset")),se()(G).data("click-number",0),!0;var de=setTimeout(function(){se()(G).data("click-number",0),clearTimeout(de)},500);return se()(G).data("click-number",T).data("timer-reset",de),!1}function v(G,T,de,F,ge){var ye=G.height/3/2,a=F<ye&&F>-ye&&(de==null?void 0:de.parentKey)!==T.id;return a?ge:F>0?ge+1:F<0?ge-1:NaN}}}]);

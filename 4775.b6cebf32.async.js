"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[4775],{84775:function(Le,V,l){var Z=l(13769),Q=l.n(Z),z=l(15009),p=l.n(z),G=l(99289),O=l.n(G),H=l(97857),x=l.n(H),J=l(5574),d=l.n(J),c=l(62435),X=l(96974),q=l(39711),ee=l(46027),re=l(30381),_=l.n(re),te=l(10185),ne=l(35908),se=l(14336),ae=l(94528),v=l(58301),n=l(2721),R=l(59357),S=l(60551),oe=l(82144),f=l(75981),ue=l(12708),D=l(24127),e=l(86074),le=["keywords"];function ie(y,ce){var j,w,b,C,F=(0,X.s0)(),de=(0,q.lr)(),_e=d()(de,1),m=_e[0],me=(0,ne.ot)(),h=me.data,g=(0,c.useMemo)(function(){return(0,v.bp)(m,[{source:"q",target:"keywords"},{source:"customer",target:"customerId"},{source:"stores",target:"storeId_in",transform:function(t){return t.split(",")}},{source:"created_by",target:"createdBy_in",transform:function(t){return t.split(",")}},{source:"status",target:"status"},{source:"created_at_range",target:"createdAt_range",transform:function(t){var s=t.split("~"),u=d()(s,2),a=u[0],r=u[1];return[_()(a),_()(r)]}},{source:"contact",target:"contact_contains"},{source:"assignee",target:"assignee_in",transform:function(t){return t.split(",")}},{source:"resolvedAt_range",target:"resolvedAt_range",transform:function(t){var s=t.split("~"),u=d()(s,2),a=u[0],r=u[1];return[_()(a),_()(r)]}}])},[m.toString()]);(0,c.useState)({keywords:m.get("q")||""});var E=(0,c.useMemo)(function(){var o=(0,v.bp)(m,[{source:"q",target:"where.name_contains"},{source:"customer",target:"where.customerId"},{source:"stores",target:"where.storeId_in",transform:function(s){return s.split(",")}},{source:"created_by",target:"where.createdBy_in",transform:function(s){return s.split(",")}},{source:"status",target:"where.status"},{source:"created_at_range",target:"where.createdAt_range",transform:function(s){var u=s.split("~"),a=d()(u,2),r=a[0],i=a[1];return{start:_()(r),end:_()(i)}}},{source:"contact",target:"where.contact_contains"},{source:"assignee",target:"where.assignee_in",transform:function(s){return s.split(",")}},{source:"resolvedAt_range",target:"where.resolvedAt_range",transform:function(s){var u=s.split("~"),a=d()(u,2),r=a[0],i=a[1];return{start:_()(r),end:_()(i)}}},{source:"page",transform:function(s){return parseInt(s)}},{source:"per_page",transform:function(s){return parseInt(s)}},{source:"sort",target:"orderBy",transform:function(s){var u=s.split(":"),a=d()(u,2),r=a[0],i=a[1];return"".concat(r,"_").concat(i)}}],{where:x()({},y.where)});return o.where=o.where||{},o},[m.toString(),y.where]),he=(0,D.pw)({fetchPolicy:"network-only"}),fe=d()(he,1),ye=fe[0],ge=(0,v.ZP)(D.VB,{variables:E,skip:!y.where}),L=d()(ge,2),pe=L[0],P=L[1],ve=P.loading,k=P.pageInfo,T=P.refetch,Ee=(0,c.useState)((j=E.where)===null||j===void 0?void 0:j.customerId),U=d()(Ee,2),W=U[0],ke=U[1],xe=(0,oe.xY)({variables:{where:{tenantId:h==null?void 0:h.tenantId},pageSize:100},fetchPolicy:"network-only",skip:!(h!=null&&h.tenantId)}),A=xe.data,De=(0,S.rq)({fetchPolicy:"network-only",skip:!!((w=y.where)!==null&&w!==void 0&&w.customerId)}),I=De.data,K=(0,S.YG)({fetchPolicy:"network-only",skip:!W,variables:{where:{customer:W||((b=E.where)===null||b===void 0?void 0:b.customerId)}}}),M=K.data,je=K.loading,we=(I==null?void 0:I.result)||[],be=(M==null?void 0:M.result)||[],N=(A==null?void 0:A.result.edges.map(function(o){return o.node}))||[],$=(0,se.Z)(D.Q9,{onDeleted:function(){T()},dialog:{title:"\u4F60\u786E\u5B9A\u8981\u5220\u9664\u5417\uFF1F",content:function(t,s){var u;if(s.batch){var a=t;u="\u786E\u5B9A\u5220\u9664\u9009\u4E2D\u7684, \u5171 ".concat(a.length," \u4E2A\u670D\u52A1\u5355\u5417?")}else u=(0,e.jsxs)(e.Fragment,{children:["\u60A8\u5373\u5C06\u5220\u9664\u201C",(0,e.jsx)("strong",{children:t.name})]});return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("p",{className:"tip-confirm",children:u}),(0,e.jsx)("p",{children:"\u5220\u9664\u7684\u64CD\u4F5C\u4E0D\u53EF\u9006,\u8BF7\u8C28\u614E\u64CD\u4F5C"})]})}}}),Ce=$.delete,Pe=$.deleteMany,Ae=(0,c.useCallback)(function(o){return O()(p()().mark(function t(){return p()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:Pe(o);case 1:case"end":return u.stop()}},t)}))},[]),B=(0,c.useCallback)(function(o,t,s){var u=(0,v.Oh)({searchForm:o,pagination:t,sorter:s},[{source:"searchForm.keywords",target:"q",skip:function(r){return!r}},{source:"searchForm.customerId",target:"customer",skip:function(r){return!r}},{source:"searchForm.storeId_in",target:"stores",transform:function(r){return r==null?void 0:r.join(",")},skip:function(r){return!r||!r.length}},{source:"searchForm.contact_contains",target:"contact",skip:function(r){return!r}},{source:"searchForm.assignee_in",target:"assignee",transform:function(r){return r==null?void 0:r.join(",")},skip:function(r){return!r||!r.length}},{source:"searchForm.resolvedAt_range",target:"resolvedAt_range",transform:function(r){return r[0].format("YYYY-MM-DD")+"~"+r[1].format("YYYY-MM-DD")},skip:function(r){return!r}},{source:"searchForm.createdBy_in",target:"created_by",transform:function(r){return r==null?void 0:r.join(",")},skip:function(r){return!r||!r.length}},{source:"searchForm.status",target:"status",transform:function(r){return r},skip:function(r){return!r||r==="ALL"}},{source:"searchForm.createdAt_range",target:"created_at_range",transform:function(r){return r[0].format("YYYY-MM-DD")+"~"+r[1].format("YYYY-MM-DD")},skip:function(r){return!r}},{source:"pagination.current",target:"page",skip:function(r){return r===1}},{source:"pagination.pageSize",target:"per_page",skip:function(r){return r===15}},{source:"sorter.field",target:"sort",transform:function(r){return"".concat(r,":").concat(s.order==="ascend"?"asc":"desc")}}]);F(location.pathname+"?"+u,{replace:!0})},[g]),Ie=(0,ae.Z)({fields:[{key:"no",title:"\u5355\u53F7",type:"string"},{key:"device.sn",title:"\u8BBE\u5907\u5E8F\u5217\u53F7",type:"string"},{key:"device.brand.name",title:"\u54C1\u724C",type:"string"},{key:"device.product.name",title:"\u4EA7\u54C1\u540D\u79F0",type:"string"},{key:"device.name",title:"\u8BBE\u5907\u540D\u79F0",type:"date"},{key:"device.warrantyStatus",title:"\u4FDD\u56FA\u72B6\u6001",type:"string"},{key:"device.warrantyStartDate",title:"\u542F\u7528\u65F6\u95F4",type:"string"},{key:"store.no",title:"\u95E8\u5E97\u5E97\u53F7",type:"string"},{key:"store.name",title:"\u95E8\u5E97\u540D\u79F0",type:"string"},{key:"store.address.fullAddress",title:"\u95E8\u5E97\u5730\u5740",type:"string"},{key:"store.phone",title:"\u95E8\u5E97\u7535\u8BDD",type:"string"},{key:"store.openingDate",title:"\u5F00\u4E1A\u65F6\u95F4",type:"string"},{key:"customer.name",title:"\u6240\u5C5E\u5BA2\u6237",type:"string"},{key:"description",title:"\u6545\u969C\u63CF\u8FF0",type:"string"},{key:"status",title:"\u6848\u4EF6\u72B6\u6001",type:"string"},{key:"createdAt",title:"\u62A5\u4FEE\u65F6\u95F4",type:"string"},{key:"contactInfo.name",title:"\u62A5\u4FEE\u4EBA",type:"string"},{key:"contactInfo.phone",title:"\u62A5\u4FEE\u4EBA\u8054\u7CFB\u7535\u8BDD",type:"string"},{key:"contactInfo.address.fullAddress",title:"\u62A5\u4FEE\u4EBA\u8054\u7CFB\u5730\u5740",type:"string"},{key:"assignee.name",title:"\u7EF4\u4FEE\u4EBA\u5458",type:"string"},{key:"assignee.phone.number",title:"\u7EF4\u4FEE\u4EBA\u5458\u8054\u7CFB\u7535\u8BDD",type:"string"},{key:"completedAt",title:"\u5B8C\u6210\u7EF4\u4FEE\u65F6\u95F4",type:"string"}],export:{filename:"\u670D\u52A1\u5355\u5217\u8868.xlsx",columns:[{key:"no",style:{wch:20}},{key:"device.sn",style:{wch:20}},{key:"device.brand.name",style:{wch:10}},{key:"device.product.name",style:{wch:10}},{key:"device.name",style:{wch:16}},{key:"device.warrantyStatus",style:{wch:10}},{key:"device.warrantyStartDate",style:{wch:16}},{key:"store.no",style:{wch:10}},{key:"store.name",style:{wch:10}},{key:"store.address.fullAddress",style:{wch:40}},{key:"store.phone",style:{wch:20}},{key:"store.openingDate",style:{wch:16}},{key:"customer.name",style:{wch:10}},{key:"description",style:{wch:10}},{key:"status",style:{wch:10}},{key:"createdAt",style:{wch:10}},{key:"contactInfo.name",style:{wch:10}},{key:"contactInfo.phone",style:{wch:20}},{key:"contactInfo.address.fullAddress",style:{wch:40}},{key:"assignee.name",style:{wch:10}},{key:"assignee.phone.number",style:{wch:20}},{key:"completedAt",style:{wch:16}}],dataSource:function(){return O()(p()().mark(function t(){var s,u;return p()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,ye({variables:x()(x()({},E),{},{page:1,pageSize:((k==null?void 0:k.total)||1e4)+100})});case 2:return s=r.sent,u=s.data,r.abrupt("return",u.result.edges.map(function(i){return i.node}));case 5:case"end":return r.stop()}},t)}))()}}}),Me=(0,c.useCallback)(function(o){return function(t){t.key==="view"?F("/srm/tickets/".concat(o.id),{}):t.key==="delete"&&Ce(o)}},[]),Be=(0,c.useCallback)(function(o,t,s){B(g,o,s)},[g]),Oe=(0,c.useCallback)(function(o){B({keywords:o},{},{})},[]),Re=(0,c.useCallback)(function(o){B(o,{},{})},[]);(0,c.useImperativeHandle)(ce,function(){return{refetch:function(){T()}}});var Se=g.keywords,Y=Q()(g,le);return console.log("advancedSearchValues",Y),(0,e.jsxs)(n.Card,{className:"mb-5 mb-xl-10",children:[(0,e.jsxs)(n.Card.Header,{className:"pt-8",children:[(0,e.jsxs)(n.Card.Title,{className:"flex-row",children:[(0,e.jsx)(n.Input.Search,{solid:!0,defaultValue:Se,className:"w-250px",placeholder:"\u5173\u952E\u8BCD\u641C\u7D22",onSearch:Oe}),(0,e.jsxs)(te.ZJ,{values:Y,onSearch:Re,children:[!((C=y.where)!==null&&C!==void 0&&C.customerId)&&(0,e.jsx)(n.Row,{gutter:8,className:"mb-8",children:(0,e.jsxs)(n.Col,{xxl:7,children:[(0,e.jsx)("label",{className:"fs-6 form-label fw-bold text-dark",children:"\u5BA2\u6237"}),(0,e.jsx)(n.Form.Item,{noStyle:!0,name:"customerId",children:(0,e.jsx)(n.Select2,{solid:!0,matcher:function(t,s){return!t.term||t.term===""||s.text.includes(t.term)?s:null},onChange:function(t){ke(t)},placeholder:"\u5168\u90E8\u5BA2\u6237",options:we.map(function(o){return{label:o.name,value:o.id}})})})]})}),(0,e.jsxs)(n.Row,{gutter:8,className:"mb-8",children:[(0,e.jsxs)(n.Col,{xxl:7,children:[(0,e.jsx)("label",{className:"fs-6 form-label fw-bold text-dark",children:"\u95E8\u5E97"}),(0,e.jsx)(n.Form.Item,{dependencies:["customerId"],noStyle:!0,children:function(t){var s=t.getFieldValue("customerId"),u=s?"\u5168\u90E8\u95E8\u5E97":"\u8BF7\u5148\u9009\u62E9\u5BA2\u6237";return(0,e.jsx)(n.Form.Item,{noStyle:!0,name:"storeId_in",children:(0,e.jsx)(n.Select2,{solid:!0,multiple:!0,placeholder:je?"\u52A0\u8F7D\u4E2D...":u,options:be.map(function(a){return{label:a.name,value:a.id}})})})}})]}),(0,e.jsxs)(n.Col,{xxl:5,children:[(0,e.jsx)("label",{className:"fs-6 form-label fw-bold text-dark",children:"\u72B6\u6001"}),(0,e.jsx)(n.Form.Item,{noStyle:!0,name:"status",initialValue:"ALL",children:(0,e.jsxs)(n.Radio.Group,{children:[(0,e.jsx)(n.Radio.Button,{value:"ALL",children:"\u5168\u90E8"}),(0,e.jsx)(n.Radio.Button,{value:"NEW",children:"\u65B0\u5EFA"}),(0,e.jsx)(n.Radio.Button,{value:"IN_PROGRESS",children:"\u5904\u7406\u4E2D"}),(0,e.jsx)(n.Radio.Button,{value:"SUSPENDED",children:"\u6682\u505C"}),(0,e.jsx)(n.Radio.Button,{value:"RESOLVED",children:"\u5DF2\u89E3\u51B3"})]})})]})]}),(0,e.jsxs)(n.Row,{gutter:8,className:"mb-8",children:[(0,e.jsxs)(n.Col,{xxl:7,children:[(0,e.jsx)("label",{className:"fs-6 form-label fw-bold text-dark",children:"\u62A5\u4FEE\u4EBA"}),(0,e.jsx)(n.Form.Item,{noStyle:!0,name:"contact_contains",children:(0,e.jsx)(n.Input,{solid:!0,placeholder:"\u62A5\u4FEE\u4EBA"})})]}),(0,e.jsxs)(n.Col,{xxl:5,children:[(0,e.jsx)("label",{className:"fs-6 form-label fw-bold text-dark",children:"\u62A5\u4FEE\u65F6\u95F4"}),(0,e.jsx)(n.Form.Item,{noStyle:!0,name:"createdAt_range",children:(0,e.jsx)(R.Z,{solid:!0})})]})]}),(0,e.jsxs)(n.Row,{gutter:8,className:"mb-8",children:[(0,e.jsxs)(n.Col,{xxl:7,children:[(0,e.jsx)("label",{className:"fs-6 form-label fw-bold text-dark",children:"\u5904\u7406\u5DE5\u7A0B\u5E08"}),(0,e.jsx)(n.Form.Item,{noStyle:!0,name:"assignee_in",children:(0,e.jsx)(n.Select2,{solid:!0,multiple:!0,matcher:function(t,s){var u,a,r;if(!t.term||t.term==="")return s;var i=N.find(function(Fe){return Fe.id===s.id});return i!=null&&(u=i.nickname)!==null&&u!==void 0&&u.includes(t.term)||i!=null&&(a=i.username)!==null&&a!==void 0&&a.includes(t.term)||i!=null&&(r=i.phone)!==null&&r!==void 0&&(r=r.number)!==null&&r!==void 0&&r.includes(t.term)?s:null},placeholder:"\u5904\u7406\u5DE5\u7A0B\u5E08",labelProp:"name",valueProp:"id",options:N})})]}),(0,e.jsxs)(n.Col,{xxl:5,children:[(0,e.jsx)("label",{className:"fs-6 form-label fw-bold text-dark",children:"\u5B8C\u4FEE\u65F6\u95F4"}),(0,e.jsx)(n.Form.Item,{noStyle:!0,name:"resolvedAt_range",children:(0,e.jsx)(R.Z,{solid:!0})})]})]})]})]}),(0,e.jsx)(n.Card.Toolbar,{children:(0,e.jsx)("div",{children:(0,e.jsx)(n.Button,{className:"me-4 my-1",variant:"light",onClick:function(){return Ie.export()},children:"\u5BFC\u51FA Excel"})})})]}),(0,e.jsx)(n.Card.Body,{children:(0,e.jsx)(n.BlockUI,{overlayClassName:"bg-white bg-opacity-25",loading:ve,children:(0,e.jsx)(n.Table,{hover:!0,rowKey:"id",rowSelection:{type:"checkbox",renderTitle:function(t){return(0,e.jsxs)(e.Fragment,{children:["\u5DF2\u9009\u4E2D",(0,e.jsx)("span",{className:"mx-2",children:t}),"\u4E2A"]})},toolbar:function(t){return(0,e.jsx)("div",{children:(0,e.jsx)(n.Button,{color:"success",onClick:Ae(t),variant:!1,children:"\u6279\u91CF\u5220\u9664"})})}},noRowsRenderer:function(){return(0,e.jsx)(n.Empty,{description:"\u5217\u8868\u6570\u636E\u4E3A\u7A7A",image:"/assets/media/illustrations/sigma-1/5.png"})},columns:[{key:"no",title:"\u7F16\u53F7",width:160,sorter:!0,sortOrder:(0,ue.PE)(m,"no")},{key:"store.name",title:"\u95E8\u5E97",render:function(t,s){var u,a;return(0,e.jsxs)(e.Fragment,{children:[(u=s.customer)===null||u===void 0?void 0:u.name,", ",(a=s.store)===null||a===void 0?void 0:a.name]})}},{key:"createdAt",title:"\u62A5\u4FEE\u65F6\u95F4",width:160},{key:"description",title:"\u6545\u969C\u8BF4\u660E",width:180},{key:"status",title:"\u72B6\u6001",sorter:!0,width:120,render:function(t){switch(t){case f.mk.New:return(0,e.jsx)(n.Badge,{color:"danger",light:!0,children:"\u672A\u63A5\u5355"});case f.mk.Suspended:return(0,e.jsx)(n.Badge,{color:"warning",light:!0,children:"\u6682\u505C\u7684"});case f.mk.Resolved:return(0,e.jsx)(n.Badge,{color:"success",light:!0,children:"\u5DF2\u5B8C\u6210"});case f.mk.Reopen:case f.mk.InProgress:return(0,e.jsx)(n.Badge,{color:"info",light:!0,children:"\u5904\u7406\u4E2D"});default:return(0,e.jsx)(n.Badge,{color:"dark",children:"\u72B6\u6001\u672A\u77E5"})}}},{title:"\u64CD\u4F5C",key:"action",width:120,render:function(t,s){return(0,e.jsx)("div",{children:(0,e.jsx)(n.Dropdown,{overlay:(0,e.jsxs)(n.Menu,{onClick:Me(s),className:"menu-sub menu-sub-dropdown menu-gray-600 menu-state-bg-light-primary fw-bold w-125px py-2",children:[(0,e.jsx)(n.Menu.Item,{className:"px-3",children:"\u67E5\u770B\u8BE6\u60C5"},"view"),(0,e.jsx)(n.Menu.Item,{className:"px-3",children:"\u5220\u9664"},"delete")]}),placement:"bottomRight",children:(0,e.jsxs)(n.Button,{variant:"clean",activeColor:"light-primary",children:["\u64CD \u4F5C",(0,e.jsx)(ee.ZP,{className:"ms-2 svg-icon-5 m-0",name:"Duotune/arr072"})]})})})}}],pagination:k,onChange:Be,dataSource:pe})})})]})}V.Z=(0,c.forwardRef)(ie)}}]);

(self.webpackChunkasany_admin=self.webpackChunkasany_admin||[]).push([[1286],{81286:function(te,X,s){"use strict";s.r(X),s.d(X,{default:function(){return O}});var $=s(3182),r=s(11849),N=s(2824),A=s(94043),B=s.n(A),d=s(67294),P=s(28865),K=s(94184),J=s.n(K),M=s(86582),z=s(93224);function w(i){if(i==null)throw new TypeError("Cannot destructure undefined")}var y=s(14843),n=s(53704),F=s(25496),e=s(85893);function G(i){var l,c=i.form,f=i.appId,b=(0,y.mp)({variables:{id:f}}),m=b.data,D=(m==null||(l=m.app)===null||l===void 0?void 0:l.routes)||[],v=(0,d.useMemo)(function(){return(0,F.$H)((0,F.G_)((D||[]).map(function(o){return(0,r.Z)({},o)}),{pidKey:"parent.id",sort:function(x,h){return x.index-h.index},converter:function(x,h){return w(h),(0,r.Z)((0,r.Z)({},x),{},{key:x.id,routeType:x.type,title:x.path})}}))},[D]);return(0,d.useEffect)(function(){var o=i.data,x=o.children,h=o._rect,p=o.pos,I=o.parent,E=(0,z.Z)(o,["children","_rect","pos","parent"]);i.data.id||c.resetFields(),c.setFieldsValue((0,r.Z)((0,r.Z)({},E),{},{parentRoute:I?I.id:void 0}))},[c,i.data]),(0,e.jsxs)(n.l0,{form:c,children:[(0,e.jsx)(n.X2,{children:(0,e.jsx)(n.JX,{span:6,children:(0,e.jsx)(n.l0.Item,{name:"name",className:"d-flex flex-column mb-7",required:!0,label:"\u540D\u79F0",rules:[{required:!0,message:"\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A"}],children:(0,e.jsx)(n.II,{solid:!0})})})}),(0,e.jsx)(n.X2,{children:(0,e.jsx)(n.JX,{span:6,children:(0,e.jsx)(n.l0.Item,{name:"parentRoute",className:"d-flex flex-column mb-7",label:"\u4E0A\u7EA7\u8DEF\u7531",children:(0,e.jsx)(n.ub,{solid:!0,options:[{value:"",label:"\u6839\u8282\u70B9"}].concat((0,M.Z)(v.map(function(o){return{value:o.id,label:o.title}})))})})})}),(0,e.jsx)(n.X2,{children:(0,e.jsx)(n.l0.Item,{name:"type",className:"d-flex flex-column mb-7",label:"\u7C7B\u578B",children:(0,e.jsx)(n.Y8.Group,{solid:!0,options:[{value:"MENU",label:"\u83DC\u5355"},{value:"HEADER",label:"\u6807\u9898"},{value:"DIVIDER",label:"\u5206\u9694\u7B26"},{value:"ROUTE",label:"\u8DEF\u7531"}]})})}),(0,e.jsxs)(n.X2,{children:[(0,e.jsx)(n.JX,{span:6,children:(0,e.jsx)(n.l0.Item,{name:"icon",className:"d-flex flex-column mb-7",label:"\u56FE\u6807",children:(0,e.jsx)(n.II,{})})}),(0,e.jsx)(n.JX,{span:6,children:(0,e.jsx)(n.l0.Item,{className:"d-flex flex-column mb-7",name:"index",label:"\u6392\u5E8F\u4F4D\u7F6E",children:(0,e.jsx)(n.II,{solid:!0})})})]}),(0,e.jsxs)(n.X2,{children:[(0,e.jsx)(n.JX,{span:4,children:(0,e.jsx)(n.l0.Item,{valuePropName:"checked",className:"d-flex flex-column mb-7",name:"authorized",children:(0,e.jsx)(n.rs,{solid:!0,label:"\u6388\u6743\u540E\u8BBF\u95EE"})})}),(0,e.jsx)(n.JX,{span:4,children:(0,e.jsx)(n.l0.Item,{valuePropName:"checked",className:"d-flex flex-column mb-7",name:"enabled",children:(0,e.jsx)(n.rs,{solid:!0,label:"\u542F\u7528"})})}),(0,e.jsx)(n.JX,{span:4,children:(0,e.jsx)(n.l0.Item,{valuePropName:"checked",className:"d-flex flex-column mb-7",name:"hideInBreadcrumb",children:(0,e.jsx)(n.rs,{solid:!0,label:"\u4E0D\u5728\u9762\u5305\u5C51\u4E2D\u663E\u793A"})})})]}),(0,e.jsx)(n.l0.Item,{dependencies:["hideInBreadcrumb"],noStyle:!0,children:function(){return c.getFieldValue("hideInBreadcrumb")?(0,e.jsx)(e.Fragment,{}):(0,e.jsx)(n.X2,{children:(0,e.jsx)(n.l0.Item,{className:"d-flex flex-column mb-7",name:"breadcrumb",label:"\u81EA\u5B9A\u4E49\u9762\u5305\u5C51\u7EC4\u4EF6",children:(0,e.jsx)(n.II,{solid:!0})})})}}),(0,e.jsx)(n.X2,{children:(0,e.jsx)(n.l0.Item,{className:"d-flex flex-column mb-7",name:"access",label:"\u8BBF\u95EE\u6743\u9650",children:(0,e.jsx)(n.II,{solid:!0})})}),(0,e.jsx)(n.X2,{children:(0,e.jsx)(n.l0.Item,{rules:[{required:!0,message:"\u8BBF\u95EE\u8DEF\u5F84\u4E0D\u80FD\u4E3A\u7A7A"}],className:"d-flex flex-column mb-7",name:"path",label:"\u8DEF\u5F84",children:(0,e.jsx)(n.II,{solid:!0})})}),(0,e.jsx)(n.X2,{children:(0,e.jsx)(n.l0.Item,{className:"d-flex flex-column mb-7",name:"redirect",label:"\u91CD\u5B9A\u5411",children:(0,e.jsx)(n.II,{solid:!0})})}),(0,e.jsx)(n.X2,{children:(0,e.jsx)(n.l0.Item,{className:"d-flex flex-column mb-7",name:"component",label:"\u7EC4\u4EF6",children:(0,e.jsx)(n.II,{solid:!0})})})]})}function H(i){var l=i.route,c=i.visible,f=i.onClose,b=i.onSuccess,m=i.onDeleteSuccess,D=(0,y.Hr)(l,b),v=(0,N.Z)(D,2),o=v[0],x=v[1],h=x.form,p=x.submitting,I=(0,d.useMemo)(function(){var S,g;return l?(0,r.Z)((0,r.Z)({},l),{},{breadcrumb:(S=l.breadcrumb)===null||S===void 0?void 0:S.id,component:(g=l.component)===null||g===void 0?void 0:g.id}):{type:"URL",index:0}},[l]),E=(0,y.cT)(l,m),Z=(0,N.Z)(E,1),j=Z[0];return(0,e.jsx)(n.dy,{title:l!=null&&l.id?"\u7F16\u8F91\u8DEF\u7531":"\u65B0\u589E\u8DEF\u7531",placement:"right",width:640,mask:!1,onClose:f,visible:c,footer:(0,e.jsxs)(n.X2,{children:[(0,e.jsx)(n.JX,{span:6,children:(0,e.jsx)(n.zx,{style:{letterSpacing:"1rem"},className:"w-100",loading:p,onClick:o,children:"\u4FDD\u5B58"})}),(0,e.jsx)(n.JX,{span:6,children:(l==null?void 0:l.id)&&(0,e.jsx)(n.zx,{style:{letterSpacing:"1rem"},className:"w-100",variant:"danger",variantStyle:"light",onClick:j,children:"\u5220\u9664"})})]}),children:l&&(0,e.jsx)(G,{submitting:p,data:I,appId:l.application.id,form:h,submit:o,onDeleteSuccess:m})})}var U=H,L=s(75468);function Q(i){var l=i.data,c=i.onDeleteSuccess,f=(0,y.cT)(l,c),b=(0,N.Z)(f,1),m=b[0];return(0,e.jsx)("div",{className:"d-flex flex-row-fluid justify-content-center",onClick:function(v){v.stopPropagation(),v.preventDefault()},children:(0,e.jsx)("div",{className:"ms-2",children:(0,e.jsx)(n.zx,{variant:"danger",variantStyle:"light",onClick:m,icon:(0,e.jsx)(P.ZP,{className:"svg-icon-2",name:"Duotune/arr088"})})})})}function V(i){var l,c,f=i.match.params.id,b=(0,y.mp)({variables:{id:f},fetchPolicy:"cache-and-network"}),m=b.data,D=b.loading,v=m==null||(l=m.app)===null||l===void 0?void 0:l.routes,o=(0,y.WE)({fetchPolicy:"no-cache",refetchQueries:[{query:y.dP,variables:{id:f}}]}),x=(0,N.Z)(o,1),h=x[0],p=(0,d.useMemo)(function(){return(0,F.G_)((v||[]).map(function(a){return(0,r.Z)({},a)}),{pidKey:"parent.id",sort:function(u,t){return u.index-t.index},converter:function(u){return(0,r.Z)((0,r.Z)({},u),{},{key:u.id,title:u.name,routeType:u.type,type:"directory"})}})},[v]),I=(0,d.useState)({visible:!1}),E=(0,N.Z)(I,2),Z=E[0],j=E[1],S=(0,d.useState)([]),g=(0,N.Z)(S,2),W=g[0],T=g[1];(0,d.useEffect)(function(){!p.length||T(function(a){return a.length?a:p.map(function(u){return u.id})})},[p]);var Y=(0,d.useCallback)(function(){j(function(a){return(0,r.Z)((0,r.Z)({},a),{},{visible:!1})})},[]),q=(0,d.useCallback)(function(a){j(function(u){return(0,r.Z)((0,r.Z)({},u),{},{route:a})})},[j]),k=(0,d.useCallback)(function(a){j(function(u){var t;return((t=u.route)===null||t===void 0?void 0:t.id)!=a.id?u:(0,r.Z)((0,r.Z)({},u),{},{visible:!1,menu:void 0})})},[j]),_=(0,d.useCallback)(function(){j(function(a){return(0,r.Z)((0,r.Z)({},a),{},{visible:!0,route:{index:0,icon:"Duotune/abs005",type:"ROUTE",application:{id:f}}})})},[f]),ee=(0,d.useCallback)(function(a){j(function(u){var t;return((t=u.route)===null||t===void 0?void 0:t.id)==a.node.id&&u.visible?(0,r.Z)((0,r.Z)({},u),{},{visible:!1}):(0,r.Z)((0,r.Z)({},u),{},{visible:!0,route:(0,r.Z)((0,r.Z)({},a.node),{},{type:a.node.routeType,parentRoute:a.node.parentKey})})})},[]),ne=(0,d.useCallback)(function(){var a=(0,$.Z)(B().mark(function u(t){var R;return B().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(console.log("handleDrop",t),!(((R=t.dragNode.parent)===null||R===void 0?void 0:R.id)==t.toParentKey&&t.dragNode.index==t.toIndex)){C.next=3;break}return C.abrupt("return");case 3:return C.next=5,n.FN.promise(h({variables:{id:t.dragNode.id,parentRoute:t.toParentKey,location:t.toIndex}}),{pending:"\u66F4\u65B0\u6392\u5E8F...",success:"\u6392\u5E8F\u8C03\u6574\u6210\u529F",error:"\u63D0\u4EA4\u51FA\u9519"},{duration:2e3,placement:"top-center"});case 5:case"end":return C.stop()}},u)}));return function(u){return a.apply(this,arguments)}}(),[h]);return console.log("keys",p.map(function(a){return a.id})),(0,e.jsxs)(L.v,{header:{title:"\u8DEF\u7531\u8BBE\u7F6E"},loading:D,children:[(0,e.jsxs)(n.Zb,{flush:!0,className:"mt-6 mt-xl-9",headerClassName:"mt-5",children:[(0,e.jsxs)(n.Zb.Header,{className:"pt-8",children:[(0,e.jsx)(n.Zb.Title,{}),(0,e.jsx)(n.Zb.Toolbar,{children:(0,e.jsx)("div",{className:"d-flex justify-content-end",children:(0,e.jsx)(n.zx,{onClick:_,variant:"primary",children:"\u65B0\u5EFA\u8DEF\u7531"})})})]}),(0,e.jsx)(n.Zb.Body,{className:"pt-0",children:(0,e.jsx)(n.N4,{className:"app-treelist",rowKey:"id",draggable:!0,expandedKeys:W,onExpand:T,selectedKeys:(c=Z.route)!==null&&c!==void 0&&c.id?[Z.route.id]:[],onSelect:ee,onDrop:ne,columns:[{key:"title",title:"\u540D\u79F0",width:"auto",render:function(u,t){return(0,e.jsxs)("div",{className:"d-flex flex-column py-5",children:[(0,e.jsx)("span",{className:J()("title  text-hover-primary mb-1 fs-6",{"text-gray-800":!!t.title,"text-gray-600":!t.title}),children:t.title||"(\u672A\u8BBE\u7F6E\u540D\u79F0)"}),(0,e.jsxs)("div",{className:"d-flex flex-row col-stacked",children:[(0,e.jsx)(n.Ct,{color:"secondary",className:"me-2",children:t.path}),t.authorized&&(0,e.jsx)(n.Ct,{color:"primary",children:"\u9700\u8981\u767B\u5F55"})]})]})}},{key:"index",title:"\u6392\u5E8F",className:"w-100px"},{key:"actions",title:"\u64CD\u4F5C",className:"min-w-125px text-center",render:function(u,t){return(0,e.jsx)(Q,{data:t,onDeleteSuccess:k})}}],dataSource:p})})]}),(0,e.jsx)(U,{route:Z.route,onClose:Y,onSuccess:q,onDeleteSuccess:k,visible:Z.visible})]})}var O=V}}]);

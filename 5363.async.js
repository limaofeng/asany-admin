"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[5363,1201],{51253:function(H,z,e){e.d(z,{GP:function(){return p.Z},Hk:function(){return B},xx:function(){return y.x}});var Q=e(74958),p=e(5166),y=e(19260),l=e(68400),d=e.n(l),A=e(62435),I=e(93967),M=e.n(I),W=e(94589),v=e(97857),D=e.n(v),n=e(46027),N=e(42687),w=e(10811),K=e(5574),R=e.n(K),o=e(96486),r=e(86074),t={aside:{minimize:!1,width:280}},i=A.createContext({state:t,dispatch:function(){}}),h=function(a){return a.AsideToggle="ASIDE_TOGGLE",a.AsideWidth="ASIDE_WIDTH",a}({});function S(a,j){switch(j.type){case"ASIDE_TOGGLE":return a.aside.minimize=!a.aside.minimize,D()({},a);case"ASIDE_WIDTH":return a.aside.width=j.payload,D()({},a);default:throw new Error}}var g=function(j){var E=(0,A.useReducer)(S,(0,o.cloneDeep)(t)),L=R()(E,2),s=L[0],O=L[1];return(0,r.jsx)(i.Provider,{value:{state:s,dispatch:O},children:j.children})},b=function(){return(0,A.useContext)(i)},x=e(65495);function m(a){var j=b(),E=j.dispatch,L=j.state.aside.minimize,s=(0,A.useCallback)(function(){E({type:h.AsideToggle})},[E]);return(0,r.jsx)(w.Button,{style:D()({marginBottom:"1.35rem",zIndex:105},a.style),onClick:s,activeColor:"primary",className:M()("micro-app-aside-toggle","btn-icon bg-body btn-color-gray-700 rounded-2 position-absolute translate-middle bottom-0 shadow-sm d-none d-lg-flex",a.className,{active:L}),children:(0,r.jsx)(n.JO,{name:"Duotune/arr063",className:"svg-icon-2 rotate-180"})})}function c(a){var j=a.className,E=a.header,L=a.children,s=a.collapsible,O=s===void 0?!0:s,F=a.width,U=F===void 0?280:F,$=(0,N.$Y)(),Z=b(),G=Z.dispatch;return(0,A.useEffect)(function(){$.aside.width(U+100),G({type:h.AsideWidth,payload:U})},[$.aside,G,U]),(0,r.jsxs)("div",{className:M()("app-aside aside",j),children:[(0,r.jsx)(x.Z,{children:(0,r.jsx)(p.Z,{header:E,resizeable:!0,className:"app-sidebar",children:L})}),O&&(0,r.jsx)(m,{className:"start-100 end-0"})]})}c.Toggle=m;var u=c,C,T=W.ZP.div(C||(C=d()([`
  --root-aside-width: `,`;
  --met-aside-width: `,`;
`])),function(a){return a.minimize?"100px":"".concat(a.width,"px")},function(a){return a.minimize?"100px":"".concat(a.width,"px")});function P(a){var j=a.children,E=a.className,L=b(),s=L.state.aside,O=s.minimize,F=s.width,U=(0,A.useCallback)(function($){$.preventDefault()},[]);return(0,r.jsx)(T,{minimize:O,width:F,className:M()("micro-app-container page-full-content",E,{"aside-minimize":O}),onContextMenu:U,children:j})}function f(a){var j=a.children,E=a.className;return(0,r.jsx)(g,{children:(0,r.jsx)(P,{className:E,children:j})})}f.Sidebar=u;var B=f},42687:function(H,z,e){e.d(z,{$Y:function(){return n},BK:function(){return w},aM:function(){return R}});var Q=e(5574),p=e.n(Q),y=e(97857),l=e.n(y),d=e(62435),A=e(86074),I=d.createContext({getState:function(){return{routes:[]}},subscribe:function(){},dispatch:function(){}}),M=function(r,t){return t?t.type==="ASIDE_MINIMIZE"?l()(l()({},r),{},{aside:l()(l()({},r.aside),{},{minimize:!!t.payload})}):t.type==="ASIDE_WIDTH"?l()(l()({},r),{},{aside:l()(l()({},r.aside),{},{width:t.payload})}):t.type==="ASIDE_COLLAPSIBLE"?l()(l()({},r),{},{aside:l()(l()({},r.aside),{},{collapsible:t.payload})}):r:r},W=function(r){return l()({},r)};function v(o){var r=(0,d.useReducer)(M,o,W),t=p()(r,2),i=t[0],h=t[1],S=(0,d.useState)([]),g=p()(S,1),b=g[0],x=function(B){return function(){var a=b.indexOf(B);a>-1&&b.splice(a,1)}},m=(0,d.useCallback)(function(f){return b.unshift(f),x(f)},[b]),c=(0,d.useCallback)(function(){b.forEach(function(f){return f()})},[b]),u={getState:function(){return i},dispatch:h,subscribe:m},C=(0,d.useState)(u),T=p()(C,1),P=T[0];return(0,d.useEffect)(function(){P.getState=function(){return i},c()},[i]),P}var D=function(r,t){return r===t};function n(){var o=(0,d.useContext)(I),r=(0,d.useRef)({aside:{get state(){return o.getState().aside},width:function(i){o.dispatch({type:"ASIDE_WIDTH",payload:i})},minimize:function(i){o.dispatch({type:"ASIDE_MINIMIZE",payload:i})},collapsible:function(i){o.dispatch({type:"ASIDE_COLLAPSIBLE",payload:i})}}});return r.current}function N(o){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:D,t=(0,d.useContext)(I),i=(0,d.useReducer)(function(m){return m+1},0),h=p()(i,2),S=h[1],g=(0,d.useRef)(),b=o(t.getState());function x(){var m=o(t.getState());r(m,g.current)||(g.current=m,S())}return(0,d.useEffect)(function(){return t.subscribe(x)},[]),b}function w(o){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:D;return N(o,r)}function K(){var o=useContext(I);return o.dispatch}function R(o){var r=o.children,t=o.state,i=v(t);return(0,d.useMemo)(function(){return(0,A.jsx)(I.Provider,{value:i,children:r})},[r,i])}},52680:function(H,z,e){e.d(z,{v7:function(){return x},_$:function(){return r},F6:function(){return w}});var Q=e(97857),p=e.n(Q),y=e(68400),l=e.n(y),d=e(75063),A=e(37887),I=e(73359),M,W,v,D,n={},N=(0,d.Ps)(M||(M=l()([`
    query websites {
  websites {
    id
    name
    description
  }
}
    `])));function w(c){var u=p()(p()({},n),c);return A.a(N,u)}function K(c){var u=_objectSpread(_objectSpread({},n),c);return Apollo.useLazyQuery(N,u)}function R(c){var u=_objectSpread(_objectSpread({},n),c);return Apollo.useSuspenseQuery(N,u)}var o=(0,d.Ps)(W||(W=l()([`
    query website($id: ID!) {
  website(id: $id) {
    id
    name
    description
    channel {
      id
    }
    application {
      id
    }
  }
}
    `])));function r(c){var u=p()(p()({},n),c);return A.a(o,u)}function t(c){var u=_objectSpread(_objectSpread({},n),c);return Apollo.useLazyQuery(o,u)}function i(c){var u=_objectSpread(_objectSpread({},n),c);return Apollo.useSuspenseQuery(o,u)}var h=(0,d.Ps)(v||(v=l()([`
    mutation createWebsite($input: WebsiteCreateInput!) {
  createWebsite(input: $input) {
    id
    name
  }
}
    `])));function S(c){var u=_objectSpread(_objectSpread({},n),c);return Apollo.useMutation(h,u)}var g=(0,d.Ps)(D||(D=l()([`
    query websiteArticleCategories($id: ID!) {
  categories: articleCategories(where: {parent: {id: $id, subColumns: true}}) {
    id
    icon
    name
    fullName
    path
    index
    level
    image
    storeTemplate {
      id
    }
    parent {
      id
    }
  }
}
    `])));function b(c){var u=_objectSpread(_objectSpread({},n),c);return Apollo.useQuery(g,u)}function x(c){var u=p()(p()({},n),c);return I.t(g,u)}function m(c){var u=_objectSpread(_objectSpread({},n),c);return Apollo.useSuspenseQuery(g,u)}},22294:function(H,z,e){e.r(z),e.d(z,{default:function(){return r}});var Q=e(5574),p=e.n(Q),y=e(62435),l=e(96974),d=e(51253),A=e(97857),I=e.n(A),M=e(39711),W=e(46027),v=e(10811),D=e(12708),n=e(86074);function N(t,i){return t.children&&t.children.length?(0,n.jsx)(v.Menu.SubMenu,{url:"/websites/".concat(i,"/cms/categories/").concat(t.id,"/articles"),bullet:!0,icon:t.icon,title:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:"flex-row-fluid",children:t.name}),(0,n.jsx)(v.Tooltip,{title:"\u680F\u76EE\u8BBE\u7F6E",children:(0,n.jsx)("div",{children:(0,n.jsx)(M.rU,{onClick:function(S){return S.stopPropagation()},className:"category-setting me-2 text-primary",to:"/websites/".concat(i,"/cms/categories/").concat(t.id),children:(0,n.jsx)(W.JO,{name:"Bootstrap/gear",className:"svg-icon-primary"})})})})]}),children:(t.children||[]).map(function(h){return N(h,i)})},"category_".concat(t.id)):(0,n.jsx)(v.Menu.Item,{url:"/websites/".concat(i,"/cms/categories/").concat(t.id,"/articles"),bullet:!0,icon:t.icon,title:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:"flex-row-fluid",children:t.name}),(0,n.jsx)(v.Tooltip,{title:"\u680F\u76EE\u8BBE\u7F6E",children:(0,n.jsx)(M.rU,{onClick:function(S){return S.stopPropagation()},className:"category-setting me-4 text-primary",to:"/websites/".concat(i,"/cms/categories/").concat(t.id),children:(0,n.jsx)(W.JO,{name:"Bootstrap/gear",className:"svg-icon-primary"})})})]})},"category_".concat(t.id))}function w(t){var i=t.id,h=t.location,S=t.loading,g=t.website,b=(0,l.s0)(),x=(0,y.useMemo)(function(){return(0,D.G_)(t.categories.map(function(s){return I()({},s)}),{idKey:"id",childrenKey:"children",pidKey:"parent.id",sort:function(O,F){return O.index-F.index}})},[t.categories]),m=(0,y.useMemo)(function(){var s=(0,l.LX)("/websites/:sid/cms/categories/:cid",h.pathname);if(s)return"category_".concat(s.params.cid);var O=(0,l.LX)("/websites/:sid/files",h.pathname);return O?"files":"my-drive"},[h.pathname]),c=(0,y.useState)(m),u=p()(c,2),C=u[0],T=u[1],P=(0,y.useState)(x.map(function(s){return s.id})),f=p()(P,2),B=f[0],a=f[1];(0,y.useEffect)(function(){m&&T(m)},[m]);var j=(0,y.useCallback)(function(s){console.log("selectedKey",s.key),T(s.key)},[]),E=(0,y.useCallback)(function(){var s;C.startsWith("category_")&&(s=C.split("_")[1]),b("/websites/".concat(i,"/cms/categories/new")+(s?"?parent_category_id=".concat(s):""))},[history,i,C]),L=(0,y.useCallback)(function(s){a(s)},[]);return(0,y.useEffect)(function(){a(x.map(function(s){return"category_".concat(s.id)}))},[x.map(function(s){return s.id}).join(",")]),(0,n.jsxs)(v.BlockUI,{zIndex:10,className:"my-5 p-5",overlayClassName:"bg-white bg-opacity-25",loading:!1,children:[(0,n.jsx)("div",{children:(0,n.jsx)("h1",{className:"text-gray-800 fw-bold mx-5",children:(g==null?void 0:g.name)||" "})}),(0,n.jsxs)(v.Menu,{fit:!0,accordion:!1,selectable:"AllMenu",className:"menu-title-gray-600 menu-icon-gray-400 menu-state-primary menu-state-icon-primary menu-state-bullet-primary menu-arrow-gray-500 fw-bold fs-6 px-6 my-5 my-lg-0",selectedKeys:C?[C]:[],onSelect:j,openKeys:B,onOpenChange:L,children:[(0,n.jsxs)(v.Menu.Section,{className:"pt-8 pb-0 flex-row-fluid align-items-center",contentClassName:"d-flex flex-row-fluid",sectionClassName:"d-flex flex-row-fluid",children:[(0,n.jsxs)("span",{className:"text-muted text-uppercase fs-8 ls-1 align-items-center d-flex flex-row-fluid",children:["\u680F\u76EE ",S&&" - loading..."]}),(0,n.jsx)(v.Button,{icon:(0,n.jsx)(W.JO,{style:{marginRight:".2rem"},name:"Duotune/arr087",className:""}),size:"sm",variant:"white",className:"py-1 px-3 me-n4",onClick:E,children:"\u65B0\u589E"})]}),x.map(function(s){return N(s,i)}),(0,n.jsx)(v.Menu.Section,{children:"\u8BBE\u7F6E"}),(0,n.jsx)(v.Menu.Item,{bullet:!0,icon:"",title:"\u901A\u7528\u8BBE\u7F6E",url:"/websites/".concat(i,"/settings/general")},"settings_general"),(0,n.jsx)(v.Menu.Item,{bullet:!0,icon:"",title:"\u6587\u4EF6\u7BA1\u7406",url:"/websites/".concat(i,"/files")},"files"),(0,n.jsx)(v.Menu.Item,{bullet:!0,icon:"",title:"\u5BFC\u822A\u83DC\u5355",url:"/websites/".concat(i,"/settings/navigation")},"settings_navigation")]})]})}var K=w,R=e(52680);function o(){var t=(0,l.UO)(),i=t.sid,h=(0,l.TH)(),S=(0,R._$)({fetchPolicy:"cache-and-network",variables:{id:i}}),g=S.data,b=S.loading,x=g==null?void 0:g.website,m=x==null?void 0:x.channel.id,c=(0,R.v7)({fetchPolicy:"cache-and-network"}),u=p()(c,2),C=u[0],T=u[1],P=T.data,f=P===void 0?{categories:[]}:P,B=T.loading,a=(0,y.useMemo)(function(){return!(f!=null&&f.categories)||!f.categories.length?[]:f.categories},[f==null?void 0:f.categories]);return(0,y.useEffect)(function(){m&&C({variables:{id:m}})},[C,m]),(0,n.jsxs)(d.Hk,{className:"micro-app-website",children:[(0,n.jsx)(d.Hk.Sidebar,{children:(0,n.jsx)(K,{website:x,categories:a,location:h,id:i,loading:b||B})}),m&&!B&&(0,n.jsx)(l.j3,{context:{rootCategoryId:m,categories:a,baseUrl:"/websites/"+i}})]})}var r=o}}]);

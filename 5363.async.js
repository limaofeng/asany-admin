"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[5363,1201],{51253:function(G,P,t){t.d(P,{GP:function(){return h.Z},Hk:function(){return Z},xx:function(){return b.x}});var K=t(74958),h=t(5166),b=t(19260),s=t(68400),d=t.n(s),A=t(62435),N=t(93967),M=t.n(N),L=t(94589),v=t(97857),D=t.n(v),n=t(46027),w=t(10582),B=t(42687),F=t(79817),R=t(5574),o=t.n(R),u=t(96486),e=t(86074),a={aside:{minimize:!1,width:280}},g=A.createContext({state:a,dispatch:function(){}}),x=function(r){return r.AsideToggle="ASIDE_TOGGLE",r.AsideWidth="ASIDE_WIDTH",r}({});function y(r,j){switch(j.type){case"ASIDE_TOGGLE":return r.aside.minimize=!r.aside.minimize,D()({},r);case"ASIDE_WIDTH":return r.aside.width=j.payload,D()({},r);default:throw new Error}}var S=function(j){var i=(0,A.useReducer)(y,(0,u.cloneDeep)(a)),E=o()(i,2),I=E[0],Q=E[1];return(0,e.jsx)(g.Provider,{value:{state:I,dispatch:Q},children:j.children})},p=function(){return(0,A.useContext)(g)},m=t(65495);function l(r){var j=p(),i=j.dispatch,E=j.state.aside.minimize,I=(0,A.useCallback)(function(){i({type:x.AsideToggle})},[i]);return(0,e.jsx)(F.Button,{style:D()({marginBottom:"1.35rem",zIndex:105},r.style),onClick:I,activeColor:"primary",className:M()("micro-app-aside-toggle","btn-icon bg-body btn-color-gray-700 rounded-2 position-absolute translate-middle bottom-0 shadow-sm d-none d-lg-flex",r.className,{active:E}),children:(0,e.jsx)(n.JO,{name:"Duotune/arr063",className:"svg-icon-2 rotate-180"})})}var c={"drawer drawer-start":{maxWidth:992}};function C(r){var j=r.className,i=r.header,E=r.children,I=r.collapsible,Q=I===void 0?!0:I,$=r.width,U=$===void 0?280:$,H=(0,B.$Y)(),X=p(),J=X.dispatch;(0,A.useEffect)(function(){H.aside.width(U+100),J({type:x.AsideWidth,payload:U})},[H.aside,J,U]);var Y=(0,w.CN)(c),V=(0,B.BK)(function(_){return _.aside.drawer});return(0,e.jsxs)("div",{className:M()("app-aside aside",j,Y,{"drawer-on":V}),children:[(0,e.jsx)(m.Z,{children:(0,e.jsx)(h.Z,{header:i,resizeable:!0,className:"app-sidebar",children:E})}),Q&&(0,e.jsx)(l,{className:"start-100 end-0"})]})}C.Toggle=l;var T=C,O,f=L.ZP.div(O||(O=d()([`
  --root-aside-width: `,`;
  --met-aside-width: `,`;
`])),function(r){return r.minimize?"100px":"".concat(r.width,"px")},function(r){return r.minimize?"100px":"".concat(r.width,"px")});function z(r){var j=r.children,i=r.className,E=p(),I=E.state.aside,Q=I.minimize,$=I.width,U=(0,A.useCallback)(function(H){H.preventDefault()},[]);return(0,e.jsx)(f,{minimize:Q,width:$,className:M()("micro-app-container page-full-content",i,{"aside-minimize":Q}),onContextMenu:U,children:j})}function W(r){var j=r.children,i=r.className;return(0,e.jsx)(S,{children:(0,e.jsx)(z,{className:i,children:j})})}W.Sidebar=T;var Z=W},42687:function(G,P,t){t.d(P,{$Y:function(){return n},BK:function(){return B},aM:function(){return R}});var K=t(5574),h=t.n(K),b=t(97857),s=t.n(b),d=t(62435),A=t(86074),N=d.createContext({getState:function(){return{routes:[]}},subscribe:function(){},dispatch:function(){}}),M=function(u,e){return e?e.type==="ASIDE_MINIMIZE"?s()(s()({},u),{},{aside:s()(s()({},u.aside),{},{minimize:!!e.payload})}):e.type==="ASIDE_WIDTH"?s()(s()({},u),{},{aside:s()(s()({},u.aside),{},{width:e.payload})}):e.type==="ASIDE_COLLAPSIBLE"?s()(s()({},u),{},{aside:s()(s()({},u.aside),{},{collapsible:e.payload})}):e.type==="ASIDE_DRAWER"?s()(s()({},u),{},{aside:s()(s()({},u.aside),{},{drawer:e.payload})}):u:u},L=function(u){return s()({},u)};function v(o){var u=(0,d.useReducer)(M,o,L),e=h()(u,2),a=e[0],g=e[1],x=(0,d.useState)([]),y=h()(x,1),S=y[0],p=function(z){return function(){var W=S.indexOf(z);W>-1&&S.splice(W,1)}},m=(0,d.useCallback)(function(f){return S.unshift(f),p(f)},[S]),l=(0,d.useCallback)(function(){S.forEach(function(f){return f()})},[S]),c={getState:function(){return a},dispatch:g,subscribe:m},C=(0,d.useState)(c),T=h()(C,1),O=T[0];return(0,d.useEffect)(function(){O.getState=function(){return a},l()},[a]),O}var D=function(u,e){return u===e};function n(){var o=(0,d.useContext)(N),u=(0,d.useRef)({aside:{get state(){return o.getState().aside},width:function(a){o.dispatch({type:"ASIDE_WIDTH",payload:a})},minimize:function(a){o.dispatch({type:"ASIDE_MINIMIZE",payload:a})},collapsible:function(a){o.dispatch({type:"ASIDE_COLLAPSIBLE",payload:a})},drawer:function(a){o.dispatch({type:"ASIDE_DRAWER",payload:a})}}});return u.current}function w(o){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:D,e=(0,d.useContext)(N),a=(0,d.useReducer)(function(m){return m+1},0),g=h()(a,2),x=g[1],y=(0,d.useRef)(),S=o(e.getState());function p(){var m=o(e.getState());u(m,y.current)||(y.current=m,x())}return(0,d.useEffect)(function(){return e.subscribe(p)},[]),S}function B(o){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:D;return w(o,u)}function F(){var o=useContext(N);return o.dispatch}function R(o){var u=o.children,e=o.state,a=v(e);return(0,d.useMemo)(function(){return(0,A.jsx)(N.Provider,{value:a,children:u})},[u,a])}},52680:function(G,P,t){t.d(P,{v7:function(){return p},_$:function(){return u},F6:function(){return B}});var K=t(97857),h=t.n(K),b=t(68400),s=t.n(b),d=t(75063),A=t(37887),N=t(73359),M,L,v,D,n={},w=(0,d.Ps)(M||(M=s()([`
    query websites {
  websites {
    id
    name
    description
  }
}
    `])));function B(l){var c=h()(h()({},n),l);return A.a(w,c)}function F(l){var c=_objectSpread(_objectSpread({},n),l);return Apollo.useLazyQuery(w,c)}function R(l){var c=_objectSpread(_objectSpread({},n),l);return Apollo.useSuspenseQuery(w,c)}var o=(0,d.Ps)(L||(L=s()([`
    query website($id: ID!) {
  website(id: $id) {
    id
    name
    description
    channel {
      id
    }
    application {
      id
    }
  }
}
    `])));function u(l){var c=h()(h()({},n),l);return A.a(o,c)}function e(l){var c=_objectSpread(_objectSpread({},n),l);return Apollo.useLazyQuery(o,c)}function a(l){var c=_objectSpread(_objectSpread({},n),l);return Apollo.useSuspenseQuery(o,c)}var g=(0,d.Ps)(v||(v=s()([`
    mutation createWebsite($input: WebsiteCreateInput!) {
  createWebsite(input: $input) {
    id
    name
  }
}
    `])));function x(l){var c=_objectSpread(_objectSpread({},n),l);return Apollo.useMutation(g,c)}var y=(0,d.Ps)(D||(D=s()([`
    query websiteArticleCategories($id: ID!) {
  categories: articleCategories(where: {parent: {id: $id, subColumns: true}}) {
    id
    icon
    name
    fullName
    path
    index
    level
    image
    storeTemplate {
      id
    }
    parent {
      id
    }
  }
}
    `])));function S(l){var c=_objectSpread(_objectSpread({},n),l);return Apollo.useQuery(y,c)}function p(l){var c=h()(h()({},n),l);return N.t(y,c)}function m(l){var c=_objectSpread(_objectSpread({},n),l);return Apollo.useSuspenseQuery(y,c)}},22294:function(G,P,t){t.r(P),t.d(P,{default:function(){return u}});var K=t(5574),h=t.n(K),b=t(62435),s=t(96974),d=t(51253),A=t(97857),N=t.n(A),M=t(39711),L=t(46027),v=t(79817),D=t(12708),n=t(86074);function w(e,a){return e.children&&e.children.length?(0,n.jsx)(v.Menu.SubMenu,{url:"/websites/".concat(a,"/cms/categories/").concat(e.id,"/articles"),bullet:!0,icon:e.icon,title:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:"flex-row-fluid",children:e.name}),(0,n.jsx)(v.Tooltip,{title:"\u680F\u76EE\u8BBE\u7F6E",children:(0,n.jsx)("div",{children:(0,n.jsx)(M.rU,{onClick:function(x){return x.stopPropagation()},className:"category-setting me-2 text-primary",to:"/websites/".concat(a,"/cms/categories/").concat(e.id),children:(0,n.jsx)(L.JO,{name:"Bootstrap/gear",className:"svg-icon-primary"})})})})]}),children:(e.children||[]).map(function(g){return w(g,a)})},"category_".concat(e.id)):(0,n.jsx)(v.Menu.Item,{url:"/websites/".concat(a,"/cms/categories/").concat(e.id,"/articles"),bullet:!0,icon:e.icon,title:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:"flex-row-fluid",children:e.name}),(0,n.jsx)(v.Tooltip,{title:"\u680F\u76EE\u8BBE\u7F6E",children:(0,n.jsx)(M.rU,{onClick:function(x){return x.stopPropagation()},className:"category-setting me-4 text-primary",to:"/websites/".concat(a,"/cms/categories/").concat(e.id),children:(0,n.jsx)(L.JO,{name:"Bootstrap/gear",className:"svg-icon-primary"})})})]})},"category_".concat(e.id))}function B(e){var a=e.id,g=e.location,x=e.loading,y=e.website,S=(0,s.s0)(),p=(0,b.useMemo)(function(){return(0,D.G_)(e.categories.map(function(i){return N()({},i)}),{idKey:"id",childrenKey:"children",pidKey:"parent.id",sort:function(E,I){return E.index-I.index}})},[e.categories]),m=(0,b.useMemo)(function(){var i=(0,s.LX)("/websites/:sid/cms/categories/:cid",g.pathname);if(i)return"category_".concat(i.params.cid);var E=(0,s.LX)("/websites/:sid/files",g.pathname);return E?"files":"my-drive"},[g.pathname]),l=(0,b.useState)(m),c=h()(l,2),C=c[0],T=c[1],O=(0,b.useState)(p.map(function(i){return i.id})),f=h()(O,2),z=f[0],W=f[1];(0,b.useEffect)(function(){m&&T(m)},[m]);var Z=(0,b.useCallback)(function(i){console.log("selectedKey",i.key),T(i.key)},[]),r=(0,b.useCallback)(function(){var i;C.startsWith("category_")&&(i=C.split("_")[1]),S("/websites/".concat(a,"/cms/categories/new")+(i?"?parent_category_id=".concat(i):""))},[history,a,C]),j=(0,b.useCallback)(function(i){W(i)},[]);return(0,b.useEffect)(function(){W(p.map(function(i){return"category_".concat(i.id)}))},[p.map(function(i){return i.id}).join(",")]),(0,n.jsxs)(v.BlockUI,{zIndex:10,className:"my-5 p-5",overlayClassName:"bg-white bg-opacity-25",loading:!1,children:[(0,n.jsx)("div",{children:(0,n.jsx)("h1",{className:"text-gray-800 fw-bold mx-5",children:(y==null?void 0:y.name)||" "})}),(0,n.jsxs)(v.Menu,{fit:!0,accordion:!1,selectable:"AllMenu",className:"menu-title-gray-600 menu-icon-gray-400 menu-state-primary menu-state-icon-primary menu-state-bullet-primary menu-arrow-gray-500 fw-bold fs-6 px-6 my-5 my-lg-0",selectedKeys:C?[C]:[],onSelect:Z,openKeys:z,onOpenChange:j,children:[(0,n.jsxs)(v.Menu.Section,{className:"pt-8 pb-0 flex-row-fluid align-items-center",contentClassName:"d-flex flex-row-fluid",sectionClassName:"d-flex flex-row-fluid",children:[(0,n.jsxs)("span",{className:"text-muted text-uppercase fs-8 ls-1 align-items-center d-flex flex-row-fluid",children:["\u680F\u76EE ",x&&" - loading..."]}),(0,n.jsx)(v.Button,{icon:(0,n.jsx)(L.JO,{style:{marginRight:".2rem"},name:"Duotune/arr087",className:""}),size:"sm",variant:"white",className:"py-1 px-3 me-n4",onClick:r,children:"\u65B0\u589E"})]}),p.map(function(i){return w(i,a)}),(0,n.jsx)(v.Menu.Section,{children:"\u8BBE\u7F6E"}),(0,n.jsx)(v.Menu.Item,{bullet:!0,icon:"",title:"\u901A\u7528\u8BBE\u7F6E",url:"/websites/".concat(a,"/settings/general")},"settings_general"),(0,n.jsx)(v.Menu.Item,{bullet:!0,icon:"",title:"\u6587\u4EF6\u7BA1\u7406",url:"/websites/".concat(a,"/files")},"files"),(0,n.jsx)(v.Menu.Item,{bullet:!0,icon:"",title:"\u5BFC\u822A\u83DC\u5355",url:"/websites/".concat(a,"/settings/navigation")},"settings_navigation")]})]})}var F=B,R=t(52680);function o(){var e=(0,s.UO)(),a=e.sid,g=(0,s.TH)(),x=(0,R._$)({fetchPolicy:"cache-and-network",variables:{id:a}}),y=x.data,S=x.loading,p=y==null?void 0:y.website,m=p==null?void 0:p.channel.id,l=(0,R.v7)({fetchPolicy:"cache-and-network"}),c=h()(l,2),C=c[0],T=c[1],O=T.data,f=O===void 0?{categories:[]}:O,z=T.loading,W=(0,b.useMemo)(function(){return!(f!=null&&f.categories)||!f.categories.length?[]:f.categories},[f==null?void 0:f.categories]);return(0,b.useEffect)(function(){m&&C({variables:{id:m}})},[C,m]),(0,n.jsxs)(d.Hk,{className:"micro-app-website",children:[(0,n.jsx)(d.Hk.Sidebar,{children:(0,n.jsx)(F,{website:p,categories:W,location:g,id:a,loading:S||z})}),m&&!z&&(0,n.jsx)(s.j3,{context:{rootCategoryId:m,categories:W,baseUrl:"/websites/"+a}})]})}var u=o}}]);

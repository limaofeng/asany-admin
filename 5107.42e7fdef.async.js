"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[5107],{46253:function(Ae,te,u){u.d(te,{f1:function(){return X},Nk:function(){return q},sW:function(){return ae},SP:function(){return n}});var c=u(97857),h=u.n(c),k=u(68400),Y=u.n(k),x=u(75063),ne=u(37887),C=u(50319),oe,re,J,g,D,L={},K=(0,x.Ps)(oe||(oe=Y()([`
    fragment ProcessModelPart on ProcessModel {
  id
  key
  name
  description
  version
  createdBy
  created
  lastUpdated
  lastUpdatedBy
}
    `]))),X=(0,x.Ps)(re||(re=Y()([`
    query processModels($where: ProcessModelWhereInput, $page: Int, $pageSize: Int, $orderBy: OrderBy) {
  total: processModels(pageSize: 1, where: {user: "self"}) {
    totalCount
  }
  processModels(
    where: $where
    page: $page
    pageSize: $pageSize
    orderBy: $orderBy
  ) {
    totalPage
    pageSize
    current: currentPage
    total: totalCount
    edges {
      node {
        ...ProcessModelPart
      }
    }
  }
}
    `,""])),K);function n(F){var B=h()(h()({},L),F);return ne.a(X,B)}function ye(F){var B=_objectSpread(_objectSpread({},L),F);return Apollo.useLazyQuery(X,B)}function pe(F){var B=_objectSpread(_objectSpread({},L),F);return Apollo.useSuspenseQuery(X,B)}var U=(0,x.Ps)(J||(J=Y()([`
    query processModel($id: ID!) {
  processModel(id: $id) {
    ...ProcessModelPart
    editorJson
  }
}
    `,""])),K);function ae(F){var B=h()(h()({},L),F);return ne.a(U,B)}function se(F){var B=_objectSpread(_objectSpread({},L),F);return Apollo.useLazyQuery(U,B)}function je(F){var B=_objectSpread(_objectSpread({},L),F);return Apollo.useSuspenseQuery(U,B)}var ie=(0,x.Ps)(g||(g=Y()([`
    mutation importProcessModel($file: Upload!) {
  importProcessModel(file: $file) {
    ...ProcessModelPart
  }
}
    `,""])),K);function le(F){var B=_objectSpread(_objectSpread({},L),F);return Apollo.useMutation(ie,B)}var ce=(0,x.Ps)(D||(D=Y()([`
    mutation deleteProcessModel($id: ID!) {
  deleteProcessModel(id: $id)
}
    `])));function q(F){var B=h()(h()({},L),F);return C.D(ce,B)}},35107:function(Ae,te,u){u.r(te),u.d(te,{default:function(){return en}});var c=u(62435),h=u(8032),k=u(35090),Y=u(97857),x=u.n(Y),ne=u(5574),C=u.n(ne),oe=u(17647),re=u(13769),J=u.n(re),g=u(67802),D=u(46027),L=u(4104);function K(){var e=(0,L.u)(),t=e.getNodes,o=e.setNodes,s=(0,c.useCallback)(function(a){var r=t();o(r.filter(function(i){return i.id!==a}))},[t,o]);return{removeNode:s}}var X=K,n=u(86074),ye=["data"];function pe(e){var t=e.data,o=J()(e,ye),s=X(),a=s.removeNode,r=(0,c.useCallback)(function(i){i.stopPropagation(),i.preventDefault(),a(o.id)},[o.id,a]);return(0,n.jsxs)("div",{className:"text-updater-node selectable",children:[(0,n.jsxs)("div",{className:"react-flow__node-header",children:[(0,n.jsx)("div",{className:"react-flow__node-icon",children:(0,n.jsx)(D.JO,{name:"Bootstrap/stop-circle"})}),(0,n.jsx)("div",{className:"react-flow__node-title",children:"\u7ED3\u675F"}),(0,n.jsx)("div",{onClick:r,className:"react-flow__node-header__delete",children:(0,n.jsx)(D.JO,{name:"Bootstrap/x"})})]}),(0,n.jsx)("div",{children:t.label}),(0,n.jsx)(h.HH,{type:"target",position:g.P.Top,id:"top"}),(0,n.jsx)(h.HH,{type:"source",position:g.P.Bottom,id:"bottom"}),(0,n.jsx)(h.HH,{type:"target",position:g.P.Left,id:"left"}),(0,n.jsx)(h.HH,{type:"target",position:g.P.Right,id:"right"})]})}pe.info={icon:"Bootstrap/stop-circle",type:"EndNoneEvent",name:"\u7ED3\u675F"};var U=pe;function ae(e){var t=e.data;return console.log("data",t),(0,n.jsxs)("div",{className:"inner-container",children:[(0,n.jsx)("div",{className:"shape-diamond react-flow__node-header",children:(0,n.jsx)("div",{children:(0,n.jsx)(D.JO,{name:"Bootstrap/plus"})})}),(0,n.jsx)(h.HH,{type:"target",position:g.P.Top,id:"top"}),(0,n.jsx)(h.HH,{type:"source",position:g.P.Bottom,id:"bottom"}),(0,n.jsx)(h.HH,{type:"source",position:g.P.Left,id:"left"}),(0,n.jsx)(h.HH,{type:"source",position:g.P.Right,id:"right"})]})}ae.info={icon:"Bootstrap/diamond",type:"ExclusiveGateway",name:"\u6392\u5B83\u7F51\u5173"};var se=ae,je=["data"];function ie(e){var t=e.data,o=J()(e,je),s=X(),a=s.removeNode,r=(0,c.useCallback)(function(i){i.stopPropagation(),i.preventDefault(),a(o.id)},[o.id,a]);return(0,n.jsxs)("div",{className:"text-updater-node selectable",children:[(0,n.jsxs)("div",{className:"react-flow__node-header",children:[(0,n.jsx)("div",{className:"react-flow__node-icon",children:(0,n.jsx)(D.JO,{name:"Bootstrap/filetype-java"})}),(0,n.jsx)("div",{className:"react-flow__node-title",children:"\u670D\u52A1\u4EFB\u52A1"}),(0,n.jsx)("div",{onClick:r,className:"react-flow__node-header__delete",children:(0,n.jsx)(D.JO,{name:"Bootstrap/x"})})]}),(0,n.jsx)("div",{children:t.label}),(0,n.jsx)(h.HH,{type:"target",position:g.P.Top,id:"top"}),(0,n.jsx)(h.HH,{type:"source",position:g.P.Bottom,id:"bottom"}),(0,n.jsx)(h.HH,{type:"source",position:g.P.Left,id:"left"}),(0,n.jsx)(h.HH,{type:"source",position:g.P.Right,id:"right"}),(0,n.jsx)("div",{className:"xxx",children:"123123"})]})}ie.info={icon:"Bootstrap/filetype-java",type:"ServiceTask",name:"\u670D\u52A1\u4EFB\u52A1"};var le=ie;function ce(e){var t,o=X(),s=o.removeNode,a=(0,c.useCallback)(function(r){r.stopPropagation(),r.preventDefault(),s(e.id)},[e.id,s]);return(0,n.jsxs)("div",{className:"text-updater-node selectable",children:[(0,n.jsxs)("div",{className:"react-flow__node-header",children:[(0,n.jsx)("div",{className:"react-flow__node-icon",children:(0,n.jsx)(D.JO,{name:"Bootstrap/play-fill"})}),(0,n.jsx)("div",{className:"react-flow__node-title",children:"\u5F00\u59CB"}),(0,n.jsx)("div",{onClick:a,className:"react-flow__node-header__delete",children:(0,n.jsx)(D.JO,{name:"Bootstrap/x"})})]}),(0,n.jsx)("div",{children:(t=e.data)===null||t===void 0?void 0:t.label}),(0,n.jsx)(h.HH,{type:"target",position:g.P.Top,id:"top"}),(0,n.jsx)(h.HH,{type:"source",position:g.P.Bottom,id:"bottom"}),(0,n.jsx)(h.HH,{type:"source",position:g.P.Left,id:"left"}),(0,n.jsx)(h.HH,{type:"source",position:g.P.Right,id:"right"})]})}ce.info={type:"StartNoneEvent",icon:"Bootstrap/play-fill",name:"\u5F00\u59CB"};var q=ce,F=["data"];function B(e){var t=e.data,o=J()(e,F),s=X(),a=s.removeNode,r=(0,c.useCallback)(function(i){i.stopPropagation(),i.preventDefault(),a(o.id)},[o.id,a]);return(0,n.jsxs)("div",{className:"text-updater-node selectable",children:[(0,n.jsx)(h.HH,{type:"target",position:g.P.Top}),(0,n.jsxs)("div",{className:"react-flow__node-header",children:[(0,n.jsx)("div",{className:"react-flow__node-icon",children:(0,n.jsx)(D.JO,{name:"Bootstrap/person-workspace"})}),(0,n.jsx)("div",{className:"react-flow__node-title",children:"\u5BA1\u6279"}),(0,n.jsx)("div",{onClick:r,className:"react-flow__node-header__delete",children:(0,n.jsx)(D.JO,{name:"Bootstrap/x"})})]}),(0,n.jsx)("div",{children:t.label}),(0,n.jsx)(h.HH,{type:"target",position:g.P.Top,id:"top"}),(0,n.jsx)(h.HH,{type:"source",position:g.P.Bottom,id:"bottom"}),(0,n.jsx)(h.HH,{type:"source",position:g.P.Left,id:"left"}),(0,n.jsx)(h.HH,{type:"source",position:g.P.Right,id:"right"})]})}B.info={icon:"Bootstrap/person-workspace",type:"UserTask",name:"\u7528\u6237\u4EFB\u52A1"};var he=B,Pe={StartNoneEvent:q,UserTask:he,ServiceTask:le,EndNoneEvent:U,ExclusiveGateway:se},Ce={simple:[q.info,U.info],classics:[q.info,U.info,he.info,le.info,se.info],quick:[he.info,le.info,se.info]},Xe=function(t){return c.createElement(Pe[t],{data:{label:"\u62D6\u62FD\u9884\u89C8"}})},Ne=Pe;function Qe(e,t){var o=Math.round(e/32)*32,s=Math.round(t/32)*32;return[o,s]}var ze={position:"fixed",pointerEvents:"none",zIndex:100,left:0,top:0,width:"100%",height:"100%"};function Ye(e,t,o){if(!e||!t)return{display:"none"};var s=t.x,a=t.y;if(o){s-=e.x,a-=e.y;var r=Qe(s,a),i=C()(r,2);s=i[0],a=i[1],s+=e.x,a+=e.y}var l="translate(".concat(s,"px, ").concat(a,"px)");return{transform:l,WebkitTransform:l}}function Ue(){var e=(0,oe.f)(function(r){return{item:r.getItem(),itemType:r.getItemType(),initialOffset:r.getInitialSourceClientOffset(),currentOffset:r.getSourceClientOffset(),isDragging:r.isDragging()}}),t=e.isDragging,o=e.itemType,s=e.initialOffset,a=e.currentOffset;return t?(0,n.jsx)("div",{style:ze,children:(0,n.jsx)("div",{className:"react-flow__node-".concat(o),style:x()({},Ye(s,a)),children:Xe(o)})}):null}var $e=Ue,We=u(5856),G=(0,c.createContext)({tools:{canUndo:!1,canRedo:!1,undo:function(){},redo:function(){},reset:function(){},resetInitialState:function(){},showQuickControls:function(){},hideQuickControls:function(){}},quickControls:{visible:!1},setState:function(){},state:{nodes:[],edges:[]}}),be=function(){var t=(0,c.useContext)(G);return[t.quickControls,{show:t.tools.showQuickControls,hide:t.tools.hideQuickControls}]},Ee=function(){var t=(0,c.useContext)(G);return[t.state,t.setState]},Je=function(){var t=(0,c.useContext)(G),o=t.state,s=t.setState,a=(0,h.Rr)(o.nodes),r=C()(a,3),i=r[0],l=r[1],d=r[2],f=(0,c.useRef)(o);f.current=o;var m=(0,c.useCallback)(function(p){if(typeof p=="function"){var N=p(f.current.nodes);s(x()(x()({},f.current),{},{nodes:N}))}else s(x()(x()({},f.current),{},{nodes:p}))},[s]);return(0,c.useLayoutEffect)(function(){l(o.nodes)},[o.nodes,l]),[i,m,d]},Ge=function(){var t=(0,c.useContext)(G),o=t.state,s=t.setState,a=(0,h.ll)(o.edges),r=C()(a,3),i=r[0],l=r[1],d=r[2],f=(0,c.useRef)(o);f.current=o;var m=(0,c.useCallback)(function(p){if(typeof p=="function"){var N=p(f.current.edges);s(x()(x()({},f.current),{},{edges:N}))}else s(x()(x()({},f.current),{},{edges:p}))},[s]);return(0,c.useLayoutEffect)(function(){l(o.edges)},[o.edges,l]),[i,m,d]},de=function(){var t=(0,c.useContext)(G);return t.tools},Ze=function(t){var o=t.children,s=(0,We.Z)({nodes:[],edges:[]},{behavior:"keepFuture"}),a=C()(s,3),r=a[0],i=a[1],l=a[2],d=l.undo,f=l.canUndo,m=l.redo,p=l.canRedo,N=l.reset,b=l.resetInitialState,E=(0,c.useState)({visible:!1,rect:void 0}),y=C()(E,2),w=y[0],T=y[1],v=(0,c.useCallback)(function(R,I){T({visible:!0,edgeId:R,rect:I})},[]),H=(0,c.useCallback)(function(){T({visible:!1})},[]);return(0,n.jsx)(G.Provider,{value:{state:r,setState:i,quickControls:w,tools:{undo:d,canRedo:p,redo:m,canUndo:f,reset:N,resetInitialState:b,showQuickControls:v,hideQuickControls:H}},children:o})},tn=u(38173),Se=u(98958),Ve=u(14313),we=u(47221),Ke=we.Z.Panel;function qe(e){var t=e.name,o=e.title,s=e.cover,a=e.createDragObject,r=a(e),i=(0,Se.c)({item:function(){return x()(x()({},r),{},{id:(0,k.DO)()})},type:r.type,collect:function(m){return{opacity:m.isDragging()?.4:1}}}),l=C()(i,2),d=l[1];return(0,n.jsxs)("li",{children:[(0,n.jsx)("div",{className:"component-icon",ref:d,children:(0,n.jsx)("img",{src:s,alt:o})}),(0,n.jsx)("div",{className:"component-info",children:o||t})]})}function _e(){var e=(0,k.NX)(function(l){return l.project.data.template}),t=(0,k.vQ)(e),o=(0,c.useState)(t.map(function(l){return l.title})),s=C()(o,2),a=s[0],r=s[1],i=(0,c.useCallback)(function(l){r(typeof l=="string"?[l]:l)},[]);return(0,c.useEffect)(function(){r(t.map(function(l){return l.title}))},[t.map(function(l){return l.title}).join(",")]),(0,n.jsx)("div",{className:"componet-list-wrap",children:(0,n.jsx)(we.Z,{bordered:!1,activeKey:a,expandIcon:function(d){var f=d.isActive;return(0,n.jsx)(Ve.Z,{rotate:f?90:0})},className:"site-collapse-compactness-collapse",onChange:i,children:t.map(function(l){return(0,n.jsx)(Ke,{header:l.title,children:(0,n.jsx)("ul",{className:"component-content show-list",children:l.components.map(function(d){return(0,n.jsx)(qe,x()(x()({},d),{},{createDragObject:l.createDragObject,type:l.type}),d.name)})})},l.title)})})})}var et=c.memo(_e),tt=u(18446),nt=u.n(tt);function ot(e){var t=e.onBack,o=(0,k.fQ)(function(r){return r.ui.toolbar.tools}),s=(0,k.NX)(function(r){return r.ui.toolbar.tools.reduce(function(i,l){return i[l.id]=l.useSelector&&l.useSelector(r),i},{})},nt()),a=(0,c.useCallback)(function(){return t&&t()},[t]);return(0,n.jsxs)("div",{className:"sunmao-navigation",children:[(0,n.jsxs)("div",{className:"navigation-left",children:[(0,n.jsx)(D.ZP,{name:"AsanyEditor/ToolbarBack",onClick:a,className:"back-icon toolbar-icon"}),(0,n.jsx)("span",{className:"title",children:"SUNMAO "})]}),(0,n.jsxs)("div",{className:"sunmao-navigation-container",children:[(0,n.jsx)("div",{className:"toolbar-center",children:o.filter(function(r){return r.position==="left"&&r.isVisibled(s[r.id])}).map(k.ei,s)}),(0,n.jsx)("div",{className:"toolbar-right",children:o.filter(function(r){return r.position==="right"&&r.isVisibled(s[r.id])}).map(k.ei,s)})]})]})}var rt=ot,at=u(49677),ke=u.n(at),st=u(93967),$=u.n(st),it=u(1861),lt=u(23295);function ct(e){var t=e.children,o=e.type,s=(0,c.useCallback)(function(d){d.dataTransfer.setData("application/reactflow",o),d.dataTransfer.effectAllowed="move"},[o]),a=(0,Se.c)({item:function(){return{type:o}},type:o,collect:function(f){return{opacity:f.isDragging()?.4:1}}}),r=C()(a,3),i=r[1],l=r[2];return l((0,lt.r)(),{captureDraggingState:!0}),(0,n.jsx)("div",{ref:i,className:"flow-node",onDragStart:s,draggable:!0,children:t})}var ue=ct,_=36,De=_+300;function dt(e){ke()(e);var t=(0,c.useState)(!1),o=C()(t,2),s=o[0],a=o[1],r=(0,c.useRef)({prevOutlinePaneHeight:De,outlinePaneHeight:De,outlinePaneExpanded:!0}),i=(0,c.useReducer)(function(v){return v+1},0),l=C()(i,2),d=l[1],f=(0,c.useCallback)(function(){r.current.outlinePaneExpanded=!r.current.outlinePaneExpanded,d()},[]),m=(0,c.useCallback)(function(){r.current.outlinePaneExpanded?r.current.prevOutlinePaneHeight=r.current.outlinePaneHeight:r.current.outlinePaneHeight=_,a(!0)},[]),p=(0,c.useCallback)(function(v){r.current.outlinePaneHeight+=v,r.current.outlinePaneExpanded=r.current.outlinePaneHeight>_,d()},[]),N=(0,c.useCallback)(function(){r.current.outlinePaneExpanded||(r.current.outlinePaneHeight=r.current.prevOutlinePaneHeight),a(!1)},[]),b=r.current,E=b.outlinePaneExpanded,y=b.outlinePaneHeight,w=window.innerHeight-50-40,T=Math.min(w,Math.max(y,_));return T=E?T:_,(0,n.jsxs)("div",{className:$()("sidebar-panel",{"resizer-y-active":s}),children:[(0,n.jsx)("div",{className:"sidebar-screen-panel",children:(0,n.jsxs)("div",{className:"sidebar-subpanel",children:[(0,n.jsxs)("div",{className:"sidebar-subpanel-header",children:[(0,n.jsx)("div",{className:"header-left",children:"\u57FA\u7840\u8282\u70B9"}),(0,n.jsx)("div",{className:"header-right"})]}),(0,n.jsx)(it.E,{options:{scrollbars:{autoHide:"scroll"}},style:{height:"calc(100% - 38px)"},children:(0,n.jsxs)("div",{style:{padding:"8px 8px 0 8px"},children:[(0,n.jsx)(ue,{type:"StartNoneEvent",children:"\u5F00\u59CB"}),(0,n.jsx)(ue,{type:"EndNoneEvent",children:"\u7ED3\u675F"}),(0,n.jsx)(ue,{type:"UserTask",children:"\u7528\u6237\u4EFB\u52A1"})]})})]})}),(0,n.jsxs)(k.w_,{className:"sidebar-subpanel",direction:"y",onResizeStart:m,onResize:p,onResizeEnd:N,style:{flexBasis:T},children:[(0,n.jsxs)("div",{className:"sidebar-subpanel-header",children:[(0,n.jsx)("div",{className:"header-left",children:"\u7ECF\u5178"}),(0,n.jsx)("div",{className:"header-right",children:(0,n.jsx)(D.ZP,{onClick:f,className:$()("header-icon",{expanded:E}),name:"AsanyEditor/Arrow"})})]}),(0,n.jsx)("div",{className:"sidebar-subpanel-body",children:(0,n.jsx)("div",{className:"sidebar-node-types-classics",children:Ce.classics.map(function(v){return(0,n.jsxs)(ue,{type:v.type,children:[(0,n.jsx)(D.ZP,{name:v.icon}),v.name]},v.type)})})})]})]})}var ut=dt,vt=function(e){return e.SET_ELEMENTS="FLOW_SET_ELEMENTS",e}({});function ft(e,t){return t.type===k.hA.PluginStateInit?{}:t.type===vt.SET_ELEMENTS?x()(x()({},e),t.payload):e}var gt=u(70681),He=u.n(gt),Z=new(He()).graphlib.Graph;Z.setDefaultEdgeLabel(function(){return{}});var pt=function(t,o){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"TB",a=s==="LR";return Z.setGraph({rankdir:s,ranksep:80}),t.forEach(function(r){Z.setNode(r.id,{width:r.width,height:r.height})}),o.forEach(function(r){Z.setEdge(r.source,r.target)}),He().layout(Z),t.forEach(function(r){var i=Z.node(r.id);r.targetPosition=a?g.P.Left:g.P.Top,r.sourcePosition=a?g.P.Right:g.P.Bottom;var l=i.width,d=i.height;return r.position={x:i.x-l/2,y:i.y-d/2},r}),{nodes:t,edges:o}};function Be(){var e=(0,L.u)(),t=e.getNodes,o=e.getEdges,s=Ee(),a=C()(s,2),r=a[1],i=(0,c.useCallback)(function(l){var d=t(),f=o();o();var m=pt(d,f,l),p=m.nodes,N=m.edges;r({nodes:p,edges:N})},[t,o,r]);return i}function ht(e){var t=e.className,o=e.disabled,s=e.active,a=e.style,r=e.children,i=Be(),l=(0,c.useCallback)(function(){i("TB")},[i]);return(0,n.jsx)("a",{onClick:l,className:$()("toolbar-icon",t,{disabled:o,active:s}),style:a,children:r})}function mt(e){var t=e.className,o=e.disabled,s=e.active,a=e.style,r=e.children,i=Be(),l=(0,c.useCallback)(function(){i("LR")},[i]);return(0,n.jsx)("a",{onClick:l,className:$()("toolbar-icon",t,{disabled:o,active:s}),style:a,children:r})}function xt(e){var t=e.className,o=e.style,s=e.children,a=de(),r=a.canUndo,i=a.undo;return(0,n.jsx)("a",{onClick:i,className:$()("toolbar-icon",t,{disabled:!r}),style:o,children:s})}function yt(e){var t=e.className,o=e.style,s=e.children,a=de(),r=a.canRedo,i=a.redo;return(0,n.jsx)("a",{onClick:i,className:$()("toolbar-icon",t,{disabled:!r}),style:o,children:s})}var jt=u(98169),Pt=u(56022),Ct=u(734),Nt=u(65362),bt=u(61254),Et=u(69293);function St(e){var t=(0,c.useRef)(null),o=(0,g.b)(function(y){return y.transform[2]}),s=be(),a=C()(s,2),r=a[0],i=r.visible,l=r.rect,d=a[1].hide,f=(0,L.u)(),m=f.project,p=e.flowContainer;(0,Et.Z)(t,function(){d()});var N=(0,c.useMemo)(function(){if(!i||!p.current||!t.current||!l)return{transform:"translate(0px, 0px)",opacity:0,pointerEvents:"unset"};var y=p.current.getBoundingClientRect(),w=y.top,T=y.left,v=t.current.getBoundingClientRect().height,H=l.x,R=l.y,I=l.width,A=l.height;if(o!==1){var M=o<1?100/o*(1-o)/100+1:100/o/100,W=m({x:H+I-T+10,y:R-w+A/2-v/2});return console.log("scale",o,M),{transform:"translate(".concat(W.x,"px, ").concat(W.y,"px) scale(").concat(M,")"),transformOrigin:"0 0"}}var V=m({x:H+I-T,y:R-w+A/2-v/2});return{transform:"translate(".concat(V.x,"px, ").concat(V.y,"px)")}},[p,m,l,i,o]),b=(0,n.jsxs)("div",{ref:t,className:"quick-controls",style:N,children:[(0,n.jsx)("div",{className:"quick-controls-arrow",children:(0,n.jsx)("span",{className:"quick-controls-arrow-content"})}),Ce.quick.map(function(y){return(0,n.jsxs)("div",{className:$()("flow-node-type","quick-controls__node-".concat(y.type)),children:[(0,n.jsx)("div",{className:"flow-node-type-icon",children:(0,n.jsx)(D.JO,{name:y.icon})}),(0,n.jsx)("div",{className:"flow-node-type-label",children:y.name})]},y.type)}),(0,n.jsx)("div",{className:"flow-node-type-separator"}),(0,n.jsxs)("div",{className:"flow-node-type",children:[(0,n.jsx)("div",{className:"flow-node-type-icon",children:(0,n.jsx)(D.JO,{name:"Bootstrap/gear"})}),(0,n.jsx)("div",{className:"flow-node-type-label",children:"\u8BBE\u7F6E"})]})]}),E=document.querySelector(".react-flow__viewport");return E?bt.createPortal(b,E):(0,n.jsx)(c.Fragment,{})}var wt=St;function kt(e,t){var o,s,a=(o=e[g.i])===null||o===void 0?void 0:o.handleBounds;if(!a)return[0,0];var r=a==null||(s=a.source)===null||s===void 0?void 0:s.find(function(p){return p.position===t});if(!r){var i;r=a==null||(i=a.target)===null||i===void 0?void 0:i.find(function(p){return p.position===t})}if(!r)return[0,0];var l=r.width/2,d=r.height/2,f=e.positionAbsolute.x+r.x+l,m=e.positionAbsolute.y+r.y+d;return[f,m]}function Te(e){return{x:e.positionAbsolute.x+e.width/2,y:e.positionAbsolute.y+e.height/2}}function Fe(e,t){var o=Te(e),s=Te(t),a=Math.abs(o.x-s.x),r=Math.abs(o.y-s.y),i;a>r?i=o.x>s.x?g.P.Left:g.P.Right:i=o.y>s.y?g.P.Top:g.P.Bottom;var l=kt(e,i),d=C()(l,2),f=d[0],m=d[1];return[f,m,i]}function Oe(e,t){var o=Fe(e,t),s=C()(o,3),a=s[0],r=s[1],i=s[2],l=Fe(t,e),d=C()(l,3),f=d[0],m=d[1],p=d[2];return{sourceX:a,sourceY:r,targetX:f,targetY:m,sourcePosition:i,targetPosition:p}}function Dt(e){var t=e.targetX,o=e.targetY,s=e.sourcePosition,a=e.targetPosition,r=e.sourceNode;if(!r)return null;var i={id:"connection-target",width:1,height:1,positionAbsolute:{x:t,y:o}},l=Oe(r,i),d=l.sourceX,f=l.sourceY,m=(0,h.OW)({sourceX:d,sourceY:f,sourcePosition:s,targetPosition:a,targetX:t,targetY:o});return(0,n.jsxs)("g",{children:[(0,n.jsx)("path",{fill:"none",stroke:"#222",strokeWidth:1.5,className:"animated",d:m}),(0,n.jsx)("circle",{cx:t,cy:o,fill:"#fff",r:3,stroke:"#222",strokeWidth:1.5})]})}var Ht=Dt;function Ie(e,t){var o=e.width,s=e.height,a=e.positionAbsolute,r=t.positionAbsolute,i=o/2,l=s/2,d=a.x+i,f=a.y+l,m=r.x+i,p=r.y+l,N=(m-d)/(2*i)-(p-f)/(2*l),b=(m-d)/(2*i)+(p-f)/(2*l),E=1/(Math.abs(N)+Math.abs(b)),y=E*N,w=E*b,T=i*(y+w)+d,v=l*(-y+w)+f;return{x:T,y:v}}function Me(e,t){var o=x()(x()({},e.positionAbsolute),e),s=Math.round(o.x),a=Math.round(o.y),r=Math.round(t.x),i=Math.round(t.y);return r<=s+1?g.P.Left:r>=s+o.width-1?g.P.Right:i<=a+1?g.P.Top:i>=o.y+o.height-1?g.P.Bottom:g.P.Top}function Bt(e,t){var o=Ie(e,t),s=Ie(t,e),a=Me(e,o),r=Me(t,s);return{sx:o.x,sy:o.y,tx:s.x,ty:s.y,sourcePos:a,targetPos:r}}function Tt(e){var t=e.id,o=e.source,s=e.target,a=e.markerEnd,r=e.style,i=(0,g.b)((0,c.useCallback)(function(w){return w.nodeInternals.get(o)},[o])),l=(0,g.b)((0,c.useCallback)(function(w){return w.nodeInternals.get(s)},[s]));if(!i||!l)return null;var d=Bt(i,l),f=d.sx,m=d.sy,p=d.tx,N=d.ty,b=d.sourcePos,E=d.targetPos,y=(0,h.OW)({sourceX:f,sourceY:m,sourcePosition:b,targetPosition:E,targetX:p,targetY:N});return(0,n.jsx)("g",{className:"react-flow__connection",children:(0,n.jsx)("path",{id:t,className:"react-flow__edge-path",d:y,markerEnd:a,style:r})})}var Ft=Tt,ve=40;function Ot(e){var t=e.id,o=e.source,s=e.target,a=e.markerEnd,r=e.style,i=(0,g.b)((0,c.useCallback)(function(O){return O.nodeInternals.get(o)},[o])),l=(0,g.b)((0,c.useCallback)(function(O){return O.nodeInternals.get(s)},[s])),d=(0,c.useRef)(null),f=(0,g.b)(function(O){return O.transform[2]}),m=be(),p=C()(m,2),N=p[0].edgeId,b=p[1].show,E=(0,c.useCallback)(function(O){O.preventDefault(),O.stopPropagation();var Q=d.current.getBoundingClientRect(),P=Q.x,j=Q.y,S=Q.width,z=Q.height;b(t,{x:P,y:j,width:S,height:z})},[t,b]);if((0,c.useEffect)(function(){if(N===t){var O=d.current.getBoundingClientRect(),Q=O.x,P=O.y,j=O.width,S=O.height;b(t,{x:Q,y:P,width:j,height:S})}},[N,t,b,f]),!i||!l)return null;var y=Oe(i,l),w=y.sourceX,T=y.sourceY,v=y.targetX,H=y.targetY,R=y.sourcePosition,I=y.targetPosition,A=(0,h.OW)({sourceX:w,sourceY:T,sourcePosition:R,targetPosition:I,targetX:v,targetY:H}),M=(0,h.Pp)({sourceX:w,sourceY:T,sourcePosition:R,targetPosition:I,targetX:v,targetY:H}),W=C()(M,2),V=W[0],me=W[1];return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{id:t,className:"react-flow__edge-path",d:A,markerEnd:a,style:r}),(0,n.jsx)("foreignObject",{width:ve,height:ve,x:V-ve/2,y:me-ve/2,className:"edgebutton-foreignobject",requiredExtensions:"http://www.w3.org/1999/xhtml",children:(0,n.jsx)("div",{className:"edge-container",onClick:E,children:(0,n.jsx)("button",{ref:d,type:"button",className:"edgebutton",children:(0,n.jsx)(D.JO,{name:"Bootstrap/plus"})})})})]})}var It=Ot,fe=40;function Mt(e){var t=e.id,o=e.sourceX,s=e.sourceY,a=e.targetX,r=e.targetY,i=e.sourcePosition,l=e.targetPosition,d=e.style,f=d===void 0?{}:d,m=e.markerEnd,p=(0,h.OW)({sourceX:o,sourceY:s,sourcePosition:i,targetX:a,targetY:r,targetPosition:l}),N=(0,h.Pp)({sourceX:o,sourceY:s,targetX:a,targetY:r}),b=C()(N,2),E=b[0],y=b[1];return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{id:t,style:f,className:"react-flow__edge-path",d:p,markerEnd:m}),(0,n.jsx)("foreignObject",{width:fe,height:fe,x:E-fe/2,y:y-fe/2,className:"edgebutton-foreignobject",requiredExtensions:"http://www.w3.org/1999/xhtml",children:(0,n.jsx)("div",{className:"edge-container",children:(0,n.jsx)("button",{type:"button",className:"edgebutton",children:(0,n.jsx)(D.JO,{name:"Bootstrap/plus"})})})})]})}var Rt={buttonedge:Mt,floating:Ft,simple_floating:It},Lt=0,At=function(){return"dndnode_".concat(Lt++)},Xt=function(t){var o=(0,c.useRef)(null),s=Je(),a=C()(s,3),r=a[0],i=a[1],l=a[2],d=Ge(),f=C()(d,3),m=f[0],p=f[1],N=f[2],b=(0,c.useState)(null),E=C()(b,2),y=E[0],w=E[1],T=de(),v=T.hideQuickControls,H=(0,c.useCallback)(function(P){P.source!==P.target&&p(function(j){return(0,g.c)(x()(x()({},P),{},{type:"simple_floating"}),j)})},[p]),R=(0,c.useCallback)(function(P){P.preventDefault(),P.dataTransfer.dropEffect="move"},[]),I=(0,jt.L)({accept:Object.keys(Ne),drop:function(j){return j},canDrop:function(j,S){return S.isOver({shallow:!0})},collect:function(j){return{isOver:j.isOver(),isOverCurrent:j.isOver({shallow:!0}),handlerId:j.getHandlerId()}}}),A=C()(I,2);ke()(A[0]);var M=A[1];M(o);var W=(0,c.useCallback)(function(P){var j;P.preventDefault();var S=(j=o.current)===null||j===void 0?void 0:j.getBoundingClientRect(),z=P.dataTransfer.getData("application/reactflow");if(!(typeof z=="undefined"||!z||!S)){var ee=y.project({x:P.clientX-S.left,y:P.clientY-S.top}),ge={id:At(),type:z,position:ee,data:{label:"".concat(z," node")}};i(function(xe){return xe.concat(ge)})}},[y,i]),V=(0,c.useCallback)(function(P,j,S){console.log(j,S),i(function(z){return z.map(function(ee){var ge=S.findIndex(function(xe){return xe.id===ee.id});return ge>-1?x()(x()({},ee),{},{position:S[ge].position}):ee})})},[i]),me=(0,c.useCallback)(function(P){var j=P.target.classList.contains("react-flow__pane");console.log("targetIsPane",j)},[]),O=t.onClick,Q=(0,c.useCallback)(function(P){var j=P.target.classList.contains("react-flow__pane");j&&(O(P),v())},[v,O]);return(0,n.jsx)("div",{className:"reactflow-wrapper",style:{height:"100%"},ref:o,children:(0,n.jsxs)(h.ZP,{nodes:r,edges:m,onClick:Q,onNodesChange:l,onEdgesChange:N,onEdgeClick:t.onEdgeClick,onNodeClick:t.onNodeClick,onNodesDelete:t.onNodesDelete,onEdgesDelete:t.onEdgesDelete,onNodeDragStop:V,onConnect:H,onConnectStop:me,onInit:w,onDrop:W,onDragOver:R,fitView:!0,attributionPosition:"top-right",proOptions:{account:"paid-pro",hideAttribution:!0},edgeTypes:Rt,nodeTypes:Ne,connectionLineComponent:Ht,children:[(0,n.jsx)(Pt.Z,{nodeStrokeColor:function(j){var S;return(S=j.style)!==null&&S!==void 0&&S.background?j.style.background:j.type==="StartNoneEvent"?"#0041d0":j.type==="EndNoneEvent"?"#ff0072":["UserTask","ExclusiveGateway"].includes(j.type)?"#1a192b":"#eee"},nodeColor:function(j){var S;return(S=j.style)!==null&&S!==void 0&&S.background?j.style.background:"#fff"},nodeBorderRadius:2}),(0,n.jsx)(Ct.i,{}),(0,n.jsx)(Nt.Z,{color:"#aaa",gap:16}),(0,n.jsx)(wt,{flowContainer:o})]})})},Qt=Xt,zt=u(64599),Yt=u.n(zt);function Re(e,t){var o;return(o=t.find(function(s){return s.outgoing.some(function(a){return a.resourceId===e})}))===null||o===void 0?void 0:o.resourceId}function Le(e){return e.target.resourceId}function Ut(e){var t={nodes:[],edges:[]},o=e.childShapes,s=o.filter(function(l){return l.stencil.id!=="SequenceFlow"}),a=Yt()(o),r;try{for(a.s();!(r=a.n()).done;){var i=r.value;i.stencil.id==="SequenceFlow"?(t.edges.push({id:i.resourceId,type:"simple_floating",source:Re(i.resourceId,s),target:Le(i),label:i.properties.name||"\u7EBF",markerEnd:{type:g.M.ArrowClosed}}),console.log(Re(i.resourceId,s),Le(i))):(t.nodes.push({id:i.resourceId,type:i.stencil.id,data:{label:i.properties.name},position:{x:i.bounds.upperLeft.x,y:i.bounds.upperLeft.y}}),console.log("shape",i.stencil.id,i.resourceId,i.properties.name))}}catch(l){a.e(l)}finally{a.f()}return t}var $t={title:"\u8282\u70B9\u8BBE\u7F6E",fields:[{label:" \u7F16\u7801",name:"id",type:"String"},{label:"\u540D\u79F0",name:"label",type:"String"},{label:"\u63CF\u8FF0",name:"documentation",type:"String",renderer:{component:"MultiLineText",props:{autoSize:{minRows:2,maxRows:4}}}}]},Wt={title:"\u6761\u4EF6\u8BBE\u7F6E",fields:[{label:" \u7F16\u7801",name:"id",type:"String"},{label:"\u540D\u79F0",name:"label",type:"String"},{label:"\u63CF\u8FF0",name:"documentation",type:"String",renderer:{component:"MultiLineText",props:{autoSize:{minRows:2,maxRows:4}}}}]};function Jt(){var e=(0,k.pn)(),t=(0,k.NX)(function(v){return v.ui.sidebar.width}),o=(0,k.NX)(function(v){return v.ui.sidebar.minWidth}),s=(0,k.NX)(function(v){return v.ui.sidebar.minimizable}),a=(0,c.useMemo)(function(){var v=t;return s?v=0:v=Math.max(o,v),v},[t,s,o]),r=Ee(),i=C()(r,2),l=i[1],d=de(),f=d.reset,m=d.resetInitialState,p=(0,k.NX)(function(v){var H;return(H=v.project.data)===null||H===void 0?void 0:H.editorJson});(0,c.useEffect)(function(){if(p){var v=Ut(JSON.parse(p));l(v),m(v),f(v)}},[p]);var N=(0,c.useCallback)(function(){e.aside.close()},[e.aside]),b=(0,c.useCallback)(function(v,H){v.preventDefault(),v.stopPropagation();var R=function(M){console.log("handleUpdate",M)};console.log("handleNodeClick",v,H);var I={label:H.data.label,id:H.id};e.aside.open({customizer:$t,value:I,update:R,watchValue:function(M){M(I)}},{width:280})},[e.aside]),E=(0,c.useCallback)(function(v,H){v.preventDefault(),v.stopPropagation();var R=function(M){console.log("handleUpdate",M)};console.log("handleNodeClick",v,H);var I={label:"1111"};e.aside.open({customizer:Wt,value:I,update:R,watchValue:function(M){M(I)}},{width:280})},[e.aside]),y=(0,c.useCallback)(function(){e.aside.close()},[e.aside]),w=(0,c.useCallback)(function(){e.aside.close()},[e.aside]),T=(0,k.NX)(function(v){return v.ui.sidebar.minimizable});return console.log("minimizable",T),(0,n.jsx)("div",{style:{height:"100%",width:"100%",marginLeft:a},children:(0,n.jsx)(Qt,{onClick:N,onNodeClick:b,onEdgeClick:E,onNodesDelete:y,onEdgesDelete:w})})}var Gt=c.memo(Jt),Zt=function(){return{id:"workflow",description:"",types:["flow"],toolbar:{content:rt,tools:[{id:"save",name:"\u4FDD\u5B58",position:"left",onClick:function(t){var o=t.state.project;console.log("onClick  project",o),t.save({})}}]},reducer:ft,sidebar:{minimizable:!1,content:function(){return(0,n.jsx)(ut,{})},tools:[{id:"components",icon:"AsanyEditor/LayoutGrid",name:"\u7EC4\u4EF6",position:"top",mutex:"left",onClick:function(t){return t.sidebar.open("components","\u7EC4\u4EF6",et)}},{id:"drag",name:"\u62D6\u62FD\u753B\u5E03",icon:"AsanyEditor/HandDrag",position:"top",useSelector:function(t){return t.features.drag},isSelected:function(t){return t},onClick:function(t){return t.features.drag(!0),function(){t.features.drag(!1)}}},{id:"selecto",name:"\u9009\u62E9",icon:"AsanyEditor/SelectFilled",position:"top",mutex:"icons-actions",useSelector:function(t){return t.features.selecto},isSelected:function(t){return t},onClick:function(t){return t.features.selecto(!0),function(){t.features.selecto(!1)}}}]},scena:{screen:"fullscreen",toolbar:{tools:[{id:"undo",icon:"Bootstrap/arrow-90deg-left",position:"left",render:function(t,o){return(0,n.jsx)(xt,x()(x()({},o),{},{item:t}))}},{id:"redo",icon:"Bootstrap/arrow-90deg-right",position:"left",render:function(t,o){return(0,n.jsx)(yt,x()(x()({},o),{},{item:t}))}},{id:"vertical-divider"},{id:"horizontal",name:"\u6C34\u5E73\u5BF9\u9F50",icon:"AsanyEditor/AlignHorizontalCenters",position:"left",render:function(t,o){return(0,n.jsx)(ht,x()(x()({},o),{},{item:t}))}},{id:"vertical-divider"},{id:"vertical",name:"\u5782\u76F4\u5BF9\u9F50",icon:"AsanyEditor/AlignVerticalCenters",position:"left",render:function(t,o){return(0,n.jsx)(mt,x()(x()({},o),{},{item:t}))}}]},workspace:Gt},features:[]}};function Vt(e){var t=(0,c.useRef)(null),o=e.loading,s=e.onBack,a=e.data,r=(0,c.useCallback)(function(){},[]),i=(0,c.useMemo)(function(){return a?{id:a.id,type:"flow",name:(a==null?void 0:a.name)||"",data:a}:{type:"flow"}},[a]);return(0,n.jsxs)(h.tV,{children:[(0,n.jsx)(k.lR,{children:(0,n.jsx)(k.lg,{container:Ze,ref:t,plugins:[Zt()],onSave:r,onBack:s,loading:o,className:"flow-editor",project:i})}),(0,n.jsx)($e,{})]})}var Kt=Vt,qt=u(46253);function _t(e){var t=e.match.params.id,o=e.history,s=(0,qt.sW)({variables:{id:t},fetchPolicy:"cache-and-network"}),a=s.data,r=s.loading,i=(0,c.useCallback)(function(){o.goBack()},[o]);return(0,n.jsx)(Kt,{onBack:i,loading:r,data:a==null?void 0:a.processModel})}var en=_t}}]);

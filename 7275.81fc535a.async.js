(self.webpackChunkasany_admin=self.webpackChunkasany_admin||[]).push([[7275],{37275:function(U,k,t){"use strict";t.r(k),t.d(k,{default:function(){return de}});var D=t(39428),M=t(3182),y=t(2824),m=t(67294),o=t(28865),E=t(94184),A=t.n(E),Y=t(1861),G=t(24561),Q=t(73727),K=t(51615),W=t(19755),V=t.n(W),q=t(30381),F=t.n(q),c=t(88403),i=t(74200),_=t(54108),e=t(85893),ee=i.mN.Avatar;function ae(d){var a=d.message,r=d.mailbox,s=(0,m.useState)(!0),h=(0,y.Z)(s,2),v=h[0],p=h[1],O=(0,m.useCallback)(function(C){!V()(C.target).hasClass("message-handover")||p(function(J){return!J})},[p]);return(0,e.jsxs)("div",{className:A()("message_wrapper",{shrink:!v}),children:[(0,e.jsxs)("div",{className:"d-flex flex-wrap gap-2 cursor-pointer message-handover",onClick:O,children:[(0,e.jsxs)("div",{className:"d-flex align-items-center message-handover",children:[(0,e.jsx)(ee,{alt:a==null?void 0:a.from.map(c.ss).join("\u3001"),src:"assets/media/avatars/300-6.jpg",size:50,labelClassName:"fs-2",className:"me-4"}),(0,e.jsxs)("div",{className:"pe-5",children:[(0,e.jsxs)("div",{className:"d-flex align-items-center flex-wrap gap-1",children:[(0,e.jsx)("a",{className:"fw-bolder text-dark text-hover-primary",children:a==null?void 0:a.from.map(c.ss).join("\u3001")}),(0,e.jsx)(o.JO,{className:"svg-icon-7 svg-icon-success mx-3",name:"Duotune/abs050"}),(0,e.jsx)("span",{className:"text-muted fw-bolder",children:a&&F()(a.date).fromNow()})]}),(0,e.jsx)(i.J2,{stopPropagation:!0,content:(0,e.jsx)("div",{className:"menu menu-column menu-rounded menu-gray-600 menu-state-bg-light-primary fw-bold fs-7","data-kt-menu":"true",children:(0,e.jsx)("table",{className:"table mb-0",children:(0,e.jsxs)("tbody",{children:[r!="sent"&&(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{className:"w-75px text-muted",children:"\u53D1\u4EF6\u4EBA"}),(0,e.jsx)("td",{children:a==null?void 0:a.from.join("\u3001")})]}),r!="inbox"&&(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{className:"w-75px text-muted",children:"\u6536\u4EF6\u4EBA"}),(0,e.jsx)("td",{children:a==null?void 0:a.to.join("\u3001")})]}),(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{className:"text-muted",children:"\u65F6\u95F4"}),(0,e.jsx)("td",{children:a&&F()(a.date).format("lll")})]}),(a==null?void 0:a.replyTo)&&(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{className:"text-muted",children:"\u56DE\u590D"}),(0,e.jsx)("td",{children:a.replyTo.map(c.ss).join("\u3001")})]})]})})}),placement:"bottom-start",children:(0,e.jsxs)("div",{className:A()("inbox-message-details",{"d-none":!v}),children:[(0,e.jsxs)("span",{className:"text-muted fw-bold",children:["\u53D1\u9001\u7ED9 ",r=="inbox"?"\u6211":a==null?void 0:a.to.map(c.ss).join("\u3001")]}),(0,e.jsx)("a",{className:"me-1","data-kt-menu-trigger":"click","data-kt-menu-placement":"bottom-start",children:(0,e.jsx)(o.JO,{className:"svg-icon-5 m-0",name:"Duotune/arr072"})})]})}),(0,e.jsx)("div",{className:A()("message_wrapper_preview-message message-handover text-muted fw-bold",{"d-none":v}),children:(a==null?void 0:a.mimeType)=="text/html"?(0,_.Kv)(a.body||""):a==null?void 0:a.body})]})]}),(0,e.jsxs)("div",{className:"message_wrapper_actions d-flex align-items-center flex-wrap gap-2",children:[(0,e.jsx)("span",{className:"mail-message-date fw-bold text-muted me-3",children:a&&F()(a.date).format("YYYY-MM-DD A HH:mm")}),(0,e.jsxs)("div",{className:"mail-message-actions d-flex",children:[(0,e.jsx)(i.u,{placement:"bottom",title:"\u6536\u85CF",children:(0,e.jsx)("a",{className:"btn btn-icon btn-clear btn-active-light-primary me-3",children:(0,e.jsx)(o.JO,{name:"Duotune/gen029",className:"svg-icon-2 m-0"})})}),(0,e.jsx)(i.u,{placement:"bottom",title:"\u8BBE\u7F6E\u4E3A\u91CD\u8981",children:(0,e.jsx)("a",{className:"btn btn-icon btn-clear btn-active-light-primary me-3",children:(0,e.jsx)(o.JO,{name:"Duotune/gen056",className:"svg-icon-2 m-0"})})}),(0,e.jsx)(i.u,{placement:"bottom",title:"\u56DE\u590D",children:(0,e.jsx)("a",{className:"btn btn-icon btn-clear btn-active-light-primary me-3",children:(0,e.jsx)(o.JO,{name:"Duotune/gen055",className:"svg-icon-2 m-0"})})}),(0,e.jsx)("a",{className:"btn btn-icon btn-clear btn-active-light-primary","data-bs-toggle":"tooltip","data-bs-placement":"top",title:"Settings",children:(0,e.jsx)(o.JO,{name:"Duotune/gen053",className:"svg-icon-2 m-0"})})]})]})]}),(0,e.jsx)("div",{className:A()("collapse fade",{show:v}),"data-kt-inbox-message":"message",children:(0,e.jsx)("div",{className:"py-5",dangerouslySetInnerHTML:{__html:(a==null?void 0:a.body)||""}})})]})}function se(d){var a=d.message,r=d.mailbox;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"d-flex flex-wrap gap-2 justify-content-between mb-8",children:[(0,e.jsx)("div",{className:"d-flex align-items-center flex-wrap gap-2",children:(0,e.jsx)("h2",{className:"fw-bold me-3 my-1",children:(a==null?void 0:a.subject)||"(\u65E0\u4E3B\u9898)"})}),(0,e.jsx)("div",{className:"d-flex",children:(0,e.jsx)(i.u,{placement:"bottom",title:"\u6253\u5370",children:(0,e.jsx)("a",{className:"btn btn-icon btn-light btn-active-light-primary me-2",children:(0,e.jsx)("i",{className:"bi bi-printer-fill fs-2"})})})})]}),(0,e.jsx)(ae,{message:a,mailbox:r}),(0,e.jsx)("div",{className:"separator my-6"})]})}var te=se,ne=t(54782),j=t(32669),ie=t(25496);function re(d){var a=d.message,r=d.onAction,s=(0,m.useCallback)(function(h){return function(){r(h)}},[r]);return(0,e.jsx)("div",{className:"d-flex",children:a&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(i.u,{placement:"bottom",title:"\u8FD4\u56DE",children:(0,e.jsx)(Q.Link,{className:"btn btn-icon btn-clear btn-active-light-primary me-3",to:"/mail/".concat(a.mailboxName.toLowerCase()),children:(0,e.jsx)(o.JO,{name:"Duotune/arr063",className:"svg-icon-1 m-0"})})}),![c.LJ.INBOX.id,c.LJ.Drafts.id].includes(a.mailboxName)&&c.LJ.INBOX.id==a.originalMailboxName&&(0,e.jsx)(i.u,{placement:"bottom",title:"\u6536\u4EF6\u7BB1",children:(0,e.jsx)("a",{onClick:s("inbox"),className:"btn btn-icon btn-light btn-active-light-primary me-2",children:(0,e.jsx)(o.JO,{name:c.LJ.INBOX.icon,className:"svg-icon-2 m-0"})})}),![c.LJ.Sent.id,c.LJ.Drafts.id].includes(a.mailboxName)&&c.LJ.Sent.id==a.originalMailboxName&&(0,e.jsx)(i.u,{placement:"bottom",title:"\u5DF2\u53D1\u9001",children:(0,e.jsx)("a",{onClick:s("sent"),className:"btn btn-icon btn-light btn-active-light-primary me-2",children:(0,e.jsx)(o.JO,{name:c.LJ.Sent.icon,className:"svg-icon-2 m-0"})})}),![c.LJ.Archive.id,c.LJ.Drafts.id,c.LJ.Trash.id].includes(a.mailboxName)&&(0,e.jsx)(i.u,{placement:"bottom",title:"\u5B58\u6863",children:(0,e.jsx)("a",{onClick:s("archive"),className:"btn btn-icon btn-light btn-active-light-primary me-2",children:(0,e.jsx)(o.JO,{name:c.LJ.Archive.icon,className:"svg-icon-2 m-0"})})}),![c.LJ.Spam.id,c.LJ.Drafts.id].includes(a.mailboxName)&&(0,e.jsx)(i.u,{placement:"bottom",title:"\u5783\u573E\u90AE\u4EF6",children:(0,e.jsx)("a",{onClick:s("spam"),className:"btn btn-icon btn-light btn-active-light-primary me-2",children:(0,e.jsx)(o.JO,{name:c.LJ.Spam.icon,className:"svg-icon-2 m-0"})})}),(0,e.jsx)(i.u,{placement:"bottom",title:"\u5220\u9664\u90AE\u4EF6",children:(0,e.jsx)("a",{onClick:s("deleted"),className:"btn btn-icon btn-light btn-active-light-primary me-2",children:(0,e.jsx)(o.JO,{name:"Duotune/gen027",className:"svg-icon-2 m-0"})})}),(0,e.jsx)(i.u,{placement:"bottom",title:a.seen?"\u6807\u8BB0\u4E3A\u672A\u8BFB":"\u6807\u8BB0\u4E3A\u5DF2\u8BFB",children:(0,e.jsx)("a",{onClick:s(a.seen?"unread":"read"),className:"btn btn-icon btn-light btn-active-light-primary me-2",children:(0,e.jsx)(o.JO,{name:a.seen?"Duotune/gen028":"Duotune/gen054",className:"svg-icon-2 m-0"})})})]})})}function le(d){var a=d.current,r=d.pagination,s=d.goto,h=(0,m.useCallback)(function(){s(Math.max(0,a-2))},[s,a]),v=(0,m.useCallback)(function(){s(Math.min(r.totalCount-1,a))},[a,s,r.totalCount]);return(0,e.jsxs)("div",{className:"d-flex align-items-center",children:[(0,e.jsxs)("span",{className:"fw-bold text-muted me-2",children:[a==0?"loading...":a," / ",r.totalCount]}),(0,e.jsx)(i.u,{placement:"bottom",title:"\u4E0A\u4E00\u5C01\u90AE\u4EF6",children:(0,e.jsx)(i.zx,{onClick:h,icon:(0,e.jsx)(o.JO,{name:"Duotune/arr074",className:"svg-icon-2 m-0"}),variant:"light",activeColor:"light-primary",className:"me-3",disabled:a==1})}),(0,e.jsx)(i.u,{placement:"bottom",title:"\u4E0B\u4E00\u5C01\u90AE\u4EF6",children:(0,e.jsx)(i.zx,{onClick:v,icon:(0,e.jsx)(o.JO,{name:"Duotune/arr071",className:"svg-icon-2 m-0"}),variant:"light",activeColor:"light-primary",className:"me-2",disabled:a==r.totalCount})})]})}function ce(){return(0,e.jsx)("div",{children:(0,e.jsxs)(G.ZP,{speed:2,width:"100%",height:500,viewBox:"0 0 926 500",backgroundColor:"#f3f3f3",foregroundColor:"#ecebeb",children:[(0,e.jsx)("rect",{x:"0",y:"0",rx:"3",ry:"3",width:"230",height:"34"}),(0,e.jsx)("rect",{x:"48",y:"26",rx:"3",ry:"3",width:"52",height:"6"}),(0,e.jsx)("rect",{x:"0",y:"60",rx:"3",ry:"3",width:"50",height:"50"}),(0,e.jsx)("rect",{x:"2",y:"126",rx:"4",ry:"4",width:"178",height:"20"}),(0,e.jsx)("rect",{x:"60",y:"65",rx:"0",ry:"0",width:"228",height:"13"}),(0,e.jsx)("rect",{x:"62",y:"88",rx:"0",ry:"0",width:"226",height:"18"}),(0,e.jsx)("rect",{x:"826",y:"83",rx:"0",ry:"0",width:"100",height:"23"}),(0,e.jsx)("rect",{x:"6",y:"158",rx:"0",ry:"0",width:"242",height:"17"}),(0,e.jsx)("rect",{x:"6",y:"190",rx:"0",ry:"0",width:"325",height:"14"}),(0,e.jsx)("rect",{x:"6",y:"220",rx:"0",ry:"0",width:"427",height:"20"}),(0,e.jsx)("rect",{x:"6",y:"255",rx:"0",ry:"0",width:"513",height:"15"})]})})}function oe(d){var a=d.match.params,r=a.folder,s=a.id,h=d.message,v=d.pagination,p=d.goto,O=d.activeIndex,C=d.refresh,J=(0,K.k6)(),me=(0,j.Pg)({fetchPolicy:"cache-and-network"}),P=(0,y.Z)(me,2),R=P[0],B=P[1],f=B.data,X=B.loading,S=B.error,ue=(0,j.Rh)({refetchQueries:[j.f_,j.Nd]}),xe=(0,y.Z)(ue,1),I=xe[0],he=(0,j.aB)({refetchQueries:[j.f_]}),ge=(0,y.Z)(he,1),z=ge[0],ve=(0,j.k0)({refetchQueries:[j.Nd]}),be=(0,y.Z)(ve,1),H=be[0],x=(0,m.useRef)({pagination:v,mailbox:r,activeIndex:O}),n=(0,m.useMemo)(function(){var u;return(f==null||(u=f.message)===null||u===void 0?void 0:u.id)==s?f==null?void 0:f.message:(h==null?void 0:h.id)==s?h:x.current.message},[s,f==null?void 0:f.message,h]);x.current.mailbox=r,x.current.message=n,x.current.pagination=v,x.current.activeIndex=O;var w=(0,m.useCallback)(function(){var u=x.current,N=u.mailbox,b=u.pagination,g=u.activeIndex;b.totalCount==0?J.push("/mail/".concat(N)):p(Math.min(g,b.totalCount-1))},[p,J]),Z=(0,m.useCallback)(function(){var u=(0,M.Z)((0,D.Z)().mark(function N(b){var g,T,L,$;return(0,D.Z)().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:g=x.current.message;case 1:if(((T=g)===null||T===void 0?void 0:T.index)!=null){l.next=7;break}return l.next=4,(0,ie._v)(60);case 4:g=x.current.message,l.next=1;break;case 7:if(!(b=="read"||b=="unread")){l.next=13;break}return l.next=10,z({variables:{id:s,flags:["seen"],mode:b=="unread"?"REMOVE":"ADD"}});case 10:L="updateFlags",l.next=34;break;case 13:if(b!="deleted"){l.next=30;break}if(!(r=="drafts"||r=="trash")){l.next=25;break}return l.next=17,i.u_.confirm({title:"\u8B66\u544A",content:r=="trash"?"\u786E\u5B9A\u6C38\u4E45\u5220\u9664\u4FE1\u606F\uFF1F":"\u786E\u5B9A\u6C38\u4E45\u5220\u9664\u8349\u7A3F\uFF1F"});case 17:if($=l.sent,$.isConfirmed){l.next=20;break}return l.abrupt("return");case 20:return l.next=22,H({variables:{id:s}});case 22:L="delete",l.next=28;break;case 25:return l.next=27,I({variables:{id:s,mailbox:"trash"}});case 27:L="toFolder";case 28:l.next=34;break;case 30:if(!["archive","spam","inbox","sent"].includes(b)){l.next=34;break}return l.next=33,I({variables:{id:s,mailbox:b}});case 33:L="toFolder";case 34:C({type:L,key:g.id,index:g.index-1}),L!="updateFlags"&&w();case 36:case"end":return l.stop()}},N)}));return function(N){return u.apply(this,arguments)}}(),[H,s,r,w,C,I,z]);(0,m.useEffect)(function(){x.current.autoReadExecuted=!1;var u=setTimeout(function(){R({variables:{id:s}})},600);return function(){clearTimeout(u)}},[R,s]),(0,m.useEffect)(function(){if(!(!n||n.id!=s)&&(n==null?void 0:n.mailboxName)==c.LJ.INBOX.id){if(x.current.autoReadExecuted||n.seen){x.current.autoReadExecuted=!0;return}x.current.autoReadExecuted=!0,Z("read")}},[Z,s,n]);var fe=(0,m.useCallback)(function(u){x.current.message=u},[]),je=(0,m.useCallback)((0,M.Z)((0,D.Z)().mark(function u(){var N;return(0,D.Z)().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:N=x.current.message,C({type:"toFolder",key:N.id,index:N.index-1}),w();case 3:case"end":return g.stop()}},u)})),[w,C]);return(0,m.useEffect)(function(){if(!(!n||X||n.index==null||n.id!=s)){var u=x.current.activeIndex;u!=n.index-1&&p(n.index-1)}},[n,p,X,s]),(0,m.useEffect)(function(){!S||i.u_.error({title:"\u9519\u8BEF",content:S.message,timer:3e3,timerProgressBar:!0}).then(function(){J.push("/mail/".concat(x.current.mailbox))})},[S,J]),(0,e.jsx)(Y.E,{className:"mail-message-details flex-lg-row-fluid custom-scrollbar",options:{scrollbars:{autoHide:"scroll"}},children:(0,e.jsxs)(i.Zb,{className:"mail-message-container",children:[(0,e.jsxs)(i.Zb.Header,{className:"align-items-center py-5 gap-5",children:[(0,e.jsx)(re,{message:n,onAction:Z}),(0,e.jsx)(le,{pagination:v,current:(n==null?void 0:n.index)||O+1,goto:p})]}),(0,e.jsx)(i.Zb.Body,{className:A()({"px-5 py-0 mail-message-draft":n==null?void 0:n.draft}),children:n?n.draft?(0,e.jsx)(ne.Z,{message:n,onAutoSave:fe,onSend:je}):(0,e.jsx)(te,{message:n,mailbox:r}):(0,e.jsx)(ce,{})})]})})}var de=oe},88403:function(U,k,t){"use strict";t.d(k,{LJ:function(){return M},GG:function(){return y},ss:function(){return m}});var D=t(5618),M={INBOX:{id:"INBOX",name:"\u6536\u4EF6\u7BB1",icon:"Duotune/com010",badge:"success"},Sent:{id:"Sent",name:"\u5DF2\u53D1\u9001",icon:"Duotune/gen016"},Drafts:{id:"Drafts",name:"\u8349\u7A3F",icon:"Duotune/gen009",badge:"primary"},Archive:{id:"Archive",name:"\u5F52\u6863",icon:"Duotune/lay010"},Spam:{id:"Spam",name:"\u5783\u573E\u90AE\u4EF6",icon:"Duotune/gen044"},Trash:{id:"Trash",name:"\u56DE\u6536\u7AD9",icon:"Duotune/gen027",badge:"warning"},Outbox:{id:"Outbox",name:"\u53D1\u4EF6\u7BB1",icon:"Duotune/gen027"}},y=Object.keys(M).map(function(o){return M[o]});function m(o){var E=(0,D.N8)(o);return E.name||E.address&&E.address.substring(0,E.address.indexOf("@"))}}}]);

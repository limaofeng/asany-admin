(self.webpackChunkasany_admin=self.webpackChunkasany_admin||[]).push([[2015],{2015:function(Ye,Pe,m){"use strict";m.d(Pe,{Z:function(){return Qe}});var p=m(93224),C=m(3182),g=m(2824),q=m(11849),X=m(86582),fe=m(94043),b=m.n(fe),r=m(67294),ye=m(51615),ue=m(95551),P=m(28865),je=m(94184),G=m.n(je),be=m(13356),e=m(85893);function De(l){var n=l.paths,a=l.onClick;console.log("FolderPath",n);var y=(0,r.useCallback)(function(h){return function(f){f.preventDefault(),f.stopPropagation(),a(h)}},[a]);return(0,e.jsx)("div",{className:"folder-path badge badge-lg badge-white",children:(0,e.jsx)("div",{className:"d-flex align-items-center flex-wrap",children:n.map(function(h,f){var F=f==0,$=f==n.length-1;return(0,e.jsxs)(r.Fragment,{children:[!F&&(0,e.jsx)(P.ZP,{name:F?"Duotune/abs039":"Duotune/arr071",className:G()("svg-icon-2 svg-icon-primary",{"mx-1":!F,"me-3":F})}),$?h.name:(0,e.jsx)("a",{href:f==0?"/drive/my-drive":"/drive/folders/".concat(h.id),onClick:y(h),children:h.name})]},h.id)})})})}var Ce=De,Q=m(14928),M=m(1861),he=m(73727),t=m(69851),Ne=m(54108);function Me(){return(0,e.jsx)(e.Fragment,{children:"\u65E5\u5FD7"})}function $e(l){var n=(0,r.useState)(l.file),a=(0,g.Z)(n,2),y=a[0],h=a[1],f=(0,Q.lK)({fetchPolicy:"cache-and-network",variables:{id:l.file.id}}),F=f.data,$=f.loading;return(0,r.useEffect)(function(){(F==null?void 0:F.file)&&h(F==null?void 0:F.file)},[F==null?void 0:F.file]),(0,e.jsxs)(t.bH,{overlayClassName:"bg-white bg-opacity-25",className:"pt-5",loading:$,children:[!y.isDirectory&&(0,e.jsx)("div",{className:"file-preview mb-6",children:(0,e.jsx)(t.mN,{src:"//api.asany.cn"+"/thumbnail/".concat(y.id,"?size=120x120")})}),!1,(0,e.jsx)("div",{className:"fs-6 text-gray-800 mb-4",children:"\u7CFB\u7EDF\u5C5E\u6027"}),(0,e.jsxs)("div",{className:"row mb-4",children:[(0,e.jsx)("label",{className:"col-lg-3 fw-bold text-muted",children:"\u7C7B\u578B"}),(0,e.jsx)("div",{className:"col-lg-9",children:(0,e.jsx)("span",{className:"fs-7 text-gray-800",children:y.isDirectory?"\u6587\u4EF6\u5939":y.mimeType})})]}),!y.isDirectory&&(0,e.jsxs)("div",{className:"row mb-4",children:[(0,e.jsx)("label",{className:"col-lg-3 fw-bold text-muted",children:"\u5927\u5C0F"}),(0,e.jsx)("div",{className:"col-lg-9 fv-row",children:(0,e.jsx)("span",{className:"fs-7 text-gray-800",children:(0,Ne.jb)(y.size)})})]}),(0,e.jsxs)("div",{className:"row mb-4",children:[(0,e.jsx)("label",{className:"col-lg-3 fw-bold text-muted",children:"\u4F4D\u7F6E"}),(0,e.jsxs)("div",{className:"col-lg-9 d-flex align-items-center flex-wrap",children:[(0,e.jsx)(he.Link,{className:"tw-truncate mw-90px",to:"/drive/my-drive",children:"\u5168\u90E8\u6587\u4EF6"}),(y.parents||[]).map(function(z){return(0,e.jsxs)(r.Fragment,{children:[(0,e.jsx)(P.ZP,{name:"Duotune/arr071",className:G()("svg-icon-5 svg-icon-primary")}),(0,e.jsx)(he.Link,{className:"tw-truncate mw-90px",to:"/drive/folders/".concat(z.id),children:z.name})]},z.id)})]})]}),(0,e.jsxs)("div",{className:"row mb-4",children:[(0,e.jsx)("label",{className:"col-lg-3 fw-bold text-muted",children:"\u4FEE\u6539\u65F6\u95F4"}),(0,e.jsx)("div",{className:"col-lg-9",children:(0,e.jsx)("span",{className:"fs-7 text-gray-800",children:y.lastModified})})]}),(0,e.jsxs)("div",{className:"row mb-4",children:[(0,e.jsx)("label",{className:"col-lg-3 fw-bold text-muted",children:"\u521B\u5EFA\u65F6\u95F4"}),(0,e.jsx)("div",{className:"col-lg-9",children:(0,e.jsx)("span",{className:"fs-7 text-gray-800",children:y.createdAt})})]}),(0,e.jsxs)("div",{className:"row mb-4",children:[(0,e.jsx)("label",{className:"col-lg-3 fw-bold text-muted",children:"\u8BF4\u660E"}),(0,e.jsx)("div",{className:"col-lg-9",children:(0,e.jsx)("span",{className:"fs-7 text-gray-800",children:y.description})})]})]})}function ze(l){var n=l.file;return(0,e.jsxs)(t.mQ,{className:"nav-line-tabs-2x",children:[(0,e.jsx)(t.mQ.TabPane,{tab:"\u6587\u4EF6\u8BE6\u60C5",children:(0,e.jsx)(M.E,{className:"flex-column-fluid custom-scrollbar",options:{scrollbars:{autoHide:"scroll"}},children:(0,e.jsx)($e,{file:n})})},"file-details"),(0,e.jsx)(t.mQ.TabPane,{tab:"\u64CD\u4F5C\u8BB0\u5F55",children:(0,e.jsx)(M.E,{className:"flex-column-fluid custom-scrollbar",options:{scrollbars:{autoHide:"scroll"}},children:(0,e.jsx)(Me,{})})},"action-records")]})}function Be(l){var n=l.files,a=l.currentFolder,y=(0,r.useMemo)(function(){return n.length==1?"file_details":n.length>1?"many_file_details":"current_folder"},[n]),h=(0,r.useMemo)(function(){return y==="file_details"?n[0].name:y==="many_file_details"?"\u591A\u4E2A\u6587\u4EF6":(a==null?void 0:a.name)||""},[a==null?void 0:a.name,n,y]),f=(0,r.useMemo)(function(){var V=h.lastIndexOf(".");return V==-1?[h,void 0]:[h.substring(0,V),h.substring(V+1)]},[h]),F=(0,g.Z)(f,2),$=F[0],z=F[1];return(0,e.jsxs)("div",{className:"preview-container",children:[(0,e.jsx)("div",{className:"preview-header",children:(0,e.jsx)("h4",{className:G()({"tw-truncate":!z,"d-flex":z}),children:z?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("span",{className:"file-title shrink tw-truncate",children:$}),(0,e.jsxs)("span",{className:"file-suffix",children:[".",z]})]}):$})}),(0,e.jsx)("div",{className:"preview-body",children:y=="file_details"&&(0,e.jsx)(ze,{file:n[0]})})]})}var Ae=Be,Fe=m(19228);function Te(l){var n=l.data,a=l.editable,y=l.onClick,h=l.onCancelRename,f=l.onSuccess,F=(0,r.useRef)(null),$=(0,r.useState)(!1),z=(0,g.Z)($,2),V=z[0],D=z[1],oe=(0,r.useState)(n.name),J=(0,g.Z)(oe,2),I=J[0],K=J[1],_=(0,Q.Ep)(),ae=(0,g.Z)(_,1),w=ae[0],u=(0,r.useCallback)(function(v){K(v.target.value)},[]),s=(0,r.useCallback)(function(){var v=(0,C.Z)(b().mark(function O(E){var te,re,A;return b().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return E.stopPropagation(),B.prev=1,D(!0),B.next=5,(0,Fe.gw)(w({variables:{id:n.id,name:I}}),350);case 5:return te=B.sent,re=te.data,f(re.file),B.next=10,(0,Fe._v)(350);case 10:D(!1),h(),B.next=22;break;case 14:return B.prev=14,B.t0=B.catch(1),D(!1),B.next=19,t.FN.error(B.t0.message,2e5,{progressBar:!0,placement:"middle-center"});case 19:return B.next=21,(0,Fe._v)(300);case 21:(A=F.current)===null||A===void 0||A.select();case 22:case"end":return B.stop()}},O,null,[[1,14]])}));return function(O){return v.apply(this,arguments)}}(),[n.id,I,h,f,w]),L=(0,r.useCallback)(function(v){v.preventDefault(),s(v)},[s]),ee=(0,r.useCallback)(function(v){v.stopPropagation(),v.preventDefault(),h()},[h]),R=(0,r.useCallback)(function(v){y(n),v.preventDefault(),v.stopPropagation()},[n,y]);(0,r.useEffect)(function(){var v;K(function(){return n.name}),!!a&&((v=F.current)===null||v===void 0||v.select(0,n.name.length-(n.extension?n.extension.length+1:0)))},[n.extension,n.name,a]);var j=(0,r.useCallback)(function(v){a&&(v.stopPropagation(),v.preventDefault())},[a]),H=(0,r.useMemo)(function(){var v,O;return((v=n.mimeType)===null||v===void 0?void 0:v.startsWith("image/"))||((O=n.mimeType)===null||O===void 0?void 0:O.startsWith("video/"))},[n.mimeType]);return(0,e.jsxs)("div",{onClick:j,className:G()("d-flex align-items-center",{"no-selecto-drag":a}),children:[(0,e.jsxs)("div",{className:"title-icon-container position-relative me-1 d-flex align-items-center justify-content-center",children:[H?(0,e.jsx)(t.mN,{alt:(0,e.jsx)(P.ZP,{name:"Duotune/".concat(n.isDirectory?"fil012":"fil003"),className:"svg-icon-2x svg-icon-primary"}),src:"//api.asany.cn"+"/thumbnail/".concat(n.id,"?size=120x120")}):(0,e.jsx)(P.ZP,{name:"Duotune/".concat(n.isDirectory?"fil012":"fil003"),className:"svg-icon-2x svg-icon-primary"}),n.starred&&(0,e.jsx)(P.ZP,{name:"Bootstrap/star-fill",className:"position-absolute starred-flag"})]}),a?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(t.II,{ref:F,value:I,onChange:u,onPressEnter:L,placeholder:"\u8F93\u5165\u65B0\u6587\u4EF6\u5939\u540D\u79F0",size:"sm",className:"mw-250px me-3"}),(0,e.jsx)(t.zx,{as:"button",loading:V,variantStyle:"light",variant:"primary",size:"sm",icon:(0,e.jsx)(P.ZP,{name:"Duotune/arr085",className:"svg-icon-1"}),className:"me-3",onClick:s}),(0,e.jsx)(t.zx,{as:"button",variantStyle:"light",size:"sm",variant:"danger",icon:(0,e.jsx)(P.ZP,{name:"Duotune/arr088",className:"svg-icon-1"}),className:"svg-icon-1",onClick:ee})]}):(0,e.jsx)("a",{className:"text-gray-800 text-hover-primary no-selecto-drag",onClick:R,href:n.isDirectory?"/drive/folders/".concat(n.id):"/preview/".concat(n.id),children:n.name})]})}var Re=Te;function Ie(l){var n=l.visible,a=l.onCancel,y=l.onSuccess,h=l.parentFolder,f=(0,r.useState)("\u672A\u547D\u540D\u6587\u4EF6\u5939"),F=(0,g.Z)(f,2),$=F[0],z=F[1],V=(0,r.useState)(!1),D=(0,g.Z)(V,2),oe=D[0],J=D[1],I=(0,Q.we)(),K=(0,g.Z)(I,2),_=K[0],ae=K[1].loading,w=(0,r.useRef)(null),u=(0,r.useCallback)(function(){a()},[a]),s=(0,r.useCallback)(function(R){z(R.target.value),J(!R.target.value)},[]),L=(0,r.useCallback)((0,C.Z)(b().mark(function R(){var j,H,v;return b().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:if($){E.next=2;break}return E.abrupt("return");case 2:return E.prev=2,E.next=5,_({variables:{name:$,parentFolder:h}});case 5:j=E.sent,H=j.data,a&&a(),(H==null?void 0:H.folder)&&y(H.folder),t.FN.success("\u6587\u4EF6\u5939\u65B0\u589E\u6210\u529F",2e3,{progressBar:!0,placement:"bottom-start"}),E.next=19;break;case 12:return E.prev=12,E.t0=E.catch(2),E.next=16,t.FN.error(E.t0.message,2e3,{progressBar:!0});case 16:return E.next=18,(0,Fe._v)(300);case 18:(v=w.current)===null||v===void 0||v.select();case 19:case"end":return E.stop()}},R,null,[[2,12]])})),[_,a,y,h,$]),ee=(0,r.useCallback)(function(){L()},[L]);return(0,r.useEffect)(function(){if(n){var R;(R=w.current)===null||R===void 0||R.select()}else z("\u672A\u547D\u540D\u6587\u4EF6\u5939"),J(!1)},[n]),(0,e.jsx)(t.u_,{centered:!0,visible:n,dialogClassName:"modal-dialog-small w-400px",onCancel:u,onOk:L,title:"\u65B0\u5EFA\u6587\u4EF6\u5939",closable:!1,okButtonProps:{loading:ae,className:G()({disabled:oe})},headerClassName:"border-bottom-0",bodyClassName:"py-2",footerClassName:"border-top-0",children:(0,e.jsx)(t.II,{ref:w,onPressEnter:ee,onChange:s,value:$})})}var Le=Ie;function we(l,n){var a=l?[{id:l.id,name:l.name,isDirectory:!0,isRootFolder:!0,path:"/"}]:[];return!!n&&n.id!==(l==null?void 0:l.id)&&(n.parents&&a.push.apply(a,(0,X.Z)(n.parents)),n.isRootFolder||a.push((0,q.Z)({},n))),a}function Oe(l){var n=l.folder,a=l.rootFolder,y=l.filter,h=l.toolbar,f=h===void 0?"default":h,F=(0,ye.k6)(),$=(0,ue.tT)("cloud-drive.index",function(i){var d=i.state;return d.cloudDrive}),z=(0,ue.tT)("cloud-drive.index",function(i){return i.upload}),V=(0,ue.tT)("cloud-drive.index",function(i){return i.download}),D=(0,r.useRef)({sorter:l.orderBy||{field:"name",order:"ascend"},rootFolder:a,newFolderVisible:!1,currentFolder:l.currentFolder}),oe=(0,r.useReducer)(function(i){return i+1},0),J=(0,g.Z)(oe,2),I=J[1],K=(0,r.useCallback)(function(){D.current.newFolderVisible=!0,I()},[]),_=(0,r.useCallback)(function(){D.current.newFolderVisible=!1,I()},[]),ae=(0,Q.rn)({fetchPolicy:"cache-and-network",variables:{folder:n}}),w=ae.data,u=(0,Q.tz)(),s=(0,g.Z)(u,1),L=s[0],ee=(0,Q._D)(),R=(0,g.Z)(ee,1),j=R[0],H=(0,Q.HD)(),v=(0,g.Z)(H,1),O=v[0],E=(0,Q.fX)(),te=(0,g.Z)(E,1),re=te[0],A=D.current.sorter,Ze=(0,r.useMemo)(function(){return A?"isDirectory_desc,"+A.field+"_"+(A.order=="ascend"?"asc":"desc"):"isDirectory_desc,name_asc"},[A]),B=(0,Q.Eo)(a==null?void 0:a.id,y,Ze),Y=(0,g.Z)(B,4),W=Y[0],ce=Y[1],We=Y[2],pe=Y[3],se=pe.loadedCount,ie=pe.allItems,Ee=pe.refetch,ge=pe.refetchForObjects,de=pe.refetchWithRemoveForObjects,me=(0,r.useMemo)(function(){return{loadedCount:se,rowCount:W.totalCount,get items(){return ie()},useItem:We}},[ie,se,W.totalCount,We]),qe=(0,r.useState)([]),Ue=(0,g.Z)(qe,2),S=Ue[0],le=Ue[1],ve=(0,r.useMemo)(function(){return l.currentFolder&&w!==null&&w!==void 0&&w.currentFolder&&l.currentFolder.id!=w.currentFolder.id&&l.currentFolder.path.startsWith(w.currentFolder.path)?D.current.currentFolder=l.currentFolder:w!=null&&w.currentFolder?D.current.currentFolder=w==null?void 0:w.currentFolder:D.current.currentFolder},[w==null?void 0:w.currentFolder,l.currentFolder]),_e=(0,r.useCallback)(function(i){le(i)},[le]),er=(0,r.useCallback)(function(){var i=(0,C.Z)(b().mark(function d(o){return b().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:return Z.next=2,ge([o],function(N,x){return N.id==x.id});case 2:case"end":return Z.stop()}},d)}));return function(d){return i.apply(this,arguments)}}(),[ge]),T=(0,r.useMemo)(function(){if(S.length==1)return ie().find(function(i){return i&&i.id==S[0]})},[ie,S]),rr=(0,r.useCallback)(function(){D.current.renameFile=void 0,I()},[]),nr=(0,r.useMemo)(function(){return we(a,ve)},[a,ve]),Xe=(0,r.useCallback)(function(){var i=(0,C.Z)(b().mark(function d(o){var c,Z,N;return b().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:if(f!="trash"){k.next=4;break}return k.next=3,t.u_.confirm({title:(0,e.jsxs)(e.Fragment,{children:["\u6B64\u6587\u4EF6",o.isDirectory&&"\u5939","\u4F4D\u4E8E\u60A8\u7684\u56DE\u6536\u7AD9\u4E2D"]}),content:(0,e.jsxs)(e.Fragment,{children:["\u8981\u67E5\u770B\u8BE5\u6587\u4EF6",o.isDirectory&&"\u5939","\uFF0C\u60A8\u9700\u8981\u5C06\u5176\u4ECE\u56DE\u6536\u7AD9\u8FD8\u539F\u3002"]}),okText:"\u8FD8\u539F"});case 3:return k.abrupt("return");case 4:if(!o.isDirectory){k.next=9;break}return c=(0,q.Z)({},o),o.isRootFolder||(Z=[].concat((0,X.Z)(we(D.current.rootFolder,D.current.currentFolder)),[c]),c.parents=Z.slice(1,Z.length-1),N=c.parents.findIndex(function(U){return U.path==o.path}),N!=-1&&(c.parents=c.parents.slice(0,N))),o.isRootFolder?F.push("/drive/my-drive",{rootFolder:a,currentFolder:c,orderBy:D.current.sorter}):F.push("/drive/folders/".concat(o.id),{rootFolder:a,currentFolder:c,orderBy:D.current.sorter}),k.abrupt("return");case 9:case"end":return k.stop()}},d)}));return function(d){return i.apply(this,arguments)}}(),[f,F,a]),ar=(0,r.useCallback)(function(){return(0,e.jsxs)("div",{className:"clouddrive-listfiles-no-rows d-flex flex-column flex-center",children:[(0,e.jsx)("img",{src:"/assets/media/illustrations/sketchy-1/5.png",className:"mw-200px"}),(0,e.jsx)("div",{className:"fs-1 fw-bolder text-dark mb-4",children:"\u5C06\u6587\u4EF6\u62D6\u62FD\u5230\u6B64\u5904"}),(0,e.jsxs)("div",{className:"fs-6",children:["\u6216\u70B9\u51FB \u201C",(0,e.jsx)("span",{className:"text-success",children:"\u4E0A\u4F20"}),"\u201D \u6309\u94AE"]})]})},[]),tr=(0,r.useCallback)(function(){return W.totalCount==se&&se==0?ce?(0,e.jsx)(e.Fragment,{children:"\u52A0\u8F7D\u4E2D...."}):(0,e.jsx)(e.Fragment,{}):(0,e.jsxs)(e.Fragment,{children:[W.totalCount==se?(0,e.jsx)(e.Fragment,{children:"\u5DF2\u5168\u90E8\u52A0\u8F7D"}):(0,e.jsxs)(e.Fragment,{children:["\u5DF2\u52A0\u8F7D ",se," \u4E2A"]}),"\uFF0C\u5171 ",W.totalCount," \u4E2A"]})},[se,ce,W.totalCount]),He=ie().filter(function(i){return S.includes(i.id)}).every(function(i){return i.starred}),sr=(0,r.useCallback)(function(i,d,o){D.current.sorter=o,I()},[]),ir=(0,r.useMemo)(function(){return me.items.filter(function(i){return S.some(function(d){return d==i.id})})},[me,S]),lr=(0,r.useCallback)(function(){var i=(0,C.Z)(b().mark(function d(o){var c;return b().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return N.next=2,Ee(1);case 2:c=ie(),c.some(function(x){return x&&x.id==o.id})&&le([o.id]);case 4:case"end":return N.stop()}},d)}));return function(d){return i.apply(this,arguments)}}(),[Ee,ie]),Se=(ve==null?void 0:ve.id)||(a==null?void 0:a.id);(0,r.useEffect)(function(){le([])},[Se,a==null?void 0:a.name]);var ur=(0,r.useCallback)(function(i){z(i,{space:$.space,folder:Se})},[$,Se,z]),Ve=(0,be.uI)({onDrop:ur}),or=Ve.getRootProps,cr=Ve.getInputProps,dr=Ve.isDragActive;console.log("isDragActive",dr);var ke=or(),xr=ke.role,yr=ke.tabIndex,Ge=ke.onClick,mr=(0,p.Z)(ke,["role","tabIndex","onClick"]),vr=(0,r.useCallback)(function(i){Ge(i)},[Ge]),fr=(0,r.useCallback)((0,C.Z)(b().mark(function i(){var d,o,c;return b().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:d=me.items,o=d.filter(function(x){return S.includes(x.id)}),c=o.length==1?o[0].name:"\u3010\u6279\u91CF\u4E0B\u8F7D\u3011".concat(o[0].name," \u7B49 (").concat(o.length,").zip"),V(o,c);case 4:case"end":return N.stop()}},i)})),[me,V,S]),hr=(0,r.useCallback)((0,C.Z)(b().mark(function i(){var d,o,c,Z;return b().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return d=T?T!=null&&T.isDirectory?"\u6587\u4EF6\u5939":"\u6587\u4EF6":S.length+" \u9879\u5185\u5BB9",x.next=3,t.u_.confirm({title:"\u786E\u5B9A\u5220\u9664",content:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("p",{className:"tip-confirm",children:"\u786E\u5B9A\u5220\u9664\u6240\u9009\u7684\u6587\u4EF6\u5417\uFF1F"}),(0,e.jsx)("p",{children:"\u5220\u9664\u7684\u6587\u4EF6\u53EF\u5728 10\u5929 \u5185\u901A\u8FC7\u56DE\u6536\u7AD9\u8FD8\u539F"})]}),icon:"info",okText:"\u5220\u9664"});case 3:if(o=x.sent,o.isConfirmed){x.next=6;break}return x.abrupt("return");case 6:return x.next=8,j({variables:{ids:S}});case 8:c=x.sent,Z=c.data,le([]),de(Z==null?void 0:Z.files,function(k,U){return k.id==U.id}),t.FN.success(d+" \u5DF2\u79FB\u81F3\u56DE\u6536\u7AD9",2e3,{placement:"bottom-start",progressBar:!0});case 13:case"end":return x.stop()}},i)})),[j,de,T,S]),Fr=(0,r.useCallback)((0,C.Z)(b().mark(function i(){var d;return b().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,t.u_.confirm({title:"\u6E05\u7A7A\u56DE\u6536\u7AD9",content:"\u7CFB\u7EDF\u5C06\u6C38\u4E45\u5220\u9664\u56DE\u6536\u7AD9\u4E2D\u7684\u5185\u5BB9\uFF0C\u6B64\u64CD\u4F5C\u65E0\u6CD5\u6062\u590D \uFF1F"});case 2:if(d=c.sent,d.isConfirmed){c.next=5;break}return c.abrupt("return");case 5:return c.next=7,O({variables:{folder:n}});case 7:Ee(1),t.FN.success("\u56DE\u6536\u7AD9\u5DF2\u88AB\u6E05\u7A7A",2e3,{placement:"bottom-start",progressBar:!0});case 9:case"end":return c.stop()}},i)})),[O,n,Ee]),Je=(0,r.useCallback)((0,C.Z)(b().mark(function i(){var d,o,c,Z;return b().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return d=T?T!=null&&T.isDirectory?"\u6587\u4EF6\u5939":"\u6587\u4EF6":S.length+" \u9879\u5185\u5BB9",x.next=3,t.u_.confirm({title:"\u786E\u5B9A\u8FD8\u539F",content:"\u786E\u8BA4\u8FD8\u539F\u9009\u4E2D\u7684 "+d+" \uFF1F"});case 3:if(o=x.sent,o.isConfirmed){x.next=6;break}return x.abrupt("return");case 6:return x.next=8,re({variables:{ids:S}});case 8:c=x.sent,Z=c.data,le([]),de(Z==null?void 0:Z.files,function(k,U){return k.id==U.id}),t.FN.success(d+" \u8FD8\u539F\u6210\u529F",2e3,{placement:"bottom-start",progressBar:!0});case 13:case"end":return x.stop()}},i)})),[de,re,T,S]),Ke=(0,r.useCallback)((0,C.Z)(b().mark(function i(){var d,o,c,Z,N;return b().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:if(d=T?T!=null&&T.isDirectory?"\u6587\u4EF6\u5939":"\u6587\u4EF6":S.length+" \u9879\u5185\u5BB9",!He){k.next=10;break}return k.next=4,L({variables:{ids:S,mode:"REMOVE"}});case 4:o=k.sent,c=o.data,ge(c==null?void 0:c.files,function(U,xe){return U.id==xe.id}),t.FN.success(d+"\u5DF2\u4ECE\u6536\u85CF\u4E2D\u79FB\u9664",2e3,{placement:"bottom-start",progressBar:!0}),k.next=16;break;case 10:return k.next=12,L({variables:{ids:S,mode:"ADD"}});case 12:Z=k.sent,N=Z.data,f=="starred"?(le([]),de(N==null?void 0:N.files,function(U,xe){return U.id==xe.id})):ge(N==null?void 0:N.files,function(U,xe){return U.id==xe.id}),t.FN.success(d+" \u5DF2\u6DFB\u52A0\u5230\u6536\u85CF",2e3,{placement:"bottom-start",progressBar:!0});case 16:I();case 17:case"end":return k.stop()}},i)})),[ge,de,T,S,L,He,f]),pr=(0,r.useCallback)((0,C.Z)(b().mark(function i(){return b().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:D.current.renameFile=T,I();case 2:case"end":return o.stop()}},i)})),[T]),ne=(0,r.useMemo)(function(){return S.length?S.length==1?"row":"multi-row":"no_rows"},[S.length]),gr=(0,r.useMemo)(function(){if(f=="starred")return function(){return(0,e.jsx)("div",{children:(0,e.jsx)(t.zx,{color:"success",variant:!1,className:"trash-restore",onClick:Ke,icon:(0,e.jsx)(P.ZP,{name:"Duotune/arr029",className:"svg-icon-4 svg-icon-success"}),children:"\u53D6\u6D88\u6536\u85CF"})})};if(f=="trash")return function(){return(0,e.jsx)("div",{children:(0,e.jsx)(t.zx,{color:"success",variant:!1,className:"trash-restore",onClick:Je,icon:(0,e.jsx)(P.ZP,{name:"Duotune/arr029",className:"svg-icon-4 svg-icon-success"}),children:"\u8FD8\u539F"})})}},[Je,Ke,f]);return(0,e.jsxs)(t.Zb,{flush:!0,children:[f=="default"&&(0,e.jsxs)(t.Zb.Header,{className:"pt-8 flex-row-reverse",children:[(0,e.jsx)(t.Zb.Title,{children:(0,e.jsx)(t.II.Search,{size:"lg",solid:!0,className:"rounded-2 w-300px",placeholder:"\u641C\u7D22 \u6587\u4EF6 & \u6587\u4EF6\u5939"})}),(0,e.jsx)(t.Zb.Toolbar,{children:(0,e.jsxs)("div",{className:G()("d-flex justify-content-end",{"file-action-group px-3 gap-2":["row","multi-row"].includes(ne)}),children:[ne=="no_rows"&&(0,e.jsxs)(e.Fragment,{children:[f=="default"&&(0,e.jsx)(t.zx,{variant:"primary",className:"rounded-2 me-3",icon:(0,e.jsx)(P.ZP,{className:"svg-icon-2",name:"Duotune/fil018"}),onClick:vr,children:"\u4E0A\u4F20\u6587\u4EF6"}),f=="default"&&(a==null?void 0:a.isRootFolder)&&(0,e.jsx)(t.zx,{variantStyle:"light",variant:"primary",className:"rounded-2",icon:(0,e.jsx)(P.ZP,{className:"svg-icon-2",name:"Duotune/fil013"}),onClick:K,children:"\u65B0\u5EFA\u6587\u4EF6\u5939"})]}),["row","multi-row"].includes(ne)&&(0,e.jsx)(t.zx,{variantStyle:"light",variant:"primary",className:"rounded-2",icon:(0,e.jsx)(P.ZP,{className:"svg-icon-2",name:"Duotune/arr095"}),children:"\u5206\u4EAB"}),["row","multi-row"].includes(ne)&&(0,e.jsx)(t.zx,{variantStyle:"light",variant:"primary",className:"rounded-2",icon:(0,e.jsx)(P.ZP,{className:"svg-icon-2",style:{transform:"rotateZ(90deg)"},name:"Duotune/arr076"}),onClick:fr,children:"\u4E0B\u8F7D"}),["row","multi-row"].includes(ne)&&(0,e.jsx)(t.zx,{variantStyle:"light",variant:"primary",className:"rounded-2",icon:(0,e.jsx)(P.ZP,{className:"svg-icon-2",name:"Duotune/gen027"}),onClick:hr,children:"\u5220\u9664"}),ne=="row"&&(0,e.jsx)(t.zx,{as:"button",variantStyle:"light",variant:"primary",className:"rounded-2",icon:(0,e.jsx)(P.ZP,{className:"svg-icon-2",name:"Duotune/gen055"}),onClick:pr,children:"\u91CD\u547D\u540D"}),["row","multi-row"].includes(ne)&&(0,e.jsx)(t.zx,{variantStyle:"light",variant:"primary",className:"rounded-2",icon:(0,e.jsx)(P.ZP,{className:"svg-icon-2",name:"Duotune/arr033"}),children:"\u79FB\u52A8"}),["row","multi-row"].includes(ne)&&(0,e.jsx)(t.zx,{variantStyle:"light",variant:"primary",className:"rounded-2",icon:(0,e.jsx)(P.ZP,{className:"svg-icon-2",name:"Duotune/abs024"}),onClick:Ke,children:He?"\u53D6\u6D88\u6536\u85CF":"\u6536\u85CF"})]})})]}),(0,e.jsxs)(t.Zb.Body,{className:"d-flex flex-row",children:[(0,e.jsxs)("div",(0,q.Z)((0,q.Z)({className:"flex-row-fluid"},mr),{},{children:[(0,e.jsxs)("div",{className:"d-flex flex-stack",children:[(0,e.jsx)(Ce,{onClick:Xe,paths:nr}),(0,e.jsx)(t.Ct,{size:"lg",color:"white",children:tr()})]}),f=="trash"&&!!me.rowCount&&(0,e.jsx)(t.bZ,{theme:"Light",type:"primary",action:(0,e.jsx)(t.zx,{onClick:Fr,variantStyle:"light",variant:"primary",className:"me-3 ls-1",children:"\u6E05\u7A7A\u56DE\u6536\u7AD9"}),message:"\u5185\u5BB9\u79FB\u81F3\u56DE\u6536\u7AD9\u540E\u4F1A\u5728 10 \u5929\u540E\u88AB\u6C38\u4E45\u5220\u9664"}),(0,e.jsx)("input",(0,q.Z)({},cr())),(0,e.jsx)(t.bH,{overlayClassName:"bg-white bg-opacity-25",loading:ce,children:!W.totalCount&&!ce?ar():(0,e.jsx)(t.iA,{rowKey:"id",hover:!0,rowSelection:{type:"checkbox",selectedRowKeys:S,renderTitle:function(d){return(0,e.jsxs)(e.Fragment,{children:["\u5DF2\u9009\u4E2D",(0,e.jsx)("span",{className:"mx-2",children:d}),"\u4E2A\u6587\u4EF6/\u6587\u4EF6\u5939"]})},toolbar:gr,onChange:_e},rowHeight:50,columns:[{key:"name",title:(0,e.jsx)("span",{className:"ps-2",children:"\u6587\u4EF6\u540D"}),className:"min-w-250px",sorter:!0,sortOrder:A.field=="name"?A.order:void 0,render:function(d,o){var c;return(0,e.jsx)(Re,{onClick:Xe,onSuccess:er,onCancelRename:rr,data:o,editable:o.id==((c=D.current.renameFile)===null||c===void 0?void 0:c.id)})}},{key:"lastModified",title:"\u66F4\u65B0\u65F6\u95F4",sorter:!0,className:"min-w-125px",sortOrder:A.field=="lastModified"?A.order:void 0},{key:"size",title:"\u6587\u4EF6\u5927\u5C0F",sorter:!0,className:"min-w-100px",sortOrder:A.field=="size"?A.order:void 0,render:function(d,o){return o.isDirectory?"-":(0,Ne.jb)(d)}}],dataSource:me,onChange:sr})})]})),(0,e.jsx)("div",{className:"file-details-quick-preview pb-7",children:(0,e.jsx)(Ae,{files:ir,currentFolder:ve})}),(0,e.jsx)(Le,{onCancel:_,visible:D.current.newFolderVisible,parentFolder:Se,onSuccess:lr})]})]})}var Qe=Oe},14928:function(Ye,Pe,m){"use strict";m.d(Pe,{tz:function(){return Be},HD:function(){return Le},f4:function(){return Ne},dH:function(){return a},we:function(){return $e},lK:function(){return f},rn:function(){return z},Eo:function(){return w},_D:function(){return Re},Ep:function(){return l},fX:function(){return Oe}});var p=m(11849),C=m(20310),g=m(49704),q=m(38460),X=m(21919),fe=m(93633),b,r,ye,ue,P,je,G,be,e,De,Ce,Q,M={},he=(0,g.Ps)(b||(b=(0,C.Z)([`
    query cloudDrive($id: ID!) {
  cloudDrive(id: $id) {
    id
    name
    type
    space
    rootFolder
    recycleBin
  }
}
    `])));function t(u){var s=_objectSpread(_objectSpread({},M),u);return Apollo.useQuery(he,s)}function Ne(u){var s=(0,p.Z)((0,p.Z)({},M),u);return q.t(he,s)}var Me=(0,g.Ps)(r||(r=(0,C.Z)([`
    mutation createFolder($name: String!, $parentFolder: ID!) {
  folder: createFolder(name: $name, parentFolder: $parentFolder) {
    id
    name
  }
}
    `])));function $e(u){var s=(0,p.Z)((0,p.Z)({},M),u);return X.D(Me,s)}var ze=(0,g.Ps)(ye||(ye=(0,C.Z)([`
    mutation addStarForFiles($ids: [ID!]!, $mode: UpdateMode) {
  files: addStarForFiles(ids: $ids, mode: $mode) {
    id
    starred
  }
}
    `])));function Be(u){var s=(0,p.Z)((0,p.Z)({},M),u);return X.D(ze,s)}var Ae=(0,g.Ps)(ue||(ue=(0,C.Z)([`
    mutation deleteFiles($ids: [ID!]!) {
  files: deleteFiles(ids: $ids) {
    id
  }
}
    `])));function Fe(u){var s=_objectSpread(_objectSpread({},M),u);return Apollo.useMutation(Ae,s)}var Te=(0,g.Ps)(P||(P=(0,C.Z)([`
    mutation moveFilesToTrash($ids: [ID!]!) {
  files: moveFilesToTrash(ids: $ids) {
    id
  }
}
    `])));function Re(u){var s=(0,p.Z)((0,p.Z)({},M),u);return X.D(Te,s)}var Ie=(0,g.Ps)(je||(je=(0,C.Z)([`
    mutation clearFilesInTrash($folder: ID!) {
  clearFilesInTrash(folder: $folder)
}
    `])));function Le(u){var s=(0,p.Z)((0,p.Z)({},M),u);return X.D(Ie,s)}var we=(0,g.Ps)(G||(G=(0,C.Z)([`
    mutation restoreFiles($ids: [ID!]!) {
  files: restoreFiles(ids: $ids) {
    id
    path
  }
}
    `])));function Oe(u){var s=(0,p.Z)((0,p.Z)({},M),u);return X.D(we,s)}var Qe=(0,g.Ps)(be||(be=(0,C.Z)([`
    mutation renameFile($id: ID!, $name: String!) {
  file: renameFile(id: $id, name: $name) {
    id
    name
    lastModified(format: "yyyy-MM-dd HH:mm")
  }
}
    `])));function l(u){var s=(0,p.Z)((0,p.Z)({},M),u);return X.D(Qe,s)}var n=(0,g.Ps)(e||(e=(0,C.Z)([`
    query cloudDrives {
  cloudDrives {
    id
    name
    type
    space
    quota {
      id
      count
      usage
      size
      usageStr: usage(format: true)
      sizeStr: size(format: true)
    }
    rootFolder
  }
}
    `])));function a(u){var s=(0,p.Z)((0,p.Z)({},M),u);return fe.a(n,s)}function y(u){var s=_objectSpread(_objectSpread({},M),u);return Apollo.useLazyQuery(n,s)}var h=(0,g.Ps)(De||(De=(0,C.Z)([`
    query file($id: ID!) {
  file(id: $id) {
    id
    name
    path
    starred
    size
    sizeFormat: size(format: true)
    mimeType
    extension
    isDirectory
    isRootFolder
    lastModified(format: "yyyy-MM-dd HH:mm")
    createdAt(format: "yyyy-MM-dd HH:mm")
    description
    parents {
      id
      isDirectory
      isRootFolder
      name
      path
    }
  }
}
    `])));function f(u){var s=(0,p.Z)((0,p.Z)({},M),u);return fe.a(h,s)}function F(u){var s=_objectSpread(_objectSpread({},M),u);return Apollo.useLazyQuery(h,s)}var $=(0,g.Ps)(Ce||(Ce=(0,C.Z)([`
    query folder($folder: ID!) {
  currentFolder: file(id: $folder) {
    id
    name
    path
    isDirectory
    isRootFolder
    parents {
      id
      isDirectory
      isRootFolder
      name
      path
    }
  }
}
    `])));function z(u){var s=(0,p.Z)((0,p.Z)({},M),u);return fe.a($,s)}function V(u){var s=_objectSpread(_objectSpread({},M),u);return Apollo.useLazyQuery($,s)}var D=(0,g.Ps)(Q||(Q=(0,C.Z)([`
    query listFiles($rootFolder: ID!, $filter: FileFilter, $page: Int = 1, $pageSize: Int = 30, $orderBy: OrderBy) {
  listFiles(
    rootFolder: $rootFolder
    filter: $filter
    page: $page
    pageSize: $pageSize
    orderBy: $orderBy
  ) {
    pageSize
    currentPage
    totalPage
    totalCount
    edges {
      node {
        id
        name
        path
        size
        starred
        mimeType
        extension
        isDirectory
        lastModified(format: "yyyy-MM-dd HH:mm")
      }
    }
  }
}
    `])));function oe(u){var s=_objectSpread(_objectSpread({},M),u);return Apollo.useQuery(D,s)}function J(u){var s=(0,p.Z)((0,p.Z)({},M),u);return q.t(D,s)}var I=m(2824),K=m(67294),_=m(71447),ae=function(){var s=J({fetchPolicy:"cache-and-network"}),L=(0,I.Z)(s,2),ee=L[0],R=L[1],j=R.data,H=R.loading,v=R.refetch,O=(j==null?void 0:j.listFiles.pageSize)||0,E=(j==null?void 0:j.listFiles.currentPage)||0,te=(j==null?void 0:j.listFiles.totalCount)||0,re=(j==null?void 0:j.listFiles.totalPage)||0,A=(0,K.useMemo)(function(){return{totalCount:te,currentPage:E,pageSize:O,totalPage:re}},[E,O,te,re]),Ze=(0,K.useMemo)(function(){return function(Y,W){ee({variables:(0,p.Z)((0,p.Z)({},Y),{},{page:W})})}},[ee]),B=(0,K.useMemo)(function(){return{pagination:A,items:(j==null?void 0:j.listFiles.edges.map(function(Y){return Y.node}))||[],loading:H,refetch:function(W,ce){return v((0,p.Z)((0,p.Z)({},W),{},{page:ce}))}}},[H,A,j==null?void 0:j.listFiles.edges,v]);return[Ze,B]};function w(u,s,L){return(0,_.RM)(ae,{rootFolder:u,filter:s,orderBy:L})}}}]);

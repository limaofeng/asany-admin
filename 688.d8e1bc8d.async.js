"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[688],{688:function(ae,F,l){l.r(F);var R=l(97857),T=l.n(R),M=l(15009),f=l.n(M),S=l(99289),g=l.n(S),U=l(5574),C=l.n(U),m=l(62435),k=l(96974),K=l(73588),a=l(79817),c=l(91726),e=l(86074);function L(){var j,b,x,I=(0,k.UO)(),o=a.Form.useForm(),W=(0,m.useState)({}),N=C()(W,2),B=N[0],P=N[1],A=(0,c.Ux)({fetchPolicy:"network-only"}),p=A.data,$=A.refetch,V=(0,c.G6)(),G=C()(V,1),Q=G[0],w=(0,c.Mg)({fetchPolicy:"network-only",variables:{id:I.id}}),E=w.data,v=w.loading,Y=(0,c.rq)({fetchPolicy:"network-only"}),y=Y.data,z=(0,c.YG)({fetchPolicy:"network-only",skip:!B.customerId,variables:{where:{customer:B.customerId}}}),D=z.data,s=E==null?void 0:E.result,u=s==null?void 0:s.product,h=s==null?void 0:s.owner,O=h==null?void 0:h.customer,H=(p==null||(j=p.products.find(function(n){return n.id===(u==null?void 0:u.id)}))===null||j===void 0?void 0:j.warrantyPolicies)||[],J=(y==null?void 0:y.result)||[],_=(D==null?void 0:D.result)||[],X=(0,m.useCallback)(g()(f()().mark(function n(){var d,r;return f()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o.validateFields();case 2:return r=t.sent,r.address?(delete r.address.provinceName,delete r.address.cityName,delete r.address.districtName,delete r.address.streetName,delete r.address.__typename):r.address={},r.detailedAddress&&(r.address.detailedAddress=r.detailedAddress,delete r.detailedAddress),delete r.customer,r.owner={id:r.customerStore.id,name:(d=_.find(function(ee){return ee.id===r.customerStore.id}))===null||d===void 0?void 0:d.name,type:"CUSTOMER_STORE"},delete r.customerStore,delete r.productName,t.prev=9,t.next=12,a.Toast.promise(Q({variables:{id:I.id,input:r}}),{pending:"\u66F4\u65B0\u4E2D...",success:"\u8BBE\u5907 \u201C".concat(r.name,"\u201D \u66F4\u65B0\u6210\u529F"),error:"\u66F4\u65B0\u51FA\u9519"},{duration:2e3,placement:"top-center"});case 12:$(),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(9),a.Toast.error("\u4FDD\u5B58\u5931\u8D25");case 18:case"end":return t.stop()}},n,null,[[9,15]])})),[_]),Z=(0,m.useCallback)(function(n){var d;if(n){var r=_.find(function(t){return t.id===n});if(r){var i=T()({},r.address);delete i.__typename,o.setFieldValue("address",i),o.setFieldValue("detailedAddress",(d=r.address)===null||d===void 0?void 0:d.detailedAddress),o.setFieldValue("contactInfo",r.contactInfo)}}},[_]),q=(0,m.useCallback)(function(n){n.customer&&P({customerId:n.customer})},[]);return(0,m.useEffect)(function(){var n,d;v||(o.setFieldsValue({no:s==null?void 0:s.no,sn:s==null?void 0:s.sn,name:s==null?void 0:s.name,purchaseDate:s==null?void 0:s.purchaseDate,productName:u==null?void 0:u.name,warrantyPolicyId:s==null||(n=s.warrantyCards)===null||n===void 0?void 0:n.reduce(function(r,i){return i.endDate>r.endDate?i:r},s==null?void 0:s.warrantyCards[0]).policy.id,warrantyStartDate:s==null?void 0:s.warrantyStartDate,warrantyEndDate:s==null?void 0:s.warrantyEndDate,customer:O.id,customerStore:{id:String(h.id)},address:s==null?void 0:s.address,detailedAddress:s==null||(d=s.address)===null||d===void 0?void 0:d.detailedAddress,contactInfo:s==null?void 0:s.contactInfo}),P(function(r){return r.customerId=O.id,r}))},[s,u,v]),(0,e.jsx)(K.vs,{loading:v,header:{title:"\u7F16\u8F91\u8BBE\u5907"},children:(0,e.jsx)(a.Card,{className:"mb-5 mb-xl-10",children:(0,e.jsx)(a.Card.Body,{children:(0,e.jsx)(a.BlockUI,{overlayClassName:"bg-white bg-opacity-25",loading:v,children:(0,e.jsxs)(a.Form,{onValuesChange:q,form:o,className:"form d-flex flex-column",children:[(0,e.jsxs)(a.Tabs,{type:"line-tabs",tabContentClassName:"mw-800px",defaultActiveKey:"general",contentContainer:!1,className:"border-0 fs-4 fw-bold mb-n2 nav-line-tabs-2x",children:[(0,e.jsx)(a.Tabs.TabPane,{tab:"\u8BBE\u5907\u4FE1\u606F",forceRender:!0,children:(0,e.jsxs)("div",{className:"py-4",children:[(0,e.jsxs)(a.Row,{className:"mt-5",children:[(0,e.jsx)(a.Col,{span:6,children:(0,e.jsx)(a.Form.Item,{className:"mb-5",name:"productName",label:"\u4EA7\u54C1",children:(0,e.jsx)(a.Input,{solid:!0,readOnly:!0})})}),(0,e.jsx)(a.Col,{span:6,children:(0,e.jsx)(a.Form.Item,{className:"mb-5",name:"name",label:"\u540D\u79F0",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u540D\u79F0"}],children:(0,e.jsx)(a.Input,{solid:!0})})})]}),(0,e.jsxs)(a.Row,{className:"mt-5",children:[(0,e.jsx)(a.Col,{span:6,children:(0,e.jsx)(a.Form.Item,{className:"mb-5",name:"no",label:"\u8D44\u4EA7\u7F16\u53F7",children:(0,e.jsx)(a.Input,{solid:!0})})}),(0,e.jsx)(a.Col,{span:6,children:(0,e.jsx)(a.Form.Item,{className:"mb-5",name:"sn",label:"\u4EA7\u54C1\u5E8F\u5217\u53F7",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u5E8F\u5217\u53F7"}],children:(0,e.jsx)(a.Input,{solid:!0})})})]}),(0,e.jsxs)(a.Row,{className:"mt-5",children:[(0,e.jsx)(a.Col,{span:6,children:(0,e.jsx)(a.Form.Item,{className:"mb-5",name:"purchaseDate",label:"\u8D2D\u4E70\u65E5\u671F",children:(0,e.jsx)(a.DatePicker,{})})}),(0,e.jsx)(a.Col,{span:6})]})]})},"general"),(0,e.jsx)(a.Tabs.TabPane,{tab:"\u4FDD\u4FEE\u4FE1\u606F",forceRender:!0,children:(0,e.jsxs)("div",{className:"py-4",children:[(0,e.jsxs)(a.Row,{className:"mt-5",children:[(0,e.jsx)(a.Col,{span:6,children:(0,e.jsx)(a.Form.Item,{className:"mb-5",name:"warrantyPolicyId",label:"\u4FDD\u4FEE\u7B56\u7565",children:(0,e.jsx)(a.Select,{solid:!0,options:H.map(function(n){return{label:n.name,value:n.id}})})})}),(0,e.jsx)(a.Col,{span:6})]}),(0,e.jsxs)(a.Row,{className:"mt-5",children:[(0,e.jsx)(a.Col,{span:6,children:(0,e.jsx)(a.Form.Item,{className:"mb-5",name:"warrantyStartDate",label:"\u4FDD\u4FEE\u5F00\u59CB\u65E5\u671F",children:(0,e.jsx)(a.DatePicker,{})})}),(0,e.jsx)(a.Col,{span:6,children:(0,e.jsx)(a.Form.Item,{className:"mb-5",name:"warrantyEndDate",label:"\u4FDD\u4FEE\u7ED3\u675F\u65E5\u671F",children:(0,e.jsx)(a.DatePicker,{})})})]})]})},"warranty-information"),(0,e.jsx)(a.Tabs.TabPane,{tab:"\u95E8\u5E97\u4FE1\u606F",forceRender:!0,children:(0,e.jsxs)("div",{className:"py-4",children:[(0,e.jsxs)(a.Row,{className:"mt-5",children:[(0,e.jsx)(a.Col,{span:6,children:(0,e.jsx)(a.Form.Item,{className:"mb-5",name:"customer",label:"\u5BA2\u6237",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u4E00\u4E2A\u5BA2\u6237"}],children:(0,e.jsx)(a.Select,{solid:!0,options:J.map(function(n){return{label:n.name,value:n.id}}),onChange:Z})})}),(0,e.jsx)(a.Col,{span:6,children:(0,e.jsx)(a.Form.Item,{className:"mb-5",name:["customerStore","id"],label:"\u95E8\u5E97",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u4E00\u4E2A\u95E8\u5E97"}],children:(0,e.jsx)(a.Select2,{solid:!0,className:"w-150px",selectClassName:"w-150px",matcher:function(d,r){return!d.term||d.term===""||r.text.includes(d.term)?r:null},options:_.map(function(n){return{label:n.name,value:n.id}})})})})]}),(0,e.jsx)(a.Row,{className:"mt-5",children:(0,e.jsx)(a.Col,{span:12,children:(0,e.jsx)(a.Form.Item,{className:"mb-5",name:"address",label:"\u6240\u5728\u5730\u533A",children:(0,e.jsx)(a.RegionPicker,{ends:"district",resultType:"object"})})})}),(0,e.jsx)(a.Row,{children:(0,e.jsx)(a.Col,{span:12,children:(0,e.jsx)(a.Form.Item,{className:"mb-5",name:"detailedAddress",label:"\u8BE6\u7EC6\u5730\u5740",children:(0,e.jsx)(a.Input.TextArea,{})})})})]})},"store-information"),(0,e.jsx)(a.Tabs.TabPane,{tab:"\u8054\u7CFB\u65B9\u5F0F",forceRender:!0,children:(0,e.jsxs)("div",{className:"py-4",children:[(0,e.jsxs)(a.Row,{className:"mt-5",children:[(0,e.jsx)(a.Col,{span:6,children:(0,e.jsx)(a.Form.Item,{className:"mb-5",name:["contactInfo","name"],label:"\u8054\u7CFB\u4EBA",children:(0,e.jsx)(a.Input,{solid:!0})})}),(0,e.jsx)(a.Col,{span:6,children:(0,e.jsx)(a.Form.Item,{className:"mb-5",name:["contactInfo","phone"],label:"\u8054\u7CFB\u7535\u8BDD",children:(0,e.jsx)(a.Input,{solid:!0})})})]}),(0,e.jsxs)(a.Row,{className:"mt-5",children:[(0,e.jsx)(a.Col,{span:6,children:(0,e.jsx)(a.Form.Item,{className:"mb-5",name:["contactInfo","email"],label:"\u7535\u5B50\u90AE\u7BB1",children:(0,e.jsx)(a.Input,{solid:!0})})}),(0,e.jsx)(a.Col,{span:6})]})]})},"contact-information"),(0,e.jsx)(a.Tabs.TabPane,{tab:"\u7EF4\u62A4\u4EBA\u4FE1\u606F",forceRender:!0,children:(0,e.jsxs)("div",{className:"py-4",children:[(0,e.jsxs)(a.Row,{className:"mt-5",children:[(0,e.jsx)(a.Col,{span:6,children:(0,e.jsx)(a.Form.Item,{className:"mb-5",label:"\u521B\u5EFA\u4EBA",children:(0,e.jsx)(a.Input,{value:s==null||(b=s.createdBy)===null||b===void 0?void 0:b.name,solid:!0,readOnly:!0})})}),(0,e.jsx)(a.Col,{span:6,children:(0,e.jsx)(a.Form.Item,{className:"mb-5",label:"\u521B\u5EFA\u65F6\u95F4",children:(0,e.jsx)(a.Input,{value:s==null?void 0:s.createdAt,solid:!0,readOnly:!0})})})]}),(0,e.jsxs)(a.Row,{className:"mt-5",children:[(0,e.jsx)(a.Col,{span:6,children:(0,e.jsx)(a.Form.Item,{className:"mb-5",label:"\u66F4\u65B0\u4EBA",children:(0,e.jsx)(a.Input,{value:s==null||(x=s.updatedBy)===null||x===void 0?void 0:x.name,solid:!0,readOnly:!0})})}),(0,e.jsx)(a.Col,{span:6,children:(0,e.jsx)(a.Form.Item,{className:"mb-5",label:"\u66F4\u65B0\u65F6\u95F4",children:(0,e.jsx)(a.Input,{value:s==null?void 0:s.updatedAt,solid:!0,readOnly:!0})})})]})]})},"maintainer-information")]}),(0,e.jsx)(a.Button,{className:"w-100px",onClick:X,children:"\u4FDD\u5B58"})]})})})})})}F.default=L}}]);

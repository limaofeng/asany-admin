(self.webpackChunkasany_admin=self.webpackChunkasany_admin||[]).push([[3945],{33945:function(ie,N,u){"use strict";u.r(N);var _=u(11849),w=u(93224),y=u(3182),f=u(2824),V=u(94043),h=u.n(V),j=u(67294),I=u(81303),Q=u(75468),a=u(11974),H=u(71447),e=u(85893);function X(L){var P,F=L.match,p=L.history,J=(0,H.GR)(),Y=(0,f.Z)(J,2),k=Y[1].loadRegion,q=(0,I.eU)({fetchPolicy:"cache-and-network"}),S=(0,f.Z)(q,2),T=S[0],R=S[1],O=R.data,U=R.loading,ee=(0,I.Sj)({fetchPolicy:"cache-and-network"}),W=(0,f.Z)(ee,2),D=W[0],M=W[1].loading,ae=(0,I.j6)({}),K=(0,f.Z)(ae,2),G=K[0],se=K[1].loading,re=(0,I.mt)({}),$=(0,f.Z)(re,2),z=$[0],le=$[1].loading,E=F.params.id=="new",t=a.l0.useForm(),de=(0,j.useCallback)((0,y.Z)(h().mark(function b(){var l,i,o,d;return h().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,t.validateFields();case 2:if(l=s.sent,i=l.detailedAddress,o=l.address,d=(0,w.Z)(l,["detailedAddress","address"]),!E){s.next=11;break}return s.next=9,G({variables:{input:(0,_.Z)((0,_.Z)({},d),{},{address:(0,_.Z)((0,_.Z)({},o),{},{detailedAddress:i})})}});case 9:s.next=13;break;case 11:return s.next=13,z({variables:{id:F.params.id,input:(0,_.Z)((0,_.Z)({},d),{},{address:(0,_.Z)((0,_.Z)({},o),{},{detailedAddress:i})})}});case 13:a.FN.success("\u95E8\u5E97 \u201C".concat(d.name,"\u201D ").concat(E?"\u65B0\u589E":"\u4FEE\u6539","\u6210\u529F"),2e3,{placement:"bottom-start",progressBar:!0}),p.length?p.goBack():p.replace("/website/landing/stores");case 15:case"end":return s.stop()}},b)})),[G,F.params.id,t,p,E,z]);(0,j.useEffect)(function(){if(F.params.id!="new"){var b=new AbortController;return T({variables:{id:F.params.id},context:{fetchOptions:{signal:b.signal}}}).then(function(){var l=(0,y.Z)(h().mark(function i(o){var d,r,s,c,g,n,v,B,A,C;return h().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(r=o.data,console.log("loadStore",r==null?void 0:r.store),s=r==null?void 0:r.store,s){x.next=8;break}return x.next=6,a.u_.error({content:"\u95E8\u5E97\u4E0D\u5B58\u5728,\u53EF\u80FD\u5DF2\u7ECF\u88AB\u5220\u9664\u4E86",timer:3e3,timerProgressBar:!0});case 6:return!p.length||E?p.replace("/website/landing/stores"):p.goBack(),x.abrupt("return");case 8:c=s.location||{},g=c.__typename,n=(0,w.Z)(c,["__typename"]),v=s.address||{},B=v.__typename,A=v.detailedAddress,C=(0,w.Z)(v,["__typename","detailedAddress"]),t.setFieldsValue((0,_.Z)((0,_.Z)({},s),{},{address:C,location:n,detailedAddress:A,qrCode:(d=s.qrCode)===null||d===void 0?void 0:d.id}));case 11:case"end":return x.stop()}},i)}));return function(i){return l.apply(this,arguments)}}()),function(){b.abort()}}},[t,T,p,F.params.id,E]);var ne=(0,j.useCallback)(function(){var b=(0,y.Z)(h().mark(function l(i){var o,d,r,s,c,g,n,v,B,A,C,Z;return h().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(o=t.getFieldValue("address"),d=t.getFieldValue("location"),!o){m.next=4;break}return m.abrupt("return");case 4:if(r=i.clipboardData.getData("text/plain"),["\u7701","\u5E02","\u533A","\u53BF"].some(function(te){return r.includes(te)})){m.next=7;break}return m.abrupt("return");case 7:return m.next=9,D({variables:{address:r}});case 9:return s=m.sent,c=s.data,g=c.amapOpenAPI.geocodes[0],m.next=14,k(g.adcode);case 14:n=m.sent,v=r.indexOf(g.district),v!=-1&&(r=r.substring(v+g.district.length)),d==null?(B=g.location.split(","),A=(0,f.Z)(B,2),C=A[0],Z=A[1],t.setFieldsValue({address:n,detailedAddress:r,location:{longitude:C,latitude:Z}})):t.setFieldsValue({address:n,detailedAddress:r});case 18:case"end":return m.stop()}},l)}));return function(l){return b.apply(this,arguments)}}(),[t,k,D]),ue=(0,j.useCallback)((0,y.Z)(h().mark(function b(){var l,i,o,d,r,s,c;return h().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(l=t.getFieldsValue(),!(!l.address||!l.detailedAddress)){n.next=4;break}return a.u_.warning({content:"\u8BF7\u786E\u4FDD\u5730\u533A\u4E0E\u8BE6\u7EC6\u5730\u5740\u5DF2\u7ECF\u5F55\u5165",timer:3e3,timerProgressBar:!0}),n.abrupt("return");case 4:return n.next=6,D({variables:{city:l.address[l.address.length-1],address:l.detailedAddress}});case 6:i=n.sent,o=i.data,d=o.amapOpenAPI.geocodes[0].location.split(","),r=(0,f.Z)(d,2),s=r[0],c=r[1],t.setFieldsValue({location:{longitude:s,latitude:c}});case 10:case"end":return n.stop()}},b)})),[t,D]);return(0,e.jsx)(Q.v,{header:E?{title:"\u65B0\u589E\u95E8\u5E97"}:void 0,footer:!1,children:(0,e.jsxs)(a.Zb,{className:"mb-5 mb-xl-10",children:[(0,e.jsx)(a.Zb.Header,{children:(0,e.jsx)(a.Zb.Title,{children:E?"\u65B0\u589E\u95E8\u5E97":O==null||(P=O.store)===null||P===void 0?void 0:P.name})}),(0,e.jsxs)(a.Zb.Body,{children:[(0,e.jsx)(a.bH,{overlayClassName:"bg-white bg-opacity-25",loading:U,children:(0,e.jsxs)(a.l0,{form:t,className:"w-800px row d-flex flex-shrink-0 flex-column-reverse flex-md-row",children:[(0,e.jsxs)("div",{className:"col-12 col-md-8",children:[(0,e.jsx)(a.l0.Item,{className:"mb-5",name:"code",label:"\u5E97\u53F7",rules:[{required:!0,message:"\u5E97\u53F7\u4E0D\u80FD\u4E3A\u7A7A"}],help:"\u8BF7\u5C3D\u91CF\u4FDD\u8BC1\u5E97\u94FA\u7F16\u53F7\u7684\u552F\u4E00\u6027",children:(0,e.jsx)(a.II,{solid:!0,className:"w-400px"})}),(0,e.jsx)(a.l0.Item,{className:"mb-5",name:"name",label:"\u540D\u79F0",rules:[{required:!0,message:"\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A"}],children:(0,e.jsx)(a.II,{solid:!0,className:"w-400px"})}),(0,e.jsx)(a.l0.Item,{className:"my-5",name:"address",label:"\u6240\u5728\u5730\u533A",children:(0,e.jsx)(a.H6,{solid:!0,resultType:"object",className:"w-400px",ends:"district",placeholder:"--\u8BF7\u9009\u62E9--"})}),(0,e.jsx)(a.l0.Item,{className:"my-5",name:"detailedAddress",label:"\u8BE6\u7EC6\u5730\u5740",help:"\u76F4\u63A5\u7C98\u8D34\u5B8C\u6574\u5730\u5740,\u4F1A\u81EA\u52A8\u8BC6\u522B\u6240\u5728\u5730\u533A\u4E0E\u5730\u7406\u4F4D\u7F6E",children:(0,e.jsx)(a.II.TextArea,{solid:!0,className:"w-400px",onPaste:ne})}),(0,e.jsx)(a.l0.Item,{className:"my-5",labelClassName:"d-inline-flex align-items-center",label:(0,e.jsxs)(e.Fragment,{children:["\u5730\u7406\u4F4D\u7F6E",(0,e.jsx)("a",{onClick:M?void 0:ue,className:"ps-2 cursor-pointer",children:M?"\u8BC6\u522B\u4E2D,\u8BF7\u7A0D\u7B49...":"\u901A\u8FC7\u5730\u5740\u8BC6\u522B"}),(0,e.jsx)(a.yC,{className:"text-primary d-inline-flex align-items-center ms-2",size:"small",spinning:M})]}),help:"\u9AD8\u5FB7\u5750\u6807\u7CFB\u7ECF\u7EAC\u5EA6\uFF0C\u4E14\u4E0D\u8D85\u8FC76\u4F4D\u5C0F\u6570\uFF0C\u5747\u4E0D\u586B\u5219\u81EA\u52A8\u8BC6\u522B",children:(0,e.jsxs)(a.II.Group,{solid:!0,className:"w-400px",children:[(0,e.jsx)(a.II.Group.Text,{children:"\u7ECF\u5EA6"}),(0,e.jsx)(a.l0.Item,{noStyle:!0,name:["location","longitude"],children:(0,e.jsx)(a.II,{})}),(0,e.jsx)(a.II.Group.Text,{children:"\u7EAC\u5EA6"}),(0,e.jsx)(a.l0.Item,{noStyle:!0,name:["location","latitude"],children:(0,e.jsx)(a.II,{})})]})}),(0,e.jsx)(a.l0.Item,{className:"my-5",name:"leader",label:"\u8D1F\u8D23\u4EBA",children:(0,e.jsx)(a.II,{solid:!0,className:"w-400px"})}),(0,e.jsx)(a.l0.Item,{className:"my-5",name:"description",label:"\u63CF\u8FF0",help:"\u8BF7\u7528\u5C11\u4E8E250\u5B57\u7B26\u63CF\u8FF0",children:(0,e.jsx)(a.II.TextArea,{solid:!0,autoSize:{minRows:4,maxRows:8},showCount:!0,maxLength:250,className:"w-400px"})})]}),(0,e.jsx)("div",{className:"col-12 col-md-4",children:(0,e.jsx)(a.l0.Item,{className:"mb-5",name:"qrCode",label:"\u95E8\u5E97\u4E8C\u7EF4\u7801",children:(0,e.jsx)(a.gq.Image,{width:250,height:250,space:"orX8kLOV",crop:{height:450,zoomable:!1,aspectRatio:1},backgroundImage:"/assets/media/background/qrcode_icon.png"})})})]})}),(0,e.jsx)(a.zx,{loading:U||se||le,onClick:de,children:E?(0,e.jsx)(e.Fragment,{children:"\u6DFB\u52A0\u95E8\u5E97"}):(0,e.jsx)(e.Fragment,{children:"\u4FEE\u6539\u95E8\u5E97\u4FE1\u606F"})})]})]})})}N.default=X}}]);

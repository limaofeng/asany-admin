"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[6686],{97961:function(Je,ge,t){t.d(ge,{$F:function(){return Z},$M:function(){return de},Cd:function(){return xe},Co:function(){return c},Dw:function(){return he},Oo:function(){return R},a7:function(){return d},cu:function(){return i},j7:function(){return e},jA:function(){return z},jf:function(){return ie},oJ:function(){return m},rF:function(){return D},rl:function(){return n}});var M=t(28525),ee="UPDATEFRIENDCARD",de="TOASSIGNCVE",Z="RESETCVE",o="OPENSINGLEMODAL",Y="OPENGROUPMODAL",xe="DELETEMESSAGE",ie="ISSETDRAFT",D="REVOKEMSG",i="REPLAYMSG",R="FORWARDANDMERMSG",z="SENDFORWARDMSG",n="MUTILMSG",c="MUTILMSGCHANGE",d="MERMSGMODAL",m="ATSTATEUPDATE",F="ANTDLOCALCHANGE",p="APPLICATIONTYPEUPDATE",U="CLEARSEARCHINPUT",he=[M.Cs.PictureMessage,M.Cs.VideoMessage,M.Cs.VoiceMessage,M.Cs.FileMessage],e={RevokeMessage:M.Cs.RevokeMessage,FriendAdded:M.Cs.FriendAdded,GroupCreated:M.Cs.GroupCreated,GroupNameUpdated:M.Cs.GroupNameUpdated,GroupOwnerTransferred:M.Cs.GroupOwnerTransferred,MemberQuit:M.Cs.MemberQuit,MemberInvited:M.Cs.MemberInvited,MemberKicked:M.Cs.MemberKicked,MemberEnter:M.Cs.MemberEnter}},78864:function(Je,ge,t){var M=t(17187),ee=t.n(M),de=new M.EventEmitter;de.setMaxListeners(12),ge.Z=de},36603:function(Je,ge,t){t.d(ge,{LF:function(){return i},RD:function(){return Y},RT:function(){return de},Sv:function(){return xe},Tf:function(){return ie},_x:function(){return D},p6:function(){return Z},sc:function(){return R},vJ:function(){return ee}});var M=t(28525),ee=function(n){return n.userID!==""&&n.groupID===""},de=function(n){var c=window.getSelection(),d=document.createRange();d.selectNodeContents(n.current),d.collapse(!1),c==null||c.removeAllRanges(),c==null||c.addRange(d)},Z=function(n){var c=new Date(n),d=c.getFullYear(),m=c.getMonth()+1,F=c.getDate(),p=c.getHours(),U=c.getMinutes();U.toString().length===1&&(U="0"+U);var he=c.getSeconds();he.toString().length===1&&(he="0"+he);var e=d+"-"+m+"-"+F,Qe=p+":"+U;return[d,m,F,e,Qe]},o=function(n,c){axios.get(n,{headers:{"Content-Type":"application/x-www-form-urlencoded"},responseType:"blob"}).then(function(d){var m=new Blob([d.data]),F=c,p=document.createElement("a");p.download=F,p.style.display="none",p.href=URL.createObjectURL(m),document.body.appendChild(p),p.click(),URL.revokeObjectURL(p.href),document.body.removeChild(p)}).catch(function(d){console.log(d)})},Y=function(n){if(n===0)return"0 B";var c=1024,d=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],m=Math.floor(Math.log(n)/Math.log(c));return(n/Math.pow(c,m)).toPrecision(3)+" "+d[m]},xe=function(n){var c=["jpeg","tiff","png","gif","jpg","gif"],d=["ppt","pptx"],m=["xlsx","xls"],F=["doc","docx"],p=["rar","zip"];return c.includes(n)?"file_pic":d.includes(n)?"file_ppt":m.includes(n)?"file_xslx":F.includes(n)?"file_world":p.includes(n)?"file_zip":n==="pdf"?"file_pdf":"file_unknow"},ie=function(){var n=window.getSelection(),c=n.getRangeAt(0),d=document.createElement("br"),m=document.createTextNode("\xA0");c.deleteContents(),c.insertNode(d),c.collapse(!1),c.insertNode(m),c.selectNodeContents(m),n.removeAllRanges(),n.addRange(c),document.execCommand("delete")},D=function(n){for(var c=n.split(","),d=c[0].match(/:(.*?);/)[1],m=atob(c[1]),F=m.length,p=new Uint8Array(F);F--;)p[F]=m.charCodeAt(F);return new File([p],"screenshot".concat(Date.now(),".png"),{type:d})},i=function(n,c){var d=function(Ge){return Ge===c};switch(n.contentType){case M.Cs.TextMessage:return n.content;case M.Cs.AtTextMessage:return n.atTextElem.text;case M.Cs.PictureMessage:return"PictureMessage";case M.Cs.VideoMessage:return"VideoMessage";case M.Cs.VoiceMessage:return"VoiceMessage";case M.Cs.LocationMessage:return"LocationMessage";case M.Cs.CardMessage:return"CardMessage";case M.Cs.MergeMessage:return"MergeMessage";case M.Cs.FileMessage:return"FileMessage";case M.Cs.RevokeMessage:return"".concat(d(n.sendID)?"\u4F60":n.senderNickname,"\u64A4\u56DE\u4E86\u4E00\u6761\u6D88\u606F");case M.Cs.CustomMessage:return"CustomMessage";case M.Cs.QuoteMessage:return"QuoteMessage";case M.Cs.FriendAdded:return"AlreadyFriend";case M.Cs.MemberEnter:{var m=JSON.parse(n.notificationElem.detail),F=m.entrantUser;return"".concat(d(F.userID)?"You":F.nickname,"JoinedGroup")}case M.Cs.GroupCreated:{var p=JSON.parse(n.notificationElem.detail),U=p.opUser;return"".concat(d(U.userID)?"You":U.nickname,"GroupCreated")}case M.Cs.MemberInvited:{var he,e=JSON.parse(n.notificationElem.detail),Qe=e.opUser,He=(he=e.invitedUserList)!==null&&he!==void 0?he:[],x="";return He.forEach(function(g){return x+=(d(g.userID)?"You":g.nickname)+" "}),"".concat(d(Qe.userID)?"You":Qe.nickname,"Invited").concat(x,"IntoGroup")}case M.Cs.MemberKicked:{var H,C=JSON.parse(n.notificationElem.detail),pe=C.opUser,ye=(H=C.kickedUserList)!==null&&H!==void 0?H:[],ae="";return ye.forEach(function(g){return ae+=(d(g.userID)?"You":g.nickname)+" "}),"".concat(d(pe.userID)?"You":pe.nickname,"Kicked").concat(ae,"OutGroup")}case M.Cs.MemberQuit:{var we=JSON.parse(n.notificationElem.detail),Ne=we.quitUser;return"".concat(d(Ne.userID)?"You":Ne.nickname,"QuitedGroup")}default:return n.notificationElem.detail}},R=function(n,c,d){if(Notification&&document.hidden){var m,F=n.contentType===M.Cs.FriendAdded?"FriendNotice":n.senderNickname,p=new Notification(F,{dir:"auto",tag:(m=d!=null?d:n.groupID)!==null&&m!==void 0?m:n.sendID,renotify:!0,icon:n.senderFaceUrl,body:i(n),requireInteraction:!0}),U=n.sessionType===M.FF.Single?n.contentType===M.Cs.FriendAdded?n.recvID:n.sendID:n.groupID;p.onclick=function(){c&&c(U,n.sessionType),p.close()}}}},15132:function(Je,ge,t){t.d(ge,{Z:function(){return Ht}});var M=t(64599),ee=t.n(M),de=t(5574),Z=t.n(de),o=t(67294),Y=t(46027),xe=t(35090),ie=t(93967),D=t.n(ie),i=t(89717),R=t(36603),z=t(35908),n=t(97961),c=t(78864),d=t(15009),m=t.n(d),F=t(99289),p=t.n(F),U=t(1861),he=t(27856),e=t(85893),Qe=function(v,a){var f,r=v.data,l=v.fetchMoreData,T=v.hasMore,E=v.children,y=v.loading,O=v.holdHeight,P=O===void 0?30:O,V=(0,o.useRef)(null),K=(f=V.current)===null||f===void 0?void 0:f.osInstance(),te=(0,o.useRef)({scrollTop:0,contentHeight:0});(0,o.useImperativeHandle)(a,function(){return K},[K]);var oe=(0,o.useCallback)(function(){var S=p()(m()().mark(function J(le){var j;return m()().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(j=P!=null?P:30,te.current.contentHeight=le.target.scrollHeight,te.current.scrollTop=le.target.scrollTop,!(le.target.scrollTop<j)){_.next=7;break}if(!(y||!T)){_.next=6;break}return _.abrupt("return");case 6:requestAnimationFrame(l);case 7:case"end":return _.stop()}},J)}));return function(J){return S.apply(this,arguments)}}(),[l,T,P,y]),re=(0,he.P)(500,oe);return(0,e.jsxs)(U.E,{ref:V,className:"d-flex h-100 flex-column custom-scrollbar pe-9 pt-8",options:{scrollbars:{autoHide:"scroll"},callbacks:{onScroll:re,onContentSizeChanged:function(J){if(J){if(!K){setTimeout(function(){var j;(j=V.current)===null||j===void 0||(j=j.osInstance())===null||j===void 0||j.scroll({y:"100%"})});return}if(K.scroll().max.y===0)K.scroll({y:"100%"});else if(te.current.contentHeight){var le=J.height-te.current.contentHeight;K.scroll({y:le+te.current.scrollTop})}}}}},children:[E,T?(0,e.jsx)("div",{className:D()("scroll-view-spin","d-flex align-items-center justify-content-center","fs-6",{"flex-column-fluid":r.length===0,"h-40px":r.length!==0}),children:(0,e.jsx)(i.Spin,{tip:"\u52A0\u8F7D\u4E2D...",indicator:"Loading",size:"small"})}):(0,e.jsx)("div",{className:"con_nomore",children:"\u6CA1\u6709\u66F4\u591A\u5566~"})]})},He=o.forwardRef(Qe),x=t(97857),H=t.n(x),C=t(28525),pe=t(42532),ye=t(96522),ae=t(31254),we=t(86366),Ne=[C.Cs.TextMessage,C.Cs.AtTextMessage],g=[C.Cs.PictureMessage,C.Cs.VideoMessage,C.Cs.FileMessage],Ge=function(v){var a,f,r,l=v.msg,T=v.isSelf,E=v.children,y=(0,o.useState)(!1),O=Z()(y,2),P=O[0],V=O[1],K=["Copy","Translate","Reply","Forward"],te=(0,we.Z)(),oe=Z()(te,2),re=oe[1],S=function(){c.Z.emit(n.Oo,"forward",JSON.stringify(l))},J=function(){c.Z.emit(n.rl,!0)},le=function(){c.Z.emit(n.cu,l)},j=(0,o.useCallback)(function(){ae.S.revokeMessage(l).then(function(w){c.Z.emit(n.rF,l.clientMsgID),console.log("res",w)}).catch(function(w){return i.Toast.error("\u64A4\u56DE\u6D88\u606F\u5931\u8D25\uFF01",w)})},[l]),Ae=(0,o.useCallback)(function(){console.log("msg",l),ae.S.deleteMessageFromLocalStorage(JSON.stringify(l)).then(function(w){c.Z.emit(n.Cd,l.clientMsgID),console.log("res",w)}).catch(function(w){return i.Toast.error("\u5220\u9664\u6D88\u606F\u5931\u8D25\uFF01"+w.message)})},[l]),_=(0,o.useCallback)(p()(m()().mark(function w(){var W;return m()().wrap(function(Te){for(;;)switch(Te.prev=Te.next){case 0:return V(!1),Te.next=3,i.Modal.confirm({title:"\u5220\u9664\u6D88\u606F",content:(0,e.jsx)(e.Fragment,{children:(0,e.jsx)("p",{className:"tip-confirm",children:"\u786E\u5B9A\u5220\u9664\u8BE5\u6D88\u606F\u5417\uFF1F"})}),icon:"info",okText:"\u5220\u9664"});case 3:W=Te.sent,W.isConfirmed&&Ae();case 5:case"end":return Te.stop()}},w)})),[Ae]),Me=(0,o.useCallback)(function(){var w="";switch(l.contentType){case C.Cs.PictureMessage:w=l.pictureElem.sourcePicture.url;break;case C.Cs.VideoMessage:w=l.videoElem.videoUrl;break;case C.Cs.FileMessage:w=l.fileElem.sourceUrl;break;default:break}var W=w.lastIndexOf("/"),Oe=w.slice(W+1);downloadFileUtil(w,Oe)},[l.contentType,(a=l.fileElem)===null||a===void 0?void 0:a.sourceUrl,(f=l.pictureElem)===null||f===void 0||(f=f.sourcePicture)===null||f===void 0?void 0:f.url,(r=l.videoElem)===null||r===void 0?void 0:r.videoUrl]),Ee=(0,o.useMemo)(function(){return[{id:"Translate",title:"\u7FFB\u8BD1",icon:"Bootstrap/translate",method:function(){},hidden:!0},{id:"Forward",title:"\u8F6C\u53D1",icon:"Bootstrap/arrow-up-right-square",method:S,hidden:!1},{id:"Copy",title:"\u590D\u5236",icon:"Bootstrap/clipboard2",method:function(){var W=l.contentType===messageTypes.ATTEXTMESSAGE?l.atElem.text:l.content;re(W),i.Toast.success("\u590D\u5236\u6210\u529F\uFF01"),V(!1)},hidden:!1},{id:"Multiple",title:"\u591A\u9009",icon:"Bootstrap/list-check",method:J,hidden:!1},{id:"Reply",title:"\u5F15\u7528",icon:"Bootstrap/chat-quote",method:le,hidden:!1},{id:"Revoke",title:"\u64A4\u56DE",icon:"Bootstrap/arrow-90deg-down",method:j,hidden:!1},{id:"Delete",title:"\u5220\u9664",icon:"Bootstrap/trash",method:_,hidden:!1},{id:"Download",title:"\u4E0B\u8F7D",icon:"Bootstrap/download",method:Me,hidden:!1}]},[re,_,Me,S,l.atElem.text,l.content,l.contentType,le,j]),je=function(W){return!Ne.includes(l.contentType)&&K.includes(W.id)&&(W.hidden=!0),W.id==="Download"&&!g.includes(l.contentType)&&(W.hidden=!0),!T&&W.id==="Revoke"&&(W.hidden=!0),!W.hidden&&(0,e.jsx)(i.Menu.Item,{icon:(0,e.jsx)(Y.JO,{name:W.icon,className:"svg-icon-6"}),className:"px-3",onClick:W.method,children:W.title},W.id)};return(0,e.jsx)(i.Popover,{trigger:"contextMenu",visible:P,onVisibleChange:V,content:(0,e.jsx)(i.Menu,{className:"menu-sub show menu-sub-dropdown show menu-gray-600 menu-state-bg-light-primary fw-bold fs-8 w-125px py-2",children:Ee.map(je)}),overlayClassName:"overlay-no-arrow msg_item_menu_popover",children:(0,e.jsx)("div",{className:D()("chat_bg_msg_content py-3",{"ps-4 pe-8":!T,"ps-8 pe-4":T}),children:E})})},mt=Ge,Ke=t(6366),gt=t(12845),We=t(3030),Et=t(30381),ht=t.n(Et),tt=[{context:"[\u6655]",src:""}],nt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAAUCAYAAABWMrcvAAAAAXNSR0IArs4c6QAAAk5JREFUOE+N081LFHEYB/Dvd9wMk0p3dsid1fIkduhUl0jIoDckDx2MOnSKPCU6o5KBkCG9ic4u1CUr6FQHQyqK3CCMBAPpXwjsZWdNZ3YxJXHNeWLH3HZTqzk+z3z4/p7fPEP8+dSPBvS9ezoo/JCw1KE1fQDML5Y3p7ZvKfWegKgXoM+2Qhf/iiqNzyWCklEh9wnQkbTU2HogW8sl6ebMXQrPeSLNyZh2byOQQ3pb6gDojYFy37a08/mgwkgfpAJJDpS/Xa37SRHTfSGQukBxoPrTjbL0ajNiuqaI9BMykohqDTlU0TKnKZsWbQB3bCt0YbWht7pHUIQRQF4vzCtN6cHgbA6FDeekQgx75PHkgBrPS5kApHJhibWpW+q3/CMzbDqXFODaYkYizm0tmwi9NbWTRTIp9HrtAe1ythZuc3aT0gSv6AF1w7lOokvmM6X2oP7dR4Z7lJQ4oDQmrOBzf27DGQexH8JhRgynG0TvD2Xzjq/9W6cLkTQmLM1HuuH2gdJOsJO6kTpNeo+WPTk0FdPe+EdpT+9SZHlSwCu2pfbk5mmSYgwxQ910qyDyEfTXpit3e+bMe4LhxYDUOn3aXMFF+NGmOwZ4NYqEqr9EubCS5h6jJy9BxjMB71Q+9D+ubsw0knwG4GrCCnXn0oxUJ+HdFMi4HdXqCjZiBTpZ1CDgiWRUHfkNncOesGwqpj5egyqN2aAwM5H1IjxjR0NP/7nlv2arAvAKQA2EZ+1o8OF6sOAnzL4QbHG3lQS8niVRhqZj6rv/QhsdKb/+E7En8byRi/iIAAAAAElFTkSuQmCC",pt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAATCAYAAABLN4eXAAAAAXNSR0IArs4c6QAAAiBJREFUOE+Fk0toU1EQhv+5oVINKrgIJAQtuCgkEHLPCQaFiiLYik+KXehKUHErIhWUYgUXFR8rV4orF4LFlaX4AhUqLpIzN5vEIgFfKZKNaEBKQ3JGTkkgMaQ9y5/5ZuafmUPo87TWEwB2GmPuAGh0hlE/SCl1i4gmAbwDcMIY86cd2xdyAUqpi0TkKuWr1er+SqWy7PQ1IRegtT4H4AGAR8aY8z2Q7/t7XaIgCN53tq21figiZ621I4VC4UNXJaXUPIAxEbkcBMG9NphMJrcNDg5+AbBgjDncBWmttwKYFZEDnueN5fP5121QKXWfiC5Ya2M9nrLZ7JZGo7EoIhVm3tUBjRLRCxEZJ631dgBnRGSWmT+1zN8AMAVgyBjz3Wm+78c8z1sCcJWUUs+IaFxEPjLzntaojxDRcwCjxphXTovFYpui0ehfADOu0iURuQ3gLjO7Zbr99ECpVCoyMDBQtdZOrXpKJBIbSqVSvaP/aSK6bq0dCoLgm9PT6fS+UCj01lp7qmcQw8PDm8Ph8CKAn8ycaSfSWs+IyGS9Xt/RBbWAp84LgEPM/NJB8Xh8YyQS+UpEn40xI//vaUFE3DCuMLPzufqUUjeJ6JqIHGXmuS4ok8mcbDabv4MgeNMBjBHRnIjMM/OxdQ82nU4fD4VCT0RkaWVlJVssFn+tCWmtT4vIY+fD87yDuVzux7r/yff93UQ0UavVpsvlcq3z6v8BSUzmcN/zXjIAAAAASUVORK5CYII=",Ve=function(v){var a=v.msg,f=v.audio,r=v.curCve,l=v.selfID,T=(0,o.useState)(!1),E=Z()(T,2),y=E[0],O=E[1],P=(0,gt.useModel)("open-im.contacts",function(se){var B=se.state;return B.groupMemberList}),V=(0,o.useRef)(null),K=(0,o.useState)({}),te=Z()(K,2),oe=te[0],re=te[1],S=(0,o.useRef)();(0,o.useEffect)(function(){var se;O(r?(0,R.vJ)(r):!1),((se=V.current)===null||se===void 0?void 0:se.clientHeight)>60&&re({paddingBottom:"16px",paddingRight:"8px"})},[r]);var J=function(B){return l===B},le=function(B){var h=B,X=/@\S+\s/g,me=h.match(X)||[],$=ee()(me),ce;try{var ue=function(){var De=ce.value,ke=P.find(function(Fe){return Fe.userID===De.slice(1,-1)});ke?h=h.replaceAll(De,`<span onclick='userClick("`.concat(ke.userID.replace(".","-"),`")' style="color:#428be5;cursor: pointer;"> @`).concat(ke.nickname," </span>")):h=h.replaceAll(De,`<span onclick="userClick('`.concat(De.slice(1,-1),`')" style="color:#428be5;cursor: pointer;"> `).concat(De,"</span>"))};for($.s();!(ce=$.n()).done;)ue()}catch(be){$.e(be)}finally{$.f()}return h},j=function(B){return ht()(a.sendTime).format(B?"HH:mm":"YYYY-MM-DD HH:mm")},Ae=function(B,h){c.Z.emit(n.a7,B,h)},_=function(){var B=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"chat_bg_msg_content_time";return(0,e.jsx)(i.Tooltip,{placement:"bottom",inverse:!0,title:j(0),children:(0,e.jsx)("div",{className:B,children:j(1)})})},Me=function(B){var h=B,X=ee()(tt),me;try{for(X.s();!(me=X.n()).done;){var $=me.value,ce=h.indexOf($.context);ce>-1&&(h=h.replaceAll($.context,'<img style="padding-right:2px" width="24px" src='.concat($.src," />")))}}catch(ue){X.e(ue)}finally{X.f()}return h},Ee=function(B){var h=B.replaceAll("\\n","<br>");return h.replaceAll(`
`,"<br>")},je=function(B){var h=B,X=/[(http(s)?):\/\/(www\.)?a-zA-Z0-9@:._\+-~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:_\+.~#?&\/\/=]*)/g,me=h.match(X)||[],$=ee()(me),ce;try{for($.s();!(ce=$.n()).done;){var ue=ce.value;h=h.replaceAll(ue,`<a onclick="urlClick('`.concat(ue,`')" href="javascript:;">`).concat(ue,"</a>"))}}catch(be){$.e(be)}finally{$.f()}return h},w=function(B){switch(B.contentType){case C.Cs.TextMessage:{var h=Ee(je(le(Me(B.content))));return(0,e.jsx)("div",{className:"content",dangerouslySetInnerHTML:{__html:h}})}case C.Cs.AtTextMessage:return le(B.atTextElem.text);case C.Cs.PictureMessage:return(0,e.jsx)(We.Z,{width:60,src:B.pictureElem.sourcePicture.url});default:return""}},W=function(B){var h;f.current.src=B,(h=f.current)===null||h===void 0||h.play()},Oe=function(B){S.current=B,B.on("waiting",function(){console.log("player is waiting")}),B.on("dispose",function(){console.log("player will dispose")})},Te=function(){var B;switch(a.contentType){case C.Cs.TextMessage:{var h=a.content;return h=Me(h),h=je(h),h=Ee(h),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{ref:V,style:oe,className:"chat_bg_msg_content_text ".concat(y?"":"nick_magin"),children:(0,e.jsx)("div",{dangerouslySetInnerHTML:{__html:h}})}),_()]})}case C.Cs.AtTextMessage:{var X=a.atTextElem.text;return X=Me(X),X=le(X),X=je(X),X=Ee(X),(0,e.jsxs)("div",{style:oe,className:"chat_bg_msg_content_text ".concat(y?"":"nick_magin"),children:[(0,e.jsx)("div",{style:{display:"inline-block"},dangerouslySetInnerHTML:{__html:X}}),_()]})}case C.Cs.PictureMessage:return(0,e.jsxs)("div",{className:"chat_bg_msg_content_pic ".concat(y?"":"nick_magin"),children:[(0,e.jsx)(We.Z,{placeholder:!0,height:200,src:(B=a.pictureElem.snapshotPicture.url)!==null&&B!==void 0?B:a.pictureElem.sourcePicture.url,preview:{visible:!1},fallback:"data:image/png;base64,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"}),_("pic_msg_time")]});case C.Cs.VoiceMessage:{var me=J(a.sendID),$=me?{paddingLeft:"4px"}:{paddingRight:"4px"},ce=me?nt:pt;return(0,e.jsxs)("div",{style:oe,className:"chat_bg_msg_content_text chat_bg_msg_content_voice ".concat(y?"":"nick_magin"),children:[(0,e.jsxs)("div",{style:{flexDirection:me?"row-reverse":"row"},onClick:function(){return W(a.soundElem.sourceUrl)},children:[(0,e.jsx)("img",{style:$,src:ce,alt:""}),"".concat(a.soundElem.duration," ''")]}),_()]})}case C.Cs.FileMessage:{var ue=a.fileElem,be=ue.fileName.slice(ue.fileName.lastIndexOf(".")+1);return(0,e.jsxs)("div",{className:"chat_bg_msg_content_text chat_bg_msg_content_file ".concat(y?"":"nick_magin"),children:[(0,e.jsxs)("div",{className:"file_container",children:[(0,e.jsx)("img",{src:(0,R.Sv)(be),alt:""}),(0,e.jsxs)("div",{className:"file_info",children:[(0,e.jsx)("div",{children:ue.fileName}),(0,e.jsx)("div",{children:(0,R.RD)(ue.fileSize)})]})]}),_()]})}case C.Cs.VideoMessage:{var De={width:240,controls:!0,playbackRates:[.5,1,1.25,1.5,2],responsive:!0,fluid:!0,sources:[{src:a.videoElem.videoUrl,type:"video/mp4"}]};return(0,e.jsxs)("div",{className:"chat_bg_msg_content_video ".concat(y?"":"nick_magin"),children:[(0,e.jsx)(i.VideoPlayer,{options:De,onReady:Oe}),_("video_msg_time")]})}case C.Cs.QuoteMessage:{var ke=a.quoteElem.quoteMessage,Fe=a.quoteElem.text;return Fe=Ee(je(Me(Fe))),(0,e.jsxs)("div",{style:oe,className:"chat_bg_msg_content_text chat_bg_msg_content_qute ".concat(y?"":"nick_magin"),children:[(0,e.jsxs)("div",{className:"qute_content",children:[(0,e.jsx)("div",{children:"".concat("Reply"+a.quoteElem.quoteMessage.senderNickname,":")}),w(ke)]}),(0,e.jsx)("div",{dangerouslySetInnerHTML:{__html:Fe}}),_()]})}case C.Cs.MergeMessage:{var _e,Pe=a.mergeElem;return(0,e.jsxs)("div",{style:oe,onClick:function(){return Ae(Pe,a.sendID)},className:"chat_bg_msg_content_text chat_bg_msg_content_mer ".concat(y?"":"nick_magin"),children:[(0,e.jsx)("div",{className:"title",children:Pe.title}),(0,e.jsx)("div",{className:"content",children:(_e=Pe.abstractList)===null||_e===void 0?void 0:_e.map(function(I){return(0,e.jsx)("div",{className:"item",children:I},I)})}),_()]})}case C.Cs.CardMessage:{var Ce=JSON.parse(a.content);return(0,e.jsxs)("div",{style:oe,className:"chat_bg_msg_content_text chat_bg_msg_content_card ".concat(y?"":"nick_magin"),children:[(0,e.jsx)("div",{className:"title",children:"IDCard"}),(0,e.jsxs)("div",{className:"desc",children:[(0,e.jsx)(i.Symbol.Avatar,{src:Ce.faceURL,size:35}),(0,e.jsx)("div",{className:"card_nick",children:Ce.nickname})]}),_()]})}case C.Cs.LocationMessage:{var vt=a.locationElem,qe={longitude:vt.longitude,latitude:vt.latitude};return(0,e.jsxs)("div",{className:"chat_bg_msg_content_map ".concat(y?"":"nick_magin"),children:[(0,e.jsx)(Ke.D5,{protocol:"https",center:qe,amapkey:"dcdc861728801ee3410f67f6a487d3fa",children:(0,e.jsx)(Ke.Jx,{position:qe})}),_("pic_msg_time")]})}default:return(0,e.jsx)("div",{className:"chat_bg_msg_content_text ".concat(y?"":"nick_magin"),children:"UnsupportedMessage"})}};return Te()},xt=Ve,Ct=[C.Cs.TextMessage,C.Cs.AtTextMessage,C.Cs.PictureMessage,C.Cs.VideoMessage,C.Cs.VoiceMessage,C.Cs.CardMessage,C.Cs.FileMessage,C.Cs.LocationMessage],at=function(v){var a=v.msg,f=v.selfID,r=v.curCve,l=v.mutilSelect,T=v.className,E=(0,o.useState)(!1),y=Z()(E,2),O=y[0],P=y[1],V=(0,o.useRef)(null),K=(0,o.useRef)(null),te=(0,pe.Z)(K),oe=Z()(te,1),re=oe[0],S=(0,o.useMemo)(function(){return f===a.sendID},[f,a.sendID]),J=(0,o.useMemo)(function(){return!r||!(0,R.vJ)(r)},[r]);(0,o.useEffect)(function(){O&&P(!1)},[l]);var le=function(Ee,je){a.isRead=!0,ae.S.markC2CMessageAsRead({userID:Ee,msgIDList:[je]})};(0,o.useEffect)(function(){re&&r.userID===a.sendID&&!a.isRead&&le(a.sendID,a.clientMsgID)},[re,r]);var j=(0,o.useCallback)(function(){switch(a.status){case 1:return(0,e.jsx)(e.Fragment,{children:"loading..."});case 2:return r&&(0,R.vJ)(r)?a.isRead?"\u5DF2\u8BFB":"\u672A\u8BFB":null;case 3:return(0,e.jsx)(e.Fragment,{});default:return null}},[r,a.isRead,a.status]),Ae=function(){l&&Ct.includes(a.contentType)&&(c.Z.emit(n.Co,!O,a),P(function(Ee){return!Ee}))},_=function(){(0,R.vJ)(r)||c.Z.emit(n.oJ,a.sendID,a.senderNickname)};return(0,ye.Z)(_,V,{onClick:function(){},delay:500}),(0,e.jsx)("div",{ref:K,onClick:Ae,className:D()("msg-item d-flex mb-10",T,{"justify-content-start":!S,"justify-content-end":S,"mt-4":S}),children:(0,e.jsxs)("div",{className:D()("d-flex align-items-start",{"flex-column":J,"flex-row-reverse":S&&!J,"flex-row":!S&&!J}),children:[(0,e.jsxs)("div",{className:D()("d-flex align-items-center mb-2"),children:[(0,e.jsx)(i.Symbol.Avatar,{className:D()({"me-4":!S&&!J,"ms-4":S&&!J}),light:!0,size:40,alt:a.senderNickname,src:a.senderFaceUrl}),J&&(0,e.jsxs)("div",{className:"ms-3",children:[(0,e.jsx)("a",{href:"#",className:"fs-5 fw-bold text-gray-900 text-hover-primary me-1",children:a.senderNickname}),(0,e.jsx)("span",{className:"text-muted fs-7 mb-1",children:"2 mins"})]})]}),(0,e.jsxs)("div",{className:D()("msg-item-content rounded text-dark fw-semibold mw-lg-400px text-start",{"bg-light-info":!S,"bg-light-primary":S}),children:[(0,e.jsx)(mt,{msg:a,isSelf:S,children:(0,e.jsx)(xt,H()({},v))},a.clientMsgID),S&&(0,e.jsx)("div",{style:{color:a.isRead?"#999":"#428BE5"},className:"self_msg_chat_flag",children:j()})]})]})})},Xe=at;function rt(N){var v,a=(0,o.useRef)(null),f=N.merID,r=N.msgList,l=N.loadMore,T=N.hasMore,E=N.curCve,y=N.loading,O=(0,o.useState)(!1),P=Z()(O,2),V=P[0],K=P[1],te=(v=(0,z.ot)().data)===null||v===void 0?void 0:v.id,oe=Object.values(n.j7),re=function(Ae){K(Ae)};(0,o.useEffect)(function(){return c.Z.on(n.rl,re),function(){c.Z.off(n.rl,re)}},[]);var S=(0,o.useCallback)(function(j){return j===te},[te]),J=(0,o.useCallback)(function(j){if(j.contentType===n.j7.RevokeMessage){var Ae=j.sendID,_=(0,R.vJ)(E)?E==null?void 0:E.showName:j.senderNickname;return(0,e.jsxs)(e.Fragment,{children:[S(Ae)?"\u4F60":(0,e.jsx)("b",{children:_}),"\u64A4\u56DE\u4E86\u4E00\u6761\u6D88\u606F"]})}switch(j.contentType){case n.j7.FriendAdded:return"AlreadyFriend";case n.j7.GroupCreated:{var Me=JSON.parse(j.notificationElem.detail),Ee=Me.opUser;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("b",{children:S(Ee.userID)?"You":Ee.nickname}),"GroupCreated"]})}case n.j7.GroupNameUpdated:{var je=JSON.parse(j.notificationElem.detail),w=je.opUser;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("b",{children:S(w.userID)?"You":w.nickname}),"ModifiedGroup"]})}case n.j7.GroupOwnerTransferred:{var W=JSON.parse(j.notificationElem.detail),Oe=W.opUser,Te=W.newGroupOwner;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("b",{children:S(Oe.userID)?"You":Oe.nickname}),"TransferTo",(0,e.jsx)("b",{children:S(Te.userID)?"You":Te.nickname})]})}case n.j7.MemberQuit:{var se=JSON.parse(j.notificationElem.detail),B=se.quitUser;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("b",{children:S(B.userID)?"You":B.nickname}),"QuitedGroup"]})}case n.j7.MemberInvited:{var h,X=JSON.parse(j.notificationElem.detail),me=X.opUser,$=(h=X.invitedUserList)!==null&&h!==void 0?h:[],ce=[];return $.forEach(function(Ce){return ce.push((0,e.jsx)("b",{children:S(Ce.userID)?"You":Ce.nickname+" "},Ce.userID))}),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("b",{children:S(me.userID)?"You":me.nickname}),"Invited",ce.map(function(Ce){return Ce}),"IntoGroup"]})}case n.j7.MemberKicked:{var ue,be=JSON.parse(j.notificationElem.detail),De=be.opUser,ke=(ue=be.kickedUserList)!==null&&ue!==void 0?ue:[],Fe=[];return ke.forEach(function(Ce){return Fe.push((0,e.jsx)("b",{children:S(Ce.userID)?"You":Ce.nickname},Ce.userID))}),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("b",{children:S(De.userID)?"You":De.nickname}),"Kicked",Fe.map(function(Ce){return Ce}),"OutGroup"]})}case n.j7.MemberEnter:{var _e=JSON.parse(j.notificationElem.detail),Pe=_e.entrantUser;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("b",{children:S(Pe.userID)?"You":Pe.nickname}),"JoinedGroup"]})}default:return JSON.parse(j.content).defaultTips}},[E,S]),le=(0,o.useCallback)(function(){l(E==null?void 0:E.userID,E==null?void 0:E.groupID,r[r.length-1])},[E==null?void 0:E.groupID,E==null?void 0:E.userID,l,r]);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(He,{holdHeight:40,ref:N.scrollbar,loading:y,data:r,fetchMoreData:le,hasMore:T,children:r==null?void 0:r.map(function(j,Ae){return oe.includes(j.contentType)?(0,e.jsx)("div",{className:D()("chat_bg_tips",{"mb-6":Ae===0}),children:J(j)},j.clientMsgID):(0,e.jsx)(Xe,{audio:a,mutilSelect:V,msg:j,selfID:f!=null?f:te,curCve:E},j.clientMsgID)})}),(0,e.jsx)("audio",{ref:a})]})}var Ze=rt,At=t(19632),Ue=t.n(At),$e=t(3930),st=t(13769),it=t.n(st),ot=t(12444),lt=t.n(ot),ct=t(72004),ut=t.n(ct),dt=t(25098),s=t.n(dt),u=t(31996),L=t.n(u),G=t(26037),Ie=t.n(G),Re=t(9783),ve=t.n(Re),Ye=t(64063),ze=t.n(Ye),fe=["tagName","html","innerRef","placeholder"];function Le(N){return N&&N.replace(/&nbsp;|\u202F|\u00A0/g," ")}function yt(N){var v=document.createTextNode("");N.appendChild(v);var a=document.activeElement===N;if(v!==null&&v.nodeValue!==null&&a){var f=window.getSelection();if(f!==null){var r=document.createRange();r.setStart(v,v.nodeValue.length),r.collapse(!0),f.removeAllRanges(),f.addRange(r)}N instanceof HTMLElement&&N.focus()}}var Be=function(N){L()(a,N);var v=Ie()(a);function a(){var f;lt()(this,a);for(var r=arguments.length,l=new Array(r),T=0;T<r;T++)l[T]=arguments[T];return f=v.call.apply(v,[this].concat(l)),ve()(s()(f),"lastHtml",f.props.html),ve()(s()(f),"el",typeof f.props.innerRef=="function"?{current:null}:o.createRef()),ve()(s()(f),"getEl",function(){return(f.props.innerRef&&typeof f.props.innerRef!="function"?f.props.innerRef:f.el).current}),ve()(s()(f),"emitChange",function(E){var y=f.getEl();if(y){var O=y.innerHTML;if(f.props.onChange&&O!==f.lastHtml){var P=Object.assign({},E,{target:{value:O}});f.props.onChange(P)}f.lastHtml=O}}),f}return ut()(a,[{key:"render",value:function(){var r=this,l=this.props,T=l.tagName,E=l.html,y=l.innerRef,O=l.placeholder,P=it()(l,fe);return o.createElement(T||"div",H()(H()({},P),{},ve()(ve()(ve()(ve()(ve()(ve()(ve()(ve()({},"data-placeholder",O),"ref",typeof y=="function"?function(V){y(V),r.el.current=V}:y||this.el),"onInput",this.emitChange),"onBlur",this.props.onBlur||this.emitChange),"onKeyUp",this.props.onKeyUp||this.emitChange),"onKeyDown",this.props.onKeyDown||this.emitChange),"contentEditable",!this.props.disabled),"dangerouslySetInnerHTML",{__html:E})),this.props.children)}},{key:"shouldComponentUpdate",value:function(r){var l=this.props,T=this.getEl();return!T||Le(r.html)!==Le(T.innerHTML)?!0:l.disabled!==r.disabled||l.tagName!==r.tagName||l.className!==r.className||l.innerRef!==r.innerRef||l.placeholder!==r.placeholder||!ze()(l.style,r.style)}},{key:"componentDidUpdate",value:function(){var r=this.getEl();r&&(this.props.html!==r.innerHTML&&(r.innerHTML=this.props.html),this.lastHtml=this.props.html,yt(r))}}]),a}(o.Component),jt=function(v,a){var f=new FileReader;f.onload=function(r){var l,T=(l=r.target)===null||l===void 0?void 0:l.result;a(T)},f.readAsDataURL(v)},Tt=function(v){var a=v,f=/\<img.*?\">/g,r=a.match(f);if(r&&r.length>0){var l=ee()(r),T;try{for(l.s();!(T=l.n()).done;){var E=T.value;a=a.replaceAll(E,"")}}catch(y){l.e(y)}finally{l.f()}}return a},It=function(v){var a=v,f=Ue()(Array.from(document.getElementsByClassName("face_el"))),r=ee()(f),l;try{for(r.s();!(l=r.n()).done;){var T=l.value;a=a.replaceAll(T.outerHTML,T.alt)}}catch(E){r.e(E)}finally{r.f()}return a},bt=function(v){var a=v;return a.slice(-4)==="<br>"&&(a=a.slice(0,-4)),a=a.replaceAll("<br>",`
`),a},Rt=function(){var v=Ue()(Array.from(document.getElementsByClassName("screenshot_el")));v.length>0&&(v[v.length-1].alt="last",v.map(function(){var a=p()(m()().mark(function f(r){var l;return m()().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:l=(0,R._x)(r.src),console.log(l);case 2:case"end":return E.stop()}},f)}));return function(f){return a.apply(this,arguments)}}()))};function Lt(N){var v=N.curCve,a=N.sendMsg,f=(0,o.useRef)(null),r=(0,o.useRef)(null),l=(0,o.useState)(""),T=Z()(l,2),E=T[0],y=T[1],O=(0,$e.Z)(E),P=(0,o.useState)(),V=Z()(P,2),K=V[0],te=V[1],oe=(0,o.useState)([]),re=Z()(oe,2),S=re[0],J=re[1],le=(0,gt.useModel)("open-im.contacts",function(I){var A=I.state;return A.groupMemberList}),j=(0,o.useState)(!1),Ae=Z()(j,2),_=Ae[0],Me=Ae[1],Ee=(0,$e.Z)(_),je=(0,o.useState)([]),w=Z()(je,2),W=w[0],Oe=w[1],Te=function(A,Q){ae.S.typingStatusUpdate({recvID:A,msgTip:Q})},se=(0,o.useCallback)(function(){(0,R.vJ)(v)&&(f.current&&clearTimeout(f.current),f.current=setTimeout(function(){Te(v.userID,"yes")},2e3))},[v]),B=function(){var I=p()(m()().mark(function A(Q){var b,k,q;return m()().wrap(function(Se){for(;;)switch(Se.prev=Se.next){case 0:b=(Q.originalEvent||Q).clipboardData,b&&b.items[0].type.indexOf("image")===-1?(Q.preventDefault(),k=b.getData("text/plain")||"",document.execCommand("insertText",!1,k)):b&&b.items[0].type.indexOf("image")>-1&&(Q.preventDefault(),q=b.items[0].getAsFile(),jt(q,function(ft){var Mt='<img style="vertical-align:bottom" class="screenshot_el" src="'.concat(ft,'" alt="" >');document.execCommand("insertHTML",!1,Mt)}));case 2:case"end":return Se.stop()}},A)}));return function(Q){return I.apply(this,arguments)}}(),h=(0,o.useRef)({curCve:v,msgContent:E,latestContent:O,atList:S,groupMemberList:le,replyMsg:K,draftSaved:!1});h.current.msgContent=E,h.current.curCve=v,h.current.latestContent=O,h.current.atList=S,h.current.groupMemberList=le,h.current.replyMsg=K;var X=(0,o.useCallback)(function(I,A){var Q=h.current.atList,b=h.current.latestContent,k=h.current.replyMsg;if(k&&te(void 0),Q.findIndex(function(ne){return ne.id===I})===-1){var q='<b class="at_el" data_id="'.concat(I,'" data_name="').concat(A,'" contenteditable="false" style="color:#428be5"> @').concat(A,"</b>");J([].concat(Ue()(Q),[{id:I,name:A,tag:q}])),y(b.current+q),(0,R.RT)(r.current.el)}},[]),me=(0,o.useCallback)(function(I){var A=I,Q=h.current.atList,b=ee()(Q),k;try{for(b.s();!(k=b.n()).done;){var q=k.value;A=A.replaceAll(q.tag,"@".concat(q.id," "))}}catch(ne){b.e(ne)}finally{b.f()}return A},[]),$=(0,o.useCallback)(function(I){var A=h.current.latestContent,Q=h.current.atList;if(I.draftText!==A.current&&(I.draftText!==""||A.current!=="")){h.current.draftSaved=!0;var b=A.current;b=It(b);var k={conversationID:I.conversationID,draftText:Q.length>0?me(b):b};ae.S.setConversationDraft(k).then(function(q){console.warn(q)}).catch(function(q){console.warn(q)}).finally(function(){y("")})}},[me]),ce=(0,o.useCallback)(function(){h.current.latestContent.current="",y(""),te(void 0),J([]),Me(!1),$(v)},[v,$]),ue=(0,o.useCallback)(function(){var I=p()(m()().mark(function A(Q){var b,k;return m()().wrap(function(ne){for(;;)switch(ne.prev=ne.next){case 0:return ne.next=2,ae.S.createTextMessage(Q);case 2:b=ne.sent,k=b.data,a(k,C.Cs.TextMessage),ce();case 6:case"end":return ne.stop()}},A)}));return function(A){return I.apply(this,arguments)}}(),[ce,a]),be=(0,o.useCallback)(function(){var I=p()(m()().mark(function A(Q){var b,k,q;return m()().wrap(function(Se){for(;;)switch(Se.prev=Se.next){case 0:return b={text:Q,atUserIDList:S.map(function(ft){return ft.id})},Se.next=3,ae.S.createTextAtMessage(b);case 3:k=Se.sent,q=k.data,a(q,C.Cs.AtTextMessage),ce();case 7:case"end":return Se.stop()}},A)}));return function(A){return I.apply(this,arguments)}}(),[S,ce,a]),De=(0,o.useCallback)(function(){var I=p()(m()().mark(function A(Q){var b,k;return m()().wrap(function(ne){for(;;)switch(ne.prev=ne.next){case 0:return ne.next=2,ae.S.createQuoteMessage({text:Q,message:JSON.stringify(K)});case 2:b=ne.sent,k=b.data,a(k,C.Cs.QuoteMessage),ce();case 6:case"end":return ne.stop()}},A)}));return function(A){return I.apply(this,arguments)}}(),[ce,K,a]),ke=(0,o.useCallback)(function(I){var A=O.current;if(A=Tt(It(A)),A=bt(A),Rt(),A!=="")switch(I){case"text":ue(A);break;case"at":be(me(A));break;case"quote":De(A);break;default:break}},[O,me,De,be,ue]),Fe=(0,o.useCallback)(function(I){I.key==="Enter"&&I.metaKey&&(I.preventDefault(),(0,R.Tf)(),(0,R.RT)(r.current.el)),I.key==="Enter"&&!I.metaKey&&(I.preventDefault(),O.current&&!Ee.current&&(Me(!0),ke(K?"quote":S.length>0?"at":"text")))},[S.length,O,Ee,K,ke]),_e=(0,o.useCallback)(function(I){y(I.target.value);var A=Ue()(Array.from(document.getElementsByClassName("at_el"))),Q=[];A.map(function(b){var k,q;return Q.push({id:(k=b.attributes.getNamedItem("data_id"))===null||k===void 0?void 0:k.value,name:(q=b.attributes.getNamedItem("data_name"))===null||q===void 0?void 0:q.value,tag:b.outerHTML})}),J(Q),se()},[se]),Pe=(0,o.useCallback)(function(I){var A=I,Q=ee()(tt),b;try{for(Q.s();!(b=Q.n()).done;){var k=b.value,q=A.indexOf(k.context);if(q>-1){var ne='<img class="face_el" alt="'.concat(k.context,'" style="padding-right:2px" width="24px" src="').concat(k.src,'">');A=A.replaceAll(k.context,ne)}}}catch(Se){Q.e(Se)}finally{Q.f()}return A},[]),Ce=(0,o.useCallback)(function(I){var A=I,Q=/@\S+\s/g,b=A.match(Q)||[],k=[],q=h.current.groupMemberList,ne=ee()(b),Se;try{var ft=function(){var Dt=Se.value,et=q.find(function(Gt){return Gt.userID===Dt.slice(1,-1)});if(et){var Nt='<b class="at_el" data_id="'.concat(et.userID,'" data_name="').concat(et.nickname,'" contenteditable="false" style="color:#428be5"> @').concat(et.nickname,"</b>");A=A.replaceAll(Dt,Nt),k.push({id:et.userID,name:et.nickname,tag:Nt})}};for(ne.s();!(Se=ne.n()).done;)ft()}catch(Mt){ne.e(Mt)}finally{ne.f()}return J(k),A},[]),vt=(0,o.useCallback)(function(I){y(Pe(Ce(I)))},[Ce,Pe]);(0,o.useEffect)(function(){h.current.draftSaved=!1;var I=h.current.atList;return I.length>0&&J([]),v.draftText!==""?vt(v.draftText):y(""),Oe([]),function(){h.current.draftSaved||$(v)}},[v,vt,$]);var qe=(0,o.useCallback)(function(I,A){var Q=Ue()(W);if(I)Q=[].concat(Ue()(Q),[A]);else{var b=Q.findIndex(function(k){return k.clientMsgID===A.clientMsgID});Q.splice(b,1)}Oe(Q)},[W]);return(0,o.useEffect)(function(){return c.Z.on(n.Co,qe),function(){c.Z.off(n.Co,qe)}},[qe]),(0,o.useEffect)(function(){return c.Z.on(n.oJ,X),c.Z.on(n.jf,$),function(){c.Z.off(n.oJ,X),c.Z.off(n.jf,$)}},[X,$]),(0,e.jsxs)("div",{className:"pt-4 ps-8 h-100 d-flex flex-column",children:[(0,e.jsxs)("div",{className:"d-flex flex-row mb-2",children:[(0,e.jsx)(i.Tooltip,{placement:"bottom",inverse:!0,title:"\u8868\u60C5",children:(0,e.jsx)(i.Button,{variant:!1,icon:(0,e.jsx)(Y.JO,{name:"Bootstrap/emoji-smile",className:"svg-icon-2"}),activeColor:"secondary",className:"me-1"})}),(0,e.jsx)(i.Tooltip,{placement:"bottom",inverse:!0,title:"\u53D1\u9001\u540D\u7247",children:(0,e.jsx)(i.Button,{variant:!1,icon:(0,e.jsx)(Y.JO,{name:"Bootstrap/person-badge",className:"svg-icon-2"}),activeColor:"secondary",className:"me-1"})}),(0,e.jsx)(i.Tooltip,{placement:"bottom",inverse:!0,title:"\u53D1\u9001\u6587\u4EF6",children:(0,e.jsx)(i.Button,{variant:!1,icon:(0,e.jsx)(Y.JO,{name:"Bootstrap/folder-plus",className:"svg-icon-2"}),activeColor:"secondary",className:"me-1"})}),(0,e.jsx)(i.Tooltip,{placement:"bottom",inverse:!0,title:"\u53D1\u9001\u56FE\u7247",children:(0,e.jsx)(i.Button,{variant:!1,icon:(0,e.jsx)(Y.JO,{name:"Bootstrap/card-image",className:"svg-icon-2"}),activeColor:"secondary",className:"me-1"})}),(0,e.jsx)(i.Tooltip,{placement:"bottom",inverse:!0,title:"\u53D1\u9001\u89C6\u9891",children:(0,e.jsx)(i.Button,{variant:!1,icon:(0,e.jsx)(Y.JO,{name:"Bootstrap/film",className:"svg-icon-2"}),activeColor:"secondary",className:"me-1"})})]}),(0,e.jsxs)("div",{className:"ps-3 flex-row-fluid position-relative",children:[(0,e.jsx)(Be,{style:{paddingTop:K?"32px":"4px"},placeholder:"\u53D1\u9001\u7ED9 ".concat(v.showName),className:"h-100",ref:r,html:E,onChange:_e,onKeyDown:Fe,onPaste:B}),(0,e.jsxs)("div",{className:"chat-msg-actions d-flex flex-row position-absolute",children:[(0,e.jsxs)("div",{className:"d-flex flex-row align-items-center fs-10 text-gray-500 me-6",children:[(0,e.jsx)(Y.JO,{name:"Bootstrap/arrow-return-left",className:"svg-icon-7 me-2"})," ","\u53D1\u9001",(0,e.jsx)("span",{className:"mx-3",children:"/"}),(0,e.jsx)(Y.JO,{name:"Bootstrap/command",className:"svg-icon-7 me-2"})," \u6362\u884C"]}),(0,e.jsx)(i.Button,{className:"px-5",children:"\u53D1\u9001"})]})]})]})}var Bt=Lt;function Qt(){return(0,e.jsx)("div",{className:"d-flex align-items-center justify-content-center h-100",children:(0,e.jsx)("img",{src:"/assets/media/illustrations/dozzy-1/12.png",className:"mw-100 h-200px h-sm-325px"})})}var Ot=Qt,kt=t(230),Kt=t(14903),Ft=function(v){var a=v.userId,f=v.typing,r=(0,kt.ED)({variables:{id:a},fetchPolicy:"cache-and-network"}),l=Z()(r,2),T=l[0],E=l[1],y=E.data,O=E.refetch,P=y==null?void 0:y.user.onlineStatus.status,V=y==null?void 0:y.user.onlineStatus.detailPlatformStatus,K=(0,o.useMemo)(function(){if(P==="online"){var oe="",re=ee()(V||[]),S;try{for(re.s();!(S=re.n()).done;){var J=S.value;J.status==="online"&&(oe+="".concat(J.platform,"/"))}}catch(le){re.e(le)}finally{re.f()}return"".concat(oe.slice(0,-1)," \u5728\u7EBF")}return"\u79BB\u7EBF"},[P,V]),te=(0,o.useRef)(P);return te.current=P,(0,o.useEffect)(function(){te.current!=="online"&&O()},[T,O,f]),(0,e.jsxs)("div",{className:"mb-0 lh-1 d-flex flex-row align-items-center",children:[(0,e.jsx)(i.Badge,{color:P==="online"?"primary":"secondary",shape:"circle",className:"w-10px h-10px me-1"}),(0,e.jsx)("span",{className:"fs-7 fw-semibold text-muted",children:K})]})},Ut=function(){return(0,e.jsx)(e.Fragment,{})},Pt=105,Jt=350;function St(N){return Math.min(Jt,Math.max(Pt,N))}function wt(N){var v=N.msgList,a=N.loadMore,f=N.hasMore,r=N.curCve,l=N.loading,T=N.sendMsg,E=N.scrollbar,y=N.typing,O=N.onBack,P=(0,o.useRef)({height:200}),V=(0,o.useReducer)(function(J){return J+1},0),K=Z()(V,2),te=K[1],oe=(0,o.useMemo)(function(){return r&&(0,R.vJ)(r)},[r]),re=(0,o.useCallback)(function(J){P.current.height+=J,te()},[]),S=(0,o.useCallback)(function(){P.current.height=St(P.current.height)},[]);return(0,e.jsx)("div",{className:"wrapper d-flex flex-column flex-row-fluid app-chat-main background-transparent",children:(0,e.jsxs)(i.Card,{className:"card chat_messenger",id:"kt_chat_messenger",children:[r&&(0,e.jsxs)(i.Card.Header,{id:"kt_chat_messenger_header",children:[(0,e.jsxs)(i.Card.Title,{className:"d-flex align-items-center",children:[(0,e.jsx)(i.Symbol.Avatar,{light:!0,size:45,alt:r==null?void 0:r.showName,src:r==null?void 0:r.faceURL}),(0,e.jsxs)("div",{className:"ms-5 d-flex justify-content-center flex-column me-3",children:[(0,e.jsx)("a",{href:"#",className:"fs-4 fw-bold text-gray-900 text-hover-primary me-1 mb-2 lh-1",children:r.showName}),(0,e.jsxs)("div",{className:"d-flex flex-row align-items-center",children:[oe?(0,e.jsx)(Ft,{userId:r.userID,typing:!!y}):(0,e.jsx)(Ut,{}),y&&(0,e.jsx)("span",{className:"mb-0 lh-1 ms-4 fs-7 fw-semibold text-muted",children:"\u6B63\u5728\u8F93\u5165..."})]})]})]}),(0,e.jsxs)(i.Card.Toolbar,{children:[(0,e.jsx)(i.Tooltip,{placement:"bottom",inverse:!0,title:"\u6587\u4EF6",children:(0,e.jsx)(i.Button,{className:"me-4",icon:(0,e.jsx)(Y.JO,{name:"Bootstrap/folder",className:"svg-icon-2"}),variant:!1,activeColor:"light-primary"})}),(0,e.jsx)(i.Tooltip,{placement:"bottom",inverse:!0,title:"\u804A\u5929\u8BB0\u5F55",children:(0,e.jsx)(i.Button,{className:"me-4",icon:(0,e.jsx)(Y.JO,{name:"Bootstrap/list-ul",className:"svg-icon-2"}),variant:!1,activeColor:"light-primary"})}),(0,e.jsx)(i.Tooltip,{placement:"bottom",inverse:!0,title:"\u6DFB\u52A0\u6210\u5458",children:(0,e.jsx)(i.Button,{className:"me-4",icon:(0,e.jsx)(Y.JO,{name:"Bootstrap/person-plus",className:"svg-icon-2"}),variant:!1,activeColor:"light-primary"})}),(0,e.jsx)(i.Tooltip,{placement:"bottom",inverse:!0,title:"\u804A\u5929\u8BBE\u7F6E",children:(0,e.jsx)(i.Button,{className:D()({"me-4":!!O}),icon:(0,e.jsx)(Y.JO,{name:"Bootstrap/gear",className:"svg-icon-2"}),variant:!1,activeColor:"light-primary"})}),O&&(0,e.jsx)(i.Tooltip,{placement:"bottom",inverse:!0,title:"\u8FD4\u56DE\u6D88\u606F\u5217\u8868",children:(0,e.jsx)(i.Button,{onClick:O,icon:(0,e.jsx)(Y.JO,{name:"Bootstrap/arrow-return-left",className:"svg-icon-2"}),variant:!1,activeColor:"light-primary"})})]})]}),(0,e.jsx)(i.Card.Body,{className:"pe-0 py-0 overflow-hidden",id:"kt_chat_messenger_body",children:r?(0,e.jsx)(Ze,{loadMore:a,loading:l,msgList:v,hasMore:f,curCve:r,scrollbar:E}):(0,e.jsx)(Ot,{})}),r&&(0,e.jsx)(i.Card.Footer,{className:"p-0",id:"kt_chat_messenger_footer",children:(0,e.jsx)(xe.w_,{style:{height:St(P.current.height)},direction:"y",onResize:re,onResizeEnd:S,children:(0,e.jsx)(Bt,{curCve:r,sendMsg:T})})})]})})}var Ht=wt},26699:function(Je,ge,t){t.d(ge,{Z:function(){return M.Z}});var M=t(15132)},75517:function(Je,ge,t){t.d(ge,{Z:function(){return n}});var M=t(1861),ee=t(89717),de=t(67294),Z=t(28525),o=t(12845),Y=t(93967),xe=t.n(Y),ie=t(36603),D=t(85893);function i(c){var d=c.data,m=c.onClick,F=c.curCve,p=(0,o.useModel)("@@initialState",function(x){var H;return(H=x.initialState)===null||H===void 0||(H=H.currentUser)===null||H===void 0?void 0:H.id}),U=function(H){if(H==="")return H;var C=JSON.parse(H);if(d.draftText!==""){var pe=d.draftText,ye=/\<img.*?\">/g,ae=pe.match(ye);return ae&&ae.length>0&&ae.forEach(function(we){pe=pe.replaceAll(we,"Picture")}),(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)("span",{className:"text-warning me-1",children:"[\u8349\u7A3F]"}),pe]})}return(0,ie.LF)(C,p)},he=function(H){return H===Z.PD.Nomal},e=he(d==null?void 0:d.recvMsgOpt)?U(d.latestMsg):d.unreadCount>0?"[".concat(d.unreadCount+"Piece","] ").concat(U(d.latestMsg)):U(d.latestMsg),Qe=function(H){var C=(0,ie.p6)(H),pe=(0,ie.p6)(H+864e5),ye=(0,ie.p6)(new Date().getTime());return C[3]===ye[3]?C[4]:pe[3]===ye[3]?"\u6628\u5929":C[3]},He=(0,de.useCallback)(function(){m(d)},[d,m]);return(0,D.jsxs)("div",{className:xe()("cve-item d-flex flex-stack py-4 mb-1",{active:(F==null?void 0:F.conversationID)===d.conversationID}),onClick:He,children:[(0,D.jsxs)("div",{className:"d-flex align-items-center",children:[(0,D.jsx)(ee.Symbol.Avatar,{size:45,alt:d.showName,light:!0,badge:(0,D.jsx)(ee.Badge,{dot:!he(d==null?void 0:d.recvMsgOpt)&&d.unreadCount>0,color:"danger",shape:"circle",className:"start-100",count:he(d==null?void 0:d.recvMsgOpt)?d.unreadCount:null})}),(0,D.jsxs)("div",{className:"ms-5",children:[(0,D.jsx)("a",{href:"#",className:"fs-5 fw-bold text-gray-900 text-hover-primary mb-2",children:d.showName}),(0,D.jsx)("div",{className:"fw-semibold text-muted cve_msg",children:e})]})]}),(0,D.jsx)("div",{className:"d-flex flex-column align-items-end ms-2",children:(0,D.jsx)("span",{className:"text-muted fs-7 mb-1",children:Qe(d.latestMsgSendTime)})})]})}var R=i;function z(c){var d=c.curCve,m=c.cves,F=c.onItemClick;return(0,D.jsx)(M.E,{className:"d-flex flex-column custom-scrollbar px-2 cve-list",options:{scrollbars:{autoHide:"scroll"}},children:(0,D.jsx)(ee.Card,{flush:!0,className:"py-0 border-0 px-2 background-transparent",bodyClassName:"pt-5 pb-0 px-1 cve-list",children:m.map(function(p){return(0,D.jsx)(R,{onClick:F,cveList:m,data:p,curCve:d},p.conversationID)})})})}var n=z},83988:function(Je,ge,t){var M=t(5574),ee=t.n(M),de=t(67294),Z=t(46027),o=t(93967),Y=t.n(o),xe=t(89717),ie=t(85893);function D(i){var R=i.onSearch,z=i.className,n=(0,de.useState)(""),c=ee()(n,2),d=c[0],m=c[1],F=(0,de.useCallback)(function(p){m(p.target.value),R(p.target.value)},[R]);return(0,ie.jsxs)("div",{className:Y()("cve-searchbar ps-6 pe-6 d-flex justify-content-sm-between align-items-center",z),children:[(0,ie.jsx)(xe.Input.Search,{solid:!0,size:"lg",boxClassName:"flex-row-fluid me-2",value:d,onChange:F,placeholder:"\u641C\u7D22..."}),(0,ie.jsx)("a",{className:Y()("cve-searchbar-actions"),children:(0,ie.jsx)(Z.JO,{className:Y()("svg-icon-2x svg-icon-dark"),name:"Duotune/arr087"})})]})}ge.Z=D},230:function(Je,ge,t){t.d(ge,{ED:function(){return R}});var M=t(97857),ee=t.n(M),de=t(68400),Z=t.n(de),o=t(75063),Y=t(73359),xe,ie={},D=(0,o.Ps)(xe||(xe=Z()([`
    query getUserOnlineStatus($id: ID!) {
  user(id: $id) {
    id
    name
    onlineStatus {
      status
      detailPlatformStatus {
        platform
        connection
        background
      }
    }
  }
}
    `])));function i(n){var c=_objectSpread(_objectSpread({},ie),n);return Apollo.useQuery(D,c)}function R(n){var c=ee()(ee()({},ie),n);return Y.t(D,c)}function z(n){var c=_objectSpread(_objectSpread({},ie),n);return Apollo.useSuspenseQuery(D,c)}},50252:function(Je,ge,t){t.d(ge,{RJ:function(){return He}});var M=t(230),ee=t(15009),de=t.n(ee),Z=t(99289),o=t.n(Z),Y=t(97857),xe=t.n(Y),ie=t(19632),D=t.n(ie),i=t(67294),R=t(28525),z=t(12845),n=t(74857),c=t(63438),d=t(89717),m=t(31254),F=t(36603),p=t(97961),U=t(78864),he=function(){return(Math.random()*36).toString(36).slice(2)+new Date().getTime().toString()},e=function(H,C){return new Promise(function(pe,ye){m.S.getOneConversation({sourceID:H,sessionType:C}).then(function(ae){return pe(ae.data)}).catch(function(ae){return ye(ae)})})};function Qe(){var x=(0,z.useModel)("open-im.cve",function(s){var u=s.state;return u.curCve}),H=(0,z.useModel)("open-im.cve",function(s){var u=s.state;return u.cveInitLoading}),C=(0,z.useModel)("open-im.cve",function(s){var u=s.actions;return u.setCurCve}),pe=(0,z.useModel)("open-im.cve",function(s){var u=s.state;return u.cves}),ye=(0,z.useModel)("@@initialState",function(s){var u,L=s.initialState;return L==null||(u=L.currentUser)===null||u===void 0?void 0:u.id}),ae=(0,z.useModel)("open-im.contacts",function(s){var u=s.actions;return u.getGroupInfo}),we=(0,z.useModel)("open-im.contacts",function(s){var u=s.actions;return u.getGroupMemberList}),Ne=[],g=(0,n.Z)({historyMsgList:[],firstLoad:!1,typing:!1,hasMore:!0,merModal:!1,merData:void 0,searchStatus:!1,searchCve:[]}),Ge=(0,i.useRef)(null),mt=(0,i.useRef)(),Ke=(0,i.useCallback)(function(s){var u;(u=mt.current)===null||u===void 0||u.scroll({y:"100%"},s!=null?s:350)},[]);function gt(s){if(JSON.parse(s.data).length===0){g.hasMore=!1;return}JSON.stringify(g.historyMsgList[g.historyMsgList.length-1])===JSON.stringify(JSON.parse(s.data).reverse()[0])&&g.historyMsgList.pop(),g.historyMsgList=[].concat(D()(g.historyMsgList),D()(JSON.parse(s.data).reverse())),g.firstLoad||(g.firstLoad=!0,setTimeout(function(){return Ke(0)})),g.hasMore=!(JSON.parse(s.data).length<20)}var We=(0,c.Z)(m.S.getAdvancedHistoryMessageList,{manual:!0,onSuccess:gt,onError:function(u){return console.log("GetChatRecordFailed",u)}}),Et=We.loading,ht=We.run,tt=We.cancel,nt=(0,i.useCallback)(function(s,u,L){var G,Ie={userID:s!=null?s:"",groupID:u!=null?u:"",count:20,startClientMsgID:(G=L==null?void 0:L.clientMsgID)!==null&&G!==void 0?G:""};ht(Ie)},[ht]),pt=(0,i.useCallback)(function(s,u){m.S.markMessagesAsReadByMsgID({conversationID:s,clientMsgIDList:u})},[]),Ve=(0,i.useCallback)(function(s,u){s.unreadCount===0&&!u||(0,F.vJ)(s)&&pt(s.userID,[])},[pt]),xt=(0,i.useCallback)(function(s){s?(g.searchStatus=!0,g.searchCve=pe.filter(function(u){return u.conversationID.indexOf(s)>-1||u.showName.indexOf(s)>-1})):(g.searchCve=[],g.searchStatus=!1)},[pe,g]),Ct=(0,i.useCallback)(function(s){if(!(0,F.vJ)(s)){ae(s.groupID);var u={groupID:s.groupID,offset:0,filter:0,count:2e3};we(u)}},[ae,we]),at=(0,i.useCallback)(function(s){s.conversationID!==(x==null?void 0:x.conversationID)&&(x&&U.Z.emit(p.jf,x),g.historyMsgList=[],g.firstLoad=!1,C(s),g.hasMore=!0,Ct(s),tt(),nt(s.userID,s.groupID),Ve(s))},[x,nt,Ct,Ve,tt,g,C]),Xe=(0,i.useCallback)(function(s,u,L){Ne.forEach(function(G){if(G.oid===s.operationID){var Ie=g.historyMsgList.findIndex(function(Re){return Re.clientMsgID===(G==null?void 0:G.mid)});Ie!==-1&&(G.flag=!0,L?g.historyMsgList[Ie].status=3:g.historyMsgList[Ie]=s.data)}}),u===R.Cs.MergeMessage&&d.Toast.success("ForwardSuccessTip"),Ke()},[Ne,g.historyMsgList,Ke]),rt=(0,i.useCallback)(function(s,u,L,G){var Ie=he();if(L&&(x==null?void 0:x.userID)===L||G&&(x==null?void 0:x.groupID)===G||!L&&!G){var Re=s,ve={oid:Ie,mid:Re.clientMsgID,flag:!1};Ne=[].concat(D()(Ne),[ve]),Re.status=2,g.historyMsgList=[Re].concat(D()(g.historyMsgList)),setTimeout(function(){var fe=Ne.find(function(Le){return Le.mid===Re.clientMsgID});fe&&!fe.flag&&g.historyMsgList.forEach(function(Le){Le.clientMsgID===fe.mid&&(Le.status=1)})},2e3),Ke()}var Ye={title:"\u4F60\u6709\u4E00\u6761\u65B0\u6D88\u606F",desc:"",ex:"",iOSPushSound:"+1",iOSBadgeCount:!0},ze={recvID:L!=null?L:x.userID,groupID:G!=null?G:x.groupID,offlinePushInfo:Ye,message:s};Ne=Ne.filter(function(fe){return!fe.flag}),p.Dw.includes(u)?m.S.sendMessageNotOss(ze,Ie).then(function(fe){return Xe(fe,u)}).catch(function(fe){return Xe(fe,u,!0)}):m.S.sendMessage(ze,Ie).then(function(fe){return Xe(fe,u)}).catch(function(fe){return Xe(fe,u,!0)})},[x]),Ze=(0,i.useCallback)(function(s,u){e(s,u).then(function(L){return at(L)}).catch(function(L){d.Toast.error("\u83B7\u53D6\u4F1A\u8BDD\u5931\u8D25\uFF01"),console.error(L)})},[at]),At=(0,i.useCallback)(function(s){var u=s.sendID===(x==null?void 0:x.userID)||s.sendID===ye&&s.recvID===(x==null?void 0:x.userID);return s.sessionType===R.FF.Single?u:s.groupID===(x==null?void 0:x.groupID)},[x==null?void 0:x.groupID,x==null?void 0:x.userID,ye]),Ue=(0,i.useCallback)(function(){g.typing=!0,Ge.current&&clearTimeout(Ge.current),Ge.current=setTimeout(function(){g.typing=!1},1e3)},[g]),$e=(0,i.useCallback)(function(s){var u=JSON.parse(s.data);u.contentType!==R.Cs.TypingMessage&&u.sendID!==ye&&(0,F.sc)(u,function(L,G){Ze(L,G),window.focus()}),x&&At(u)&&(u.contentType===R.Cs.TypingMessage?Ue():(u.contentType===R.Cs.RevokeMessage?g.historyMsgList=[u].concat(D()(g.historyMsgList.filter(function(L){return L.clientMsgID!==u.content}))):g.historyMsgList=[u].concat(D()(g.historyMsgList)),Ve(x,1)))},[Ze,x,At,Ve,g,ye,Ue]),st=(0,i.useCallback)(function(s){var u=g.historyMsgList.findIndex(function(L){return L.clientMsgID===s.data});u>-1&&g.historyMsgList.splice(u,1)},[g]),it=(0,i.useCallback)(function(s){JSON.parse(s.data).forEach(function(u){u.msgIDList.forEach(function(L){g.historyMsgList.forEach(function(G){G.clientMsgID===L&&(G.isRead=!0)})})})},[g]),ot=(0,i.useCallback)(function(){C(null)},[C]),lt=(0,i.useCallback)(function(s){var u=g.historyMsgList.findIndex(function(G){return G.clientMsgID===s}),L=D()(g.historyMsgList);L.splice(u,1),g.historyMsgList=L,d.Toast.success("\u5220\u9664\u6D88\u606F\u6210\u529F\uFF01")},[g]),ct=(0,i.useCallback)(function(s){var u=g.historyMsgList.findIndex(function(L){return L.clientMsgID===s});g.historyMsgList[u].contentType=p.j7.RevokeMessage},[g]),ut=(0,i.useCallback)(function(s,u){g.merData=xe()(xe()({},s),{},{sender:u}),g.merModal=!0},[g]),dt=(0,i.useCallback)(function(s,u,L){L.map(function(){var G=o()(de()().mark(function Ie(Re){var ve,Ye,ze,fe,Le;return de()().wrap(function(Be){for(;;)switch(Be.prev=Be.next){case 0:if(ze=(ve=Re.userID)!==null&&ve!==void 0?ve:"",fe=(Ye=Re.groupID)!==null&&Ye!==void 0?Ye:"",u!==R.Cs.MergeMessage){Be.next=8;break}return Be.next=5,m.S.createMergerMessage(s);case 5:Le=Be.sent,Be.next=11;break;case 8:return Be.next=10,m.S.createForwardMessage(s);case 10:Le=Be.sent;case 11:rt(Le.data,u,ze,fe),U.Z.emit(p.rl,!1);case 13:case"end":return Be.stop()}},Ie)}));return function(Ie){return G.apply(this,arguments)}}())},[rt]);return(0,i.useEffect)(function(){return m.S.on(R.l2.OnRecvMessageRevoked,st),m.S.on(R.l2.OnRecvC2CReadReceipt,it),function(){m.S.off(R.l2.OnRecvMessageRevoked,st),m.S.off(R.l2.OnRecvC2CReadReceipt,it)}},[it,st]),(0,i.useEffect)(function(){return U.Z.on(p.$F,ot),U.Z.on(p.Cd,lt),U.Z.on(p.rF,ct),U.Z.on(p.a7,ut),function(){U.Z.off(p.$F,ot),U.Z.off(p.Cd,lt),U.Z.off(p.rF,ct),U.Z.off(p.a7,ut)}},[lt,ut,ot,ct]),(0,i.useEffect)(function(){return U.Z.on(p.jA,dt),U.Z.on(p.$M,Ze),m.S.on(R.l2.OnRecvNewMessage,$e),function(){U.Z.off(p.jA,dt),U.Z.off(p.$M,Ze),m.S.off(R.l2.OnRecvNewMessage,$e)}},[Ze,x,$e,dt]),(0,i.useEffect)(function(){return function(){C(null)}},[C]),{rs:g,cveList:pe,loading:Et,cveLoading:H,curCve:x,setCurCve:C,handleCveSearch:xt,handleItemClick:at,scrollbar:mt,getHistoryMsg:nt,sendMsg:rt}}var He=Qe},14903:function(){}}]);

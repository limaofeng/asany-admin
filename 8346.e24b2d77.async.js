"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[8346],{22152:function(Ne,Y,s){s.r(Y),s.d(Y,{default:function(){return ce}});var X=s(19632),K=s.n(X),W=s(15009),C=s.n(W),q=s(97857),Q=s.n(q),_=s(99289),A=s.n(_),ee=s(5574),D=s.n(ee),v=s(62435),O=s(96974),N=s(12845),$=s(84059),I=s(38018),re=s(64763);function ae(){var h=(0,N.useLocation)();return I.parse(h.search)}var ne=ae,ue=s(73588),t=s(79817),M=s(60551),te=s(84730),se=s(92592);function le(h){return T.apply(this,arguments)}function T(){return T=A()(C()().mark(function h(F){var f,g,i;return C()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,fetch(F);case 2:return f=o.sent,o.next=5,f.blob();case 5:return g=o.sent,i=new FileReader,o.abrupt("return",new Promise(function(y,j){i.onloadend=function(){y(i.result)},i.onerror=j,i.readAsDataURL(g)}));case 8:case"end":return o.stop()}},h)})),T.apply(this,arguments)}var oe=le("/assets/images/qrcode_logo.png");function G(h){return P.apply(this,arguments)}function P(){return P=A()(C()().mark(function h(F){var f,g,i,x,o,y;return C()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return f=80,g=40,i=new te.ZP("l","mm",[f,g]),p.next=4,Promise.all(F.map(function(E){return se.toDataURL(E.qrcode,{width:40,height:40,errorCorrectionLevel:"H",quality:.92})}));case 4:x=p.sent,o=0;case 6:if(!(o<F.length)){p.next=16;break}return i.addImage(x[o],"JPEG",0,0,40,40,"","FAST"),p.next=10,oe;case 10:y=p.sent,i.addImage(y,"JPEG",40,0,40,40,"","FAST"),o<x.length-1&&i.addPage([f,g],"l");case 13:o++,p.next=6;break;case 16:window.open(i.output("bloburl"),"_blank");case 17:case"end":return p.stop()}},h)})),P.apply(this,arguments)}var e=s(86074);function ie(h,F){var f=new Date,g=f.getFullYear().toString(),i=(f.getMonth()+1).toString().padStart(2,"0"),x=f.getDate().toString().padStart(2,"0"),o=h.replace("{YYYY}",g).replace("{MM}",i).replace("{DD}",x),y=h.match(/{SEQ:(\d+)}/);if(y){var j=parseInt(y[1],10),p=F.toString().padStart(j,"0");o=o.replace(y[0],p)}return o}function de(){var h,F,f=(0,O.TH)(),g=(0,O.s0)(),i=ne(),x=(0,v.useState)(!1),o=D()(x,2),y=o[0],j=o[1],p=t.Form.useForm(),E=(0,v.useMemo)(function(){return i.q&&(i.filter={name_contains:i.q},delete i.q),i},[i]),ve=(0,M.BC)({refetchQueries:[M.aT]}),me=D()(ve,1),V=me[0],R=(0,M.Vh)({fetchPolicy:"cache-and-network",variables:E}),d=R.data,B=R.loading,c=R.previousData,fe=(0,M.Fm)({refetchQueries:[M.aT]}),H=D()(fe,2),he=H[0],pe=H[1].loading,Ce=(0,v.useCallback)(function(){j(!0)},[]),ge=(0,v.useCallback)(A()(C()().mark(function r(){var a,n,u,m;return C()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,p.validateFields();case 2:return a=b.sent,b.next=5,he({variables:{links:Array.from({length:a.count}).map(function(w,S){return{category:"wxb",metadata:{no:ie(a.numberRule,S+1)}}})}});case 5:n=b.sent,u=n.data,m=(u==null?void 0:u.result.map(function(w){return Q()(Q()({},w),{},{qrcode:N.APP_CONFIG.SHORT_DOMAIN_NAME+"/s/"+w.code})}))||[],G(m),t.Toast.success("\u4E8C\u7EF4\u7801\u6279\u91CF\u5220\u9664\u6210\u529F",2e3,{placement:"bottom-left",progressBar:!0}),j(!1);case 11:case"end":return b.stop()}},r)})),[]),k=(0,v.useMemo)(function(){if(!E.orderBy)return{order:"descend",field:"createdAt"};var r=E.orderBy.split("_"),a=D()(r,2),n=a[0],u=a[1];return{order:u==="desc"?"descend":"ascend",field:n}},[E.orderBy]),Fe=(0,v.useMemo)(function(){return B?(c==null?void 0:c.deviceQrCodes.pageInfo.total)||0:(d==null?void 0:d.deviceQrCodes.pageInfo.total)||0},[d==null?void 0:d.deviceQrCodes.pageInfo.total,B,c==null?void 0:c.deviceQrCodes.pageInfo.total]),ye=(0,v.useMemo)(function(){return B?(c==null?void 0:c.deviceQrCodes.pageInfo)||{total:0,current:1}:(d==null?void 0:d.deviceQrCodes.pageInfo)||{total:0,current:1}},[d==null?void 0:d.deviceQrCodes,B,c==null?void 0:c.deviceQrCodes]),Ee=(0,v.useMemo)(function(){var r;if(B){var a;return((c==null||(a=c.deviceQrCodes)===null||a===void 0?void 0:a.edges)||[]).map(function(n){return n.node})}return((d==null||(r=d.deviceQrCodes)===null||r===void 0?void 0:r.edges)||[]).map(function(n){return n.node})},[d==null?void 0:d.deviceQrCodes,B,c==null?void 0:c.deviceQrCodes]),be=(0,v.useCallback)(function(r){g(f.pathname+"?"+I.stringify({q:r}),{replace:!0})},[g,f.pathname]),xe=(0,v.useCallback)(function(r,a,n){var u,m={};if((u=E.filter)!==null&&u!==void 0&&u.name_contains){var l;m.q=(l=E.filter)===null||l===void 0?void 0:l.name_contains}n&&(m.orderBy=n.field+"_"+(n.order==="ascend"?"asc":"desc")),m.page=r.current,g(f.pathname+"?"+I.stringify(m),{replace:!0})},[history,f.pathname,(h=E.filter)===null||h===void 0?void 0:h.name_contains]),U=(0,v.useCallback)(A()(C()().mark(function r(){var a,n,u,m,l,b=arguments;return C()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:for(a=b.length,n=new Array(a),u=0;u<a;u++)n[u]=b[u];return S.next=3,V({variables:{where:{id_in:n}}});case 3:return m=S.sent,l=m.data,S.abrupt("return",(l==null?void 0:l.result.count)||0);case 6:case"end":return S.stop()}},r)})),[V]),z=(0,v.useCallback)(function(r){return A()(C()().mark(function a(){var n,u;return C()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return n="\u786E\u5B9A\u5220\u9664\u9009\u4E2D\u7684, \u5171 ".concat(r.length," \u4E2A\u4E8C\u7EF4\u7801\u5417\uFF1F"),l.next=3,t.Modal.confirm({title:"\u786E\u5B9A\u5220\u9664",content:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("p",{className:"tip-confirm",children:n}),(0,e.jsx)("p",{children:"\u5220\u9664\u7684\u64CD\u4F5C\u4E0D\u53EF\u9006,\u8BF7\u8C28\u614E\u64CD\u4F5C"})]}),okClassName:"btn-danger",okText:"\u5220\u9664"});case 3:if(u=l.sent,u.isConfirmed){l.next=6;break}return l.abrupt("return");case 6:return l.next=8,U.apply(void 0,K()(r));case 8:t.Toast.success("\u4E8C\u7EF4\u7801\u6279\u91CF\u5220\u9664\u6210\u529F",2e3,{placement:"bottom-left",progressBar:!0});case 9:case"end":return l.stop()}},a)}))},[U]),je=(0,v.useCallback)(function(r,a){return A()(C()().mark(function n(){return C()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:G(a.map(function(l){return Q()(Q()({},l),{},{qrcode:N.APP_CONFIG.SHORT_DOMAIN_NAME+"/s/"+l.code})}));case 1:case"end":return m.stop()}},n)}))},[]),Be=(0,v.useMemo)(function(){return function(r,a){return(0,e.jsxs)("div",{children:[(0,e.jsx)(t.Button,{color:"success",onClick:z(r),variant:!1,children:"\u6279\u91CF\u5220\u9664"}),(0,e.jsx)(t.Button,{color:"success",onClick:je(r,a),variant:!1,children:"\u6253\u5370\u4E8C\u7EF4\u7801"})]})}},[z]),Se=(0,v.useState)(),J=D()(Se,2),L=J[0],Z=J[1],Ae=(0,v.useCallback)(function(r){Z(r)},[]),De=(0,v.useCallback)(function(){Z(void 0)},[]);return(0,e.jsxs)(ue.vs,{header:{title:"\u8BBE\u5907\u4E8C\u7EF4\u7801"},children:[(0,e.jsxs)(t.Modal,{width:640,centered:!0,onOk:ge,confirmLoading:pe,okText:"\u4FDD\u5B58",visible:y,onCancel:function(){return j(!1)},children:[(0,e.jsx)(t.Modal.Header,{closable:!0,className:"ms-5 border-0",children:(0,e.jsx)("h1",{className:"modal-title pt-6 pb-4",children:"\u751F\u6210\u8BBE\u5907\u4E8C\u7EF4\u7801"})}),(0,e.jsx)(t.Modal.Body,{children:(0,e.jsxs)(t.Form,{form:p,initialValues:{numberRule:"NV-{YYYY}{MM}{DD}-{SEQ:3}",count:1},children:[(0,e.jsx)(t.Form.Item,{className:"d-flex flex-column mb-7",name:"numberRule",label:"\u8BBE\u5907\u7F16\u53F7\u89C4\u5219",help:"\u7F16\u53F7\u89C4\u5219\u652F\u6301\u53D8\u91CF\uFF1A{YYYY} {MM} {DD} {SEQ:3}",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u7F16\u53F7\u89C4\u5219"}],children:(0,e.jsx)(t.Input,{solid:!0,placeholder:"INV-{YYYY}{MM}{DD}-{SEQ:3}"})}),(0,e.jsx)(t.Form.Item,{className:"d-flex flex-column mb-7",name:"count",label:"\u751F\u6210\u6570\u91CF",children:(0,e.jsx)(t.Input,{solid:!0})})]})})]}),(0,e.jsxs)(t.Modal,{title:"\u9884\u89C8\u4E8C\u7EF4\u7801",dialogClassName:"w-250px",onCancel:De,visible:!!L,centered:!0,okButtonProps:{style:{display:"none"}},children:[(0,e.jsx)("div",{className:"d-inline-block",children:!!L&&(0,e.jsx)($.Qd,{size:200,value:L})}),(0,e.jsx)("span",{children:"\u4F7F\u7528\u624B\u673A\u626B\u7801\u4E8C\u7EF4\u7801\u9884\u89C8"})]}),(0,e.jsxs)("div",{className:"d-flex flex-wrap flex-stack pb-7",children:[(0,e.jsxs)("div",{className:"d-flex flex-wrap align-items-center",children:[(0,e.jsx)("h3",{className:"fw-bolder me-5",children:"\u8BBE\u5907\u4E8C\u7EF4\u7801"}),(0,e.jsx)(t.Input.Search,{onSearch:be,defaultValue:(F=E.filter)===null||F===void 0?void 0:F.name_contains,placeholder:"\u641C\u7D22",className:"border-body bg-body w-250px"})]}),(0,e.jsx)(re.ZX,{children:(0,e.jsx)("div",{className:"d-flex my-0",children:(0,e.jsx)(t.Button,{onClick:Ce,children:"\u751F\u6210\u4E8C\u7EF4\u7801"})})})]}),!Fe&&!B?(0,e.jsx)(t.Card,{className:"mb-5 mb-xl-10",children:(0,e.jsx)(t.Empty,{title:"\u8FD8\u6CA1\u6709\u8BBE\u5907\u4E8C\u7EF4\u7801",description:"\u9A6C\u4E0A\u6DFB\u52A0\u8BBE\u5907\u4E8C\u7EF4\u7801",image:"/assets/media/illustrations/sigma-1/4.png",children:(0,e.jsx)(t.Button,{variant:"primary",children:"\u751F\u6210\u4E8C\u7EF4\u7801"})})}):(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(t.Card,{className:"mb-5 mb-xl-10",children:(0,e.jsx)(t.Card.Body,{children:(0,e.jsx)(t.BlockUI,{overlayClassName:"bg-white bg-opacity-25",loading:B,children:(0,e.jsx)(t.Table,{hover:!0,rowKey:"id",rowSelection:{type:"checkbox",renderTitle:function(a){return(0,e.jsxs)(e.Fragment,{children:["\u5DF2\u9009\u4E2D",(0,e.jsx)("span",{className:"mx-2",children:a}),"\u4E2A\u4E8C\u7EF4\u7801"]})},toolbar:Be},noRowsRenderer:function(){return(0,e.jsx)(t.Empty,{description:"\u5217\u8868\u6570\u636E\u4E3A\u7A7A",image:"/assets/media/illustrations/sigma-1/5.png"})},columns:[{key:"code",title:"\u7F16\u53F7",sorter:!0,sortOrder:k.field==="code"?k.order:void 0,width:80},{key:"url",title:"\u4E8C\u7EF4\u7801\u94FE\u63A5",sorter:!0,sortOrder:k.field==="url"?k.order:void 0,render:function(a,n){var u;return a?(0,e.jsx)("a",{className:"text-gray-700",href:a,target:"_",children:(u=n.metadata)===null||u===void 0?void 0:u.no}):(0,e.jsx)("span",{className:"text-gray-700",children:"\u672A\u7ED1\u5B9A\u8BBE\u5907"})}},{key:"createdAt",title:"\u521B\u5EFA\u65F6\u95F4",width:200},{key:"accessCount",title:"\u8BBF\u95EE\u6B21\u6570",width:120},{key:"qrCode",title:"\u4E8C\u7EF4\u7801",width:180,render:function(a,n){var u=N.APP_CONFIG.SHORT_DOMAIN_NAME+"/s/"+n.code;return(0,e.jsx)($.Qd,{onClick:function(l){l.preventDefault(),l.stopPropagation(),Ae(N.APP_CONFIG.SHORT_DOMAIN_NAME+"/s/"+n.code)},size:30,value:u})}}],pagination:ye,onChange:xe,dataSource:Ee})})})})})]})}var ce=de}}]);

(self.webpackChunkasany_admin=self.webpackChunkasany_admin||[]).push([[6008],{80590:function(ee,F,a){"use strict";a.d(F,{Z:function(){return G}});var s=a(2824),t=a(67294),H=a(96486),V=a(94184),$=a.n(V),W=a(54406),u=a(85893),S=260,X=768;function L(n){var z=n.minWidth,m=z===void 0?S:z,e=n.maxWidth,Z=e===void 0?X:e,P=n.collapsible,O=P===void 0?!0:P,Y=n.children,J=n.className,f=n.onWidthChange,r=(0,t.useRef)({minimized:!1,width:n.width}),j=(0,t.useReducer)(function(C){return C+1},0),R=(0,s.Z)(j,2),E=R[1],N=(0,t.useMemo)(function(){return(0,H.debounce)(function(){E()},10)},[]),g=(0,t.useCallback)(function(C){return O&&m-C>m/2||C<=30},[O,m]),b=(0,t.useCallback)(function(){r.current.minimized&&r.current.width>0&&(r.current.width=0)},[]),I=(0,t.useCallback)(function(C){r.current.width+=C,g(r.current.width)?r.current.minimized=!0:r.current.minimized=!1,N()},[N,g]),x=(0,t.useCallback)(function(){r.current.width=g(r.current.width)?0:Math.min(Z,Math.max(m,r.current.width))},[g,Z,m]),T=(0,t.useCallback)(function(){r.current.minimized=!r.current.minimized,r.current.width||(r.current.width=m),N()},[N,m]),D=r.current,h=D.minimized,A=D.width,p=(0,t.useMemo)(function(){return Math.min(Z,Math.max(m,A))},[Z,m,A]);return(0,t.useEffect)(function(){f&&f(h?0:p)},[f,h,p]),(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("div",{className:"secondary_sidebar-resizer__mirror",style:{width:h?void 0:p}}),(0,u.jsxs)(W.w_,{className:$()("secondary_sidebar-resizer d-flex flex-column flex-lg-row",J,{"secondary_sidebar-resizer-minimized":h}),style:{width:h?void 0:p},onResizeStart:b,onResize:I,onResizeEnd:x,children:[O&&(0,u.jsxs)("button",{onClick:T,className:$()("secondary_sidebar-resize-button",{collapsed:h,expanded:!h}),type:"button",children:[(0,u.jsx)("div",{className:"invisible-area"}),(0,u.jsx)("span",{className:"homemade-button",role:"presentation",children:(0,u.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",focusable:"false",role:"presentation",children:(0,u.jsx)("path",{d:"M10.294 9.698a.988.988 0 0 1 0-1.407 1.01 1.01 0 0 1 1.419 0l2.965 2.94a1.09 1.09 0 0 1 0 1.548l-2.955 2.93a1.01 1.01 0 0 1-1.42 0 .988.988 0 0 1 0-1.407l2.318-2.297-2.327-2.307z",fill:"currentColor",fillRule:"evenodd"})})})]}),(0,u.jsx)("div",{className:"secondary_sidebar-inner flex-column flex-lg-row-auto w-100 mb-10 mb-lg-0",children:Y})]})]})}var G=L},64043:function(ee,F,a){"use strict";a.d(F,{ZO:function(){return s.ZO},Yw:function(){return s.Yw},KX:function(){return s.KX},Pw:function(){return s.Pw},aA:function(){return s.aA},G$:function(){return s.G$},_c:function(){return s._c},c9:function(){return s.c9},oM:function(){return s.oM},WF:function(){return s.WF},ot:function(){return s.ot},au:function(){return s.au},Nq:function(){return s.Nq},wp:function(){return s.wp},w4:function(){return s.w4},AQ:function(){return s.AQ}});var s=a(23798)},26008:function(ee,F,a){"use strict";a.r(F),a.d(F,{default:function(){return J}});var s=a(2824),t=a(67294),H=a(28865),V=a(1861),$=a(51615),W=a(11849),u=a(39428),S=a(3182),X=a(94184),L=a.n(X),G=a(84820),n=a(17818),z=a(64043),m=a(40446),e=a(85893);function Z(f){var r=f.module,j=f.visible,R=f.onClose,E=f.onSuccess,N=(0,t.useState)("settings"),g=(0,s.Z)(N,2),b=g[0],I=g[1],x=n.l0.useForm(),T=(0,z.oM)(),D=(0,s.Z)(T,1),h=D[0],A=(0,z.Pw)({refetchQueries:[{query:z.Yw,variables:{module:r.id}}]}),p=(0,s.Z)(A,2),C=p[0],k=p[1].loading,U=(0,m.RO)(function(){var o=(0,S.Z)((0,u.Z)().mark(function d(M,v,B){var l,c;return(0,u.Z)().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,h({variables:{moduleId:r.id,filter:{name:v}},fetchPolicy:"network-only",context:{fetchOptions:{signal:B}}});case 2:return l=i.sent,c=l.data,i.abrupt("return",!(c!=null&&c.models.length));case 5:case"end":return i.stop()}},d)}));return function(d,M,v){return o.apply(this,arguments)}}()),w=(0,m.RO)(function(){var o=(0,S.Z)((0,u.Z)().mark(function d(M,v,B){var l,c;return(0,u.Z)().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,h({variables:{moduleId:r.id,filter:{code:v}},fetchPolicy:"network-only",context:{fetchOptions:{signal:B}}});case 2:return l=i.sent,c=l.data,i.abrupt("return",!(c!=null&&c.models.length));case 5:case"end":return i.stop()}},d)}));return function(d,M,v){return o.apply(this,arguments)}}()),q=(0,m.RO)(function(){var o=(0,S.Z)((0,u.Z)().mark(function d(M,v,B){var l,c;return(0,u.Z)().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,h({variables:{moduleId:r.id,filter:{databaseTableName:v}},fetchPolicy:"network-only",context:{fetchOptions:{signal:B}}});case 2:return l=i.sent,c=l.data,i.abrupt("return",!(c!=null&&c.models.length));case 5:case"end":return i.stop()}},d)}));return function(d,M,v){return o.apply(this,arguments)}}()),K=(0,t.useCallback)(function(o){return function(){I(o)}},[]),Q=(0,t.useCallback)((0,S.Z)((0,u.Z)().mark(function o(){var d,M,v;return(0,u.Z)().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,x.validateFields();case 2:return d=l.sent,d.databaseTableName||(d.databaseTableName=d.code),l.prev=4,l.next=7,C({variables:{input:(0,W.Z)((0,W.Z)({},d),{},{features:["master","system-fields"],module:r.id})}});case 7:M=l.sent,v=M.data,n.FN.success("\u6A21\u578B \u201C".concat(d.name,"\u201D \u65B0\u589E\u6210\u529F"),2e3,{placement:"bottom-end",progressBar:!0}),E(v==null?void 0:v.createModel),l.next=16;break;case 13:l.prev=13,l.t0=l.catch(4),n.FN.error(l.t0.message,2e3,{placement:"bottom-end",progressBar:!0});case 16:case"end":return l.stop()}},o,null,[[4,13]])})),[C,x,r.id,E]),y=(0,t.useState)(!0),ae=(0,s.Z)(y,2),ne=ae[0],te=ae[1],le=(0,t.useState)(!0),re=(0,s.Z)(le,2),_=re[0],ie=re[1],ue=(0,t.useCallback)(function(o){if(Object.hasOwn(o,"code")&&te(!1),Object.hasOwn(o,"databaseColumnName")&&ie(!1),Object.hasOwn(o,"name")&&ne){var d=(0,G.N9)(o.name,{toneType:"none",type:"array"}).join("");x.setFieldValue("code",d),_&&x.setFieldValue("databaseColumnName",d.toUpperCase())}Object.hasOwn(o,"code")&&_&&x.setFieldValue("databaseColumnName",o.code.toUpperCase())},[ne,_,x]);return(0,e.jsxs)(n.u_,{confirmLoading:k,maskClosable:!k,width:592,centered:!0,visible:j,closable:!1,onCancel:R,onOk:Q,children:[(0,e.jsx)(n.u_.Header,{children:(0,e.jsx)("h4",{children:"\u521B\u5EFA\u6A21\u578B"})}),(0,e.jsx)(n.u_.Body,{children:(0,e.jsxs)(n.l0,{form:x,onValuesChange:ue,children:[(0,e.jsxs)("div",{className:"mb-5",children:[(0,e.jsx)(n.zx,{color:b!="settings"&&"gray-700",variant:b=="settings"?"light-primary":!1,activeColor:b=="settings"?"light-primary":"secondary",className:"me-4 px-5",onClick:K("settings"),children:"\u8BBE\u7F6E"}),(0,e.jsx)(n.zx,{color:b!="advanced"&&"gray-700",variant:b=="advanced"?"light-primary":!1,activeColor:b=="advanced"?"light-primary":"secondary",className:"me-4 px-5",onClick:K("advanced"),children:"\u9AD8\u7EA7"})]}),(0,e.jsxs)("div",{className:L()("modal-tabpane",{"d-none":b!="settings"}),children:[(0,e.jsx)(n.l0.Item,{required:!1,className:"mb-5",name:"name",hasFeedback:!0,label:"\u663E\u793A\u540D\u79F0",help:"\u914D\u7F6E\u6A21\u578B\u65F6\u663E\u793A\u7684\u540D\u79F0, \u901A\u5E38\u4E3A\u4E2D\u6587",rules:[{required:!0,message:"\u663E\u793A\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A"},{validator:U,message:"\u7F16\u7801\u91CD\u590D"}],children:(0,e.jsx)(n.II,{solid:!0,boxClassName:"w-75"})}),(0,e.jsx)(n.l0.Item,{required:!1,className:"my-5",name:"code",label:"\u7F16\u7801",hasFeedback:!0,help:"\u7528\u4E8E\u901A\u8FC7 API \u8BBF\u95EE\u6B64\u6A21\u578B\u7684 ID, \u4E0D\u80FD\u4E3A\u4E2D\u6587",rules:[{required:!0,message:"\u7F16\u7801\u4E0D\u80FD\u4E3A\u7A7A"},{pattern:/^([a-z])([a-z1-9])*(_([a-z1-9]+))*/i,message:"\u8BF7\u9075\u5FAA Java \u547D\u540D\u89C4\u8303"},{validator:w,message:"\u7F16\u7801\u91CD\u590D"}],children:(0,e.jsx)(n.II,{solid:!0,boxClassName:"w-75"})}),(0,e.jsx)(n.l0.Item,{className:"mt-5",name:"description",label:"\u63CF\u8FF0",help:"\u4E3A\u5185\u5BB9\u7F16\u8F91\u8005\u548C API \u7528\u6237\u663E\u793A\u63D0\u793A",requiredMark:"optional",children:(0,e.jsx)(n.II.TextArea,{className:"w-75",solid:!0,autoSize:{maxRows:4,minRows:2}})})]}),(0,e.jsx)("div",{className:L()("modal-tabpane",{"d-none":b!="advanced"}),children:(0,e.jsx)(n.l0.Item,{className:"mb-5",name:"databaseTableName",label:"\u8868\u540D",hasFeedback:!0,help:"\u6620\u5C04\u5230\u6570\u636E\u5E93\u4E2D\u7684\u8868\u540D",rules:[{pattern:/^([a-z])([a-z1-9])*(_([a-z1-9]+))*/i,message:"\u8BF7\u9075\u5FAA\u6570\u636E\u5E93\u547D\u540D\u89C4\u8303"},{validator:q,message:"\u6570\u636E\u5E93\u8868\u540D\u91CD\u590D"}],children:(0,e.jsx)(n.II,{solid:!0,boxClassName:"w-75"})})})]})})]})}var P=Z,O=a(80590);function Y(f){var r=f.location,j=f.history,R=f.children,E=r.state.module,N=(0,t.useState)(!1),g=(0,s.Z)(N,2),b=g[0],I=g[1],x=(0,z.wp)({variables:{module:E.id},fetchPolicy:"cache-and-network"}),T=x.data,D=x.loading,h=T||{},A=h.models,p=A===void 0?[]:A,C=(0,t.useCallback)(function(){I(!0)},[]),k=(0,t.useCallback)(function(){I(!1)},[]),U=r.state.baseUrl,w=U===void 0?"":U,q=(0,t.useCallback)(function(y){k(),j.push("".concat(w,"/schema/models/").concat(y.id))},[w,k,j]),K=(0,t.useCallback)(function(y){return function(){j.push("".concat(w,"/schema/models/").concat(y.id))}},[w,j]),Q=(0,t.useMemo)(function(){var y=(0,$.LX)(r.pathname,{path:"".concat(w,"/schema/models/:mid"),exact:!0,strict:!0});return y?"model_"+y.params.mid:""},[w,r.pathname]);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(O.Z,{className:"module_secondary_sidebar",width:260,children:(0,e.jsxs)("div",{className:"h-100",children:[(0,e.jsx)("div",{className:"mx-2 p-5 mt-5",children:(0,e.jsx)("h3",{className:"fw-bold text-dark mx-0 mb-0",children:"\u67B6\u6784"})}),(0,e.jsx)(V.E,{className:"d-flex h-100 flex-column custom-scrollbar",options:{scrollbars:{autoHide:"scroll"}},children:(0,e.jsxs)(n.v2,{className:"px-7 menu-state-bg menu-title-gray-600 menu-icon-gray-400 menu-state-primary menu-state-icon-primary menu-state-bullet-primary menu-arrow-gray-500 fw-bold fs-6 my-5 my-lg-0",selectedKeys:Q?[Q]:[],accordion:!1,selectable:"AllMenu",fit:!0,children:[(0,e.jsxs)(n.v2.Section,{className:"menu-section-container",sectionClassName:"d-flex align-items-center",children:[(0,e.jsxs)("span",{className:"menu-section text-muted text-uppercase fs-8 ls-1 flex-row-fluid",children:["\u6A21\u578B ",D&&" - \u52A0\u8F7D\u4E2D..."]}),(0,e.jsx)(n.zx,{icon:(0,e.jsx)(H.JO,{style:{marginRight:".2rem"},name:"Duotune/arr087",className:""}),size:"sm",variant:"white",activeColor:"light",className:"px-3 me-n4",onClick:C,children:"\u65B0\u589E"})]}),p.map(function(y){return(0,e.jsx)(n.v2.Item,{onClick:K(y),children:y.name},"model_".concat(y.id))}),(0,e.jsx)(n.v2.Item,{children:"xxxx3"})]})})]})}),(0,e.jsx)(P,{module:E,onSuccess:q,visible:b,onClose:k}),R]})}var J=Y}}]);

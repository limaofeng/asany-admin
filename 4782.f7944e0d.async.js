(self.webpackChunkasany_admin=self.webpackChunkasany_admin||[]).push([[4782],{54782:function(Ee,G,l){"use strict";var X=l(86582),B=l(2824),h=l(11849),J=l(91220),k=l(3182),q=l(94043),g=l.n(q),o=l(67294),F=l(28865),D=l(71167),ee=l.n(D),S=l(5618),j=l(40839),u=l(11974),U=l(54108),ae=l(4387),re=l(25496),e=l(85893),T={validator:function(p,d){return(0,k.Z)(g().mark(function a(){var b,M,c;return g().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:b=(0,J.Z)(d),i.prev=1,b.s();case 3:if((M=b.n()).done){i.next=9;break}if(c=M.value,!(0,S.Le)(c)){i.next=7;break}throw new Error("\u7535\u5B50\u90AE\u4EF6\u5730\u5740\u65E0\u6548");case 7:i.next=3;break;case 9:i.next=14;break;case 11:i.prev=11,i.t0=i.catch(1),b.e(i.t0);case 14:return i.prev=14,b.f(),i.finish(14);case 17:case"end":return i.stop()}},a,null,[[1,11,14,17]])}))()}},L=D.Quill.import("attributors/style/size"),w=D.Quill.import("attributors/style/font"),K=["9px","10px","11px","12px","13px",!1,"16px","18px","24px","36px","48px","64px","72px","96px","144px","288px"];L.whitelist=K;var W=["SimSun","SimHei","Microsoft-YaHei","KaiTi","FangSong","Arial","pingfang"];w.whitelist=W,D.Quill.register(L,!0),D.Quill.register(w,!0);function I(n){return(0,e.jsx)(S.ZP,(0,h.Z)({className:"email-tags-input border-0 form-control form-control-transparent",validate:S.Le,parseTag:S.N8},n))}function se(n){var p=n.mode,d=n.onChange,a=(0,o.useRef)(n.value||""),b=(0,o.useCallback)(function(c){d&&d(a.current=c)},[d]),M=(0,o.useCallback)(function(c){d&&d(c.target.value)},[d]);return p=="html"?(0,e.jsx)(ee(),{id:"kt_inbox_form_editor",className:"quill-zh_hans",modules:{toolbar:[["bold","italic","underline","strike"],[{font:W}],[{size:K}],[{color:[]},{background:[]}],[{list:"bullet"},{list:"ordered"}],[{indent:"-1"},{indent:"+1"}],[{align:[]}],["clean"]]},placeholder:"\u8F93\u5165\u6B63\u6587",theme:"snow",value:n.value,onChange:b}):(0,e.jsx)("div",{id:"kt_inbox_form_editor",className:"bg-transparent border-0 px-3",children:(0,e.jsx)(u.II.TextArea,{bordered:!1,value:n.value,onChange:M,className:"editor_mode_text",placeholder:"\u8F93\u5165\u6B63\u6587"})})}function $(n){var p;if(!n)return{sending:!1,mode:"plain",disabled:!0,autoSaveState:"default",recipients:[],title:""};var d=[];return n.cc.length&&d.push("cc"),n.bcc.length&&d.push("bcc"),{message:n,sending:!1,disabled:!n.to||!n.to.length,autoSaveState:"default",title:n.subject,recipients:d,mode:(p=n.mimeType)!==null&&p!==void 0&&p.endsWith("html")?"html":"plain"}}function ne(n){var p=n.onAutoSave,d=n.onSend,a=(0,o.useRef)($(n.message)),b=(0,o.useReducer)(function(s){return s+1},0),M=(0,B.Z)(b,2),c=M[1],z=(0,j.gi)({refetchQueries:[j.Nd]}),i=(0,B.Z)(z,1),ue=i[0],te=(0,j.qX)({refetchQueries:[j.Nd]}),le=(0,B.Z)(te,1),ie=le[0],de=(0,j.do)({refetchQueries:[j.Nd]}),oe=(0,B.Z)(de,1),Q=oe[0],ce=(0,ae.Qk)(function(){var s=(0,k.Z)(g().mark(function t(v,x){var C,P,E,f,_;return g().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(C=a.current.message,C){r.next=9;break}return r.next=4,ue({variables:{input:x}});case 4:P=r.sent,E=P.data,a.current.message=E==null?void 0:E.message,r.next=14;break;case 9:return r.next=11,ie({variables:{id:C.id,input:x}});case 11:f=r.sent,_=f.data,a.current.message=_==null?void 0:_.message;case 14:p(a.current.message);case 15:case"end":return r.stop()}},t)}));return function(t,v){return s.apply(this,arguments)}}(),a.current.message||{}),V=(0,B.Z)(ce,2),N=V[0],R=V[1],m=u.l0.useForm(),Z=(0,o.useRef)(null),O=(0,o.useCallback)(function(s){return function(){a.current.recipients.includes(s)?a.current.recipients=a.current.recipients.filter(function(t){return t!=s}):a.current.recipients=[].concat((0,X.Z)(a.current.recipients),[s]),c()}},[]),me=(0,o.useCallback)(function(){var s=a.current.mode=="plain"?"html":"plain",t=m.getFieldValue("body");s=="plain"?m.setFieldsValue({body:(0,U.Kv)(t,{text:"format"})}):m.setFieldsValue({body:(0,U.vb)(t)}),a.current.mode=s;var v=m.getFieldsValue();N((0,h.Z)((0,h.Z)({},v),{},{mimeType:"text/".concat(a.current.mode)}))},[m,N]);(0,o.useEffect)(function(){if(a.current.mode!="plain"){var s=document.querySelector(".ql-toolbar");s==null||s.classList.add("px-5","border-top-0","border-start-0","border-end-0");var t=document.querySelector(".ql-container");t==null||t.classList.add("bg-transparent","border-0","px-3","ql-snow")}},[a.current.mode]);var _e=(0,o.useCallback)(function(s){var t;(t=Z.current)===null||t===void 0||t.browse(s)},[]),be=(0,o.useCallback)(function(s,t){console.log("changedValues",s),s.hasOwnProperty("subject")&&(a.current.title=s.subject,c()),s.hasOwnProperty("to")&&(!s.to||!s.to.length?a.current.disabled||(a.current.disabled=!0,c()):a.current.disabled&&(a.current.disabled=!1,c())),N((0,h.Z)((0,h.Z)({},t),{},{mimeType:"text/".concat(a.current.mode)}))},[N]),ve=(0,o.useCallback)((0,k.Z)(g().mark(function s(){var t,v,x,C,P,E,f,_;return g().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,(t=Z.current)===null||t===void 0?void 0:t.uploadAll();case 2:return r.prev=2,r.next=5,m.validateFields();case 5:if(v=r.sent,!(!v.subject||!v.body)){r.next=15;break}return x=[],v.subject||x.push("\u4E3B\u9898"),v.body||x.push("\u6B63\u6587"),r.next=12,u.u_.confirm({title:"\u6B64\u90AE\u4EF6\u6CA1\u6709"+x.join("\u548C"),content:"\u662F\u5426\u4ECD\u8981\u53D1\u9001\u90AE\u4EF6\uFF1F",okText:"\u4ECD\u7136\u53D1\u9001"});case 12:if(C=r.sent,C.isConfirmed){r.next=15;break}return r.abrupt("return");case 15:return a.current.sending=!0,c(),r.prev=17,r.next=20,(0,re.gw)(Q({variables:{id:a.current.message.id}}),350);case 20:P=r.sent,u.u_.success({title:"\u64CD\u4F5C\u6210\u529F",content:"\u90AE\u4EF6\u5DF2\u6210\u529F\u53D1\u9001",timer:3e3}),d(P.data.message),r.next=30;break;case 25:r.prev=25,r.t0=r.catch(17),a.current.sending=!1,c(),u.u_.error({title:"\u9519\u8BEF",content:r.t0.message});case 30:r.next=38;break;case 32:r.prev=32,r.t1=r.catch(2),E=r.t1,f=E.errorFields[0],f.name.includes("to")?_="\u201C\u6536\u4EF6\u4EBA\uFF1A\u201D\u5B57\u6BB5\u4E2D\u7684\u4E00\u4E2A\u6216\u591A\u4E2A\u5730\u5740\u65E0\u6548\u3002\u8BF7\u5728\u7EA0\u6B63\u540E\u91CD\u8BD5\u3002":f.name.includes("cc")?_="\u201C\u6284\u9001\uFF1A\u201D\u5B57\u6BB5\u4E2D\u7684\u4E00\u4E2A\u6216\u591A\u4E2A\u5730\u5740\u65E0\u6548\u3002\u8BF7\u5728\u7EA0\u6B63\u540E\u91CD\u8BD5\u3002":f.name.includes("bcc")?_="\u201C\u5BC6\u9001\uFF1A\u201D\u5B57\u6BB5\u4E2D\u7684\u4E00\u4E2A\u6216\u591A\u4E2A\u5730\u5740\u65E0\u6548\u3002\u8BF7\u5728\u7EA0\u6B63\u540E\u91CD\u8BD5\u3002":_="\u8BF7\u5728\u7EA0\u6B63\u540E\u91CD\u8BD5\u3002",u.u_.error({title:f.errors[0],content:_});case 38:case"end":return r.stop()}},s,null,[[2,32],[17,25]])})),[m,d,Q]);(0,o.useMemo)(function(){return R?a.current.autoSaveState="saving":a.current.autoSaveState!="default"?a.current.autoSaveState="saved":a.current.autoSaveState},[R]),(0,o.useEffect)(function(){var s;!n.message||n.message.id==((s=a.current.message)===null||s===void 0?void 0:s.id)||(a.current=$(n.message),m.setFieldsValue((0,h.Z)({},n.message)),c())},[m,n.message]);var y=a.current,pe=y.message,A=y.recipients,fe=y.mode,H=y.autoSaveState,he=y.disabled,Y=y.sending;return console.log("recipients",A),(0,e.jsxs)(u.Zb,{className:"email-compose-editor",children:[(0,e.jsxs)(u.Zb.Header,{children:[(0,e.jsx)(u.Zb.Title,{children:a.current.title||"\u65B0\u4FE1\u606F"}),(0,e.jsxs)(u.Zb.Toolbar,{className:"text-gray-600",children:[H=="saving"&&"\u6B63\u5728\u5B58\u50A8\u8349\u7A3F...",H=="saved"&&"\u5DF2\u5B58\u50A8"]})]}),(0,e.jsx)(u.Zb.Body,{className:"p-0",children:(0,e.jsxs)(u.l0,{form:m,initialValues:(0,h.Z)({},pe||{}),onValuesChange:be,id:"kt_inbox_compose_form",children:[(0,e.jsxs)("div",{className:"email-compose-editor-body",children:[(0,e.jsxs)("div",{className:"d-flex align-items-center border-bottom px-8 min-h-45px",children:[(0,e.jsx)("div",{className:"text-dark fw-bolder w-75px",children:"\u6536\u4EF6\u4EBA:"}),(0,e.jsx)(u.l0.Item,{noStyle:!0,name:"to",rules:[T],children:(0,e.jsx)(I,{placeholder:"\u8F93\u5165\u6536\u4EF6\u4EBA\u90AE\u7BB1"})}),(0,e.jsxs)("div",{className:"ms-auto w-75px text-end",children:[!A.includes("cc")&&(0,e.jsx)("span",{onClick:O("cc"),className:"text-muted fs-bold cursor-pointer text-hover-primary me-2",children:"\u6284\u9001"}),!A.includes("bcc")&&(0,e.jsx)("span",{onClick:O("bcc"),className:"text-muted fs-bold cursor-pointer text-hover-primary",children:"\u5BC6\u9001"})]})]}),A.includes("cc")&&(0,e.jsxs)("div",{className:"align-items-center border-bottom ps-8 pe-5 min-h-45px d-flex",children:[(0,e.jsx)("div",{className:"text-dark fw-bolder w-75px",children:"\u6284\u9001:"}),(0,e.jsx)(u.l0.Item,{noStyle:!0,name:"cc",rules:[T],children:(0,e.jsx)(I,{placeholder:"\u8F93\u5165\u6284\u9001\u90AE\u7BB1"})}),(0,e.jsx)("span",{className:"btn btn-clean btn-xs btn-icon",onClick:O("cc"),children:(0,e.jsx)("i",{className:"la la-close"})})]}),A.includes("bcc")&&(0,e.jsxs)("div",{className:"align-items-center border-bottom inbox-to-bcc ps-8 pe-5 min-h-45px d-flex",children:[(0,e.jsx)("div",{className:"text-dark fw-bolder w-75px",children:"\u5BC6\u9001:"}),(0,e.jsx)(u.l0.Item,{noStyle:!0,name:"bcc",rules:[T],children:(0,e.jsx)(I,{placeholder:"\u8F93\u5165\u5BC6\u9001\u90AE\u7BB1"})}),(0,e.jsx)("span",{className:"btn btn-clean btn-xs btn-icon",onClick:O("bcc"),children:(0,e.jsx)("i",{className:"la la-close"})})]}),(0,e.jsxs)("div",{className:"d-flex align-items-center border-bottom px-8 min-h-45px",children:[(0,e.jsx)("div",{className:"text-dark fw-bolder w-75px",children:"\u4E3B\u9898:"}),(0,e.jsx)(u.l0.Item,{noStyle:!0,name:"subject",children:(0,e.jsx)(u.II,{className:"border-0 min-h-45px",placeholder:"\u8F93\u5165\u4E3B\u9898",transparent:!0})})]}),(0,e.jsx)(u.l0.Item,{noStyle:!0,name:"body",children:(0,e.jsx)(se,{mode:fe})}),(0,e.jsx)(u.l0.Item,{noStyle:!0,name:"attachments",children:(0,e.jsx)(u.gq.Queue,{auto:!0,ref:Z,namespace:"email"})})]}),(0,e.jsxs)("div",{className:"d-flex flex-stack flex-wrap gap-2 py-5 ps-8 pe-5 border-top",children:[(0,e.jsx)("div",{className:"d-flex align-items-center me-3",children:(0,e.jsx)("div",{className:"btn-group me-4",children:(0,e.jsx)(u.zx,{htmlType:"button",loading:Y,size:"lg",className:"rounded-2 fs-bold px-10",variant:"primary",icon:(0,e.jsx)(F.ZP,{name:"Duotune/gen016",className:"svg-icon-1 ms-n4 me-4"}),disabled:R||he,onClick:ve,children:Y?"\u53D1\u9001\u4E2D...":"\u53D1\u9001"})})}),(0,e.jsxs)("div",{className:"d-flex align-items-center",children:[(0,e.jsx)(u.u,{title:"\u6DFB\u52A0\u9644\u4EF6",placement:"top",children:(0,e.jsx)("span",{onClick:_e,className:"btn btn-icon btn-sm btn-clean btn-active-light-primary me-2 dz-clickable",children:(0,e.jsx)(F.ZP,{className:"svg-icon-2 m-0",name:"Duotune/com008"})})}),(0,e.jsx)(u.u,{title:"\u5207\u6362\u7F16\u8F91\u5668",placement:"top",children:(0,e.jsx)(u.zx,{as:"span",variant:"clean",activeColor:"light-primary",className:"btn-clean",icon:(0,e.jsx)(F.ZP,{className:"svg-icon-2",name:"Duotune/art001"}),onClick:me})})]})]})]})})]})}G.Z=ne}}]);

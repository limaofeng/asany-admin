(self.webpackChunkasany_admin=self.webpackChunkasany_admin||[]).push([[3609],{13609:function(Pe,L,a){"use strict";a.r(L);var Ae=a(3515),J=a(86288),X=a(93224),Y=a(3182),E=a(11849),p=a(2824),w=a(94043),B=a.n(w),r=a(67294),q=a(94184),ee=a.n(q),ae=a(30381),K=a.n(ae),te=a(43219),ne=a(73727),re=a(89887),h=a(33043),se=a(8845),le=a(75468),s=a(53704),W=a(25496),t=a(85893);function _e(F){var v=F.match.params.cid,M=F.location.state,ue=M.rootCategoryId,_=M.categories,b=M.baseUrl,u=(0,r.useRef)({action:"draft",publishedAt:K()()}),ie=(0,r.useReducer)(function(e){return e+1},0),oe=(0,p.Z)(ie,2),S=oe[1],Z=(0,r.useRef)(null),o=s.l0.useForm(),de=(0,r.useMemo)(function(){return!_||!_.length?[]:(0,W.G_)(_.map(function(e){return(0,E.Z)((0,E.Z)({},e),{},{value:e.id,title:e.name})}),{idKey:"id",childrenKey:"children",pidKey:"parent.id",sort:function(l,n){return l.index-n.index}})},[_]),ce=(0,se.uw)(),N=(0,p.Z)(ce,2),$=N[0],C=N[1].loading,me=(0,r.useState)(),k=(0,p.Z)(me,2),fe=k[0],Ee=k[1],he=(0,r.useCallback)(function(e){var l,n=_.find(function(d){return d.id==e});Ee(n==null||(l=n.storeTemplate)===null||l===void 0?void 0:l.id)},[_]),G=(0,r.useMemo)(function(){var e,l=_.find(function(n){return n.id==v});return((l==null||(e=l.path)===null||e===void 0?void 0:e.split("/"))||[]).map(function(n){return _.find(function(d){return d.id==n})}).filter(function(n){return n})},[_,v]),y=(0,r.useCallback)(function(){var e=(0,Y.Z)(B().mark(function l(n){var d,c,D,x,Q,H,T,V,j,P,R,f,A,U,g,m,z,I;return B().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return u.current.action=n,i.next=3,(d=Z.current)===null||d===void 0?void 0:d.uploadAll();case 3:return i.next=5,o.validateFields();case 5:for(c=i.sent,D=c.meta,x=c.category,Q=c.body,H=c.publishedAt,T=(0,X.Z)(c,["meta","category","body","publishedAt"]),V={seo_title:"single_line_text_field",seo_description:"multi_line_text_field",seo_keywords:"list.single_line_text_field"},j=[],P=0,R=Object.keys(D);P<R.length;P++)for(f=R[P],A=0,U=Object.keys(D[f]);A<U.length;A++)g=U[A],j.push({namespace:f,key:g,value:D[f][g],type:V[f+"_"+g]});return m=(0,E.Z)((0,E.Z)({},T),{},{metafields:j,category:x.id,body:{type:"HTML",text:Q.text}}),n=="publish"?m.status="PUBLISHED":n=="schedule"?(m.status="SCHEDULED",m.publishedAt=H):m.status="DRAFT",z=$({variables:{input:m}}),i.next=19,s.FN.promise((0,W.gw)(z,350),{pending:"\u63D0\u4EA4\u4E2D...",success:"\u201C".concat(T.title,"\u201D \u4FEE\u6539\u6210\u529F"),error:"\u63D0\u4EA4\u51FA\u9519"},{duration:2e3,placement:"top-center"});case 19:I=i.sent,te.m8.replace("".concat(b,"/cms/categories/").concat(x.id,"/articles/").concat(I.data.article.id)),console.log("submit result set",I);case 22:case"end":return i.stop()}},l)}));return function(l){return e.apply(this,arguments)}}(),[b,$,o]),ve=(0,r.useCallback)(function(){y("draft")},[y]),be=(0,r.useCallback)(function(e){y(e)},[y]),O=u.current.publishedAt,ye=(0,r.useCallback)(function(e){u.current.publishedAt=e,o.setFieldsValue({publishedAt:e}),S()},[o]),De=(0,r.useCallback)(function(){u.current.publishedAt=K()(),S(),o.setFieldsValue({publishedAt:u.current.publishedAt})},[o]);return console.log("storeTemplate",fe,O),(0,t.jsx)(le.v,{header:{title:"\u65B0\u589E\u6587\u7AE0"},breadcrumb:(0,t.jsx)(s.aG,{className:"fw-bold fs-base text-muted my-1",children:G?(0,t.jsx)(t.Fragment,{children:G.filter(function(e){return e.id!=ue}).map(function(e){return e.id==v?(0,t.jsx)(s.aG.Item,{className:"text-dark",children:e.name},e.id):(0,t.jsx)(s.aG.Item,{children:(0,t.jsx)(ne.Link,{to:"".concat(b,"/cms/categories/").concat(e.id,"/articles"),className:"text-muted",children:e.name})},e.id)})}):(0,t.jsx)(s.aG.Item,{children:"\u52A0\u8F7D\u4E2D..."})}),children:(0,t.jsxs)(s.l0,{form:o,initialValues:{status:"DRAFT",publishedAt:O,category:{id:v}},className:"form d-flex flex-column flex-lg-row",children:[(0,t.jsxs)("div",{className:"d-flex flex-column flex-row-fluid gap-7 gap-lg-10  me-lg-10",children:[(0,t.jsxs)(s.mQ,{defaultActiveKey:"general",renderContainer:!1,className:"border-0 fs-4 fw-bold mb-n2 nav-line-tabs-2x",children:[(0,t.jsx)(s.mQ.TabPane,{tab:"\u57FA\u672C\u4FE1\u606F",forceRender:!0,children:(0,t.jsx)(h.LQ,{queueUpload:Z})},"general"),(0,t.jsx)(s.mQ.TabPane,{tab:"\u9AD8\u7EA7\u8BBE\u7F6E",forceRender:!0,children:(0,t.jsx)(h.aE,{})},"advanced"),(0,t.jsx)(s.mQ.TabPane,{tab:"\u5143\u6570\u636E",forceRender:!0,children:(0,t.jsx)(h.SF,{})},"meta")]}),(0,t.jsx)(J.Z,{offsetBottom:16,children:(0,t.jsxs)("div",{className:ee()("d-flex bg-body-color p-5 mx-4 tw-rounded-2xl justify-content-end"),children:[(0,t.jsx)(s.zx,{variant:"light",loading:u.current.action=="draft"&&C,onClick:ve,className:"me-5",children:!u.current.action&&C?"\u4FDD\u5B58\u4E2D...":"\u4FDD\u5B58\u8349\u7A3F"}),(0,t.jsx)(h.H5,{onPublish:be,publishedAt:O,submitting:u.current.action!="draft"&&C,setPublishedAt:ye,onCancel:De})]})})]}),(0,t.jsx)(re.Z,{baseUrl:b,categoryTreeData:de,onChangeCategory:he})]})})}L.default=_e}}]);

"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[6412],{9566:function(X,w,r){var I=r(12845),L=r(38018);function T(){var h=(0,I.useLocation)();return L.parse(h.search)}w.Z=T},26651:function(X,w,r){r.r(w),r.d(w,{default:function(){return de}});var I=r(19632),L=r.n(I),T=r(15009),h=r.n(T),q=r(97857),M=r.n(q),_=r(99289),S=r.n(_),ee=r(5574),Q=r.n(ee),v=r(62435),O=r(96974),V=r(84059),G=r(38018),re=r(64763),ae=r(9566),ne=r(73588),s=r(79817),k=r(91726),te=r(84730),ue=r(92592);function se(C){return R.apply(this,arguments)}function R(){return R=S()(h()().mark(function C(y){var f,g,i;return h()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,fetch(y);case 2:return f=o.sent,o.next=5,f.blob();case 5:return g=o.sent,i=new FileReader,o.abrupt("return",new Promise(function(E,j){i.onloadend=function(){E(i.result)},i.onerror=j,i.readAsDataURL(g)}));case 8:case"end":return o.stop()}},C)})),R.apply(this,arguments)}var le=se("/assets/images/qrcode_logo.png");function U(C){return Y.apply(this,arguments)}function Y(){return Y=S()(h()().mark(function C(y){var f,g,i,x,o,E;return h()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return f=80,g=40,i=new te.ZP("l","mm",[f,g]),p.next=4,Promise.all(y.map(function(F){return ue.toDataURL(F.qrcode,{width:40,height:40,errorCorrectionLevel:"H",quality:.92})}));case 4:x=p.sent,o=0;case 6:if(!(o<y.length)){p.next=16;break}return i.addImage(x[o],"JPEG",0,0,40,40,"","FAST"),p.next=10,le;case 10:E=p.sent,i.addImage(E,"JPEG",40,0,40,40,"","FAST"),o<x.length-1&&i.addPage([f,g],"l");case 13:o++,p.next=6;break;case 16:window.open(i.output("bloburl"),"_blank");case 17:case"end":return p.stop()}},C)})),Y.apply(this,arguments)}var e=r(86074);function oe(C,y){var f=new Date,g=f.getFullYear().toString(),i=(f.getMonth()+1).toString().padStart(2,"0"),x=f.getDate().toString().padStart(2,"0"),o=C.replace("{YYYY}",g).replace("{MM}",i).replace("{DD}",x),E=C.match(/{SEQ:(\d+)}/);if(E){var j=parseInt(E[1],10),p=y.toString().padStart(j,"0");o=o.replace(E[0],p)}return o}function ie(){var C,y,f=(0,O.TH)(),g=(0,O.s0)(),i=(0,ae.Z)(),x=(0,v.useState)(!1),o=Q()(x,2),E=o[0],j=o[1],p=s.Form.useForm(),F=(0,v.useMemo)(function(){return i.q&&(i.filter={name_contains:i.q},delete i.q),i},[i]),ce=(0,k.BC)({refetchQueries:[k.aT]}),ve=Q()(ce,1),Z=ve[0],P=(0,k.Vh)({fetchPolicy:"cache-and-network",variables:F}),d=P.data,B=P.loading,c=P.previousData,me=(0,k.Fm)({refetchQueries:[k.aT]}),H=Q()(me,2),fe=H[0],he=H[1].loading,pe=(0,v.useCallback)(function(){j(!0)},[]),Ce=(0,v.useCallback)(S()(h()().mark(function a(){var n,t,u,m;return h()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,p.validateFields();case 2:return n=b.sent,b.next=5,fe({variables:{links:Array.from({length:n.count}).map(function(N,D){return{category:"wxb",metadata:{no:oe(n.numberRule,D+1)}}})}});case 5:t=b.sent,u=t.data,m=(u==null?void 0:u.result.map(function(N){return M()(M()({},N),{},{qrcode:"https://s.mh-procoffeemachine.com/s/"+N.code})}))||[],U(m),s.Toast.success("\u4E8C\u7EF4\u7801\u6279\u91CF\u5220\u9664\u6210\u529F",2e3,{placement:"bottom-left",progressBar:!0}),j(!1);case 11:case"end":return b.stop()}},a)})),[]),A=(0,v.useMemo)(function(){if(!F.orderBy)return{order:"descend",field:"createdAt"};var a=F.orderBy.split("_"),n=Q()(a,2),t=n[0],u=n[1];return{order:u==="desc"?"descend":"ascend",field:t}},[F.orderBy]),ge=(0,v.useMemo)(function(){return B?(c==null?void 0:c.deviceQrCodes.pageInfo.total)||0:(d==null?void 0:d.deviceQrCodes.pageInfo.total)||0},[d==null?void 0:d.deviceQrCodes.pageInfo.total,B,c==null?void 0:c.deviceQrCodes.pageInfo.total]),ye=(0,v.useMemo)(function(){return B?(c==null?void 0:c.deviceQrCodes.pageInfo)||{total:0,current:1}:(d==null?void 0:d.deviceQrCodes.pageInfo)||{total:0,current:1}},[d==null?void 0:d.deviceQrCodes,B,c==null?void 0:c.deviceQrCodes]),Ee=(0,v.useMemo)(function(){var a;if(B){var n;return((c==null||(n=c.deviceQrCodes)===null||n===void 0?void 0:n.edges)||[]).map(function(t){return t.node})}return((d==null||(a=d.deviceQrCodes)===null||a===void 0?void 0:a.edges)||[]).map(function(t){return t.node})},[d==null?void 0:d.deviceQrCodes,B,c==null?void 0:c.deviceQrCodes]),Fe=(0,v.useCallback)(function(a){g(f.pathname+"?"+G.stringify({q:a}),{replace:!0})},[g,f.pathname]),be=(0,v.useCallback)(function(a,n,t){var u,m={};if((u=F.filter)!==null&&u!==void 0&&u.name_contains){var l;m.q=(l=F.filter)===null||l===void 0?void 0:l.name_contains}t&&(m.orderBy=t.field+"_"+(t.order==="ascend"?"asc":"desc")),m.page=a.current,g(f.pathname+"?"+G.stringify(m),{replace:!0})},[history,f.pathname,(C=F.filter)===null||C===void 0?void 0:C.name_contains]),z=(0,v.useCallback)(S()(h()().mark(function a(){var n,t,u,m,l,b=arguments;return h()().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:for(n=b.length,t=new Array(n),u=0;u<n;u++)t[u]=b[u];return D.next=3,Z({variables:{where:{id_in:t}}});case 3:return m=D.sent,l=m.data,D.abrupt("return",(l==null?void 0:l.result.count)||0);case 6:case"end":return D.stop()}},a)})),[Z]),J=(0,v.useCallback)(function(a){return S()(h()().mark(function n(){var t,u;return h()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return t="\u786E\u5B9A\u5220\u9664\u9009\u4E2D\u7684, \u5171 ".concat(a.length," \u4E2A\u4E8C\u7EF4\u7801\u5417\uFF1F"),l.next=3,s.Modal.confirm({title:"\u786E\u5B9A\u5220\u9664",content:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("p",{className:"tip-confirm",children:t}),(0,e.jsx)("p",{children:"\u5220\u9664\u7684\u64CD\u4F5C\u4E0D\u53EF\u9006,\u8BF7\u8C28\u614E\u64CD\u4F5C"})]}),okClassName:"btn-danger",okText:"\u5220\u9664"});case 3:if(u=l.sent,u.isConfirmed){l.next=6;break}return l.abrupt("return");case 6:return l.next=8,z.apply(void 0,L()(a));case 8:s.Toast.success("\u4E8C\u7EF4\u7801\u6279\u91CF\u5220\u9664\u6210\u529F",2e3,{placement:"bottom-left",progressBar:!0});case 9:case"end":return l.stop()}},n)}))},[z]),xe=(0,v.useCallback)(function(a,n){return S()(h()().mark(function t(){return h()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:U(n.map(function(l){return M()(M()({},l),{},{qrcode:"https://s.mh-procoffeemachine.com/s/"+l.code})}));case 1:case"end":return m.stop()}},t)}))},[]),je=(0,v.useMemo)(function(){return function(a,n){return(0,e.jsxs)("div",{children:[(0,e.jsx)(s.Button,{color:"success",onClick:J(a),variant:!1,children:"\u6279\u91CF\u5220\u9664"}),(0,e.jsx)(s.Button,{color:"success",onClick:xe(a,n),variant:!1,children:"\u6253\u5370\u4E8C\u7EF4\u7801"})]})}},[J]),Be=(0,v.useState)(),K=Q()(Be,2),$=K[0],W=K[1],De=(0,v.useCallback)(function(a){W(a)},[]),Se=(0,v.useCallback)(function(){W(void 0)},[]);return(0,e.jsxs)(ne.vs,{header:{title:"\u8BBE\u5907\u4E8C\u7EF4\u7801"},children:[(0,e.jsxs)(s.Modal,{width:640,centered:!0,onOk:Ce,confirmLoading:he,okText:"\u4FDD\u5B58",visible:E,onCancel:function(){return j(!1)},children:[(0,e.jsx)(s.Modal.Header,{closable:!0,className:"ms-5 border-0",children:(0,e.jsx)("h1",{className:"modal-title pt-6 pb-4",children:"\u751F\u6210\u8BBE\u5907\u4E8C\u7EF4\u7801"})}),(0,e.jsx)(s.Modal.Body,{children:(0,e.jsxs)(s.Form,{form:p,initialValues:{numberRule:"NV-{YYYY}{MM}{DD}-{SEQ:3}",count:1},children:[(0,e.jsx)(s.Form.Item,{className:"d-flex flex-column mb-7",name:"numberRule",label:"\u8BBE\u5907\u7F16\u53F7\u89C4\u5219",help:"\u7F16\u53F7\u89C4\u5219\u652F\u6301\u53D8\u91CF\uFF1A{YYYY} {MM} {DD} {SEQ:3}",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u7F16\u53F7\u89C4\u5219"}],children:(0,e.jsx)(s.Input,{solid:!0,placeholder:"INV-{YYYY}{MM}{DD}-{SEQ:3}"})}),(0,e.jsx)(s.Form.Item,{className:"d-flex flex-column mb-7",name:"count",label:"\u751F\u6210\u6570\u91CF",children:(0,e.jsx)(s.Input,{solid:!0})})]})})]}),(0,e.jsxs)(s.Modal,{title:"\u9884\u89C8\u4E8C\u7EF4\u7801",dialogClassName:"w-250px",onCancel:Se,visible:!!$,centered:!0,okButtonProps:{style:{display:"none"}},children:[(0,e.jsx)("div",{className:"d-inline-block",children:!!$&&(0,e.jsx)(V.Qd,{size:200,value:$})}),(0,e.jsx)("span",{children:"\u4F7F\u7528\u624B\u673A\u626B\u7801\u4E8C\u7EF4\u7801\u9884\u89C8"})]}),(0,e.jsxs)("div",{className:"d-flex flex-wrap flex-stack pb-7",children:[(0,e.jsxs)("div",{className:"d-flex flex-wrap align-items-center",children:[(0,e.jsx)("h3",{className:"fw-bolder me-5",children:"\u8BBE\u5907\u4E8C\u7EF4\u7801"}),(0,e.jsx)(s.Input.Search,{onSearch:Fe,defaultValue:(y=F.filter)===null||y===void 0?void 0:y.name_contains,placeholder:"\u641C\u7D22",className:"border-body bg-body w-250px"})]}),(0,e.jsx)(re.ZX,{children:(0,e.jsx)("div",{className:"d-flex my-0",children:(0,e.jsx)(s.Button,{onClick:pe,children:"\u751F\u6210\u4E8C\u7EF4\u7801"})})})]}),!ge&&!B?(0,e.jsx)(s.Card,{className:"mb-5 mb-xl-10",children:(0,e.jsx)(s.Empty,{title:"\u8FD8\u6CA1\u6709\u8BBE\u5907\u4E8C\u7EF4\u7801",description:"\u9A6C\u4E0A\u6DFB\u52A0\u8BBE\u5907\u4E8C\u7EF4\u7801",image:"/assets/media/illustrations/sigma-1/4.png",children:(0,e.jsx)(s.Button,{variant:"primary",children:"\u751F\u6210\u4E8C\u7EF4\u7801"})})}):(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(s.Card,{className:"mb-5 mb-xl-10",children:(0,e.jsx)(s.Card.Body,{children:(0,e.jsx)(s.BlockUI,{overlayClassName:"bg-white bg-opacity-25",loading:B,children:(0,e.jsx)(s.Table,{hover:!0,rowKey:"id",rowSelection:{type:"checkbox",renderTitle:function(n){return(0,e.jsxs)(e.Fragment,{children:["\u5DF2\u9009\u4E2D",(0,e.jsx)("span",{className:"mx-2",children:n}),"\u4E2A\u4E8C\u7EF4\u7801"]})},toolbar:je},noRowsRenderer:function(){return(0,e.jsx)(s.Empty,{description:"\u5217\u8868\u6570\u636E\u4E3A\u7A7A",image:"/assets/media/illustrations/sigma-1/5.png"})},columns:[{key:"code",title:"\u7F16\u53F7",sorter:!0,sortOrder:A.field==="code"?A.order:void 0,width:80},{key:"url",title:"\u4E8C\u7EF4\u7801\u94FE\u63A5",sorter:!0,sortOrder:A.field==="url"?A.order:void 0,render:function(n,t){var u;return n?(0,e.jsx)("a",{className:"text-gray-700",href:n,target:"_",children:(u=t.metadata)===null||u===void 0?void 0:u.no}):(0,e.jsx)("span",{className:"text-gray-700",children:"\u672A\u7ED1\u5B9A\u8BBE\u5907"})}},{key:"createdAt",title:"\u521B\u5EFA\u65F6\u95F4",width:200},{key:"accessCount",title:"\u8BBF\u95EE\u6B21\u6570",width:120},{key:"qrCode",title:"\u4E8C\u7EF4\u7801",width:180,render:function(n,t){var u="https://s.mh-procoffeemachine.com/s/"+t.code;return(0,e.jsx)(V.Qd,{onClick:function(l){l.preventDefault(),l.stopPropagation(),De("https://s.mh-procoffeemachine.com/s/"+t.code)},size:30,value:u})}}],pagination:ye,onChange:be,dataSource:Ee})})})})})]})}var de=ie}}]);

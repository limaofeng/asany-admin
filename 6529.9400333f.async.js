(self.webpackChunkasany_admin=self.webpackChunkasany_admin||[]).push([[6529],{66529:function(J,D,t){"use strict";t.r(D);var o=t(11849),Z=t(93224),M=t(3182),E=t(2824),S=t(94043),g=t.n(S),b=t(67294),p=t(81303),T=t(75468),a=t(11974),e=t(85893);function k(w){var j,_=w.match,u=w.history,R=(0,p.ZL)({fetchPolicy:"cache-and-network",variables:{pageSize:1e3}}),f=R.data,U=(0,p.Nd)({fetchPolicy:"cache-and-network",variables:{pageSize:1e3}}),x=U.data,W=(0,p.V_)({fetchPolicy:"cache-and-network"}),C=(0,E.Z)(W,2),B=C[0],F=C[1],y=F.data,I=F.loading,K=(0,p.mp)({}),A=(0,E.Z)(K,2),O=A[0],V=A[1].loading,z=(0,p.qV)({}),L=(0,E.Z)(z,2),N=L[0],$=L[1].loading,m=_.params.id=="new",c=a.l0.useForm(),Q=(0,b.useCallback)((0,M.Z)(g().mark(function i(){var n,l,r,d;return g().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,c.validateFields();case 2:if(n=s.sent,l=n.start,r=n.end,d=(0,Z.Z)(n,["start","end"]),!m){s.next=11;break}return s.next=9,O({variables:{input:(0,o.Z)((0,o.Z)({},d),{},{start:l&&l.isValid()?l.toString():void 0,end:r&&r.isValid()?r.toString():void 0})}});case 9:s.next=13;break;case 11:return s.next=13,N({variables:{id:_.params.id,input:(0,o.Z)((0,o.Z)({},d),{},{start:l&&l.isValid()?l.toString():void 0,end:r&&r.isValid()?r.toString():void 0})}});case 13:a.FN.success("\u6D3B\u52A8 \u201C".concat(d.name,"\u201D ").concat(m?"\u65B0\u589E":"\u4FEE\u6539","\u6210\u529F"),2e3,{placement:"bottom-start",progressBar:!0}),u.length?u.goBack():u.replace("/website/landing/pages");case 15:case"end":return s.stop()}},i)})),[O,_.params.id,c,u,m,N]);(0,b.useEffect)(function(){if(_.params.id!="new"){var i=new AbortController;return B({variables:{id:_.params.id},context:{fetchOptions:{signal:i.signal}}}).then(function(){var n=(0,M.Z)(g().mark(function l(r){var d,P,s,v;return g().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(s=r.data,v=s==null?void 0:s.page,v){h.next=7;break}return h.next=5,a.u_.error({content:"\u6D3B\u52A8\u4E0D\u5B58\u5728,\u53EF\u80FD\u5DF2\u7ECF\u88AB\u5220\u9664\u4E86",timer:3e3,timerProgressBar:!0});case 5:return u.length?u.goBack():u.replace("/website/landing/pages"),h.abrupt("return");case 7:c.setFieldsValue((0,o.Z)((0,o.Z)({},v),{},{poster:(d=v.poster)===null||d===void 0?void 0:d.id,stores:(P=v.stores)===null||P===void 0?void 0:P.map(function(X){return X.id})}));case 8:case"end":return h.stop()}},l)}));return function(l){return n.apply(this,arguments)}}()),function(){i.abort()}}},[c,B,u,_.params.id]);var H=(0,b.useMemo)(function(){return f==null?void 0:f.landingStores.edges.map(function(i){var n=i.node;return{value:n.id,label:n.name}})},[f]),G=(0,b.useMemo)(function(){return x==null?void 0:x.landingPosters.edges.map(function(i){var n=i.node;return{value:n.id,label:n.name}})},[x]);return(0,e.jsx)(T.v,{header:m?{title:"\u65B0\u589E\u6D3B\u52A8"}:void 0,footer:!1,children:(0,e.jsxs)(a.Zb,{className:"mb-5 mb-xl-10",children:[(0,e.jsx)(a.Zb.Header,{children:(0,e.jsx)(a.Zb.Title,{children:m?"\u65B0\u589E\u6D3B\u52A8":y==null||(j=y.page)===null||j===void 0?void 0:j.name})}),(0,e.jsxs)(a.Zb.Body,{children:[(0,e.jsx)(a.bH,{zIndex:10,overlayClassName:"bg-white bg-opacity-25",loading:I,children:(0,e.jsxs)(a.l0,{form:c,className:"w-800px row d-flex flex-shrink-0 flex-column-reverse flex-md-row",children:[(0,e.jsxs)("div",{className:"col-12 col-md-8",children:[(0,e.jsx)(a.l0.Item,{className:"mb-5",name:"name",label:"\u540D\u79F0",rules:[{required:!0,message:"\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A"}],children:(0,e.jsx)(a.II,{solid:!0,className:"w-400px"})}),(0,e.jsx)(a.l0.Item,{className:"my-5",name:"poster",label:"\u6D77\u62A5",children:(0,e.jsx)(a.ub,{solid:!0,className:"w-400px",options:G})}),(0,e.jsx)(a.l0.Item,{className:"my-5",name:"stores",label:"\u53C2\u52A0\u6D3B\u52A8\u7684\u95E8\u5E97",children:(0,e.jsx)(a.ub,{solid:!0,multiple:!0,className:"w-400px",options:H})}),(0,e.jsx)(a.l0.Item,{className:"my-5",name:"start",label:"\u5F00\u59CB\u65F6\u95F4",children:(0,e.jsx)(a.Mt,{solid:!0,className:"w-400px"})}),(0,e.jsx)(a.l0.Item,{dependencies:["start"],noStyle:!0,children:function(){return(0,e.jsx)(a.l0.Item,{className:"my-5",name:"end",label:"\u622A\u6B62\u65F6\u95F4",children:(0,e.jsx)(a.Mt,{solid:!0,minDate:c.getFieldValue("start"),className:"w-400px"})})}}),(0,e.jsx)(a.l0.Item,{className:"my-5",name:"description",label:"\u63CF\u8FF0",help:"\u8BF7\u7528\u5C11\u4E8E250\u5B57\u7B26\u63CF\u8FF0",children:(0,e.jsx)(a.II.TextArea,{solid:!0,autoSize:{minRows:4,maxRows:8},showCount:!0,maxLength:250,className:"w-400px"})})]}),(0,e.jsx)("div",{className:"col-12 col-md-4",children:(0,e.jsx)(a.AS.iPhoneX,{children:(0,e.jsx)(a.l0.Item,{dependencies:["poster","stores"],noStyle:!0,children:function(n){var l=n.getFieldValue("poster"),r=n.getFieldValue("stores");return(0,e.jsx)("iframe",{src:"//47.103.119.188:8002"+"/lps/0?&poster=".concat(l,"&stores=").concat(r==null?void 0:r.join(",")),style:{width:"100%",height:"100%"}})}})})})]})}),(0,e.jsx)(a.zx,{loading:I||V||$,onClick:Q,children:m?(0,e.jsx)(e.Fragment,{children:"\u6DFB\u52A0\u6D3B\u52A8"}):(0,e.jsx)(e.Fragment,{children:"\u4FEE\u6539\u6D3B\u52A8"})})]})]})})}D.default=k}}]);

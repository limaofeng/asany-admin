"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[8346],{22152:function(ke,R,s){s.r(R),s.d(R,{default:function(){return ce}});var Z=s(19632),X=s.n(Z),K=s(15009),C=s.n(K),W=s(97857),w=s.n(W),q=s(99289),D=s.n(q),_=s(5574),Q=s.n(_),v=s(62435),$=s(96974),P=s(84059),N=s(38018),ee=s(64763),re=s(12845);function ae(){var h=(0,re.useLocation)();return N.parse(h.search)}var ne=ae,te=s(73588),u=s(79817),k=s(91726),ue=s(84730),se=s(92592);function le(h){return I.apply(this,arguments)}function I(){return I=D()(C()().mark(function h(y){var f,g,i;return C()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,fetch(y);case 2:return f=o.sent,o.next=5,f.blob();case 5:return g=o.sent,i=new FileReader,o.abrupt("return",new Promise(function(F,j){i.onloadend=function(){F(i.result)},i.onerror=j,i.readAsDataURL(g)}));case 8:case"end":return o.stop()}},h)})),I.apply(this,arguments)}var oe=le("/assets/images/qrcode_logo.png");function V(h){return L.apply(this,arguments)}function L(){return L=D()(C()().mark(function h(y){var f,g,i,x,o,F;return C()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return f=80,g=40,i=new ue.ZP("l","mm",[f,g]),p.next=4,Promise.all(y.map(function(b){return se.toDataURL(b.qrcode,{width:40,height:40,errorCorrectionLevel:"H",quality:.92})}));case 4:x=p.sent,o=0;case 6:if(!(o<y.length)){p.next=16;break}return i.addImage(x[o],"JPEG",0,0,40,40,"","FAST"),p.next=10,oe;case 10:F=p.sent,i.addImage(F,"JPEG",40,0,40,40,"","FAST"),o<x.length-1&&i.addPage([f,g],"l");case 13:o++,p.next=6;break;case 16:window.open(i.output("bloburl"),"_blank");case 17:case"end":return p.stop()}},h)})),L.apply(this,arguments)}var e=s(86074);function ie(h,y){var f=new Date,g=f.getFullYear().toString(),i=(f.getMonth()+1).toString().padStart(2,"0"),x=f.getDate().toString().padStart(2,"0"),o=h.replace("{YYYY}",g).replace("{MM}",i).replace("{DD}",x),F=h.match(/{SEQ:(\d+)}/);if(F){var j=parseInt(F[1],10),p=y.toString().padStart(j,"0");o=o.replace(F[0],p)}return o}function de(){var h,y,f=(0,$.TH)(),g=(0,$.s0)(),i=ne(),x=(0,v.useState)(!1),o=Q()(x,2),F=o[0],j=o[1],p=u.Form.useForm(),b=(0,v.useMemo)(function(){return i.q&&(i.filter={name_contains:i.q},delete i.q),i},[i]),ve=(0,k.BC)({refetchQueries:[k.aT]}),me=Q()(ve,1),G=me[0],T=(0,k.Vh)({fetchPolicy:"cache-and-network",variables:b}),d=T.data,B=T.loading,c=T.previousData,fe=(0,k.Fm)({refetchQueries:[k.aT]}),O=Q()(fe,2),he=O[0],pe=O[1].loading,Ce=(0,v.useCallback)(function(){j(!0)},[]),ge=(0,v.useCallback)(D()(C()().mark(function r(){var a,n,t,m;return C()().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return E.next=2,p.validateFields();case 2:return a=E.sent,E.next=5,he({variables:{links:Array.from({length:a.count}).map(function(M,S){return{category:"wxb",metadata:{no:ie(a.numberRule,S+1)}}})}});case 5:n=E.sent,t=n.data,m=(t==null?void 0:t.result.map(function(M){return w()(w()({},M),{},{qrcode:"https://s.asany.cn/s/"+M.code})}))||[],V(m),u.Toast.success("\u4E8C\u7EF4\u7801\u6279\u91CF\u5220\u9664\u6210\u529F",2e3,{placement:"bottom-left",progressBar:!0}),j(!1);case 11:case"end":return E.stop()}},r)})),[]),A=(0,v.useMemo)(function(){if(!b.orderBy)return{order:"descend",field:"createdAt"};var r=b.orderBy.split("_"),a=Q()(r,2),n=a[0],t=a[1];return{order:t==="desc"?"descend":"ascend",field:n}},[b.orderBy]),ye=(0,v.useMemo)(function(){return B?(c==null?void 0:c.deviceQrCodes.pageInfo.total)||0:(d==null?void 0:d.deviceQrCodes.pageInfo.total)||0},[d==null?void 0:d.deviceQrCodes.pageInfo.total,B,c==null?void 0:c.deviceQrCodes.pageInfo.total]),Fe=(0,v.useMemo)(function(){return B?(c==null?void 0:c.deviceQrCodes.pageInfo)||{total:0,current:1}:(d==null?void 0:d.deviceQrCodes.pageInfo)||{total:0,current:1}},[d==null?void 0:d.deviceQrCodes,B,c==null?void 0:c.deviceQrCodes]),be=(0,v.useMemo)(function(){var r;if(B){var a;return((c==null||(a=c.deviceQrCodes)===null||a===void 0?void 0:a.edges)||[]).map(function(n){return n.node})}return((d==null||(r=d.deviceQrCodes)===null||r===void 0?void 0:r.edges)||[]).map(function(n){return n.node})},[d==null?void 0:d.deviceQrCodes,B,c==null?void 0:c.deviceQrCodes]),Ee=(0,v.useCallback)(function(r){g(f.pathname+"?"+N.stringify({q:r}),{replace:!0})},[g,f.pathname]),xe=(0,v.useCallback)(function(r,a,n){var t,m={};if((t=b.filter)!==null&&t!==void 0&&t.name_contains){var l;m.q=(l=b.filter)===null||l===void 0?void 0:l.name_contains}n&&(m.orderBy=n.field+"_"+(n.order==="ascend"?"asc":"desc")),m.page=r.current,g(f.pathname+"?"+N.stringify(m),{replace:!0})},[history,f.pathname,(h=b.filter)===null||h===void 0?void 0:h.name_contains]),H=(0,v.useCallback)(D()(C()().mark(function r(){var a,n,t,m,l,E=arguments;return C()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:for(a=E.length,n=new Array(a),t=0;t<a;t++)n[t]=E[t];return S.next=3,G({variables:{where:{id_in:n}}});case 3:return m=S.sent,l=m.data,S.abrupt("return",(l==null?void 0:l.result.count)||0);case 6:case"end":return S.stop()}},r)})),[G]),U=(0,v.useCallback)(function(r){return D()(C()().mark(function a(){var n,t;return C()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return n="\u786E\u5B9A\u5220\u9664\u9009\u4E2D\u7684, \u5171 ".concat(r.length," \u4E2A\u4E8C\u7EF4\u7801\u5417\uFF1F"),l.next=3,u.Modal.confirm({title:"\u786E\u5B9A\u5220\u9664",content:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("p",{className:"tip-confirm",children:n}),(0,e.jsx)("p",{children:"\u5220\u9664\u7684\u64CD\u4F5C\u4E0D\u53EF\u9006,\u8BF7\u8C28\u614E\u64CD\u4F5C"})]}),okClassName:"btn-danger",okText:"\u5220\u9664"});case 3:if(t=l.sent,t.isConfirmed){l.next=6;break}return l.abrupt("return");case 6:return l.next=8,H.apply(void 0,X()(r));case 8:u.Toast.success("\u4E8C\u7EF4\u7801\u6279\u91CF\u5220\u9664\u6210\u529F",2e3,{placement:"bottom-left",progressBar:!0});case 9:case"end":return l.stop()}},a)}))},[H]),je=(0,v.useCallback)(function(r,a){return D()(C()().mark(function n(){return C()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:V(a.map(function(l){return w()(w()({},l),{},{qrcode:"https://s.asany.cn/s/"+l.code})}));case 1:case"end":return m.stop()}},n)}))},[]),Be=(0,v.useMemo)(function(){return function(r,a){return(0,e.jsxs)("div",{children:[(0,e.jsx)(u.Button,{color:"success",onClick:U(r),variant:!1,children:"\u6279\u91CF\u5220\u9664"}),(0,e.jsx)(u.Button,{color:"success",onClick:je(r,a),variant:!1,children:"\u6253\u5370\u4E8C\u7EF4\u7801"})]})}},[U]),Se=(0,v.useState)(),z=Q()(Se,2),Y=z[0],J=z[1],De=(0,v.useCallback)(function(r){J(r)},[]),Qe=(0,v.useCallback)(function(){J(void 0)},[]);return(0,e.jsxs)(te.vs,{header:{title:"\u8BBE\u5907\u4E8C\u7EF4\u7801"},children:[(0,e.jsxs)(u.Modal,{width:640,centered:!0,onOk:ge,confirmLoading:pe,okText:"\u4FDD\u5B58",visible:F,onCancel:function(){return j(!1)},children:[(0,e.jsx)(u.Modal.Header,{closable:!0,className:"ms-5 border-0",children:(0,e.jsx)("h1",{className:"modal-title pt-6 pb-4",children:"\u751F\u6210\u8BBE\u5907\u4E8C\u7EF4\u7801"})}),(0,e.jsx)(u.Modal.Body,{children:(0,e.jsxs)(u.Form,{form:p,initialValues:{numberRule:"NV-{YYYY}{MM}{DD}-{SEQ:3}",count:1},children:[(0,e.jsx)(u.Form.Item,{className:"d-flex flex-column mb-7",name:"numberRule",label:"\u8BBE\u5907\u7F16\u53F7\u89C4\u5219",help:"\u7F16\u53F7\u89C4\u5219\u652F\u6301\u53D8\u91CF\uFF1A{YYYY} {MM} {DD} {SEQ:3}",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u7F16\u53F7\u89C4\u5219"}],children:(0,e.jsx)(u.Input,{solid:!0,placeholder:"INV-{YYYY}{MM}{DD}-{SEQ:3}"})}),(0,e.jsx)(u.Form.Item,{className:"d-flex flex-column mb-7",name:"count",label:"\u751F\u6210\u6570\u91CF",children:(0,e.jsx)(u.Input,{solid:!0})})]})})]}),(0,e.jsxs)(u.Modal,{title:"\u9884\u89C8\u4E8C\u7EF4\u7801",dialogClassName:"w-250px",onCancel:Qe,visible:!!Y,centered:!0,okButtonProps:{style:{display:"none"}},children:[(0,e.jsx)("div",{className:"d-inline-block",children:!!Y&&(0,e.jsx)(P.Qd,{size:200,value:Y})}),(0,e.jsx)("span",{children:"\u4F7F\u7528\u624B\u673A\u626B\u7801\u4E8C\u7EF4\u7801\u9884\u89C8"})]}),(0,e.jsxs)("div",{className:"d-flex flex-wrap flex-stack pb-7",children:[(0,e.jsxs)("div",{className:"d-flex flex-wrap align-items-center",children:[(0,e.jsx)("h3",{className:"fw-bolder me-5",children:"\u8BBE\u5907\u4E8C\u7EF4\u7801"}),(0,e.jsx)(u.Input.Search,{onSearch:Ee,defaultValue:(y=b.filter)===null||y===void 0?void 0:y.name_contains,placeholder:"\u641C\u7D22",className:"border-body bg-body w-250px"})]}),(0,e.jsx)(ee.ZX,{children:(0,e.jsx)("div",{className:"d-flex my-0",children:(0,e.jsx)(u.Button,{onClick:Ce,children:"\u751F\u6210\u4E8C\u7EF4\u7801"})})})]}),!ye&&!B?(0,e.jsx)(u.Card,{className:"mb-5 mb-xl-10",children:(0,e.jsx)(u.Empty,{title:"\u8FD8\u6CA1\u6709\u8BBE\u5907\u4E8C\u7EF4\u7801",description:"\u9A6C\u4E0A\u6DFB\u52A0\u8BBE\u5907\u4E8C\u7EF4\u7801",image:"/assets/media/illustrations/sigma-1/4.png",children:(0,e.jsx)(u.Button,{variant:"primary",children:"\u751F\u6210\u4E8C\u7EF4\u7801"})})}):(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(u.Card,{className:"mb-5 mb-xl-10",children:(0,e.jsx)(u.Card.Body,{children:(0,e.jsx)(u.BlockUI,{overlayClassName:"bg-white bg-opacity-25",loading:B,children:(0,e.jsx)(u.Table,{hover:!0,rowKey:"id",rowSelection:{type:"checkbox",renderTitle:function(a){return(0,e.jsxs)(e.Fragment,{children:["\u5DF2\u9009\u4E2D",(0,e.jsx)("span",{className:"mx-2",children:a}),"\u4E2A\u4E8C\u7EF4\u7801"]})},toolbar:Be},noRowsRenderer:function(){return(0,e.jsx)(u.Empty,{description:"\u5217\u8868\u6570\u636E\u4E3A\u7A7A",image:"/assets/media/illustrations/sigma-1/5.png"})},columns:[{key:"code",title:"\u7F16\u53F7",sorter:!0,sortOrder:A.field==="code"?A.order:void 0,width:80},{key:"url",title:"\u4E8C\u7EF4\u7801\u94FE\u63A5",sorter:!0,sortOrder:A.field==="url"?A.order:void 0,render:function(a,n){var t;return a?(0,e.jsx)("a",{className:"text-gray-700",href:a,target:"_",children:(t=n.metadata)===null||t===void 0?void 0:t.no}):(0,e.jsx)("span",{className:"text-gray-700",children:"\u672A\u7ED1\u5B9A\u8BBE\u5907"})}},{key:"createdAt",title:"\u521B\u5EFA\u65F6\u95F4",width:200},{key:"accessCount",title:"\u8BBF\u95EE\u6B21\u6570",width:120},{key:"qrCode",title:"\u4E8C\u7EF4\u7801",width:180,render:function(a,n){var t="https://s.asany.cn/s/"+n.code;return(0,e.jsx)(P.Qd,{onClick:function(l){l.preventDefault(),l.stopPropagation(),De("https://s.asany.cn/s/"+n.code)},size:30,value:t})}}],pagination:Fe,onChange:xe,dataSource:be})})})})})]})}var ce=de}}]);

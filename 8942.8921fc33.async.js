(self.webpackChunkasany_admin=self.webpackChunkasany_admin||[]).push([[8942],{88447:function(Me,ee,g){"use strict";g.d(ee,{f1:function(){return t},Nk:function(){return re},sW:function(){return ne},SP:function(){return de}});var c=g(11849),h=g(20310),b=g(49704),y=g(64718),C=g(21919),te,U,D,f,$,L={},A=(0,b.Ps)(te||(te=(0,h.Z)([`
    fragment ProcessModelPart on ProcessModel {
  id
  key
  name
  description
  version
  createdBy
  created
  lastUpdated
  lastUpdatedBy
}
    `]))),t=(0,b.Ps)(U||(U=(0,h.Z)([`
    query processModels($filter: ProcessModelFilter, $page: Int, $pageSize: Int, $orderBy: OrderBy) {
  total: processModels(pageSize: 1, filter: {user: "self"}) {
    totalCount
  }
  processModels(
    filter: $filter
    page: $page
    pageSize: $pageSize
    orderBy: $orderBy
  ) {
    totalPage
    pageSize
    current: currentPage
    total: totalCount
    edges {
      node {
        ...ProcessModelPart
      }
    }
  }
}
    `,""])),A);function de(B){var I=(0,c.Z)((0,c.Z)({},L),B);return y.a(t,I)}function ue(B){var I=_objectSpread(_objectSpread({},L),B);return Apollo.useLazyQuery(t,I)}var W=(0,b.Ps)(D||(D=(0,h.Z)([`
    query processModel($id: ID!) {
  processModel(id: $id) {
    ...ProcessModelPart
    editorJson
  }
}
    `,""])),A);function ne(B){var I=(0,c.Z)((0,c.Z)({},L),B);return y.a(W,I)}function oe(B){var I=_objectSpread(_objectSpread({},L),B);return Apollo.useLazyQuery(W,I)}var ve=(0,b.Ps)(f||(f=(0,h.Z)([`
    mutation importProcessModel($file: Upload!) {
  importProcessModel(file: $file) {
    ...ProcessModelPart
  }
}
    `,""])),A);function fe(B){var I=_objectSpread(_objectSpread({},L),B);return Apollo.useMutation(ve,I)}var K=(0,b.Ps)($||($=(0,h.Z)([`
    mutation deleteProcessModel($id: ID!) {
  deleteProcessModel(id: $id)
}
    `])));function re(B){var I=(0,c.Z)((0,c.Z)({},L),B);return C.D(K,I)}},71621:function(Me,ee,g){"use strict";g.r(ee),g.d(ee,{default:function(){return Gt}});var c=g(67294),h=g(34707),b=g(54406),y=g(11849),C=g(2824),te=g(52963),U=g(93224),D=g(28865),f=g(83639),$=g(92775);function L(){var e=(0,$.u)(),n=e.getNodes,o=e.setNodes,s=(0,c.useCallback)(function(a){var r=n();o(r.filter(function(i){return i.id!=a}))},[n,o]);return{removeNode:s}}var A=L,t=g(85893),de=["data"];function ue(e){var n=e.data,o=(0,U.Z)(e,de),s=A(),a=s.removeNode,r=(0,c.useCallback)(function(i){i.stopPropagation(),i.preventDefault(),a(o.id)},[o.id,a]);return(0,t.jsxs)("div",{className:"text-updater-node selectable",children:[(0,t.jsxs)("div",{className:"react-flow__node-header",children:[(0,t.jsx)("div",{className:"react-flow__node-icon",children:(0,t.jsx)(D.JO,{name:"Bootstrap/stop-circle"})}),(0,t.jsx)("div",{className:"react-flow__node-title",children:"\u7ED3\u675F"}),(0,t.jsx)("div",{onClick:r,className:"react-flow__node-header__delete",children:(0,t.jsx)(D.JO,{name:"Bootstrap/x"})})]}),(0,t.jsx)("div",{children:n.label}),(0,t.jsx)(h.HH,{type:"target",position:f.P.Top,id:"top"}),(0,t.jsx)(h.HH,{type:"source",position:f.P.Bottom,id:"bottom"}),(0,t.jsx)(h.HH,{type:"target",position:f.P.Left,id:"left"}),(0,t.jsx)(h.HH,{type:"target",position:f.P.Right,id:"right"})]})}ue.info={icon:"Bootstrap/stop-circle",type:"EndNoneEvent",name:"\u7ED3\u675F"};var W=ue;function ne(e){var n=e.data;return console.log("data",n),(0,t.jsxs)("div",{className:"inner-container",children:[(0,t.jsx)("div",{className:"shape-diamond react-flow__node-header",children:(0,t.jsx)("div",{children:(0,t.jsx)(D.JO,{name:"Bootstrap/plus"})})}),(0,t.jsx)(h.HH,{type:"target",position:f.P.Top,id:"top"}),(0,t.jsx)(h.HH,{type:"source",position:f.P.Bottom,id:"bottom"}),(0,t.jsx)(h.HH,{type:"source",position:f.P.Left,id:"left"}),(0,t.jsx)(h.HH,{type:"source",position:f.P.Right,id:"right"})]})}ne.info={icon:"Bootstrap/diamond",type:"ExclusiveGateway",name:"\u6392\u5B83\u7F51\u5173"};var oe=ne,ve=["data"];function fe(e){var n=e.data,o=(0,U.Z)(e,ve),s=A(),a=s.removeNode,r=(0,c.useCallback)(function(i){i.stopPropagation(),i.preventDefault(),a(o.id)},[o.id,a]);return(0,t.jsxs)("div",{className:"text-updater-node selectable",children:[(0,t.jsxs)("div",{className:"react-flow__node-header",children:[(0,t.jsx)("div",{className:"react-flow__node-icon",children:(0,t.jsx)(D.JO,{name:"Bootstrap/filetype-java"})}),(0,t.jsx)("div",{className:"react-flow__node-title",children:"\u670D\u52A1\u4EFB\u52A1"}),(0,t.jsx)("div",{onClick:r,className:"react-flow__node-header__delete",children:(0,t.jsx)(D.JO,{name:"Bootstrap/x"})})]}),(0,t.jsx)("div",{children:n.label}),(0,t.jsx)(h.HH,{type:"target",position:f.P.Top,id:"top"}),(0,t.jsx)(h.HH,{type:"source",position:f.P.Bottom,id:"bottom"}),(0,t.jsx)(h.HH,{type:"source",position:f.P.Left,id:"left"}),(0,t.jsx)(h.HH,{type:"source",position:f.P.Right,id:"right"}),(0,t.jsx)("div",{className:"xxx",children:"123123"})]})}fe.info={icon:"Bootstrap/filetype-java",type:"ServiceTask",name:"\u670D\u52A1\u4EFB\u52A1"};var K=fe;function re(e){var n,o=A(),s=o.removeNode,a=(0,c.useCallback)(function(r){r.stopPropagation(),r.preventDefault(),s(e.id)},[e.id,s]);return(0,t.jsxs)("div",{className:"text-updater-node selectable",children:[(0,t.jsxs)("div",{className:"react-flow__node-header",children:[(0,t.jsx)("div",{className:"react-flow__node-icon",children:(0,t.jsx)(D.JO,{name:"Bootstrap/play-fill"})}),(0,t.jsx)("div",{className:"react-flow__node-title",children:"\u5F00\u59CB"}),(0,t.jsx)("div",{onClick:a,className:"react-flow__node-header__delete",children:(0,t.jsx)(D.JO,{name:"Bootstrap/x"})})]}),(0,t.jsx)("div",{children:(n=e.data)===null||n===void 0?void 0:n.label}),(0,t.jsx)(h.HH,{type:"target",position:f.P.Top,id:"top"}),(0,t.jsx)(h.HH,{type:"source",position:f.P.Bottom,id:"bottom"}),(0,t.jsx)(h.HH,{type:"source",position:f.P.Left,id:"left"}),(0,t.jsx)(h.HH,{type:"source",position:f.P.Right,id:"right"})]})}re.info={type:"StartNoneEvent",icon:"Bootstrap/play-fill",name:"\u5F00\u59CB"};var B=re,I=["data"];function xe(e){var n=e.data,o=(0,U.Z)(e,I),s=A(),a=s.removeNode,r=(0,c.useCallback)(function(i){i.stopPropagation(),i.preventDefault(),a(o.id)},[o.id,a]);return(0,t.jsxs)("div",{className:"text-updater-node selectable",children:[(0,t.jsx)(h.HH,{type:"target",position:f.P.Top}),(0,t.jsxs)("div",{className:"react-flow__node-header",children:[(0,t.jsx)("div",{className:"react-flow__node-icon",children:(0,t.jsx)(D.JO,{name:"Bootstrap/person-workspace"})}),(0,t.jsx)("div",{className:"react-flow__node-title",children:"\u5BA1\u6279"}),(0,t.jsx)("div",{onClick:r,className:"react-flow__node-header__delete",children:(0,t.jsx)(D.JO,{name:"Bootstrap/x"})})]}),(0,t.jsx)("div",{children:n.label}),(0,t.jsx)(h.HH,{type:"target",position:f.P.Top,id:"top"}),(0,t.jsx)(h.HH,{type:"source",position:f.P.Bottom,id:"bottom"}),(0,t.jsx)(h.HH,{type:"source",position:f.P.Left,id:"left"}),(0,t.jsx)(h.HH,{type:"source",position:f.P.Right,id:"right"})]})}xe.info={icon:"Bootstrap/person-workspace",type:"UserTask",name:"\u7528\u6237\u4EFB\u52A1"};var ge=xe,ye={StartNoneEvent:B,UserTask:ge,ServiceTask:K,EndNoneEvent:W,ExclusiveGateway:oe},je={simple:[B.info,W.info],classics:[B.info,W.info,ge.info,K.info,oe.info],quick:[ge.info,K.info,oe.info]},Re=function(n){return c.createElement(ye[n],{data:{label:"\u62D6\u62FD\u9884\u89C8"}})},Pe=ye;function Le(e,n){var o=Math.round(e/32)*32,s=Math.round(n/32)*32;return[o,s]}var Ae={position:"fixed",pointerEvents:"none",zIndex:100,left:0,top:0,width:"100%",height:"100%"};function Xe(e,n,o){if(!e||!n)return{display:"none"};var s=n.x,a=n.y;if(o){s-=e.x,a-=e.y;var r=Le(s,a),i=(0,C.Z)(r,2);s=i[0],a=i[1],s+=e.x,a+=e.y}var l="translate(".concat(s,"px, ").concat(a,"px)");return{transform:l,WebkitTransform:l}}function ze(){var e=(0,te.f)(function(r){return{item:r.getItem(),itemType:r.getItemType(),initialOffset:r.getInitialSourceClientOffset(),currentOffset:r.getSourceClientOffset(),isDragging:r.isDragging()}}),n=e.isDragging,o=e.itemType,s=e.initialOffset,a=e.currentOffset;return n?(0,t.jsx)("div",{style:Ae,children:(0,t.jsx)("div",{className:"react-flow__node-".concat(o),style:(0,y.Z)({},Xe(s,a)),children:Re(o)})}):null}var Ye=ze,Qe=g(5856),J=(0,c.createContext)({tools:{canUndo:!1,canRedo:!1,undo:function(){},redo:function(){},reset:function(){},resetInitialState:function(){},showQuickControls:function(){},hideQuickControls:function(){}},quickControls:{visible:!1},setState:function(){},state:{nodes:[],edges:[]}}),Ce=function(){var n=(0,c.useContext)(J);return[n.quickControls,{show:n.tools.showQuickControls,hide:n.tools.hideQuickControls}]},Ne=function(){var n=(0,c.useContext)(J);return[n.state,n.setState]},Ue=function(){var n=(0,c.useContext)(J),o=n.state,s=n.setState,a=(0,h.Rr)(o.nodes),r=(0,C.Z)(a,3),i=r[0],l=r[1],d=r[2],v=(0,c.useRef)(o);v.current=o;var m=(0,c.useCallback)(function(p){if(typeof p=="function"){var N=p(v.current.nodes);s((0,y.Z)((0,y.Z)({},v.current),{},{nodes:N}))}else s((0,y.Z)((0,y.Z)({},v.current),{},{nodes:p}))},[s]);return(0,c.useLayoutEffect)(function(){l(o.nodes)},[o.nodes,l]),[i,m,d]},$e=function(){var n=(0,c.useContext)(J),o=n.state,s=n.setState,a=(0,h.ll)(o.edges),r=(0,C.Z)(a,3),i=r[0],l=r[1],d=r[2],v=(0,c.useRef)(o);v.current=o;var m=(0,c.useCallback)(function(p){if(typeof p=="function"){var N=p(v.current.edges);s((0,y.Z)((0,y.Z)({},v.current),{},{edges:N}))}else s((0,y.Z)((0,y.Z)({},v.current),{},{edges:p}))},[s]);return(0,c.useLayoutEffect)(function(){l(o.edges)},[o.edges,l]),[i,m,d]},ae=function(){var n=(0,c.useContext)(J);return n.tools},We=function(n){var o=n.children,s=(0,Qe.Z)({nodes:[],edges:[]},{behavior:"keepFuture"}),a=(0,C.Z)(s,3),r=a[0],i=a[1],l=a[2],d=l.undo,v=l.canUndo,m=l.redo,p=l.canRedo,N=l.reset,E=l.resetInitialState,S=(0,c.useState)({visible:!1,rect:void 0}),x=(0,C.Z)(S,2),k=x[0],H=x[1],u=(0,c.useCallback)(function(M,T){H({visible:!0,edgeId:M,rect:T})},[]),Z=(0,c.useCallback)(function(){H({visible:!1})},[]);return(0,t.jsx)(J.Provider,{value:{state:r,setState:i,quickControls:k,tools:{undo:d,canRedo:p,redo:m,canUndo:v,reset:N,resetInitialState:E,showQuickControls:u,hideQuickControls:Z}},children:o})},Je=g(18446),Ge=g.n(Je);function Ve(e){var n=e.onBack,o=(0,b.fQ)(function(r){return r.ui.toolbar.tools}),s=(0,b.NX)(function(r){return r.ui.toolbar.tools.reduce(function(i,l){return i[l.id]=l.useSelector&&l.useSelector(r),i},{})},Ge()),a=(0,c.useCallback)(function(){return n&&n()},[n]);return(0,t.jsxs)("div",{className:"sunmao-navigation",children:[(0,t.jsxs)("div",{className:"navigation-left",children:[(0,t.jsx)(D.ZP,{name:"AsanyEditor/ToolbarBack",onClick:a,className:"back-icon toolbar-icon"}),(0,t.jsx)("span",{className:"title",children:"SUNMAO "})]}),(0,t.jsxs)("div",{className:"sunmao-navigation-container",children:[(0,t.jsx)("div",{className:"toolbar-center",children:o.filter(function(r){return r.position==="left"&&r.isVisibled(s[r.id])}).map(b.ei,s)}),(0,t.jsx)("div",{className:"toolbar-right",children:o.filter(function(r){return r.position==="right"&&r.isVisibled(s[r.id])}).map(b.ei,s)})]})]})}var Ke=Ve,_e=g(91220);function be(e,n){var o;return(o=n.find(function(s){return s.outgoing.some(function(a){return a.resourceId==e})}))===null||o===void 0?void 0:o.resourceId}function Ee(e){return e.target.resourceId}function qe(e){var n={nodes:[],edges:[]},o=e.childShapes,s=o.filter(function(l){return l.stencil.id!="SequenceFlow"}),a=(0,_e.Z)(o),r;try{for(a.s();!(r=a.n()).done;){var i=r.value;i.stencil.id=="SequenceFlow"?(n.edges.push({id:i.resourceId,type:"simple_floating",source:be(i.resourceId,s),target:Ee(i),label:i.properties.name||"\u7EBF",markerEnd:{type:f.M.ArrowClosed}}),console.log(be(i.resourceId,s),Ee(i))):(n.nodes.push({id:i.resourceId,type:i.stencil.id,dragHandle:".react-flow__node-header",data:{label:i.properties.name},position:{x:i.bounds.upperLeft.x,y:i.bounds.upperLeft.y}}),console.log("shape",i.stencil.id,i.resourceId,i.properties.name))}}catch(l){a.e(l)}finally{a.f()}return n}var Se=g(19273),et=g(89628),tt=g(56022),nt=g(65362),ot=g(24622);function we(e,n){var o=e.width,s=e.height,a=e.positionAbsolute,r=n.positionAbsolute,i=o/2,l=s/2,d=a.x+i,v=a.y+l,m=r.x+i,p=r.y+l,N=(m-d)/(2*i)-(p-v)/(2*l),E=(m-d)/(2*i)+(p-v)/(2*l),S=1/(Math.abs(N)+Math.abs(E)),x=S*N,k=S*E,H=i*(x+k)+d,u=l*(-x+k)+v;return{x:H,y:u}}function ke(e,n){var o=(0,y.Z)((0,y.Z)({},e.positionAbsolute),e),s=Math.round(o.x),a=Math.round(o.y),r=Math.round(n.x),i=Math.round(n.y);return r<=s+1?f.P.Left:r>=s+o.width-1?f.P.Right:i<=a+1?f.P.Top:i>=o.y+o.height-1?f.P.Bottom:f.P.Top}function rt(e,n){var o=we(e,n),s=we(n,e),a=ke(e,o),r=ke(n,s);return{sx:o.x,sy:o.y,tx:s.x,ty:s.y,sourcePos:a,targetPos:r}}function at(e){var n=e.id,o=e.source,s=e.target,a=e.markerEnd,r=e.style,i=(0,f.b)((0,c.useCallback)(function(k){return k.nodeInternals.get(o)},[o])),l=(0,f.b)((0,c.useCallback)(function(k){return k.nodeInternals.get(s)},[s]));if(!i||!l)return null;var d=rt(i,l),v=d.sx,m=d.sy,p=d.tx,N=d.ty,E=d.sourcePos,S=d.targetPos,x=(0,h.OW)({sourceX:v,sourceY:m,sourcePosition:E,targetPosition:S,targetX:p,targetY:N});return(0,t.jsx)("g",{className:"react-flow__connection",children:(0,t.jsx)("path",{id:n,className:"react-flow__edge-path",d:x,markerEnd:a,style:r})})}var st=at;function De(e,n){var o=Ze(e),s=Ze(n),a=Math.abs(o.x-s.x),r=Math.abs(o.y-s.y),i;a>r?i=o.x>s.x?f.P.Left:f.P.Right:i=o.y>s.y?f.P.Top:f.P.Bottom;var l=it(e,i),d=(0,C.Z)(l,2),v=d[0],m=d[1];return[v,m,i]}function it(e,n){var o,s,a=(o=e[f.i])===null||o===void 0?void 0:o.handleBounds;if(!a)return[0,0];var r=a==null||(s=a.source)===null||s===void 0?void 0:s.find(function(p){return p.position===n});if(!r){var i;r=a==null||(i=a.target)===null||i===void 0?void 0:i.find(function(p){return p.position===n})}if(!r)return[0,0];var l=r.width/2,d=r.height/2,v=e.positionAbsolute.x+r.x+l,m=e.positionAbsolute.y+r.y+d;return[v,m]}function Ze(e){return{x:e.positionAbsolute.x+e.width/2,y:e.positionAbsolute.y+e.height/2}}function He(e,n){var o=De(e,n),s=(0,C.Z)(o,3),a=s[0],r=s[1],i=s[2],l=De(n,e),d=(0,C.Z)(l,3),v=d[0],m=d[1],p=d[2];return{sourceX:a,sourceY:r,targetX:v,targetY:m,sourcePosition:i,targetPosition:p}}function lt(e){var n=e.targetX,o=e.targetY,s=e.sourcePosition,a=e.targetPosition,r=e.sourceNode;if(!r)return null;var i={id:"connection-target",width:1,height:1,positionAbsolute:{x:n,y:o}},l=He(r,i),d=l.sourceX,v=l.sourceY,m=(0,h.OW)({sourceX:d,sourceY:v,sourcePosition:s,targetPosition:a,targetX:n,targetY:o});return(0,t.jsxs)("g",{children:[(0,t.jsx)("path",{fill:"none",stroke:"#222",strokeWidth:1.5,className:"animated",d:m}),(0,t.jsx)("circle",{cx:n,cy:o,fill:"#fff",r:3,stroke:"#222",strokeWidth:1.5})]})}var ct=lt,se=40;function dt(e){var n=e.id,o=e.sourceX,s=e.sourceY,a=e.targetX,r=e.targetY,i=e.sourcePosition,l=e.targetPosition,d=e.style,v=d===void 0?{}:d,m=e.markerEnd,p=(0,h.OW)({sourceX:o,sourceY:s,sourcePosition:i,targetX:a,targetY:r,targetPosition:l}),N=(0,h.Pp)({sourceX:o,sourceY:s,targetX:a,targetY:r}),E=(0,C.Z)(N,2),S=E[0],x=E[1];return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("path",{id:n,style:v,className:"react-flow__edge-path",d:p,markerEnd:m}),(0,t.jsx)("foreignObject",{width:se,height:se,x:S-se/2,y:x-se/2,className:"edgebutton-foreignobject",requiredExtensions:"http://www.w3.org/1999/xhtml",children:(0,t.jsx)("div",{className:"edge-container",children:(0,t.jsx)("button",{className:"edgebutton",children:(0,t.jsx)(D.JO,{name:"Bootstrap/plus"})})})})]})}var ie=40;function ut(e){var n=e.id,o=e.source,s=e.target,a=e.markerEnd,r=e.style,i=(0,f.b)((0,c.useCallback)(function(F){return F.nodeInternals.get(o)},[o])),l=(0,f.b)((0,c.useCallback)(function(F){return F.nodeInternals.get(s)},[s])),d=(0,c.useRef)(null),v=(0,f.b)(function(F){return F.transform[2]}),m=Ce(),p=(0,C.Z)(m,2),N=p[0].edgeId,E=p[1].show,S=(0,c.useCallback)(function(F){F.preventDefault(),F.stopPropagation();var X=d.current.getBoundingClientRect(),P=X.x,j=X.y,w=X.width,z=X.height;E(n,{x:P,y:j,width:w,height:z})},[n,E]);if((0,c.useEffect)(function(){if(N==n){var F=d.current.getBoundingClientRect(),X=F.x,P=F.y,j=F.width,w=F.height;E(n,{x:X,y:P,width:j,height:w})}},[N,n,E,v]),!i||!l)return null;var x=He(i,l),k=x.sourceX,H=x.sourceY,u=x.targetX,Z=x.targetY,M=x.sourcePosition,T=x.targetPosition,R=(0,h.OW)({sourceX:k,sourceY:H,sourcePosition:M,targetPosition:T,targetX:u,targetY:Z}),O=(0,h.Pp)({sourceX:k,sourceY:H,sourcePosition:M,targetPosition:T,targetX:u,targetY:Z}),Q=(0,C.Z)(O,2),V=Q[0],he=Q[1];return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("path",{id:n,className:"react-flow__edge-path",d:R,markerEnd:a,style:r}),(0,t.jsx)("foreignObject",{width:ie,height:ie,x:V-ie/2,y:he-ie/2,className:"edgebutton-foreignobject",requiredExtensions:"http://www.w3.org/1999/xhtml",children:(0,t.jsx)("div",{className:"edge-container",onClick:S,children:(0,t.jsx)("button",{ref:d,className:"edgebutton",children:(0,t.jsx)(D.JO,{name:"Bootstrap/plus"})})})})]})}var vt=ut,ft={buttonedge:dt,floating:st,simple_floating:vt},gt=g(73935),pt=g(69293),ht=g(94184),Y=g.n(ht);function mt(e){var n=(0,c.useRef)(null),o=(0,f.b)(function(x){return x.transform[2]}),s=Ce(),a=(0,C.Z)(s,2),r=a[0],i=r.visible,l=r.rect,d=a[1].hide,v=(0,$.u)(),m=v.project,p=e.flowContainer;(0,pt.Z)(n,function(){d()});var N=(0,c.useMemo)(function(){if(!i||!p.current||!n.current||!l)return{transform:"translate(0px, 0px)",opacity:0,pointerEvents:"unset"};var x=p.current.getBoundingClientRect(),k=x.top,H=x.left,u=n.current.getBoundingClientRect().height,Z=l.x,M=l.y,T=l.width,R=l.height;if(o!=1){var O=o<1?100/o*(1-o)/100+1:100/o/100,Q=m({x:Z+T-H+10,y:M-k+R/2-u/2});return console.log("scale",o,O),{transform:"translate(".concat(Q.x,"px, ").concat(Q.y,"px) scale(").concat(O,")"),transformOrigin:"0 0"}}var V=m({x:Z+T-H,y:M-k+R/2-u/2});return{transform:"translate(".concat(V.x,"px, ").concat(V.y,"px)")}},[p,m,l,i,o]),E=(0,t.jsxs)("div",{ref:n,className:"quick-controls",style:N,children:[(0,t.jsx)("div",{className:"quick-controls-arrow",children:(0,t.jsx)("span",{className:"quick-controls-arrow-content"})}),je.quick.map(function(x){return(0,t.jsxs)("div",{className:Y()("flow-node-type","quick-controls__node-".concat(x.type)),children:[(0,t.jsx)("div",{className:"flow-node-type-icon",children:(0,t.jsx)(D.JO,{name:x.icon})}),(0,t.jsx)("div",{className:"flow-node-type-label",children:x.name})]},x.type)}),(0,t.jsx)("div",{className:"flow-node-type-separator"}),(0,t.jsxs)("div",{className:"flow-node-type",children:[(0,t.jsx)("div",{className:"flow-node-type-icon",children:(0,t.jsx)(D.JO,{name:"Bootstrap/gear"})}),(0,t.jsx)("div",{className:"flow-node-type-label",children:"\u8BBE\u7F6E"})]})]}),S=document.querySelector(".react-flow__viewport");return S?gt.createPortal(E,S):(0,t.jsx)(c.Fragment,{})}var xt=mt,yt=0,jt=function(){return"dndnode_".concat(yt++)},Pt=function(n){var o=(0,c.useRef)(null),s=Ue(),a=(0,C.Z)(s,3),r=a[0],i=a[1],l=a[2],d=$e(),v=(0,C.Z)(d,3),m=v[0],p=v[1],N=v[2],E=(0,c.useState)(null),S=(0,C.Z)(E,2),x=S[0],k=S[1],H=ae(),u=H.hideQuickControls,Z=(0,c.useCallback)(function(P){P.source!=P.target&&p(function(j){return(0,f.c)((0,y.Z)((0,y.Z)({},P),{},{type:"simple_floating"}),j)})},[p]),M=(0,c.useCallback)(function(P){P.preventDefault(),P.dataTransfer.dropEffect="move"},[]),T=(0,et.L)({accept:Object.keys(Pe),drop:function(j){return j},canDrop:function(j,w){return w.isOver({shallow:!0})},collect:function(j){return{isOver:j.isOver(),isOverCurrent:j.isOver({shallow:!0}),handlerId:j.getHandlerId()}}}),R=(0,C.Z)(T,2);(0,Se.Z)(R[0]);var O=R[1];O(o);var Q=(0,c.useCallback)(function(P){var j;P.preventDefault();var w=(j=o.current)===null||j===void 0?void 0:j.getBoundingClientRect(),z=P.dataTransfer.getData("application/reactflow");if(!(typeof z=="undefined"||!z||!w)){var q=x.project({x:P.clientX-w.left,y:P.clientY-w.top}),ce={id:jt(),type:z,position:q,data:{label:"".concat(z," node")}};i(function(me){return me.concat(ce)})}},[x,i]),V=(0,c.useCallback)(function(P,j,w){console.log(j,w),i(function(z){return z.map(function(q){var ce=w.findIndex(function(me){return me.id==q.id});return ce>-1?(0,y.Z)((0,y.Z)({},q),{},{position:w[ce].position}):q})})},[i]),he=(0,c.useCallback)(function(P){var j=P.target.classList.contains("react-flow__pane");console.log("targetIsPane",j)},[]),F=n.onClick,X=(0,c.useCallback)(function(P){var j=P.target.classList.contains("react-flow__pane");!j||(F(P),u())},[u,F]);return(0,t.jsx)("div",{className:"reactflow-wrapper",style:{height:"100%"},ref:o,children:(0,t.jsxs)(h.ZP,{nodes:r,edges:m,onClick:X,onNodesChange:l,onEdgesChange:N,onEdgeClick:n.onEdgeClick,onNodesDelete:n.onNodesDelete,onEdgesDelete:n.onEdgesDelete,onNodeDragStop:V,onConnect:Z,onConnectStop:he,onInit:k,onDrop:Q,onDragOver:M,fitView:!0,attributionPosition:"top-right",proOptions:{account:"paid-pro",hideAttribution:!0},edgeTypes:ft,nodeTypes:Pe,connectionLineComponent:ct,children:[(0,t.jsx)(tt.Z,{nodeStrokeColor:function(j){var w;return(w=j.style)!==null&&w!==void 0&&w.background?j.style.background:j.type==="StartNoneEvent"?"#0041d0":j.type==="EndNoneEvent"?"#ff0072":["UserTask","ExclusiveGateway"].includes(j.type)?"#1a192b":"#eee"},nodeColor:function(j){var w;return(w=j.style)!==null&&w!==void 0&&w.background?j.style.background:"#fff"},nodeBorderRadius:2}),(0,t.jsx)(nt.Z,{}),(0,t.jsx)(ot.Z,{color:"#aaa",gap:16}),(0,t.jsx)(xt,{flowContainer:o})]})})},Ct=Pt,Nt={title:"\u8282\u70B9\u8BBE\u7F6E",fields:[{label:" \u7F16\u7801",name:"id",type:"String"},{label:"\u540D\u79F0",name:"label",type:"String"},{label:"\u63CF\u8FF0",name:"documentation",type:"String",renderer:{component:"MultiLineText",props:{autoSize:{minRows:2,maxRows:4}}}}]},bt={title:"\u6761\u4EF6\u8BBE\u7F6E",fields:[{label:" \u7F16\u7801",name:"id",type:"String"},{label:"\u540D\u79F0",name:"label",type:"String"},{label:"\u63CF\u8FF0",name:"documentation",type:"String",renderer:{component:"MultiLineText",props:{autoSize:{minRows:2,maxRows:4}}}}]};function Et(){var e=(0,b.pn)(),n=(0,b.NX)(function(u){return u.ui.sidebar.width}),o=(0,b.NX)(function(u){return u.ui.sidebar.minWidth}),s=(0,b.NX)(function(u){return u.ui.sidebar.minimizable}),a=(0,c.useMemo)(function(){var u=n;return s?u=0:u=Math.max(o,u),u},[n,s,o]),r=Ne(),i=(0,C.Z)(r,2),l=i[1],d=ae(),v=d.reset,m=d.resetInitialState,p=(0,b.NX)(function(u){var Z;return(Z=u.project.data)===null||Z===void 0?void 0:Z.editorJson});(0,c.useEffect)(function(){if(p){var u=qe(JSON.parse(p));l(u),m(u),v(u)}},[p]);var N=(0,c.useCallback)(function(){e.aside.close()},[e.aside]),E=(0,c.useCallback)(function(u,Z){u.preventDefault(),u.stopPropagation();var M=function(O){console.log("handleUpdate",O)};console.log("handleNodeClick",u,Z);var T={label:Z.data.label,id:Z.id};e.aside.open({customizer:Nt,value:T,update:M,watchValue:function(O){O(T)}},{width:280})},[e.aside]),S=(0,c.useCallback)(function(u,Z){u.preventDefault(),u.stopPropagation();var M=function(O){console.log("handleUpdate",O)};console.log("handleNodeClick",u,Z);var T={label:"1111"};e.aside.open({customizer:bt,value:T,update:M,watchValue:function(O){O(T)}},{width:280})},[e.aside]),x=(0,c.useCallback)(function(){e.aside.close()},[e.aside]),k=(0,c.useCallback)(function(){e.aside.close()},[e.aside]),H=(0,b.NX)(function(u){return u.ui.sidebar.minimizable});return console.log("minimizable",H),(0,t.jsx)("div",{style:{height:"100%",width:"100%",marginLeft:a},children:(0,t.jsx)(Ct,{onClick:N,onNodeClick:E,onEdgeClick:S,onNodesDelete:x,onEdgesDelete:k})})}var St=c.memo(Et),pe;(function(e){e.SET_ELEMENTS="FLOW_SET_ELEMENTS"})(pe||(pe={}));function wt(e,n){return n.type===b.hA.PluginStateInit?{}:n.type==pe.SET_ELEMENTS?(0,y.Z)((0,y.Z)({},e),n.payload):e}var kt=g(1861),Fe=g(9690),Dt=g(46408);function Zt(e){var n=e.children,o=e.type,s=(0,c.useCallback)(function(d){d.dataTransfer.setData("application/reactflow",o),d.dataTransfer.effectAllowed="move"},[o]),a=(0,Fe.c)({item:function(){return{type:o}},type:o,collect:function(v){return{opacity:v.isDragging()?.4:1}}}),r=(0,C.Z)(a,3),i=r[1],l=r[2];return l((0,Dt.r)(),{captureDraggingState:!0}),(0,t.jsx)("div",{ref:i,className:"flow-node",onDragStart:s,draggable:!0,children:n})}var le=Zt,_=36,Be=_+300;function Ht(e){(0,Se.Z)(e);var n=(0,c.useState)(!1),o=(0,C.Z)(n,2),s=o[0],a=o[1],r=(0,c.useRef)({prevOutlinePaneHeight:Be,outlinePaneHeight:Be,outlinePaneExpanded:!0}),i=(0,c.useReducer)(function(u){return u+1},0),l=(0,C.Z)(i,2),d=l[1],v=(0,c.useCallback)(function(){r.current.outlinePaneExpanded=!r.current.outlinePaneExpanded,d()},[]),m=(0,c.useCallback)(function(){r.current.outlinePaneExpanded?r.current.prevOutlinePaneHeight=r.current.outlinePaneHeight:r.current.outlinePaneHeight=_,a(!0)},[]),p=(0,c.useCallback)(function(u){r.current.outlinePaneHeight+=u,r.current.outlinePaneExpanded=r.current.outlinePaneHeight>_,d()},[]),N=(0,c.useCallback)(function(){r.current.outlinePaneExpanded||(r.current.outlinePaneHeight=r.current.prevOutlinePaneHeight),a(!1)},[]),E=r.current,S=E.outlinePaneExpanded,x=E.outlinePaneHeight,k=window.innerHeight-50-40,H=Math.min(k,Math.max(x,_));return H=S?H:_,(0,t.jsxs)("div",{className:Y()("sidebar-panel",{"resizer-y-active":s}),children:[(0,t.jsx)("div",{className:"sidebar-screen-panel",children:(0,t.jsxs)("div",{className:"sidebar-subpanel",children:[(0,t.jsxs)("div",{className:"sidebar-subpanel-header",children:[(0,t.jsx)("div",{className:"header-left",children:"\u57FA\u7840\u8282\u70B9"}),(0,t.jsx)("div",{className:"header-right"})]}),(0,t.jsx)(kt.E,{options:{scrollbars:{autoHide:"scroll"}},style:{height:"calc(100% - 38px)"},children:(0,t.jsxs)("div",{style:{padding:"8px 8px 0 8px"},children:[(0,t.jsx)(le,{type:"StartNoneEvent",children:"\u5F00\u59CB"}),(0,t.jsx)(le,{type:"EndNoneEvent",children:"\u7ED3\u675F"}),(0,t.jsx)(le,{type:"UserTask",children:"\u7528\u6237\u4EFB\u52A1"})]})})]})}),(0,t.jsxs)(b.w_,{className:"sidebar-subpanel",direction:"y",onResizeStart:m,onResize:p,onResizeEnd:N,style:{flexBasis:H},children:[(0,t.jsxs)("div",{className:"sidebar-subpanel-header",children:[(0,t.jsx)("div",{className:"header-left",children:"\u7ECF\u5178"}),(0,t.jsx)("div",{className:"header-right",children:(0,t.jsx)(D.ZP,{onClick:v,className:Y()("header-icon",{expanded:S}),name:"AsanyEditor/Arrow"})})]}),(0,t.jsx)("div",{className:"sidebar-subpanel-body",children:(0,t.jsx)("div",{className:"sidebar-node-types-classics",children:je.classics.map(function(u){return(0,t.jsxs)(le,{type:u.type,children:[(0,t.jsx)(D.ZP,{name:u.icon}),u.name]},u.type)})})})]})]})}var Ft=Ht,Vt=g(7359),Te=g(27279),Bt=g(25782),Tt=Te.Z.Panel;function Ot(e){var n=e.name,o=e.title,s=e.cover,a=e.createDragObject,r=a(e),i=(0,Fe.c)({item:function(){return(0,y.Z)((0,y.Z)({},r),{},{id:(0,b.DO)()})},type:r.type,collect:function(m){return{opacity:m.isDragging()?.4:1}}}),l=(0,C.Z)(i,2),d=l[1];return(0,t.jsxs)("li",{children:[(0,t.jsx)("div",{className:"component-icon",ref:d,children:(0,t.jsx)("img",{src:s,alt:o})}),(0,t.jsx)("div",{className:"component-info",children:o||n})]})}function It(){var e=(0,b.NX)(function(l){return l.project.data.template}),n=(0,b.vQ)(e),o=(0,c.useState)(n.map(function(l){return l.title})),s=(0,C.Z)(o,2),a=s[0],r=s[1],i=(0,c.useCallback)(function(l){r(typeof l=="string"?[l]:l)},[]);return(0,c.useEffect)(function(){r(n.map(function(l){return l.title}))},[n.map(function(l){return l.title}).join(",")]),(0,t.jsx)("div",{className:"componet-list-wrap",children:(0,t.jsx)(Te.Z,{bordered:!1,activeKey:a,expandIcon:function(d){var v=d.isActive;return(0,t.jsx)(Bt.Z,{rotate:v?90:0})},className:"site-collapse-compactness-collapse",onChange:i,children:n.map(function(l){return(0,t.jsx)(Tt,{header:l.title,children:(0,t.jsx)("ul",{className:"component-content show-list",children:l.components.map(function(d){return(0,t.jsx)(Ot,(0,y.Z)((0,y.Z)({},d),{},{createDragObject:l.createDragObject,type:l.type}),d.name)})})},l.title)})})})}var Mt=c.memo(It),Rt=g(70681),Oe=g.n(Rt),G=new(Oe()).graphlib.Graph;G.setDefaultEdgeLabel(function(){return{}});var Lt=function(n,o){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"TB",a=s==="LR";return G.setGraph({rankdir:s,ranksep:80}),n.forEach(function(r){G.setNode(r.id,{width:r.width,height:r.height})}),o.forEach(function(r){G.setEdge(r.source,r.target)}),Oe().layout(G),n.forEach(function(r){var i=G.node(r.id);r.targetPosition=a?f.P.Left:f.P.Top,r.sourcePosition=a?f.P.Right:f.P.Bottom;var l=i.width,d=i.height;return r.position={x:i.x-l/2,y:i.y-d/2},r}),{nodes:n,edges:o}};function Ie(){var e=(0,$.u)(),n=e.getNodes,o=e.getEdges,s=Ne(),a=(0,C.Z)(s,2),r=a[1],i=(0,c.useCallback)(function(l){var d=n(),v=o();o();var m=Lt(d,v,l),p=m.nodes,N=m.edges;r({nodes:p,edges:N})},[n,o,r]);return i}function At(e){var n=e.className,o=e.disabled,s=e.active,a=e.style,r=e.children,i=Ie(),l=(0,c.useCallback)(function(){i("TB")},[i]);return(0,t.jsx)("a",{onClick:l,className:Y()("toolbar-icon",n,{disabled:o,active:s}),style:a,children:r})}function Xt(e){var n=e.className,o=e.disabled,s=e.active,a=e.style,r=e.children,i=Ie(),l=(0,c.useCallback)(function(){i("LR")},[i]);return(0,t.jsx)("a",{onClick:l,className:Y()("toolbar-icon",n,{disabled:o,active:s}),style:a,children:r})}function zt(e){var n=e.className,o=e.style,s=e.children,a=ae(),r=a.canUndo,i=a.undo;return(0,t.jsx)("a",{onClick:i,className:Y()("toolbar-icon",n,{disabled:!r}),style:o,children:s})}function Yt(e){var n=e.className,o=e.style,s=e.children,a=ae(),r=a.canRedo,i=a.redo;return(0,t.jsx)("a",{onClick:i,className:Y()("toolbar-icon",n,{disabled:!r}),style:o,children:s})}var Qt=function(){return{id:"workflow",description:"",types:["flow"],toolbar:{content:Ke,tools:[{id:"save",name:"\u4FDD\u5B58",position:"left",onClick:function(n){var o=n.state.project;console.log("onClick  project",o),n.save({})}}]},reducer:wt,sidebar:{minimizable:!1,content:function(){return(0,t.jsx)(Ft,{})},tools:[{id:"components",icon:"AsanyEditor/LayoutGrid",name:"\u7EC4\u4EF6",position:"top",mutex:"left",onClick:function(n){return n.sidebar.open("components","\u7EC4\u4EF6",Mt)}},{id:"drag",name:"\u62D6\u62FD\u753B\u5E03",icon:"AsanyEditor/HandDrag",position:"top",useSelector:function(n){return n.features.drag},isSelected:function(n){return n},onClick:function(n){return n.features.drag(!0),function(){n.features.drag(!1)}}},{id:"selecto",name:"\u9009\u62E9",icon:"AsanyEditor/SelectFilled",position:"top",mutex:"icons-actions",useSelector:function(n){return n.features.selecto},isSelected:function(n){return n},onClick:function(n){return n.features.selecto(!0),function(){n.features.selecto(!1)}}}]},scena:{screen:"fullscreen",toolbar:{tools:[{id:"undo",icon:"Bootstrap/arrow-90deg-left",position:"left",render:function(n,o){return(0,t.jsx)(zt,(0,y.Z)((0,y.Z)({},o),{},{item:n}))}},{id:"redo",icon:"Bootstrap/arrow-90deg-right",position:"left",render:function(n,o){return(0,t.jsx)(Yt,(0,y.Z)((0,y.Z)({},o),{},{item:n}))}},{id:"vertical-divider"},{id:"horizontal",name:"\u6C34\u5E73\u5BF9\u9F50",icon:"AsanyEditor/AlignHorizontalCenters",position:"left",render:function(n,o){return(0,t.jsx)(At,(0,y.Z)((0,y.Z)({},o),{},{item:n}))}},{id:"vertical-divider"},{id:"vertical",name:"\u5782\u76F4\u5BF9\u9F50",icon:"AsanyEditor/AlignVerticalCenters",position:"left",render:function(n,o){return(0,t.jsx)(Xt,(0,y.Z)((0,y.Z)({},o),{},{item:n}))}}]},workspace:St},features:[]}};function Ut(e){var n=(0,c.useRef)(null),o=e.loading,s=e.onBack,a=e.data,r=(0,c.useCallback)(function(){},[]),i=(0,c.useMemo)(function(){return a?{id:a.id,type:"flow",name:(a==null?void 0:a.name)||"",data:a}:{type:"flow"}},[a]);return(0,t.jsxs)(h.tV,{children:[(0,t.jsx)(b.lR,{children:(0,t.jsx)(b.lg,{container:We,ref:n,plugins:[Qt()],onSave:r,onBack:s,loading:o,className:"flow-editor",project:i})}),(0,t.jsx)(Ye,{})]})}var $t=Ut,Wt=g(88447);function Jt(e){var n=e.match.params.id,o=e.history,s=(0,Wt.sW)({variables:{id:n},fetchPolicy:"cache-and-network"}),a=s.data,r=s.loading,i=(0,c.useCallback)(function(){o.goBack()},[o]);return(0,t.jsx)($t,{onBack:i,loading:r,data:a==null?void 0:a.processModel})}var Gt=Jt}}]);

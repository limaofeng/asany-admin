"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[874],{874:function(se,C,s){s.r(C);var U=s(97857),p=s.n(U),S=s(15009),v=s.n(S),k=s(99289),A=s.n(k),K=s(5574),b=s.n(K),m=s(67294),M=s(96974),W=s(12845),z=s(73588),a=s(89717),c=s(19975),e=s(85893);function V(){var f,i=(0,M.UO)(),E=(0,M.s0)(),$=(0,c.ZL)({fetchPolicy:"cache-and-network",variables:{pageSize:1e3}}),x=$.data,Q=(0,c.Nd)({fetchPolicy:"cache-and-network",variables:{pageSize:1e3}}),g=Q.data,G=(0,c.V_)({fetchPolicy:"cache-and-network"}),B=b()(G,2),w=B[0],I=B[1],P=I.data,O=I.loading,H=(0,c.mp)({}),L=b()(H,2),N=L[0],X=L[1].loading,Z=(0,c.qV)({}),T=b()(Z,2),R=T[0],J=T[1].loading,t=i.id==="new",l=a.Form.useForm(),Y=(0,m.useCallback)(A()(v()().mark(function u(){var r;return v()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,l.validateFields();case 2:if(r=n.sent,!t){n.next=8;break}return n.next=6,N({variables:{input:r}});case 6:n.next=10;break;case 8:return n.next=10,R({variables:{id:i.id,input:r}});case 10:a.Toast.success("\u6D3B\u52A8 \u201C".concat(r.name,"\u201D ").concat(t?"\u65B0\u589E":"\u4FEE\u6539","\u6210\u529F"),2e3,{placement:"bottom-left",progressBar:!0}),!history.length||t?E("/website/landing/pages",{replace:!0}):E(-2);case 12:case"end":return n.stop()}},u)})),[N,i.id,l,history,t,R]);(0,m.useEffect)(function(){if(i.id!=="new"){var u=new AbortController;return w({variables:{id:i.id},context:{fetchOptions:{signal:u.signal}}}).then(function(){var r=A()(v()().mark(function h(n){var d,D,y,j,o;return v()().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(j=n.data,o=j==null?void 0:j.page,o){_.next=7;break}return _.next=5,a.Modal.error({content:"\u6D3B\u52A8\u4E0D\u5B58\u5728,\u53EF\u80FD\u5DF2\u7ECF\u88AB\u5220\u9664\u4E86",timer:3e3,timerProgressBar:!0});case 5:return history.length?E(-1):E("/website/landing/pages",{replace:!0}),_.abrupt("return");case 7:l.setFieldsValue(p()(p()({},o),{},{metadata:p()(p()({},o.metadata),{},{thumb:(d=o.metadata)===null||d===void 0||(d=d.thumb)===null||d===void 0?void 0:d.id}),poster:(D=o.poster)===null||D===void 0?void 0:D.id,stores:(y=o.stores)===null||y===void 0?void 0:y.map(function(ae){return ae.id})}));case 8:case"end":return _.stop()}},h)}));return function(h){return r.apply(this,arguments)}}()),function(){u.abort()}}},[l,w,history,i.id]);var F=(0,m.useMemo)(function(){return x==null?void 0:x.landingStores.edges.map(function(u){var r=u.node;return{value:r.id,label:r.name}})},[x]),q=(0,m.useMemo)(function(){return g==null?void 0:g.landingPosters.edges.map(function(u){var r=u.node;return{value:r.id,label:r.name}})},[g]),ee=(0,m.useCallback)(function(){F&&l.setFieldsValue({stores:F.map(function(u){return u.value})})},[l,F]);return(0,e.jsx)(z.vs,{header:t?{title:"\u65B0\u589E\u6D3B\u52A8"}:void 0,footer:!1,children:(0,e.jsxs)(a.Card,{className:"mb-5 mb-xl-10",children:[(0,e.jsx)(a.Card.Header,{children:(0,e.jsx)(a.Card.Title,{children:t?"\u65B0\u589E\u6D3B\u52A8":P==null||(f=P.page)===null||f===void 0?void 0:f.name})}),(0,e.jsxs)(a.Card.Body,{children:[(0,e.jsx)(a.BlockUI,{zIndex:10,overlayClassName:"bg-white bg-opacity-25",loading:O,children:(0,e.jsxs)(a.Form,{form:l,children:[(0,e.jsxs)("div",{className:"mw-800px row d-flex flex-shrink-0 flex-column-reverse flex-md-row",children:[(0,e.jsxs)("div",{className:"col-12 col-md-8",children:[(0,e.jsx)(a.Form.Item,{className:"mb-5",name:"name",label:"\u540D\u79F0",rules:[{required:!0,message:"\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A"}],children:(0,e.jsx)(a.Input,{solid:!0,className:"w-400px"})}),(0,e.jsx)(a.Form.Item,{className:"my-5",name:"poster",label:"\u6D77\u62A5",children:(0,e.jsx)(a.Select2,{solid:!0,className:"w-400px",options:q})}),(0,e.jsx)(a.Form.Item,{className:"my-5",name:"stores",label:(0,e.jsxs)(e.Fragment,{children:["\u53C2\u52A0\u6D3B\u52A8\u7684\u95E8\u5E97",(0,e.jsx)("a",{onClick:ee,className:"ps-2 cursor-pointer",children:"\u6DFB\u52A0\u5168\u90E8\u95E8\u5E97"})]}),children:(0,e.jsx)(a.Select2,{solid:!0,multiple:!0,className:"w-400px",options:F})}),(0,e.jsx)(a.Form.Item,{className:"my-5",name:"start",label:"\u5F00\u59CB\u65F6\u95F4",children:(0,e.jsx)(a.DatePicker,{solid:!0,className:"w-400px"})}),(0,e.jsx)(a.Form.Item,{dependencies:["start"],noStyle:!0,children:function(){return(0,e.jsx)(a.Form.Item,{className:"my-5",name:"end",label:"\u622A\u6B62\u65F6\u95F4",children:(0,e.jsx)(a.DatePicker,{solid:!0,minDate:l.getFieldValue("start"),className:"w-400px"})})}}),(0,e.jsx)(a.Form.Item,{className:"my-5",name:"description",label:"\u63CF\u8FF0",help:"\u8BF7\u7528\u5C11\u4E8E250\u5B57\u7B26\u63CF\u8FF0",children:(0,e.jsx)(a.Input.TextArea,{solid:!0,autoSize:{minRows:4,maxRows:8},showCount:!0,maxLength:250,className:"w-400px"})})]}),(0,e.jsx)("div",{className:"col-12 col-md-4",children:(0,e.jsx)(a.Device.iPhoneX,{children:(0,e.jsx)(a.Form.Item,{dependencies:["poster","stores"],noStyle:!0,children:function(r){var h=r.getFieldValue("poster"),n=r.getFieldValue("stores");return(0,e.jsx)("iframe",{src:W.APP_CONFIG.MOBILE_URL+"/lps/0?&poster=".concat(h,"&stores=").concat(n==null?void 0:n.join(",")),style:{width:"100%",height:"100%"}})}})})})]}),(0,e.jsxs)("div",{className:"row",children:[(0,e.jsx)("h4",{className:"mt-10",children:"HTML \u9875\u9762\u5143\u6570\u636E"}),(0,e.jsx)(a.Separator,{className:"mt-4 mb-8"}),(0,e.jsxs)("div",{className:"mw-800px row d-flex flex-shrink-0 flex-column-reverse flex-md-row",children:[(0,e.jsxs)("div",{className:"col-12 col-md-8",children:[(0,e.jsx)(a.Form.Item,{className:"my-5 w-400px",name:["metadata","title"],label:"\u6807\u9898",help:"\u53EF\u4F5C\u4E3A\u5FAE\u4FE1\u5206\u4EAB\u65F6,\u7684\u6807\u9898",children:(0,e.jsx)(a.Input,{solid:!0,className:""})}),(0,e.jsx)(a.Form.Item,{className:"my-5 w-400px",name:["metadata","description"],label:"\u63CF\u8FF0",help:"\u8BF7\u7528\u5C11\u4E8E250\u5B57\u7B26\u63CF\u8FF0,\u53EF\u4F5C\u4E3A\u5FAE\u4FE1\u5206\u4EAB\u65F6\u7684\u526F\u6807\u9898",children:(0,e.jsx)(a.Input.TextArea,{solid:!0,autoSize:{minRows:4,maxRows:8},showCount:!0,maxLength:250})})]}),(0,e.jsx)("div",{className:"col-12 col-md-4",children:(0,e.jsx)(a.Form.Item,{className:"mb-5",name:["metadata","thumb"],label:"\u7F29\u7565\u56FE",help:"\u53EF\u4F5C\u4E3A\u5FAE\u4FE1\u5206\u4EAB\u65F6\u7684\u56FE\u7247",children:(0,e.jsx)(a.Upload.Image,{width:250,height:250,space:"orX8kLOV",crop:{height:300,zoomable:!1,aspectRatio:1}})})})]})]})]})}),(0,e.jsx)(a.Button,{loading:O||X||J,onClick:Y,children:t?(0,e.jsx)(e.Fragment,{children:"\u6DFB\u52A0\u6D3B\u52A8"}):(0,e.jsx)(e.Fragment,{children:"\u4FEE\u6539\u6D3B\u52A8"})})]})]})})}C.default=V}}]);

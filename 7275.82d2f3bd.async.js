(self.webpackChunkasany_admin=self.webpackChunkasany_admin||[]).push([[7275],{37275:function(U,L,s){"use strict";s.r(L),s.d(L,{default:function(){return me}});var A=s(3182),f=s(2824),O=s(94043),D=s.n(O),o=s(67294),d=s(28865),Y=s(1861),G=s(73727),Q=s(51615),K=s(94184),w=s.n(K),W=s(24561),p=s(40839),c=s(88403),V=s(19755),q=s.n(V),_=s(30381),F=s.n(_),i=s(69851),ee=s(54108),e=s(85893),ae=i.mN.Avatar;function se(m){var a=m.message,r=m.mailbox,t=(0,o.useState)(!0),h=(0,f.Z)(t,2),v=h[0],N=h[1],J=(0,o.useCallback)(function(M){!q()(M.target).hasClass("message-handover")||N(function(E){return!E})},[N]);return(0,e.jsxs)("div",{className:w()("message_wrapper",{shrink:!v}),children:[(0,e.jsxs)("div",{className:"d-flex flex-wrap gap-2 cursor-pointer message-handover",onClick:J,children:[(0,e.jsxs)("div",{className:"d-flex align-items-center message-handover",children:[(0,e.jsx)(ae,{alt:a==null?void 0:a.from.map(c.ss).join("\u3001"),src:"assets/media/avatars/300-6.jpg",size:50,labelClassName:"fs-2",className:"me-4"}),(0,e.jsxs)("div",{className:"pe-5",children:[(0,e.jsxs)("div",{className:"d-flex align-items-center flex-wrap gap-1",children:[(0,e.jsx)("a",{className:"fw-bolder text-dark text-hover-primary",children:a==null?void 0:a.from.map(c.ss).join("\u3001")}),(0,e.jsx)(d.JO,{className:"svg-icon-7 svg-icon-success mx-3",name:"Duotune/abs050"}),(0,e.jsx)("span",{className:"text-muted fw-bolder",children:a&&F()(a.date).fromNow()})]}),(0,e.jsx)(i.J2,{stopPropagation:!0,content:(0,e.jsx)("div",{className:"menu menu-column menu-rounded menu-gray-600 menu-state-bg-light-primary fw-bold fs-7","data-kt-menu":"true",children:(0,e.jsx)("table",{className:"table mb-0",children:(0,e.jsxs)("tbody",{children:[r!="sent"&&(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{className:"w-75px text-muted",children:"\u53D1\u4EF6\u4EBA"}),(0,e.jsx)("td",{children:a==null?void 0:a.from.join("\u3001")})]}),r!="inbox"&&(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{className:"w-75px text-muted",children:"\u6536\u4EF6\u4EBA"}),(0,e.jsx)("td",{children:a==null?void 0:a.to.join("\u3001")})]}),(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{className:"text-muted",children:"\u65F6\u95F4"}),(0,e.jsx)("td",{children:a&&F()(a.date).format("lll")})]}),(a==null?void 0:a.replyTo)&&(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{className:"text-muted",children:"\u56DE\u590D"}),(0,e.jsx)("td",{children:a.replyTo.map(c.ss).join("\u3001")})]})]})})}),placement:"bottom-start",children:(0,e.jsxs)("div",{className:w()("inbox-message-details",{"d-none":!v}),children:[(0,e.jsxs)("span",{className:"text-muted fw-bold",children:["\u53D1\u9001\u7ED9 ",r=="inbox"?"\u6211":a==null?void 0:a.to.map(c.ss).join("\u3001")]}),(0,e.jsx)("a",{className:"me-1","data-kt-menu-trigger":"click","data-kt-menu-placement":"bottom-start",children:(0,e.jsx)(d.JO,{className:"svg-icon-5 m-0",name:"Duotune/arr072"})})]})}),(0,e.jsx)("div",{className:w()("message_wrapper_preview-message message-handover text-muted fw-bold",{"d-none":v}),children:(a==null?void 0:a.mimeType)=="text/html"?(0,ee.Kv)(a.body||""):a==null?void 0:a.body})]})]}),(0,e.jsxs)("div",{className:"message_wrapper_actions d-flex align-items-center flex-wrap gap-2",children:[(0,e.jsx)("span",{className:"mail-message-date fw-bold text-muted me-3",children:a&&F()(a.date).format("YYYY-MM-DD A HH:mm")}),(0,e.jsxs)("div",{className:"mail-message-actions d-flex",children:[(0,e.jsx)(i.u,{placement:"bottom",title:"\u6536\u85CF",children:(0,e.jsx)("a",{className:"btn btn-icon btn-clear btn-active-light-primary me-3",children:(0,e.jsx)(d.JO,{name:"Duotune/gen029",className:"svg-icon-2 m-0"})})}),(0,e.jsx)(i.u,{placement:"bottom",title:"\u8BBE\u7F6E\u4E3A\u91CD\u8981",children:(0,e.jsx)("a",{className:"btn btn-icon btn-clear btn-active-light-primary me-3",children:(0,e.jsx)(d.JO,{name:"Duotune/gen056",className:"svg-icon-2 m-0"})})}),(0,e.jsx)(i.u,{placement:"bottom",title:"\u56DE\u590D",children:(0,e.jsx)("a",{className:"btn btn-icon btn-clear btn-active-light-primary me-3",children:(0,e.jsx)(d.JO,{name:"Duotune/gen055",className:"svg-icon-2 m-0"})})}),(0,e.jsx)("a",{className:"btn btn-icon btn-clear btn-active-light-primary","data-bs-toggle":"tooltip","data-bs-placement":"top",title:"Settings",children:(0,e.jsx)("span",{className:"svg-icon svg-icon-2 m-0",children:(0,e.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:[(0,e.jsx)("rect",{x:"10",y:"10",width:"4",height:"4",rx:"2",fill:"black"}),(0,e.jsx)("rect",{x:"10",y:"3",width:"4",height:"4",rx:"2",fill:"black"}),(0,e.jsx)("rect",{x:"10",y:"17",width:"4",height:"4",rx:"2",fill:"black"})]})})})]})]})]}),(0,e.jsx)("div",{className:w()("collapse fade",{show:v}),"data-kt-inbox-message":"message",children:(0,e.jsx)("div",{className:"py-5",dangerouslySetInnerHTML:{__html:(a==null?void 0:a.body)||""}})})]})}function te(m){var a=m.message,r=m.mailbox;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"d-flex flex-wrap gap-2 justify-content-between mb-8",children:[(0,e.jsx)("div",{className:"d-flex align-items-center flex-wrap gap-2",children:(0,e.jsx)("h2",{className:"fw-bold me-3 my-1",children:(a==null?void 0:a.subject)||"(\u65E0\u4E3B\u9898)"})}),(0,e.jsx)("div",{className:"d-flex",children:(0,e.jsx)(i.u,{placement:"bottom",title:"\u6253\u5370",children:(0,e.jsx)("a",{className:"btn btn-icon btn-light btn-active-light-primary me-2",children:(0,e.jsx)("i",{className:"bi bi-printer-fill fs-2"})})})})]}),(0,e.jsx)(se,{message:a,mailbox:r}),(0,e.jsx)("div",{className:"separator my-6"})]})}var ne=te,ie=s(54782),re=s(19228);function le(m){var a=m.message,r=m.onAction,t=(0,o.useCallback)(function(h){return function(){r(h)}},[r]);return(0,e.jsx)("div",{className:"d-flex",children:a&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(i.u,{placement:"bottom",title:"\u8FD4\u56DE",children:(0,e.jsx)(G.Link,{className:"btn btn-icon btn-clear btn-active-light-primary me-3",to:"/mail/".concat(a.mailboxName.toLowerCase()),children:(0,e.jsx)(d.JO,{name:"Duotune/arr063",className:"svg-icon-1 m-0"})})}),![c.LJ.INBOX.id,c.LJ.Drafts.id].includes(a.mailboxName)&&c.LJ.INBOX.id==a.originalMailboxName&&(0,e.jsx)(i.u,{placement:"bottom",title:"\u6536\u4EF6\u7BB1",children:(0,e.jsx)("a",{onClick:t("inbox"),className:"btn btn-icon btn-light btn-active-light-primary me-2",children:(0,e.jsx)(d.JO,{name:c.LJ.INBOX.icon,className:"svg-icon-2 m-0"})})}),![c.LJ.Sent.id,c.LJ.Drafts.id].includes(a.mailboxName)&&c.LJ.Sent.id==a.originalMailboxName&&(0,e.jsx)(i.u,{placement:"bottom",title:"\u5DF2\u53D1\u9001",children:(0,e.jsx)("a",{onClick:t("sent"),className:"btn btn-icon btn-light btn-active-light-primary me-2",children:(0,e.jsx)(d.JO,{name:c.LJ.Sent.icon,className:"svg-icon-2 m-0"})})}),![c.LJ.Archive.id,c.LJ.Drafts.id,c.LJ.Trash.id].includes(a.mailboxName)&&(0,e.jsx)(i.u,{placement:"bottom",title:"\u5B58\u6863",children:(0,e.jsx)("a",{onClick:t("archive"),className:"btn btn-icon btn-light btn-active-light-primary me-2",children:(0,e.jsx)(d.JO,{name:c.LJ.Archive.icon,className:"svg-icon-2 m-0"})})}),![c.LJ.Spam.id,c.LJ.Drafts.id].includes(a.mailboxName)&&(0,e.jsx)(i.u,{placement:"bottom",title:"\u5783\u573E\u90AE\u4EF6",children:(0,e.jsx)("a",{onClick:t("spam"),className:"btn btn-icon btn-light btn-active-light-primary me-2",children:(0,e.jsx)(d.JO,{name:c.LJ.Spam.icon,className:"svg-icon-2 m-0"})})}),(0,e.jsx)(i.u,{placement:"bottom",title:"\u5220\u9664\u90AE\u4EF6",children:(0,e.jsx)("a",{onClick:t("deleted"),className:"btn btn-icon btn-light btn-active-light-primary me-2",children:(0,e.jsx)(d.JO,{name:"Duotune/gen027",className:"svg-icon-2 m-0"})})}),(0,e.jsx)(i.u,{placement:"bottom",title:a.seen?"\u6807\u8BB0\u4E3A\u672A\u8BFB":"\u6807\u8BB0\u4E3A\u5DF2\u8BFB",children:(0,e.jsx)("a",{onClick:t(a.seen?"unread":"read"),className:"btn btn-icon btn-light btn-active-light-primary me-2",children:(0,e.jsx)(d.JO,{name:a.seen?"Duotune/gen028":"Duotune/gen054",className:"svg-icon-2 m-0"})})})]})})}function ce(m){var a=m.current,r=m.pagination,t=m.goto,h=(0,o.useCallback)(function(){t(Math.max(0,a-2))},[t,a]),v=(0,o.useCallback)(function(){t(Math.min(r.totalCount-1,a))},[a,t,r.totalCount]);return(0,e.jsxs)("div",{className:"d-flex align-items-center",children:[(0,e.jsxs)("span",{className:"fw-bold text-muted me-2",children:[a==0?"loading...":a," / ",r.totalCount]}),(0,e.jsx)(i.u,{placement:"bottom",title:"\u4E0A\u4E00\u5C01\u90AE\u4EF6",children:(0,e.jsx)(i.zx,{onClick:h,icon:(0,e.jsx)(d.JO,{name:"Duotune/arr074",className:"svg-icon-2 m-0"}),variant:"light",activeColor:"light-primary",className:"me-3",disabled:a==1})}),(0,e.jsx)(i.u,{placement:"bottom",title:"\u4E0B\u4E00\u5C01\u90AE\u4EF6",children:(0,e.jsx)(i.zx,{onClick:v,icon:(0,e.jsx)(d.JO,{name:"Duotune/arr071",className:"svg-icon-2 m-0"}),variant:"light",activeColor:"light-primary",className:"me-2",disabled:a==r.totalCount})})]})}function oe(){return(0,e.jsx)("div",{children:(0,e.jsxs)(W.ZP,{speed:2,width:"100%",height:500,viewBox:"0 0 926 500",backgroundColor:"#f3f3f3",foregroundColor:"#ecebeb",children:[(0,e.jsx)("rect",{x:"0",y:"0",rx:"3",ry:"3",width:"230",height:"34"}),(0,e.jsx)("rect",{x:"48",y:"26",rx:"3",ry:"3",width:"52",height:"6"}),(0,e.jsx)("rect",{x:"0",y:"60",rx:"3",ry:"3",width:"50",height:"50"}),(0,e.jsx)("rect",{x:"2",y:"126",rx:"4",ry:"4",width:"178",height:"20"}),(0,e.jsx)("rect",{x:"60",y:"65",rx:"0",ry:"0",width:"228",height:"13"}),(0,e.jsx)("rect",{x:"62",y:"88",rx:"0",ry:"0",width:"226",height:"18"}),(0,e.jsx)("rect",{x:"826",y:"83",rx:"0",ry:"0",width:"100",height:"23"}),(0,e.jsx)("rect",{x:"6",y:"158",rx:"0",ry:"0",width:"242",height:"17"}),(0,e.jsx)("rect",{x:"6",y:"190",rx:"0",ry:"0",width:"325",height:"14"}),(0,e.jsx)("rect",{x:"6",y:"220",rx:"0",ry:"0",width:"427",height:"20"}),(0,e.jsx)("rect",{x:"6",y:"255",rx:"0",ry:"0",width:"513",height:"15"})]})})}function de(m){var a=m.match.params,r=a.folder,t=a.id,h=m.message,v=m.pagination,N=m.goto,J=m.activeIndex,M=m.refresh,E=(0,Q.k6)(),ue=(0,p.Pg)({fetchPolicy:"cache-and-network"}),P=(0,f.Z)(ue,2),R=P[0],B=P[1],j=B.data,X=B.loading,S=B.error,xe=(0,p.Rh)({refetchQueries:[p.f_,p.Nd]}),he=(0,f.Z)(xe,1),I=he[0],ge=(0,p.aB)({refetchQueries:[p.f_]}),ve=(0,f.Z)(ge,1),z=ve[0],be=(0,p.k0)({refetchQueries:[p.Nd]}),fe=(0,f.Z)(be,1),H=fe[0],x=(0,o.useRef)({pagination:v,mailbox:r,activeIndex:J}),n=(0,o.useMemo)(function(){var u;return(j==null||(u=j.message)===null||u===void 0?void 0:u.id)==t?j==null?void 0:j.message:(h==null?void 0:h.id)==t?h:x.current.message},[t,j==null?void 0:j.message,h]);x.current.mailbox=r,x.current.message=n,x.current.pagination=v,x.current.activeIndex=J;var k=(0,o.useCallback)(function(){var u=x.current,y=u.mailbox,b=u.pagination,g=u.activeIndex;b.totalCount==0?E.push("/mail/".concat(y)):N(Math.min(g,b.totalCount-1))},[N,E]),T=(0,o.useCallback)(function(){var u=(0,A.Z)(D().mark(function y(b){var g,Z,C,$;return D().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:g=x.current.message;case 1:if(((Z=g)===null||Z===void 0?void 0:Z.index)!=null){l.next=7;break}return l.next=4,(0,re._v)(60);case 4:g=x.current.message,l.next=1;break;case 7:if(!(b=="read"||b=="unread")){l.next=13;break}return l.next=10,z({variables:{id:t,flags:["seen"],mode:b=="unread"?"REMOVE":"ADD"}});case 10:C="updateFlags",l.next=34;break;case 13:if(b!="deleted"){l.next=30;break}if(!(r=="drafts"||r=="trash")){l.next=25;break}return l.next=17,i.u_.confirm({title:"\u8B66\u544A",content:r=="trash"?"\u786E\u5B9A\u6C38\u4E45\u5220\u9664\u4FE1\u606F\uFF1F":"\u786E\u5B9A\u6C38\u4E45\u5220\u9664\u8349\u7A3F\uFF1F"});case 17:if($=l.sent,$.isConfirmed){l.next=20;break}return l.abrupt("return");case 20:return l.next=22,H({variables:{id:t}});case 22:C="delete",l.next=28;break;case 25:return l.next=27,I({variables:{id:t,mailbox:"trash"}});case 27:C="toFolder";case 28:l.next=34;break;case 30:if(!["archive","spam","inbox","sent"].includes(b)){l.next=34;break}return l.next=33,I({variables:{id:t,mailbox:b}});case 33:C="toFolder";case 34:M({type:C,key:g.id,index:g.index-1}),C!="updateFlags"&&k();case 36:case"end":return l.stop()}},y)}));return function(y){return u.apply(this,arguments)}}(),[H,t,r,k,M,I,z]);(0,o.useEffect)(function(){x.current.autoReadExecuted=!1;var u=setTimeout(function(){R({variables:{id:t}})},600);return function(){clearTimeout(u)}},[R,t]),(0,o.useEffect)(function(){if(!(!n||n.id!=t)&&(n==null?void 0:n.mailboxName)==c.LJ.INBOX.id){if(x.current.autoReadExecuted||n.seen){x.current.autoReadExecuted=!0;return}x.current.autoReadExecuted=!0,T("read")}},[T,t,n]);var je=(0,o.useCallback)(function(u){x.current.message=u},[]),pe=(0,o.useCallback)((0,A.Z)(D().mark(function u(){var y;return D().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:y=x.current.message,M({type:"toFolder",key:y.id,index:y.index-1}),k();case 3:case"end":return g.stop()}},u)})),[k,M]);return(0,o.useEffect)(function(){if(!(!n||X||n.index==null||n.id!=t)){var u=x.current.activeIndex;u!=n.index-1&&N(n.index-1)}},[n,N,X,t]),(0,o.useEffect)(function(){!S||i.u_.error({title:"\u9519\u8BEF",content:S.message,timer:3e3,timerProgressBar:!0}).then(function(){E.push("/mail/".concat(x.current.mailbox))})},[S,E]),(0,e.jsx)(Y.E,{className:"mail-message-details flex-lg-row-fluid custom-scrollbar",options:{scrollbars:{autoHide:"scroll"}},children:(0,e.jsxs)(i.Zb,{className:"mail-message-container",children:[(0,e.jsxs)(i.Zb.Header,{className:"align-items-center py-5 gap-5",children:[(0,e.jsx)(le,{message:n,onAction:T}),(0,e.jsx)(ce,{pagination:v,current:(n==null?void 0:n.index)||J+1,goto:N})]}),(0,e.jsx)(i.Zb.Body,{className:w()({"px-5 py-0 mail-message-draft":n==null?void 0:n.draft}),children:n?n.draft?(0,e.jsx)(ie.Z,{message:n,onAutoSave:je,onSend:pe}):(0,e.jsx)(ne,{message:n,mailbox:r}):(0,e.jsx)(oe,{})})]})})}var me=de},88403:function(U,L,s){"use strict";s.d(L,{LJ:function(){return f},GG:function(){return O},ss:function(){return D}});var A=s(5618),f={INBOX:{id:"INBOX",name:"\u6536\u4EF6\u7BB1",icon:"Duotune/com010",badge:"success"},Sent:{id:"Sent",name:"\u5DF2\u53D1\u9001",icon:"Duotune/gen016"},Drafts:{id:"Drafts",name:"\u8349\u7A3F",icon:"Duotune/gen009",badge:"primary"},Archive:{id:"Archive",name:"\u5F52\u6863",icon:"Duotune/lay010"},Spam:{id:"Spam",name:"\u5783\u573E\u90AE\u4EF6",icon:"Duotune/gen044"},Trash:{id:"Trash",name:"\u56DE\u6536\u7AD9",icon:"Duotune/gen027",badge:"warning"},Outbox:{id:"Outbox",name:"\u53D1\u4EF6\u7BB1",icon:"Duotune/gen027"}},O=Object.keys(f).map(function(o){return f[o]});function D(o){var d=(0,A.N8)(o);return d.name||d.address&&d.address.substring(0,d.address.indexOf("@"))}}}]);

"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[2116],{14336:function(fe,$,n){var P=n(15009),s=n.n(P),re=n(99289),F=n.n(re),ne=n(97857),N=n.n(ne),te=n(5574),w=n.n(te),u=n(67294),x=n(2721),b=n(12708);function f(i,e){return i.replace(/{(\w+)}/g,function(d,j){return e[j]!==void 0?e[j]:d})}function v(i,e){var d=i(N()({fetchPolicy:"network-only"},(e==null?void 0:e.mutation)||{})),j=w()(d,1),A=j[0],O=(0,u.useRef)(!1),Q=(0,u.useRef)(null),U=(0,u.useCallback)(function(){var W=F()(s()().mark(function Z(E,L){var Y,de,ae,ce,B,k,ue,me,l;return s()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return Y=(L==null?void 0:L.dialog)||(e==null?void 0:e.dialog)||{},de=(L==null?void 0:L.mutation)||(e==null?void 0:e.mutation)||{},ae=(L==null?void 0:L.onDeleted)||(e==null?void 0:e.onDeleted),ce=Y.width,B=Y.title,k=Y.content,ue=!1,Array.isArray(E)?(ue=!0,typeof B=="function"&&(B=B(E,{batch:!0})),typeof k=="function"&&(k=k(E,{batch:!0}))):E&&(typeof B=="string"&&(B=f(B,E)),typeof k=="string"&&(k=f(k,E)),typeof B=="function"&&(B=B(E,{batch:!1})),typeof k=="function"&&(k=k(E,{batch:!1}))),me=function(){var g=F()(s()().mark(function y(){return s()().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.next=2,A(N()(N()({fetchPolicy:"network-only"},de),{},{variables:{where:{id_in:ue?E:[E==null?void 0:E.id]}}}));case 2:case"end":return _.stop()}},y)}));return function(){return g.apply(this,arguments)}}(),c.next=10,x.Modal.confirm(N()(N()({},Y),{},{title:B,content:k,width:ce,okText:"\u5220 \u9664",okClassName:"btn-danger",allowOutsideClick:function(){return!O.current},preConfirm:function(){var g=F()(s()().mark(function I(){var _,C,m;return s()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return O.current=!0,Q.current=null,p.prev=2,_=document.querySelector(".swal2-confirm"),_.textContent="\u5220\u9664\u4E2D...",C=document.createElement("span"),C.classList.add("spinner-border-sm","ms-2","spinner-border","align-middle"),_.appendChild(C),p.next=10,(0,b.gw)(me(),350);case 10:m=p.sent,ae&&ae(E,m),p.next=17;break;case 14:p.prev=14,p.t0=p.catch(2),Q.current=p.t0;case 17:return p.prev=17,O.current=!1,p.finish(17);case 20:case"end":return p.stop()}},I,null,[[2,14,17,20]])}));function y(){return g.apply(this,arguments)}return y}()}));case 10:if(l=c.sent,!Q.current){c.next=14;break}return x.Toast.error("\u5220\u9664\u5931\u8D25:"+Q.current.message,2e3,{placement:"top-center",progressBar:!0}),c.abrupt("return",!1);case 14:if(l.isConfirmed){c.next=16;break}return c.abrupt("return",!1);case 16:return x.Toast.success("\u5220\u9664\u6210\u529F",2e3,{placement:"top-center",progressBar:!0}),c.abrupt("return",!0);case 18:case"end":return c.stop()}},Z)}));return function(Z,E){return W.apply(this,arguments)}}(),[]),r=(0,u.useCallback)(function(W,Z){return U(W,Z)},[e,A]),ve=(0,u.useCallback)(function(W,Z){return U(W,Z)},[]);return{delete:r,deleteMany:ve}}$.Z=v},58301:function(fe,$,n){n.d($,{Oh:function(){return te},bp:function(){return w}});var P=n(97857),s=n.n(P),re=n(67294);function F(u,x){var b,f,v=u(s()({fetchPolicy:"network-only"},x)),i=v.data,e=v.loading,d=v.previousData,j=v.refetch,A=v.error,O=(0,re.useMemo)(function(){return e?d==null?void 0:d.result.pageInfo:i==null?void 0:i.result.pageInfo},[i==null||(b=i.result)===null||b===void 0?void 0:b.pageInfo.total,e,d==null||(f=d.result)===null||f===void 0?void 0:f.pageInfo.total]),Q=(0,re.useMemo)(function(){return i!=null&&i.result?i.result.edges.map(function(U){return U.node}):e&&d!==null&&d!==void 0&&d.result?d.result.edges.map(function(U){return U.node}):[]},[e,i==null?void 0:i.result,d==null?void 0:d.result]);return[Q,{loading:e,pageInfo:O,error:A,variables:{},refetch:j}]}function ne(u,x){return x.split(".").reduce(function(b,f){return b&&b[f]!==void 0?b[f]:void 0},u)}function N(u,x,b){for(var f=x.split("."),v=u;f.length>1;){var i=f.shift();v[i]||(v[i]={}),v=v[i]}v[f[0]]=b}function te(u,x){var b=x.map(function(f){var v=f.source,i=f.target,e=f.transform,d=f.skip,j=ne(u,v);if(j==null||d&&d(j))return"";var A=e?e(j):String(j);return"".concat(encodeURIComponent(i||v),"=").concat(encodeURIComponent(A))});return b.filter(function(f){return f}).join("&")}function w(u,x){var b=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},f=b;return x.forEach(function(v){var i=v.source,e=v.target,d=v.transform,j=v.skip,A=u.get(i);if(!(!A||A.trim()==="")){var O=d?d(A):A;j&&j(O)||(e?N(f,e,O):f[i]=O)}}),f}$.ZP=F},77521:function(fe,$,n){n.d($,{Cz:function(){return P.Cz},Qn:function(){return P.Qn},YG:function(){return P.YG},dy:function(){return P.dy},k1:function(){return P.k1},rq:function(){return P.rq},sB:function(){return P.sB}});var P=n(24127)},22116:function(fe,$,n){n.r($),n.d($,{default:function(){return me}});var P=n(97857),s=n.n(P),re=n(15009),F=n.n(re),ne=n(99289),N=n.n(ne),te=n(5574),w=n.n(te),u=n(67294),x=n(96974),b=n(39711),f=n(46027),v=n(58301),i=n(73588),e=n(2721),d=n(12708),j=n(13769),A=n.n(j),O=n(78045),Q=n(14336),U=n(24127),r=n(85893);function ve(l){var t=(0,Q.Z)(U.ow,{onDeleted:function(){l&&l()},dialog:{title:"\u4F60\u786E\u5B9A\u8981\u5220\u9664\u5417\uFF1F",content:function(I,_){var C;if(_.batch){var m=I;C="\u786E\u5B9A\u5220\u9664\u9009\u4E2D\u7684, \u5171 ".concat(m.length," \u4E2A\u5BA2\u6237\u5417\uFF1F")}else C=(0,r.jsxs)(r.Fragment,{children:["\u60A8\u5373\u5C06\u5220\u9664\u201C",(0,r.jsx)("strong",{children:I.name})]});return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("p",{className:"tip-confirm",children:C}),(0,r.jsx)("p",{children:"\u5220\u9664\u7684\u64CD\u4F5C\u4E0D\u53EF\u9006,\u8BF7\u8C28\u614E\u64CD\u4F5C"})]})}}}),c=t.delete,g=t.deleteMany;return{delete:c,deleteMany:g}}var W=ve;function Z(l,t){var c=e.Form.useForm(),g=(0,u.useState)(!1),y=w()(g,2),I=y[0],_=y[1],C=t||{},m=C.messages,T=C.onSubmitted,p=T===void 0?function(){}:T,K=C.transform,R=K===void 0?function(z){return z}:K,se=(0,U.Nv)({fetchPolicy:"no-cache",refetchQueries:t==null?void 0:t.refetchQueries}),le=w()(se,1),S=le[0],H=(0,U.oZ)({fetchPolicy:"no-cache",refetchQueries:t==null?void 0:t.refetchQueries}),ie=w()(H,1),J=ie[0],X=(0,u.useMemo)(function(){return l!=null&&l.id?N()(F()().mark(function z(){var M,q,ee;return F()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return _(!0),a.prev=1,a.t0=R,a.next=5,c.validateFields();case 5:return a.t1=a.sent,M=(0,a.t0)(a.t1),a.next=9,e.Toast.promise((0,d.gw)(J({variables:{id:l.id,input:s()({},M)}}),350),{pending:(m==null?void 0:m.pending)||"\u4FDD\u5B58\u4E2D...",success:{render:function(){return(0,r.jsxs)(r.Fragment,{children:["\u8DEF\u7531 ",(0,r.jsx)("strong",{children:M.name})," \u4FDD\u5B58\u6210\u529F"]})}},error:(m==null?void 0:m.error)||"\u4FDD\u5B58\u51FA\u9519"},{duration:2e3,placement:"top-center"});case 9:q=a.sent,ee=q.data,p(ee.updateCustomer),_(!1),a.next=19;break;case 15:a.prev=15,a.t2=a.catch(1),_(!1),console.error(a.t2);case 19:case"end":return a.stop()}},z,null,[[1,15]])})):N()(F()().mark(function z(){var M,q,ee;return F()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return _(!0),a.prev=1,a.t0=R,a.next=5,c.validateFields();case 5:return a.t1=a.sent,M=(0,a.t0)(a.t1),a.next=9,e.Toast.promise((0,d.gw)(S({variables:{input:s()({},M)}}),350),{pending:(m==null?void 0:m.pending)||"\u63D0\u4EA4\u4E2D...",success:{render:(m==null?void 0:m.pending)||"\u63D0\u4EA4\u6210\u529F"},error:(m==null?void 0:m.error)||"\u63D0\u4EA4\u51FA\u9519"},{duration:2e3,placement:"top-center"});case 9:q=a.sent,ee=q.data,p(ee.createCustomer),_(!1),a.next=18;break;case 15:a.prev=15,a.t2=a.catch(1),_(!1);case 18:case"end":return a.stop()}},z,null,[[1,15]])}))},[S,l==null?void 0:l.id,c,p,J]);return[X,{form:c,submitting:I}]}var E=Z,L=["detailedAddress","contactInfo"],Y=[{label:"\u4E0D\u5904\u7406",value:"NONE"},{label:"\u81EA\u52A8\u5206\u914D",value:"AUTO"},{label:"\u5BA2\u6237\u5206\u914D",value:"ASSIGN"}];function de(l){var t=l.form;return(0,u.useEffect)(function(){var c=l.data;c.id||t.resetFields(),console.log("CustomerForm",c),t.setFieldsValue(s()({},c))},[t,l.data]),(0,r.jsxs)(e.Form,{form:t,children:[(0,r.jsx)(e.Row,{children:(0,r.jsx)(e.Col,{span:9,children:(0,r.jsx)(e.Form.Item,{name:"name",className:"d-flex flex-column mb-7",required:!0,label:"\u540D\u79F0",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u5BA2\u6237\u540D\u79F0"}],children:(0,r.jsx)(e.Input,{solid:!0})})})}),(0,r.jsx)(e.Row,{children:(0,r.jsx)(e.Col,{span:9,children:(0,r.jsx)(e.Form.Item,{name:["contactInfo","address"],className:"d-flex flex-column mb-7",required:!0,label:"\u5730\u5740",children:(0,r.jsx)(e.RegionPicker,{solid:!0,resultType:"object",ends:"district",placeholder:"--\u8BF7\u9009\u62E9--"})})})}),(0,r.jsx)(e.Row,{children:(0,r.jsx)(e.Col,{span:9,children:(0,r.jsx)(e.Form.Item,{name:"detailedAddress",className:"d-flex flex-column mb-7",required:!0,label:"\u8BE6\u7EC6\u5730\u5740",children:(0,r.jsx)(e.Input.TextArea,{solid:!0,autoSize:{minRows:1}})})})}),(0,r.jsx)(e.Row,{children:(0,r.jsx)(e.Col,{span:9,children:(0,r.jsx)(e.Form.Item,{name:["contactInfo","name"],className:"d-flex flex-column mb-7",required:!0,label:"\u8054\u7CFB\u4EBA",children:(0,r.jsx)(e.Input,{solid:!0})})})}),(0,r.jsxs)(e.Row,{children:[(0,r.jsx)(e.Col,{span:6,children:(0,r.jsx)(e.Form.Item,{name:["contactInfo","phone"],className:"d-flex flex-column mb-7",required:!0,label:"\u7535\u8BDD",children:(0,r.jsx)(e.Input,{solid:!0})})}),(0,r.jsx)(e.Col,{span:6,children:(0,r.jsx)(e.Form.Item,{name:["contactInfo","email"],className:"d-flex flex-column mb-7",required:!0,label:"\u90AE\u7BB1",children:(0,r.jsx)(e.Input,{solid:!0})})})]}),(0,r.jsx)(e.Row,{children:(0,r.jsx)(e.Col,{span:9,children:(0,r.jsx)(e.Form.Item,{name:"ticketStrategy",className:"d-flex flex-column mb-7",required:!0,label:"\u670D\u52A1\u5355\u5904\u7406\u7B56\u7565",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u670D\u52A1\u5355\u5904\u7406\u7B56\u7565"}],children:(0,r.jsx)(O.ZP.Group,{options:Y})})})})]})}function ae(l){var t=l.data,c=l.visible,g=l.onClose,y=l.onSuccess,I=l.onDeleteSuccess,_=E(t,{transform:function(H){var ie=H.detailedAddress,J=H.contactInfo,X=A()(H,L);return console.log("transform",X),s()(s()({},X),{},{contactInfo:s()(s()({},J),{},{address:s()(s()({},J.address),{},{detailedAddress:ie})})})},onSubmitted:y}),C=w()(_,2),m=C[0],T=C[1],p=T.form,K=T.submitting,R=(0,u.useMemo)(function(){var S;return t?s()(s()({},t),{},{detailedAddress:(S=t.contactInfo)===null||S===void 0||(S=S.address)===null||S===void 0?void 0:S.detailedAddress}):{}},[t]),se=W(function(){return I(t)}),le=se.delete;return(0,r.jsx)(e.Drawer,{title:t!=null&&t.id?"\u7F16\u8F91":"\u65B0\u589E",placement:"right",width:640,mask:!0,closable:!0,onClose:g,visible:c,footer:(0,r.jsxs)(e.Row,{children:[(0,r.jsx)(e.Col,{span:6,children:(0,r.jsx)(e.Button,{style:{letterSpacing:"1rem"},className:"w-100",loading:K,onClick:m,children:"\u4FDD\u5B58"})}),(0,r.jsx)(e.Col,{span:6,children:(t==null?void 0:t.id)&&(0,r.jsx)(e.Button,{style:{letterSpacing:"1rem"},className:"w-100",variant:"light-danger",onClick:function(){return le(t)},children:"\u5220\u9664"})})]}),children:t&&(0,r.jsx)(de,{submitting:K,data:R,form:p,submit:m,onDeleteSuccess:I})})}var ce=ae,B=n(77521);function k(l){var t=l.data,c=l.onEdit,g=l.refetch,y=(0,u.useState)(!1),I=w()(y,2),_=I[0],C=I[1],m=W(g),T=m.delete,p=(0,u.useCallback)(function(K){var R=K.key;R==="edit"?c(t):R==="delete"&&T({name:t.name,id:t.id})},[]);return(0,r.jsx)(e.Dropdown,{overlay:(0,r.jsxs)(e.Menu,{onClick:p,className:"menu-sub menu-sub-dropdown menu-gray-600 menu-state-bg-light-primary fw-bold w-125px py-2",children:[(0,r.jsx)(e.Menu.Item,{url:"/crm/customers/".concat(t.id,"/information"),className:"px-3",children:"\u7BA1\u7406"},"manage"),(0,r.jsx)(e.Menu.Item,{className:"px-3",children:"\u7F16\u8F91"},"edit"),(0,r.jsx)(e.Menu.Item,{className:"actions-delete px-3",children:"\u5220\u9664"},"delete")]}),placement:"bottomRight",onVisibleChange:C,visible:_,children:(0,r.jsxs)(e.Button,{variant:"clean",activeColor:"light-primary",children:["\u64CD \u4F5C",(0,r.jsx)(f.ZP,{className:"ms-2 svg-icon-5 m-0",name:"Duotune/arr072"})]})})}function ue(){var l=(0,x.s0)(),t=(0,b.lr)(),c=w()(t,1),g=c[0],y=(0,u.useMemo)(function(){return(0,v.bp)(g,[{source:"q",target:"keywords"}])},[g.get("q")]);(0,u.useState)({keywords:g.get("q")||""});var I=(0,u.useMemo)(function(){return(0,v.bp)(g,[{source:"q",target:"where.name_contains"},{source:"sex",target:"where.sex"},{source:"page",transform:function(o){return parseInt(o)}},{source:"per_page",transform:function(o){return parseInt(o)}},{source:"sort",target:"orderBy",transform:function(o){var D=o.split(":"),V=w()(D,2),oe=V[0],G=V[1];return"".concat(oe,"_").concat(G)}}])},[g.toString()]),_=(0,v.ZP)(B.rq,{variables:I}),C=w()(_,2),m=C[0],T=C[1],p=T.loading,K=T.pageInfo,R=T.refetch,se=(0,u.useCallback)(function(h,o,D){var V=(0,v.Oh)({searchForm:y,pagination:h,filters:o,sorter:D},[{source:"searchForm.keywords",target:"q",skip:function(G){return!G}},{source:"pagination.current",target:"page",skip:function(G){return G===1}},{source:"pagination.pageSize",target:"per_page",skip:function(G){return G===15}},{source:"sorter.field",target:"sort",transform:function(G){return"".concat(G,":").concat(D.order==="ascend"?"asc":"desc")}}]);l(location.pathname+"?"+V,{replace:!0})},[y]),le=W(R),S=le.deleteMany,H=(0,u.useCallback)(function(h){l(location.pathname+(h?"?q="+h:""),{replace:!0})},[]),ie=(0,u.useCallback)(function(h){return N()(F()().mark(function o(){return F()().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:return V.next=2,S(h);case 2:case"end":return V.stop()}},o)}))},[S]),J=(0,u.useState)({visible:!1}),X=w()(J,2),z=X[0],M=X[1],q=(0,u.useCallback)(function(){M(function(h){return s()(s()({},h),{},{visible:!1})})},[]),ee=(0,u.useCallback)(function(h){M(function(o){return s()(s()({},o),{},{route:h})}),R()},[M]),he=(0,u.useCallback)(function(h){M(function(o){var D;return((D=o.data)===null||D===void 0?void 0:D.id)!==h.id?o:s()(s()({},o),{},{visible:!1,menu:void 0})}),R()},[M]),a=(0,u.useCallback)(function(){M(function(h){return s()(s()({},h),{},{visible:!0,data:{}})})},[]),_e=(0,u.useCallback)(function(h){M(function(o){return s()(s()({},o),{},{visible:!0,data:h})})},[]);return(0,r.jsxs)(i.vs,{header:{title:"\u5BA2\u6237\u7BA1\u7406"},children:[(0,r.jsx)(ce,{data:z.data,onClose:q,onSuccess:ee,onDeleteSuccess:he,visible:z.visible}),(0,r.jsxs)(e.Card,{className:"mb-5 mb-xl-10",children:[(0,r.jsxs)(e.Card.Header,{className:"pt-8",children:[(0,r.jsx)(e.Card.Title,{className:"flex-column",children:(0,r.jsx)(e.Input.Search,{solid:!0,defaultValue:y.keywords,className:"w-250px",placeholder:"\u5173\u952E\u8BCD\u641C\u7D22",onSearch:H})}),(0,r.jsx)(e.Card.Toolbar,{children:(0,r.jsx)("div",{children:(0,r.jsx)(e.Button,{onClick:a,className:"me-4 my-1",children:"\u65B0\u5EFA"})})})]}),(0,r.jsx)(e.Card.Body,{children:(0,r.jsx)(e.BlockUI,{overlayClassName:"bg-white bg-opacity-25",loading:p,children:(0,r.jsx)(e.Table,{hover:!0,rowKey:"id",rowSelection:{type:"checkbox",renderTitle:function(o){return(0,r.jsxs)(r.Fragment,{children:["\u5DF2\u9009\u4E2D",(0,r.jsx)("span",{className:"mx-2",children:o}),"\u4E2A"]})},toolbar:function(o){return(0,r.jsx)("div",{children:(0,r.jsx)(e.Button,{color:"danger",onClick:ie(o),variant:!1,children:"\u6279\u91CF\u5220\u9664"})})}},noRowsRenderer:function(){return(0,r.jsx)(e.Empty,{description:"\u5217\u8868\u6570\u636E\u4E3A\u7A7A",image:"/assets/media/illustrations/sigma-1/5.png"})},columns:[{key:"name",title:"\u540D\u79F0",sorter:!0,sortOrder:(0,d.PE)(g,"name")},{key:"contactInfo",title:"\u5730\u5740",width:180,render:function(o){var D;return o==null||(D=o.address)===null||D===void 0?void 0:D.fullAddress}},{key:"ticketStrategy",title:"\u5DE5\u5355\u7B56\u7565",width:130,render:function(o){var D={NONE:"\u4E0D\u5904\u7406",AUTO:"\u81EA\u52A8\u5206\u914D",ASSIGN:"\u5BA2\u6237\u5206\u914D"};return D[o]}},{title:"\u64CD\u4F5C",key:"action",width:120,render:function(o,D){return(0,r.jsx)(k,{data:D,refetch:R,onEdit:_e})}}],pagination:K,onChange:se,dataSource:m})})})]})]})}var me=ue}}]);

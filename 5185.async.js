"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[5185],{22287:function(Ce,B,a){a.r(B);var q=a(15009),L=a.n(q),ee=a(13769),ae=a.n(ee),te=a(99289),_e=a.n(te),ne=a(97857),c=a.n(ne),se=a(5574),M=a.n(se),s=a(62435),K=a(96974),le=a(64218),re=a(93967),ue=a.n(re),ie=a(30381),h=a.n(ie),de=a(73588),d=a(13757),I=a(12708),oe=a(25136),f=a(58496),W=a(42755),je=a(34545),_=a(86074),me=["meta","category","body","publishedAt"];function ce(){var F=(0,K.UO)(),ve=F.cid,O=F.id,S=(0,K.bx)(),r=S.categories,he=S.baseUrl,$=(0,s.useRef)(null),u=(0,s.useRef)({publishedAt:h()()}),Ee=(0,s.useReducer)(function(e){return e+1},0),be=M()(Ee,2),H=be[1],i=d.Form.useForm(),k=(0,W.V7)({fetchPolicy:"cache-and-network",variables:{id:O}}),g=k.data,fe=k.loading,t=g==null?void 0:g.article,pe=(0,s.useMemo)(function(){return!r||!r.length?[]:(0,I.G_)(r.map(function(e){return c()(c()({},e),{},{value:e.id,title:e.name})}),{idKey:"id",childrenKey:"children",pidKey:"parent.id",sort:function(l,n){return l.index-n.index}})},[r]),De=(0,W.Mq)(),N=M()(De,2),V=N[0],T=N[1].loading,Ae=(0,s.useState)(),Y=M()(Ae,2),ye=Y[0],G=Y[1],Pe=(0,s.useCallback)(function(e){var l,n=r.find(function(E){return E.id===e});G(n==null||(l=n.storeTemplate)===null||l===void 0?void 0:l.id)},[r]);(0,s.useEffect)(function(){var e;!r||!r.length||!t||G((e=r.find(function(l){var n;return l.id===((n=t.category)===null||n===void 0?void 0:n.id)}))===null||e===void 0||(e=e.storeTemplate)===null||e===void 0?void 0:e.id)},[t,r]);var p=(0,s.useCallback)(function(){var e=_e()(L()().mark(function l(n){var E,v,D,Z,z,C,j,J,R,A,x,b,y,U,P,o,X,w;return L()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return u.current.action=n,m.next=3,(E=$.current)===null||E===void 0?void 0:E.uploadAll();case 3:return m.next=5,i.validateFields();case 5:for(v=m.sent,D=v.meta,Z=v.category,z=v.body,C=v.publishedAt,j=ae()(v,me),J={seo_title:"single_line_text_field",seo_description:"multi_line_text_field",seo_keywords:"list.single_line_text_field"},R=[],A=0,x=Object.keys(D);A<x.length;A++)for(b=x[A],y=0,U=Object.keys(D[b]);y<U.length;y++)P=U[y],R.push({namespace:b,key:P,value:D[b][P],type:J[b+"_"+P]});return o=c()(c()({},j),{},{metafields:R,category:Z.id,body:{type:"HTML",text:z.text}}),n==="publish"?o.status="PUBLISHED":n==="schedule"||n==="reschedule"?(o.status="SCHEDULED",o.publishedAt=C):n==="unpublish"||n==="revert_to_draft"?o.status="DRAFT":n==="update"&&(o.status=t==null?void 0:t.status,o.publishedAt=C),X=V({variables:{id:O,input:o}}),m.next=19,d.Toast.promise((0,I.gw)(X,350),{pending:"\u63D0\u4EA4\u4E2D...",success:"\u201C".concat(j.title,"\u201D \u4FDD\u5B58\u6210\u529F"),error:"\u63D0\u4EA4\u51FA\u9519"},{duration:2e3,placement:"top-center"});case 19:w=m.sent,console.log("submit result set",w);case 21:case"end":return m.stop()}},l)}));return function(l){return e.apply(this,arguments)}}(),[i,V,O,t==null?void 0:t.status]),Q=u.current.publishedAt,Me=(0,s.useCallback)(function(e){u.current.publishedAt=e,i.setFieldsValue({publishedAt:e}),H()},[i]);(0,s.useEffect)(function(){var e;t&&(t.publishedAt&&(u.current.publishedAt=h()(t.publishedAt)),u.current.article=t,i.setFieldsValue(c()(c()({},t),{},{publishedAt:u.current.publishedAt,image:(e=t.image)===null||e===void 0?void 0:e.id})))},[t,i]);var Oe=(0,s.useCallback)(function(){p("update")},[p]),ge=(0,s.useCallback)(function(e){p(e)},[p]),Te=(0,s.useCallback)(function(){var e=u.current.article,l=e!=null&&e.publishedAt?h()(e.publishedAt):h()();u.current.publishedAt=l,H(),i.setFieldsValue({publishedAt:l})},[i]);return console.log("storeTemplate",ye,Q),(0,_.jsx)(de.vs,{loading:fe,header:{title:"\u7F16\u8F91\u6587\u7AE0"},children:(0,_.jsxs)(d.Form,{form:i,initialValues:{status:"DRAFT",channel:ve},className:"form d-flex flex-column flex-lg-row",children:[(0,_.jsxs)("div",{className:"d-flex flex-column flex-row-fluid gap-7 gap-lg-10  me-lg-10",children:[(0,_.jsxs)(d.Tabs,{defaultActiveKey:"general",contentContainer:!1,className:"border-0 fs-4 fw-bold mb-n2 nav-line-tabs-2x",children:[(0,_.jsx)(d.Tabs.TabPane,{tab:"\u57FA\u672C\u4FE1\u606F",forceRender:!0,children:(0,_.jsx)(f.LQ,{queueUpload:$})},"general"),(0,_.jsx)(d.Tabs.TabPane,{tab:"\u9AD8\u7EA7\u8BBE\u7F6E",forceRender:!0,children:(0,_.jsx)(f.aE,{})},"advanced"),(0,_.jsx)(d.Tabs.TabPane,{tab:"\u5143\u6570\u636E",forceRender:!0,children:(0,_.jsx)(f.SF,{})},"meta")]}),(0,_.jsx)(le.Z,{offsetBottom:16,children:(0,_.jsxs)("div",{className:ue()("d-flex bg-body-color p-5 mx-4 tw-rounded-2xl align-items-center"),children:[(0,_.jsx)("div",{className:"text-primary flex-row-fluid",children:(t==null?void 0:t.status)==="SCHEDULED"&&(0,_.jsxs)(_.Fragment,{children:["\u5C06\u4E8E"," ",h()(t.publishedAt).format("YYYY \u5E74 MM \u6708 DD \u65E5 HH:mm")," ","\u53D1\u5E03"]})}),(t==null?void 0:t.status)==="DRAFT"&&(0,_.jsx)(d.Button,{variant:"light",loading:u.current.action==="update"&&T,onClick:Oe,className:"me-5",children:u.current.action==="update"&&T?"\u4FDD\u5B58\u4E2D...":"\u4FDD\u5B58\u8349\u7A3F"}),(0,_.jsx)(f.H5,{article:t,onPublish:ge,publishedAt:Q,submitting:T,setPublishedAt:Me,onCancel:Te})]})})]}),(0,_.jsx)(oe.Z,{baseUrl:he,article:t,categoryTreeData:pe,onChangeCategory:Pe})]})})}B.default=ce}}]);

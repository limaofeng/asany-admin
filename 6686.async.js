"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[6686],{97961:function(we,he,t){t.d(he,{$F:function(){return Y},$M:function(){return ve},Cd:function(){return ye},Co:function(){return n},Dw:function(){return H},Oo:function(){return f},a7:function(){return r},cu:function(){return j},j7:function(){return je},jA:function(){return U},jf:function(){return se},oJ:function(){return L},rF:function(){return S},rl:function(){return u}});var A=t(51056),ee="UPDATEFRIENDCARD",ve="TOASSIGNCVE",Y="RESETCVE",i="OPENSINGLEMODAL",z="OPENGROUPMODAL",ye="DELETEMESSAGE",se="ISSETDRAFT",S="REVOKEMSG",j="REPLAYMSG",f="FORWARDANDMERMSG",U="SENDFORWARDMSG",u="MUTILMSG",n="MUTILMSGCHANGE",r="MERMSGMODAL",L="ATSTATEUPDATE",h="ANTDLOCALCHANGE",F="APPLICATIONTYPEUPDATE",T="CLEARSEARCHINPUT",H=[A.Cs.PictureMessage,A.Cs.VideoMessage,A.Cs.VoiceMessage,A.Cs.FileMessage],je={RevokeMessage:A.Cs.RevokeMessage,FriendAdded:A.Cs.FriendAdded,GroupCreated:A.Cs.GroupCreated,GroupNameUpdated:A.Cs.GroupNameUpdated,GroupOwnerTransferred:A.Cs.GroupOwnerTransferred,MemberQuit:A.Cs.MemberQuit,MemberInvited:A.Cs.MemberInvited,MemberKicked:A.Cs.MemberKicked,MemberEnter:A.Cs.MemberEnter}},78864:function(we,he,t){var A=t(17187),ee=t.n(A),ve=new A.EventEmitter;ve.setMaxListeners(12),he.Z=ve},36603:function(we,he,t){t.d(he,{LF:function(){return j},RD:function(){return z},RT:function(){return ve},Sv:function(){return ye},Tf:function(){return se},_x:function(){return S},p6:function(){return Y},sc:function(){return f},vJ:function(){return ee}});var A=t(51056),ee=function(u){return u.userID!==""&&u.groupID===""},ve=function(u){var n=window.getSelection(),r=document.createRange();r.selectNodeContents(u.current),r.collapse(!1),n==null||n.removeAllRanges(),n==null||n.addRange(r)},Y=function(u){var n=new Date(u),r=n.getFullYear(),L=n.getMonth()+1,h=n.getDate(),F=n.getHours(),T=n.getMinutes();T.toString().length===1&&(T="0"+T);var H=n.getSeconds();H.toString().length===1&&(H="0"+H);var je=r+"-"+L+"-"+h,e=F+":"+T;return[r,L,h,je,e]},i=function(u,n){axios.get(u,{headers:{"Content-Type":"application/x-www-form-urlencoded"},responseType:"blob"}).then(function(r){var L=new Blob([r.data]),h=n,F=document.createElement("a");F.download=h,F.style.display="none",F.href=URL.createObjectURL(L),document.body.appendChild(F),F.click(),URL.revokeObjectURL(F.href),document.body.removeChild(F)}).catch(function(r){console.log(r)})},z=function(u){if(u===0)return"0 B";var n=1024,r=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],L=Math.floor(Math.log(u)/Math.log(n));return(u/Math.pow(n,L)).toPrecision(3)+" "+r[L]},ye=function(u){var n=["jpeg","tiff","png","gif","jpg","gif"],r=["ppt","pptx"],L=["xlsx","xls"],h=["doc","docx"],F=["rar","zip"];return n.includes(u)?"file_pic":r.includes(u)?"file_ppt":L.includes(u)?"file_xslx":h.includes(u)?"file_world":F.includes(u)?"file_zip":u==="pdf"?"file_pdf":"file_unknow"},se=function(){var u=window.getSelection(),n=u.getRangeAt(0),r=document.createElement("br"),L=document.createTextNode("\xA0");n.deleteContents(),n.insertNode(r),n.collapse(!1),n.insertNode(L),n.selectNodeContents(L),u.removeAllRanges(),u.addRange(n),document.execCommand("delete")},S=function(u){for(var n=u.split(","),r=n[0].match(/:(.*?);/)[1],L=atob(n[1]),h=L.length,F=new Uint8Array(h);h--;)F[h]=L.charCodeAt(h);return new File([F],"screenshot".concat(Date.now(),".png"),{type:r})},j=function(u,n){var r=function(p){return p===n};switch(u.contentType){case A.Cs.TextMessage:return u.content;case A.Cs.AtTextMessage:return u.atTextElem.text;case A.Cs.PictureMessage:return"PictureMessage";case A.Cs.VideoMessage:return"VideoMessage";case A.Cs.VoiceMessage:return"VoiceMessage";case A.Cs.LocationMessage:return"LocationMessage";case A.Cs.CardMessage:return"CardMessage";case A.Cs.MergeMessage:return"MergeMessage";case A.Cs.FileMessage:return"FileMessage";case A.Cs.RevokeMessage:return"".concat(r(u.sendID)?"\u4F60":u.senderNickname,"\u64A4\u56DE\u4E86\u4E00\u6761\u6D88\u606F");case A.Cs.CustomMessage:return"CustomMessage";case A.Cs.QuoteMessage:return"QuoteMessage";case A.Cs.FriendAdded:return"AlreadyFriend";case A.Cs.MemberEnter:{var L=JSON.parse(u.notificationElem.detail),h=L.entrantUser;return"".concat(r(h.userID)?"You":h.nickname,"JoinedGroup")}case A.Cs.GroupCreated:{var F=JSON.parse(u.notificationElem.detail),T=F.opUser;return"".concat(r(T.userID)?"You":T.nickname,"GroupCreated")}case A.Cs.MemberInvited:{var H,je=JSON.parse(u.notificationElem.detail),e=je.opUser,He=(H=je.invitedUserList)!==null&&H!==void 0?H:[],Le="";return He.forEach(function(Ae){return Le+=(r(Ae.userID)?"You":Ae.nickname)+" "}),"".concat(r(e.userID)?"You":e.nickname,"Invited").concat(Le,"IntoGroup")}case A.Cs.MemberKicked:{var m,Ce=JSON.parse(u.notificationElem.detail),oe=Ce.opUser,Ie=(m=Ce.kickedUserList)!==null&&m!==void 0?m:[],x="";return Ie.forEach(function(Ae){return x+=(r(Ae.userID)?"You":Ae.nickname)+" "}),"".concat(r(oe.userID)?"You":oe.nickname,"Kicked").concat(x,"OutGroup")}case A.Cs.MemberQuit:{var ce=JSON.parse(u.notificationElem.detail),Ge=ce.quitUser;return"".concat(r(Ge.userID)?"You":Ge.nickname,"QuitedGroup")}default:return u.notificationElem.detail}},f=function(u,n,r){if(Notification&&document.hidden){var L,h=u.contentType===A.Cs.FriendAdded?"FriendNotice":u.senderNickname,F=new Notification(h,{dir:"auto",tag:(L=r!=null?r:u.groupID)!==null&&L!==void 0?L:u.sendID,renotify:!0,icon:u.senderFaceUrl,body:j(u),requireInteraction:!0}),T=u.sessionType===A.FF.Single?u.contentType===A.Cs.FriendAdded?u.recvID:u.sendID:u.groupID;F.onclick=function(){n&&n(T,u.sessionType),F.close()}}}},15132:function(we,he,t){t.d(he,{Z:function(){return Gt}});var A=t(64599),ee=t.n(A),ve=t(5574),Y=t.n(ve),i=t(62435),z=t(46027),ye=t(50603),se=t(93967),S=t.n(se),j=t(73588),f=t(79817),U=t(36603),u=t(10582),n=t(97961),r=t(78864),L=t(15009),h=t.n(L),F=t(99289),T=t.n(F),H=t(1861),je=t(27856),e=t(86074),He=function(d,a){var v,s=d.data,l=d.fetchMoreData,b=d.hasMore,M=d.children,E=d.loading,k=d.holdHeight,J=k===void 0?30:k,V=(0,i.useRef)(null),Z=(v=V.current)===null||v===void 0?void 0:v.osInstance(),te=(0,i.useRef)({scrollTop:0,contentHeight:0});(0,i.useImperativeHandle)(a,function(){return Z},[Z]);var ie=(0,i.useCallback)(function(){var I=T()(h()().mark(function w(le){var N;return h()().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(N=J!=null?J:30,te.current.contentHeight=le.target.scrollHeight,te.current.scrollTop=le.target.scrollTop,!(le.target.scrollTop<N)){_.next=7;break}if(!(E||!b)){_.next=6;break}return _.abrupt("return");case 6:requestAnimationFrame(l);case 7:case"end":return _.stop()}},w)}));return function(w){return I.apply(this,arguments)}}(),[l,b,J,E]),ae=(0,je.P)(500,ie);return(0,e.jsxs)(H.E,{ref:V,className:"d-flex h-100 flex-column custom-scrollbar pe-9 pt-8",options:{scrollbars:{autoHide:"scroll"},callbacks:{onScroll:ae,onContentSizeChanged:function(w){if(w){if(!Z){setTimeout(function(){var N;(N=V.current)===null||N===void 0||(N=N.osInstance())===null||N===void 0||N.scroll({y:"100%"})});return}if(Z.scroll().max.y===0)Z.scroll({y:"100%"});else if(te.current.contentHeight){var le=w.height-te.current.contentHeight;Z.scroll({y:le+te.current.scrollTop})}}}}},children:[M,b?(0,e.jsx)("div",{className:S()("scroll-view-spin","d-flex align-items-center justify-content-center","fs-6",{"flex-column-fluid":s.length===0,"h-40px":s.length!==0}),children:(0,e.jsx)(f.Spin,{tip:"\u52A0\u8F7D\u4E2D...",indicator:"Loading",size:"small"})}):(0,e.jsx)("div",{className:"con_nomore",children:"\u6CA1\u6709\u66F4\u591A\u5566~"})]})},Le=i.forwardRef(He),m=t(97857),Ce=t.n(m),oe=t(42532),Ie=t(96522),x=t(51056),ce=t(65956),Ge=t(86366),Ae=[x.Cs.TextMessage,x.Cs.AtTextMessage],p=[x.Cs.PictureMessage,x.Cs.VideoMessage,x.Cs.FileMessage],tt=function(d){var a,v,s,l=d.msg,b=d.isSelf,M=d.children,E=(0,i.useState)(!1),k=Y()(E,2),J=k[0],V=k[1],Z=["Copy","Translate","Reply","Forward"],te=(0,Ge.Z)(),ie=Y()(te,2),ae=ie[1],I=function(){r.Z.emit(n.Oo,"forward",JSON.stringify(l))},w=function(){r.Z.emit(n.rl,!0)},le=function(){r.Z.emit(n.cu,l)},N=(0,i.useCallback)(function(){ce.S.revokeMessage(l).then(function(G){r.Z.emit(n.rF,l.clientMsgID),console.log("res",G)}).catch(function(G){return f.Toast.error("\u64A4\u56DE\u6D88\u606F\u5931\u8D25\uFF01",G)})},[l]),Me=(0,i.useCallback)(function(){console.log("msg",l),ce.S.deleteMessageFromLocalStorage(JSON.stringify(l)).then(function(G){r.Z.emit(n.Cd,l.clientMsgID),console.log("res",G)}).catch(function(G){return f.Toast.error("\u5220\u9664\u6D88\u606F\u5931\u8D25\uFF01"+G.message)})},[l]),_=(0,i.useCallback)(T()(h()().mark(function G(){var W;return h()().wrap(function(be){for(;;)switch(be.prev=be.next){case 0:return V(!1),be.next=3,f.Modal.confirm({title:"\u5220\u9664\u6D88\u606F",content:(0,e.jsx)(e.Fragment,{children:(0,e.jsx)("p",{className:"tip-confirm",children:"\u786E\u5B9A\u5220\u9664\u8BE5\u6D88\u606F\u5417\uFF1F"})}),icon:"info",okText:"\u5220\u9664"});case 3:W=be.sent,W.isConfirmed&&Me();case 5:case"end":return be.stop()}},G)})),[Me]),Ee=(0,i.useCallback)(function(){var G="";switch(l.contentType){case x.Cs.PictureMessage:G=l.pictureElem.sourcePicture.url;break;case x.Cs.VideoMessage:G=l.videoElem.videoUrl;break;case x.Cs.FileMessage:G=l.fileElem.sourceUrl;break;default:break}var W=G.lastIndexOf("/"),Fe=G.slice(W+1);downloadFileUtil(G,Fe)},[l.contentType,(a=l.fileElem)===null||a===void 0?void 0:a.sourceUrl,(v=l.pictureElem)===null||v===void 0||(v=v.sourcePicture)===null||v===void 0?void 0:v.url,(s=l.videoElem)===null||s===void 0?void 0:s.videoUrl]),xe=(0,i.useMemo)(function(){return[{id:"Translate",title:"\u7FFB\u8BD1",icon:"Bootstrap/translate",method:function(){},hidden:!0},{id:"Forward",title:"\u8F6C\u53D1",icon:"Bootstrap/arrow-up-right-square",method:I,hidden:!1},{id:"Copy",title:"\u590D\u5236",icon:"Bootstrap/clipboard2",method:function(){var W=l.contentType===messageTypes.ATTEXTMESSAGE?l.atElem.text:l.content;ae(W),f.Toast.success("\u590D\u5236\u6210\u529F\uFF01"),V(!1)},hidden:!1},{id:"Multiple",title:"\u591A\u9009",icon:"Bootstrap/list-check",method:w,hidden:!1},{id:"Reply",title:"\u5F15\u7528",icon:"Bootstrap/chat-quote",method:le,hidden:!1},{id:"Revoke",title:"\u64A4\u56DE",icon:"Bootstrap/arrow-90deg-down",method:N,hidden:!1},{id:"Delete",title:"\u5220\u9664",icon:"Bootstrap/trash",method:_,hidden:!1},{id:"Download",title:"\u4E0B\u8F7D",icon:"Bootstrap/download",method:Ee,hidden:!1}]},[ae,_,Ee,I,l.atElem.text,l.content,l.contentType,le,N]),Te=function(W){return!Ae.includes(l.contentType)&&Z.includes(W.id)&&(W.hidden=!0),W.id==="Download"&&!p.includes(l.contentType)&&(W.hidden=!0),!b&&W.id==="Revoke"&&(W.hidden=!0),!W.hidden&&(0,e.jsx)(f.Menu.Item,{icon:(0,e.jsx)(z.JO,{name:W.icon,className:"svg-icon-6"}),className:"px-3",onClick:W.method,children:W.title},W.id)};return(0,e.jsx)(f.Popover,{trigger:"contextMenu",visible:J,onVisibleChange:V,content:(0,e.jsx)(f.Menu,{className:"menu-sub show menu-sub-dropdown show menu-gray-600 menu-state-bg-light-primary fw-bold fs-8 w-125px py-2",children:xe.map(Te)}),overlayClassName:"overlay-no-arrow msg_item_menu_popover",children:(0,e.jsx)("div",{className:S()("chat_bg_msg_content py-3",{"ps-4 pe-8":!b,"ps-8 pe-4":b}),children:M})})},gt=tt,Ke=t(6366),ht=t(12845),We=t(3030),xt=t(30381),pt=t.n(xt),nt=[{context:"[\u6655]",src:""}],at="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAAUCAYAAABWMrcvAAAAAXNSR0IArs4c6QAAAk5JREFUOE+N081LFHEYB/Dvd9wMk0p3dsid1fIkduhUl0jIoDckDx2MOnSKPCU6o5KBkCG9ic4u1CUr6FQHQyqK3CCMBAPpXwjsZWdNZ3YxJXHNeWLH3HZTqzk+z3z4/p7fPEP8+dSPBvS9ezoo/JCw1KE1fQDML5Y3p7ZvKfWegKgXoM+2Qhf/iiqNzyWCklEh9wnQkbTU2HogW8sl6ebMXQrPeSLNyZh2byOQQ3pb6gDojYFy37a08/mgwkgfpAJJDpS/Xa37SRHTfSGQukBxoPrTjbL0ajNiuqaI9BMykohqDTlU0TKnKZsWbQB3bCt0YbWht7pHUIQRQF4vzCtN6cHgbA6FDeekQgx75PHkgBrPS5kApHJhibWpW+q3/CMzbDqXFODaYkYizm0tmwi9NbWTRTIp9HrtAe1ythZuc3aT0gSv6AF1w7lOokvmM6X2oP7dR4Z7lJQ4oDQmrOBzf27DGQexH8JhRgynG0TvD2Xzjq/9W6cLkTQmLM1HuuH2gdJOsJO6kTpNeo+WPTk0FdPe+EdpT+9SZHlSwCu2pfbk5mmSYgwxQ910qyDyEfTXpit3e+bMe4LhxYDUOn3aXMFF+NGmOwZ4NYqEqr9EubCS5h6jJy9BxjMB71Q+9D+ubsw0knwG4GrCCnXn0oxUJ+HdFMi4HdXqCjZiBTpZ1CDgiWRUHfkNncOesGwqpj5egyqN2aAwM5H1IjxjR0NP/7nlv2arAvAKQA2EZ+1o8OF6sOAnzL4QbHG3lQS8niVRhqZj6rv/QhsdKb/+E7En8byRi/iIAAAAAElFTkSuQmCC",Ct="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAATCAYAAABLN4eXAAAAAXNSR0IArs4c6QAAAiBJREFUOE+Fk0toU1EQhv+5oVINKrgIJAQtuCgkEHLPCQaFiiLYik+KXehKUHErIhWUYgUXFR8rV4orF4LFlaX4AhUqLpIzN5vEIgFfKZKNaEBKQ3JGTkkgMaQ9y5/5ZuafmUPo87TWEwB2GmPuAGh0hlE/SCl1i4gmAbwDcMIY86cd2xdyAUqpi0TkKuWr1er+SqWy7PQ1IRegtT4H4AGAR8aY8z2Q7/t7XaIgCN53tq21figiZ621I4VC4UNXJaXUPIAxEbkcBMG9NphMJrcNDg5+AbBgjDncBWmttwKYFZEDnueN5fP5121QKXWfiC5Ya2M9nrLZ7JZGo7EoIhVm3tUBjRLRCxEZJ631dgBnRGSWmT+1zN8AMAVgyBjz3Wm+78c8z1sCcJWUUs+IaFxEPjLzntaojxDRcwCjxphXTovFYpui0ehfADOu0iURuQ3gLjO7Zbr99ECpVCoyMDBQtdZOrXpKJBIbSqVSvaP/aSK6bq0dCoLgm9PT6fS+UCj01lp7qmcQw8PDm8Ph8CKAn8ycaSfSWs+IyGS9Xt/RBbWAp84LgEPM/NJB8Xh8YyQS+UpEn40xI//vaUFE3DCuMLPzufqUUjeJ6JqIHGXmuS4ok8mcbDabv4MgeNMBjBHRnIjMM/OxdQ82nU4fD4VCT0RkaWVlJVssFn+tCWmtT4vIY+fD87yDuVzux7r/yff93UQ0UavVpsvlcq3z6v8BSUzmcN/zXjIAAAAASUVORK5CYII=",Ve=function(d){var a=d.msg,v=d.audio,s=d.curCve,l=d.selfID,b=(0,i.useState)(!1),M=Y()(b,2),E=M[0],k=M[1],J=(0,ht.useModel)("open-im.contacts",function(re){var Q=re.state;return Q.groupMemberList}),V=(0,i.useRef)(null),Z=(0,i.useState)({}),te=Y()(Z,2),ie=te[0],ae=te[1],I=(0,i.useRef)();(0,i.useEffect)(function(){var re;k(s?(0,U.vJ)(s):!1),((re=V.current)===null||re===void 0?void 0:re.clientHeight)>60&&ae({paddingBottom:"16px",paddingRight:"8px"})},[s]);var w=function(Q){return l===Q},le=function(Q){var g=Q,X=/@\S+\s/g,ge=g.match(X)||[],$=ee()(ge),ue;try{var de=function(){var Ne=ue.value,ke=J.find(function(Ue){return Ue.userID===Ne.slice(1,-1)});ke?g=g.replaceAll(Ne,`<span onclick='userClick("`.concat(ke.userID.replace(".","-"),`")' style="color:#428be5;cursor: pointer;"> @`).concat(ke.nickname," </span>")):g=g.replaceAll(Ne,`<span onclick="userClick('`.concat(Ne.slice(1,-1),`')" style="color:#428be5;cursor: pointer;"> `).concat(Ne,"</span>"))};for($.s();!(ue=$.n()).done;)de()}catch(Re){$.e(Re)}finally{$.f()}return g},N=function(Q){return pt()(a.sendTime).format(Q?"HH:mm":"YYYY-MM-DD HH:mm")},Me=function(Q,g){r.Z.emit(n.a7,Q,g)},_=function(){var Q=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"chat_bg_msg_content_time";return(0,e.jsx)(f.Tooltip,{placement:"bottom",inverse:!0,title:N(0),children:(0,e.jsx)("div",{className:Q,children:N(1)})})},Ee=function(Q){var g=Q,X=ee()(nt),ge;try{for(X.s();!(ge=X.n()).done;){var $=ge.value,ue=g.indexOf($.context);ue>-1&&(g=g.replaceAll($.context,'<img style="padding-right:2px" width="24px" src='.concat($.src," />")))}}catch(de){X.e(de)}finally{X.f()}return g},xe=function(Q){var g=Q.replaceAll("\\n","<br>");return g.replaceAll(`
`,"<br>")},Te=function(Q){var g=Q,X=/[(http(s)?):\/\/(www\.)?a-zA-Z0-9@:._\+-~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:_\+.~#?&\/\/=]*)/g,ge=g.match(X)||[],$=ee()(ge),ue;try{for($.s();!(ue=$.n()).done;){var de=ue.value;g=g.replaceAll(de,`<a onclick="urlClick('`.concat(de,`')" href="javascript:;">`).concat(de,"</a>"))}}catch(Re){$.e(Re)}finally{$.f()}return g},G=function(Q){switch(Q.contentType){case x.Cs.TextMessage:{var g=xe(Te(le(Ee(Q.content))));return(0,e.jsx)("div",{className:"content",dangerouslySetInnerHTML:{__html:g}})}case x.Cs.AtTextMessage:return le(Q.atTextElem.text);case x.Cs.PictureMessage:return(0,e.jsx)(We.Z,{width:60,src:Q.pictureElem.sourcePicture.url});default:return""}},W=function(Q){var g;v.current.src=Q,(g=v.current)===null||g===void 0||g.play()},Fe=function(Q){I.current=Q,Q.on("waiting",function(){console.log("player is waiting")}),Q.on("dispose",function(){console.log("player will dispose")})},be=function(){var Q;switch(a.contentType){case x.Cs.TextMessage:{var g=a.content;return g=Ee(g),g=Te(g),g=xe(g),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{ref:V,style:ie,className:"chat_bg_msg_content_text ".concat(E?"":"nick_magin"),children:(0,e.jsx)("div",{dangerouslySetInnerHTML:{__html:g}})}),_()]})}case x.Cs.AtTextMessage:{var X=a.atTextElem.text;return X=Ee(X),X=le(X),X=Te(X),X=xe(X),(0,e.jsxs)("div",{style:ie,className:"chat_bg_msg_content_text ".concat(E?"":"nick_magin"),children:[(0,e.jsx)("div",{style:{display:"inline-block"},dangerouslySetInnerHTML:{__html:X}}),_()]})}case x.Cs.PictureMessage:return(0,e.jsxs)("div",{className:"chat_bg_msg_content_pic ".concat(E?"":"nick_magin"),children:[(0,e.jsx)(We.Z,{placeholder:!0,height:200,src:(Q=a.pictureElem.snapshotPicture.url)!==null&&Q!==void 0?Q:a.pictureElem.sourcePicture.url,preview:{visible:!1},fallback:"data:image/png;base64,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"}),_("pic_msg_time")]});case x.Cs.VoiceMessage:{var ge=w(a.sendID),$=ge?{paddingLeft:"4px"}:{paddingRight:"4px"},ue=ge?at:Ct;return(0,e.jsxs)("div",{style:ie,className:"chat_bg_msg_content_text chat_bg_msg_content_voice ".concat(E?"":"nick_magin"),children:[(0,e.jsxs)("div",{style:{flexDirection:ge?"row-reverse":"row"},onClick:function(){return W(a.soundElem.sourceUrl)},children:[(0,e.jsx)("img",{style:$,src:ue,alt:""}),"".concat(a.soundElem.duration," ''")]}),_()]})}case x.Cs.FileMessage:{var de=a.fileElem,Re=de.fileName.slice(de.fileName.lastIndexOf(".")+1);return(0,e.jsxs)("div",{className:"chat_bg_msg_content_text chat_bg_msg_content_file ".concat(E?"":"nick_magin"),children:[(0,e.jsxs)("div",{className:"file_container",children:[(0,e.jsx)("img",{src:(0,U.Sv)(Re),alt:""}),(0,e.jsxs)("div",{className:"file_info",children:[(0,e.jsx)("div",{children:de.fileName}),(0,e.jsx)("div",{children:(0,U.RD)(de.fileSize)})]})]}),_()]})}case x.Cs.VideoMessage:{var Ne={width:240,controls:!0,playbackRates:[.5,1,1.25,1.5,2],responsive:!0,fluid:!0,sources:[{src:a.videoElem.videoUrl,type:"video/mp4"}]};return(0,e.jsxs)("div",{className:"chat_bg_msg_content_video ".concat(E?"":"nick_magin"),children:[(0,e.jsx)(f.VideoPlayer,{options:Ne,onReady:Fe}),_("video_msg_time")]})}case x.Cs.QuoteMessage:{var ke=a.quoteElem.quoteMessage,Ue=a.quoteElem.text;return Ue=xe(Te(Ee(Ue))),(0,e.jsxs)("div",{style:ie,className:"chat_bg_msg_content_text chat_bg_msg_content_qute ".concat(E?"":"nick_magin"),children:[(0,e.jsxs)("div",{className:"qute_content",children:[(0,e.jsx)("div",{children:"".concat("Reply"+a.quoteElem.quoteMessage.senderNickname,":")}),G(ke)]}),(0,e.jsx)("div",{dangerouslySetInnerHTML:{__html:Ue}}),_()]})}case x.Cs.MergeMessage:{var _e,Je=a.mergeElem;return(0,e.jsxs)("div",{style:ie,onClick:function(){return Me(Je,a.sendID)},className:"chat_bg_msg_content_text chat_bg_msg_content_mer ".concat(E?"":"nick_magin"),children:[(0,e.jsx)("div",{className:"title",children:Je.title}),(0,e.jsx)("div",{className:"content",children:(_e=Je.abstractList)===null||_e===void 0?void 0:_e.map(function(y){return(0,e.jsx)("div",{className:"item",children:y},y)})}),_()]})}case x.Cs.CardMessage:{var pe=JSON.parse(a.content);return(0,e.jsxs)("div",{style:ie,className:"chat_bg_msg_content_text chat_bg_msg_content_card ".concat(E?"":"nick_magin"),children:[(0,e.jsx)("div",{className:"title",children:"IDCard"}),(0,e.jsxs)("div",{className:"desc",children:[(0,e.jsx)(f.Symbol.Avatar,{src:pe.faceURL,size:35}),(0,e.jsx)("div",{className:"card_nick",children:pe.nickname})]}),_()]})}case x.Cs.LocationMessage:{var ft=a.locationElem,qe={longitude:ft.longitude,latitude:ft.latitude};return(0,e.jsxs)("div",{className:"chat_bg_msg_content_map ".concat(E?"":"nick_magin"),children:[(0,e.jsx)(Ke.D5,{protocol:"https",center:qe,amapkey:"dcdc861728801ee3410f67f6a487d3fa",children:(0,e.jsx)(Ke.Jx,{position:qe})}),_("pic_msg_time")]})}default:return(0,e.jsx)("div",{className:"chat_bg_msg_content_text ".concat(E?"":"nick_magin"),children:"UnsupportedMessage"})}};return be()},yt=Ve,At=[x.Cs.TextMessage,x.Cs.AtTextMessage,x.Cs.PictureMessage,x.Cs.VideoMessage,x.Cs.VoiceMessage,x.Cs.CardMessage,x.Cs.FileMessage,x.Cs.LocationMessage],rt=function(d){var a=d.msg,v=d.selfID,s=d.curCve,l=d.mutilSelect,b=d.className,M=(0,i.useState)(!1),E=Y()(M,2),k=E[0],J=E[1],V=(0,i.useRef)(null),Z=(0,i.useRef)(null),te=(0,oe.Z)(Z),ie=Y()(te,1),ae=ie[0],I=(0,i.useMemo)(function(){return v===a.sendID},[v,a.sendID]),w=(0,i.useMemo)(function(){return!s||!(0,U.vJ)(s)},[s]);(0,i.useEffect)(function(){k&&J(!1)},[l]);var le=function(xe,Te){a.isRead=!0,ce.S.markC2CMessageAsRead({userID:xe,msgIDList:[Te]})};(0,i.useEffect)(function(){ae&&s.userID===a.sendID&&!a.isRead&&le(a.sendID,a.clientMsgID)},[ae,s]);var N=(0,i.useCallback)(function(){switch(a.status){case 1:return(0,e.jsx)(e.Fragment,{children:"loading..."});case 2:return s&&(0,U.vJ)(s)?a.isRead?"\u5DF2\u8BFB":"\u672A\u8BFB":null;case 3:return(0,e.jsx)(e.Fragment,{});default:return null}},[s,a.isRead,a.status]),Me=function(){l&&At.includes(a.contentType)&&(r.Z.emit(n.Co,!k,a),J(function(xe){return!xe}))},_=function(){(0,U.vJ)(s)||r.Z.emit(n.oJ,a.sendID,a.senderNickname)};return(0,Ie.Z)(_,V,{onClick:function(){},delay:500}),(0,e.jsx)("div",{ref:Z,onClick:Me,className:S()("msg-item d-flex mb-10",b,{"justify-content-start":!I,"justify-content-end":I,"mt-4":I}),children:(0,e.jsxs)("div",{className:S()("d-flex align-items-start",{"flex-column":w,"flex-row-reverse":I&&!w,"flex-row":!I&&!w}),children:[(0,e.jsxs)("div",{className:S()("d-flex align-items-center mb-2"),children:[(0,e.jsx)(f.Symbol.Avatar,{className:S()({"me-4":!I&&!w,"ms-4":I&&!w}),light:!0,size:40,alt:a.senderNickname,src:a.senderFaceUrl}),w&&(0,e.jsxs)("div",{className:"ms-3",children:[(0,e.jsx)("a",{href:"#",className:"fs-5 fw-bold text-gray-900 text-hover-primary me-1",children:a.senderNickname}),(0,e.jsx)("span",{className:"text-muted fs-7 mb-1",children:"2 mins"})]})]}),(0,e.jsxs)("div",{className:S()("msg-item-content rounded text-dark fw-semibold mw-lg-400px text-start",{"bg-light-info":!I,"bg-light-primary":I}),children:[(0,e.jsx)(gt,{msg:a,isSelf:I,children:(0,e.jsx)(yt,Ce()({},d))},a.clientMsgID),I&&(0,e.jsx)("div",{style:{color:a.isRead?"#999":"#428BE5"},className:"self_msg_chat_flag",children:N()})]})]})})},Xe=rt;function st(D){var d,a=(0,i.useRef)(null),v=D.merID,s=D.msgList,l=D.loadMore,b=D.hasMore,M=D.curCve,E=D.loading,k=(0,i.useState)(!1),J=Y()(k,2),V=J[0],Z=J[1],te=(d=(0,u.ot)().data)===null||d===void 0?void 0:d.uid,ie=Object.values(n.j7),ae=function(Me){Z(Me)};(0,i.useEffect)(function(){return r.Z.on(n.rl,ae),function(){r.Z.off(n.rl,ae)}},[]);var I=(0,i.useCallback)(function(N){return N===te},[te]),w=(0,i.useCallback)(function(N){if(N.contentType===n.j7.RevokeMessage){var Me=N.sendID,_=(0,U.vJ)(M)?M==null?void 0:M.showName:N.senderNickname;return(0,e.jsxs)(e.Fragment,{children:[I(Me)?"\u4F60":(0,e.jsx)("b",{children:_}),"\u64A4\u56DE\u4E86\u4E00\u6761\u6D88\u606F"]})}switch(N.contentType){case n.j7.FriendAdded:return"AlreadyFriend";case n.j7.GroupCreated:{var Ee=JSON.parse(N.notificationElem.detail),xe=Ee.opUser;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("b",{children:I(xe.userID)?"You":xe.nickname}),"GroupCreated"]})}case n.j7.GroupNameUpdated:{var Te=JSON.parse(N.notificationElem.detail),G=Te.opUser;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("b",{children:I(G.userID)?"You":G.nickname}),"ModifiedGroup"]})}case n.j7.GroupOwnerTransferred:{var W=JSON.parse(N.notificationElem.detail),Fe=W.opUser,be=W.newGroupOwner;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("b",{children:I(Fe.userID)?"You":Fe.nickname}),"TransferTo",(0,e.jsx)("b",{children:I(be.userID)?"You":be.nickname})]})}case n.j7.MemberQuit:{var re=JSON.parse(N.notificationElem.detail),Q=re.quitUser;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("b",{children:I(Q.userID)?"You":Q.nickname}),"QuitedGroup"]})}case n.j7.MemberInvited:{var g,X=JSON.parse(N.notificationElem.detail),ge=X.opUser,$=(g=X.invitedUserList)!==null&&g!==void 0?g:[],ue=[];return $.forEach(function(pe){return ue.push((0,e.jsx)("b",{children:I(pe.userID)?"You":pe.nickname+" "},pe.userID))}),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("b",{children:I(ge.userID)?"You":ge.nickname}),"Invited",ue.map(function(pe){return pe}),"IntoGroup"]})}case n.j7.MemberKicked:{var de,Re=JSON.parse(N.notificationElem.detail),Ne=Re.opUser,ke=(de=Re.kickedUserList)!==null&&de!==void 0?de:[],Ue=[];return ke.forEach(function(pe){return Ue.push((0,e.jsx)("b",{children:I(pe.userID)?"You":pe.nickname},pe.userID))}),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("b",{children:I(Ne.userID)?"You":Ne.nickname}),"Kicked",Ue.map(function(pe){return pe}),"OutGroup"]})}case n.j7.MemberEnter:{var _e=JSON.parse(N.notificationElem.detail),Je=_e.entrantUser;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("b",{children:I(Je.userID)?"You":Je.nickname}),"JoinedGroup"]})}default:return JSON.parse(N.content).defaultTips}},[M,I]),le=(0,i.useCallback)(function(){l(M==null?void 0:M.userID,M==null?void 0:M.groupID,s[s.length-1])},[M==null?void 0:M.groupID,M==null?void 0:M.userID,l,s]);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Le,{holdHeight:40,ref:D.scrollbar,loading:E,data:s,fetchMoreData:le,hasMore:b,children:s==null?void 0:s.map(function(N,Me){return ie.includes(N.contentType)?(0,e.jsx)("div",{className:S()("chat_bg_tips",{"mb-6":Me===0}),children:w(N)},N.clientMsgID):(0,e.jsx)(Xe,{audio:a,mutilSelect:V,msg:N,selfID:v!=null?v:te,curCve:M},N.clientMsgID)})}),(0,e.jsx)("audio",{ref:a})]})}var Ze=st,Mt=t(19632),Pe=t.n(Mt),$e=t(3930),ot=t(13769),it=t.n(ot),lt=t(12444),ct=t.n(lt),ut=t(72004),dt=t.n(ut),vt=t(25098),o=t.n(vt),c=t(31996),B=t.n(c),K=t(26037),Se=t.n(K),Be=t(9783),fe=t.n(Be),Ye=t(64063),ze=t.n(Ye),me=["tagName","html","innerRef","placeholder"];function Qe(D){return D&&D.replace(/&nbsp;|\u202F|\u00A0/g," ")}function It(D){var d=document.createTextNode("");D.appendChild(d);var a=document.activeElement===D;if(d!==null&&d.nodeValue!==null&&a){var v=window.getSelection();if(v!==null){var s=document.createRange();s.setStart(d,d.nodeValue.length),s.collapse(!0),v.removeAllRanges(),v.addRange(s)}D instanceof HTMLElement&&D.focus()}}var Oe=function(D){B()(a,D);var d=Se()(a);function a(){var v;ct()(this,a);for(var s=arguments.length,l=new Array(s),b=0;b<s;b++)l[b]=arguments[b];return v=d.call.apply(d,[this].concat(l)),fe()(o()(v),"lastHtml",v.props.html),fe()(o()(v),"el",typeof v.props.innerRef=="function"?{current:null}:i.createRef()),fe()(o()(v),"getEl",function(){return(v.props.innerRef&&typeof v.props.innerRef!="function"?v.props.innerRef:v.el).current}),fe()(o()(v),"emitChange",function(M){var E=v.getEl();if(E){var k=E.innerHTML;if(v.props.onChange&&k!==v.lastHtml){var J=Object.assign({},M,{target:{value:k}});v.props.onChange(J)}v.lastHtml=k}}),v}return dt()(a,[{key:"render",value:function(){var s=this,l=this.props,b=l.tagName,M=l.html,E=l.innerRef,k=l.placeholder,J=it()(l,me);return i.createElement(b||"div",Ce()(Ce()({},J),{},fe()(fe()(fe()(fe()(fe()(fe()(fe()(fe()({},"data-placeholder",k),"ref",typeof E=="function"?function(V){E(V),s.el.current=V}:E||this.el),"onInput",this.emitChange),"onBlur",this.props.onBlur||this.emitChange),"onKeyUp",this.props.onKeyUp||this.emitChange),"onKeyDown",this.props.onKeyDown||this.emitChange),"contentEditable",!this.props.disabled),"dangerouslySetInnerHTML",{__html:M})),this.props.children)}},{key:"shouldComponentUpdate",value:function(s){var l=this.props,b=this.getEl();return!b||Qe(s.html)!==Qe(b.innerHTML)?!0:l.disabled!==s.disabled||l.tagName!==s.tagName||l.className!==s.className||l.innerRef!==s.innerRef||l.placeholder!==s.placeholder||!ze()(l.style,s.style)}},{key:"componentDidUpdate",value:function(){var s=this.getEl();s&&(this.props.html!==s.innerHTML&&(s.innerHTML=this.props.html),this.lastHtml=this.props.html,It(s))}}]),a}(i.Component),Tt=function(d,a){var v=new FileReader;v.onload=function(s){var l,b=(l=s.target)===null||l===void 0?void 0:l.result;a(b)},v.readAsDataURL(d)},bt=function(d){var a=d,v=/\<img.*?\">/g,s=a.match(v);if(s&&s.length>0){var l=ee()(s),b;try{for(l.s();!(b=l.n()).done;){var M=b.value;a=a.replaceAll(M,"")}}catch(E){l.e(E)}finally{l.f()}}return a},St=function(d){var a=d,v=Pe()(Array.from(document.getElementsByClassName("face_el"))),s=ee()(v),l;try{for(s.s();!(l=s.n()).done;){var b=l.value;a=a.replaceAll(b.outerHTML,b.alt)}}catch(M){s.e(M)}finally{s.f()}return a},Rt=function(d){var a=d;return a.slice(-4)==="<br>"&&(a=a.slice(0,-4)),a=a.replaceAll("<br>",`
`),a},Lt=function(){var d=Pe()(Array.from(document.getElementsByClassName("screenshot_el")));d.length>0&&(d[d.length-1].alt="last",d.map(function(){var a=T()(h()().mark(function v(s){var l;return h()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:l=(0,U._x)(s.src),console.log(l);case 2:case"end":return M.stop()}},v)}));return function(v){return a.apply(this,arguments)}}()))};function Bt(D){var d=D.curCve,a=D.sendMsg,v=(0,i.useRef)(null),s=(0,i.useRef)(null),l=(0,i.useState)(""),b=Y()(l,2),M=b[0],E=b[1],k=(0,$e.Z)(M),J=(0,i.useState)(),V=Y()(J,2),Z=V[0],te=V[1],ie=(0,i.useState)([]),ae=Y()(ie,2),I=ae[0],w=ae[1],le=(0,ht.useModel)("open-im.contacts",function(y){var C=y.state;return C.groupMemberList}),N=(0,i.useState)(!1),Me=Y()(N,2),_=Me[0],Ee=Me[1],xe=(0,$e.Z)(_),Te=(0,i.useState)([]),G=Y()(Te,2),W=G[0],Fe=G[1],be=function(C,O){ce.S.typingStatusUpdate({recvID:C,msgTip:O})},re=(0,i.useCallback)(function(){(0,U.vJ)(d)&&(v.current&&clearTimeout(v.current),v.current=setTimeout(function(){be(d.userID,"yes")},2e3))},[d]),Q=function(){var y=T()(h()().mark(function C(O){var R,P,q;return h()().wrap(function(De){for(;;)switch(De.prev=De.next){case 0:R=(O.originalEvent||O).clipboardData,R&&R.items[0].type.indexOf("image")===-1?(O.preventDefault(),P=R.getData("text/plain")||"",document.execCommand("insertText",!1,P)):R&&R.items[0].type.indexOf("image")>-1&&(O.preventDefault(),q=R.items[0].getAsFile(),Tt(q,function(mt){var Et='<img style="vertical-align:bottom" class="screenshot_el" src="'.concat(mt,'" alt="" >');document.execCommand("insertHTML",!1,Et)}));case 2:case"end":return De.stop()}},C)}));return function(O){return y.apply(this,arguments)}}(),g=(0,i.useRef)({curCve:d,msgContent:M,latestContent:k,atList:I,groupMemberList:le,replyMsg:Z,draftSaved:!1});g.current.msgContent=M,g.current.curCve=d,g.current.latestContent=k,g.current.atList=I,g.current.groupMemberList=le,g.current.replyMsg=Z;var X=(0,i.useCallback)(function(y,C){var O=g.current.atList,R=g.current.latestContent,P=g.current.replyMsg;if(P&&te(void 0),O.findIndex(function(ne){return ne.id===y})===-1){var q='<b class="at_el" data_id="'.concat(y,'" data_name="').concat(C,'" contenteditable="false" style="color:#428be5"> @').concat(C,"</b>");w([].concat(Pe()(O),[{id:y,name:C,tag:q}])),E(R.current+q),(0,U.RT)(s.current.el)}},[]),ge=(0,i.useCallback)(function(y){var C=y,O=g.current.atList,R=ee()(O),P;try{for(R.s();!(P=R.n()).done;){var q=P.value;C=C.replaceAll(q.tag,"@".concat(q.id," "))}}catch(ne){R.e(ne)}finally{R.f()}return C},[]),$=(0,i.useCallback)(function(y){var C=g.current.latestContent,O=g.current.atList;if(y.draftText!==C.current&&(y.draftText!==""||C.current!=="")){g.current.draftSaved=!0;var R=C.current;R=St(R);var P={conversationID:y.conversationID,draftText:O.length>0?ge(R):R};ce.S.setConversationDraft(P).then(function(q){console.warn(q)}).catch(function(q){console.warn(q)}).finally(function(){E("")})}},[ge]),ue=(0,i.useCallback)(function(){g.current.latestContent.current="",E(""),te(void 0),w([]),Ee(!1),$(d)},[d,$]),de=(0,i.useCallback)(function(){var y=T()(h()().mark(function C(O){var R,P;return h()().wrap(function(ne){for(;;)switch(ne.prev=ne.next){case 0:return ne.next=2,ce.S.createTextMessage(O);case 2:R=ne.sent,P=R.data,a(P.atTextElem.text,x.Cs.TextMessage),ue();case 6:case"end":return ne.stop()}},C)}));return function(C){return y.apply(this,arguments)}}(),[ue,a]),Re=(0,i.useCallback)(function(){var y=T()(h()().mark(function C(O){var R,P,q;return h()().wrap(function(De){for(;;)switch(De.prev=De.next){case 0:return R={text:O,atUserIDList:I.map(function(mt){return mt.id})},De.next=3,ce.S.createTextAtMessage(R);case 3:P=De.sent,q=P.data,a(q.atTextElem.text,x.Cs.AtTextMessage),ue();case 7:case"end":return De.stop()}},C)}));return function(C){return y.apply(this,arguments)}}(),[I,ue,a]),Ne=(0,i.useCallback)(function(){var y=T()(h()().mark(function C(O){var R,P;return h()().wrap(function(ne){for(;;)switch(ne.prev=ne.next){case 0:return ne.next=2,ce.S.createQuoteMessage({text:O,message:JSON.stringify(Z)});case 2:R=ne.sent,P=R.data,a(P.atTextElem.text,x.Cs.QuoteMessage),ue();case 6:case"end":return ne.stop()}},C)}));return function(C){return y.apply(this,arguments)}}(),[ue,Z,a]),ke=(0,i.useCallback)(function(y){var C=k.current;if(C=bt(St(C)),C=Rt(C),Lt(),C!=="")switch(y){case"text":de(C);break;case"at":Re(ge(C));break;case"quote":Ne(C);break;default:break}},[k,ge,Ne,Re,de]),Ue=(0,i.useCallback)(function(y){y.key==="Enter"&&y.metaKey&&(y.preventDefault(),(0,U.Tf)(),(0,U.RT)(s.current.el)),y.key==="Enter"&&!y.metaKey&&(y.preventDefault(),k.current&&!xe.current&&(Ee(!0),ke(Z?"quote":I.length>0?"at":"text")))},[I.length,k,xe,Z,ke]),_e=(0,i.useCallback)(function(y){E(y.target.value);var C=Pe()(Array.from(document.getElementsByClassName("at_el"))),O=[];C.map(function(R){var P,q;return O.push({id:(P=R.attributes.getNamedItem("data_id"))===null||P===void 0?void 0:P.value,name:(q=R.attributes.getNamedItem("data_name"))===null||q===void 0?void 0:q.value,tag:R.outerHTML})}),w(O),re()},[re]),Je=(0,i.useCallback)(function(y){var C=y,O=ee()(nt),R;try{for(O.s();!(R=O.n()).done;){var P=R.value,q=C.indexOf(P.context);if(q>-1){var ne='<img class="face_el" alt="'.concat(P.context,'" style="padding-right:2px" width="24px" src="').concat(P.src,'">');C=C.replaceAll(P.context,ne)}}}catch(De){O.e(De)}finally{O.f()}return C},[]),pe=(0,i.useCallback)(function(y){var C=y,O=/@\S+\s/g,R=C.match(O)||[],P=[],q=g.current.groupMemberList,ne=ee()(R),De;try{var mt=function(){var Nt=De.value,et=q.find(function(Kt){return Kt.userID===Nt.slice(1,-1)});if(et){var jt='<b class="at_el" data_id="'.concat(et.userID,'" data_name="').concat(et.nickname,'" contenteditable="false" style="color:#428be5"> @').concat(et.nickname,"</b>");C=C.replaceAll(Nt,jt),P.push({id:et.userID,name:et.nickname,tag:jt})}};for(ne.s();!(De=ne.n()).done;)mt()}catch(Et){ne.e(Et)}finally{ne.f()}return w(P),C},[]),ft=(0,i.useCallback)(function(y){E(Je(pe(y)))},[pe,Je]);(0,i.useEffect)(function(){g.current.draftSaved=!1;var y=g.current.atList;return y.length>0&&w([]),d.draftText!==""?ft(d.draftText):E(""),Fe([]),function(){g.current.draftSaved||$(d)}},[d,ft,$]);var qe=(0,i.useCallback)(function(y,C){var O=Pe()(W);if(y)O=[].concat(Pe()(O),[C]);else{var R=O.findIndex(function(P){return P.clientMsgID===C.clientMsgID});O.splice(R,1)}Fe(O)},[W]);return(0,i.useEffect)(function(){return r.Z.on(n.Co,qe),function(){r.Z.off(n.Co,qe)}},[qe]),(0,i.useEffect)(function(){return r.Z.on(n.oJ,X),r.Z.on(n.jf,$),function(){r.Z.off(n.oJ,X),r.Z.off(n.jf,$)}},[X,$]),(0,e.jsxs)("div",{className:"pt-4 ps-8 h-100 d-flex flex-column",children:[(0,e.jsxs)("div",{className:"d-flex flex-row mb-2",children:[(0,e.jsx)(f.Tooltip,{placement:"bottom",inverse:!0,title:"\u8868\u60C5",children:(0,e.jsx)(f.Button,{variant:!1,icon:(0,e.jsx)(z.JO,{name:"Bootstrap/emoji-smile",className:"svg-icon-2"}),activeColor:"secondary",className:"me-1"})}),(0,e.jsx)(f.Tooltip,{placement:"bottom",inverse:!0,title:"\u53D1\u9001\u540D\u7247",children:(0,e.jsx)(f.Button,{variant:!1,icon:(0,e.jsx)(z.JO,{name:"Bootstrap/person-badge",className:"svg-icon-2"}),activeColor:"secondary",className:"me-1"})}),(0,e.jsx)(f.Tooltip,{placement:"bottom",inverse:!0,title:"\u53D1\u9001\u6587\u4EF6",children:(0,e.jsx)(f.Button,{variant:!1,icon:(0,e.jsx)(z.JO,{name:"Bootstrap/folder-plus",className:"svg-icon-2"}),activeColor:"secondary",className:"me-1"})}),(0,e.jsx)(f.Tooltip,{placement:"bottom",inverse:!0,title:"\u53D1\u9001\u56FE\u7247",children:(0,e.jsx)(f.Button,{variant:!1,icon:(0,e.jsx)(z.JO,{name:"Bootstrap/card-image",className:"svg-icon-2"}),activeColor:"secondary",className:"me-1"})}),(0,e.jsx)(f.Tooltip,{placement:"bottom",inverse:!0,title:"\u53D1\u9001\u89C6\u9891",children:(0,e.jsx)(f.Button,{variant:!1,icon:(0,e.jsx)(z.JO,{name:"Bootstrap/film",className:"svg-icon-2"}),activeColor:"secondary",className:"me-1"})})]}),(0,e.jsxs)("div",{className:"ps-3 flex-row-fluid position-relative",children:[(0,e.jsx)(Oe,{style:{paddingTop:Z?"32px":"4px"},placeholder:"\u53D1\u9001\u7ED9 ".concat(d.showName),className:"h-100",ref:s,html:M,onChange:_e,onKeyDown:Ue,onPaste:Q}),(0,e.jsxs)("div",{className:"chat-msg-actions d-flex flex-row position-absolute",children:[(0,e.jsxs)("div",{className:"d-flex flex-row align-items-center fs-10 text-gray-500 me-6",children:[(0,e.jsx)(z.JO,{name:"Bootstrap/arrow-return-left",className:"svg-icon-7 me-2"})," ","\u53D1\u9001",(0,e.jsx)("span",{className:"mx-3",children:"/"}),(0,e.jsx)(z.JO,{name:"Bootstrap/command",className:"svg-icon-7 me-2"})," \u6362\u884C"]}),(0,e.jsx)(f.Button,{className:"px-5",children:"\u53D1\u9001"})]})]})]})}var Qt=Bt;function Ot(){return(0,e.jsx)("div",{className:"d-flex align-items-center justify-content-center h-100",children:(0,e.jsx)("img",{src:"/assets/media/illustrations/dozzy-1/12.png",className:"mw-100 h-200px h-sm-325px"})})}var Ft=Ot,kt=t(230),Zt=t(14903),Ut=function(d){var a=d.userId,v=d.typing,s=(0,kt.ED)({variables:{id:a},fetchPolicy:"cache-and-network"}),l=Y()(s,2),b=l[0],M=l[1],E=M.data,k=M.refetch,J=E==null?void 0:E.user.onlineStatus.status,V=E==null?void 0:E.user.onlineStatus.detailPlatformStatus,Z=(0,i.useMemo)(function(){if(J==="online"){var ie="",ae=ee()(V||[]),I;try{for(ae.s();!(I=ae.n()).done;){var w=I.value;w.status==="online"&&(ie+="".concat(w.platform,"/"))}}catch(le){ae.e(le)}finally{ae.f()}return"".concat(ie.slice(0,-1)," \u5728\u7EBF")}return"\u79BB\u7EBF"},[J,V]),te=(0,i.useRef)(J);return te.current=J,(0,i.useEffect)(function(){te.current!=="online"&&k()},[b,k,v]),(0,e.jsxs)("div",{className:"mb-0 lh-1 d-flex flex-row align-items-center",children:[(0,e.jsx)(f.Badge,{color:J==="online"?"primary":"secondary",shape:"circle",className:"w-10px h-10px me-1"}),(0,e.jsx)("span",{className:"fs-7 fw-semibold text-muted",children:Z})]})},Pt=function(){return(0,e.jsx)(e.Fragment,{})},Jt=105,wt=350;function Dt(D){return Math.min(wt,Math.max(Jt,D))}function Ht(D){var d=D.msgList,a=D.loadMore,v=D.hasMore,s=D.curCve,l=D.loading,b=D.sendMsg,M=D.scrollbar,E=D.typing,k=D.onBack,J=(0,i.useRef)({height:200}),V=(0,i.useReducer)(function(w){return w+1},0),Z=Y()(V,2),te=Z[1],ie=(0,i.useMemo)(function(){return s&&(0,U.vJ)(s)},[s]),ae=(0,i.useCallback)(function(w){J.current.height+=w,te()},[]),I=(0,i.useCallback)(function(){J.current.height=Dt(J.current.height)},[]);return(0,e.jsx)(j.vs,{className:"app-chat-main background-transparent",contentClassName:"px-0",footer:!1,header:!1,children:(0,e.jsxs)(f.Card,{className:"card chat_messenger",id:"kt_chat_messenger",children:[s&&(0,e.jsxs)(f.Card.Header,{id:"kt_chat_messenger_header",children:[(0,e.jsxs)(f.Card.Title,{className:"d-flex align-items-center",children:[(0,e.jsx)(f.Symbol.Avatar,{light:!0,size:45,alt:s==null?void 0:s.showName,src:s==null?void 0:s.faceURL}),(0,e.jsxs)("div",{className:"ms-5 d-flex justify-content-center flex-column me-3",children:[(0,e.jsx)("a",{href:"#",className:"fs-4 fw-bold text-gray-900 text-hover-primary me-1 mb-2 lh-1",children:s.showName}),(0,e.jsxs)("div",{className:"d-flex flex-row align-items-center",children:[ie?(0,e.jsx)(Ut,{userId:s.userID,typing:!!E}):(0,e.jsx)(Pt,{}),E&&(0,e.jsx)("span",{className:"mb-0 lh-1 ms-4 fs-7 fw-semibold text-muted",children:"\u6B63\u5728\u8F93\u5165..."})]})]})]}),(0,e.jsxs)(f.Card.Toolbar,{children:[(0,e.jsx)(f.Tooltip,{placement:"bottom",inverse:!0,title:"\u6587\u4EF6",children:(0,e.jsx)(f.Button,{className:"me-4",icon:(0,e.jsx)(z.JO,{name:"Bootstrap/folder",className:"svg-icon-2"}),variant:!1,activeColor:"light-primary"})}),(0,e.jsx)(f.Tooltip,{placement:"bottom",inverse:!0,title:"\u804A\u5929\u8BB0\u5F55",children:(0,e.jsx)(f.Button,{className:"me-4",icon:(0,e.jsx)(z.JO,{name:"Bootstrap/list-ul",className:"svg-icon-2"}),variant:!1,activeColor:"light-primary"})}),(0,e.jsx)(f.Tooltip,{placement:"bottom",inverse:!0,title:"\u6DFB\u52A0\u6210\u5458",children:(0,e.jsx)(f.Button,{className:"me-4",icon:(0,e.jsx)(z.JO,{name:"Bootstrap/person-plus",className:"svg-icon-2"}),variant:!1,activeColor:"light-primary"})}),(0,e.jsx)(f.Tooltip,{placement:"bottom",inverse:!0,title:"\u804A\u5929\u8BBE\u7F6E",children:(0,e.jsx)(f.Button,{className:S()({"me-4":!!k}),icon:(0,e.jsx)(z.JO,{name:"Bootstrap/gear",className:"svg-icon-2"}),variant:!1,activeColor:"light-primary"})}),k&&(0,e.jsx)(f.Tooltip,{placement:"bottom",inverse:!0,title:"\u8FD4\u56DE\u6D88\u606F\u5217\u8868",children:(0,e.jsx)(f.Button,{onClick:k,icon:(0,e.jsx)(z.JO,{name:"Bootstrap/arrow-return-left",className:"svg-icon-2"}),variant:!1,activeColor:"light-primary"})})]})]}),(0,e.jsx)(f.Card.Body,{className:"pe-0 py-0 overflow-hidden",id:"kt_chat_messenger_body",children:s?(0,e.jsx)(Ze,{loadMore:a,loading:l,msgList:d,hasMore:v,curCve:s,scrollbar:M}):(0,e.jsx)(Ft,{})}),s&&(0,e.jsx)(f.Card.Footer,{className:"p-0",id:"kt_chat_messenger_footer",children:(0,e.jsx)(ye.w_,{style:{height:Dt(J.current.height)},direction:"y",onResize:ae,onResizeEnd:I,children:(0,e.jsx)(Qt,{curCve:s,sendMsg:b})})})]})})}var Gt=Ht},26699:function(we,he,t){t.d(he,{Z:function(){return A.Z}});var A=t(15132)},75517:function(we,he,t){t.d(he,{Z:function(){return u}});var A=t(1861),ee=t(79817),ve=t(62435),Y=t(12845),i=t(93967),z=t.n(i),ye=t(51056),se=t(36603),S=t(86074);function j(n){var r=n.data,L=n.onClick,h=n.curCve,F=(0,Y.useModel)("@@initialState",function(Le){var m;return(m=Le.initialState)===null||m===void 0||(m=m.currentUser)===null||m===void 0?void 0:m.uid}),T=function(m){if(m==="")return m;var Ce=JSON.parse(m);if(r.draftText!==""){var oe=r.draftText,Ie=/\<img.*?\">/g,x=oe.match(Ie);return x&&x.length>0&&x.forEach(function(ce){oe=oe.replaceAll(ce,"Picture")}),(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("span",{className:"text-warning me-1",children:"[\u8349\u7A3F]"}),oe]})}return(0,se.LF)(Ce,F)},H=function(m){return m===ye.PD.Nomal},je=H(r==null?void 0:r.recvMsgOpt)?T(r.latestMsg):r.unreadCount>0?"[".concat(r.unreadCount+"Piece","] ").concat(T(r.latestMsg)):T(r.latestMsg),e=function(m){var Ce=(0,se.p6)(m),oe=(0,se.p6)(m+864e5),Ie=(0,se.p6)(new Date().getTime());return Ce[3]===Ie[3]?Ce[4]:oe[3]===Ie[3]?"\u6628\u5929":Ce[3]},He=(0,ve.useCallback)(function(){L(r)},[r,L]);return(0,S.jsxs)("div",{className:z()("cve-item d-flex flex-stack py-4 mb-1",{active:(h==null?void 0:h.conversationID)===r.conversationID}),onClick:He,children:[(0,S.jsxs)("div",{className:"d-flex align-items-center",children:[(0,S.jsx)(ee.Symbol.Avatar,{size:45,alt:r.showName,light:!0,badge:(0,S.jsx)(ee.Badge,{dot:!H(r==null?void 0:r.recvMsgOpt)&&r.unreadCount>0,color:"danger",shape:"circle",className:"start-100",count:H(r==null?void 0:r.recvMsgOpt)?r.unreadCount:null})}),(0,S.jsxs)("div",{className:"ms-5",children:[(0,S.jsx)("a",{href:"#",className:"fs-5 fw-bold text-gray-900 text-hover-primary mb-2",children:r.showName}),(0,S.jsx)("div",{className:"fw-semibold text-muted cve_msg",children:je})]})]}),(0,S.jsx)("div",{className:"d-flex flex-column align-items-end ms-2",children:(0,S.jsx)("span",{className:"text-muted fs-7 mb-1",children:e(r.latestMsgSendTime)})})]})}var f=j;function U(n){var r=n.curCve,L=n.cves,h=n.onItemClick;return(0,S.jsx)(A.E,{className:"d-flex flex-column custom-scrollbar px-2 cve-list",options:{scrollbars:{autoHide:"scroll"}},children:(0,S.jsx)(ee.Card,{flush:!0,className:"py-0 px-2 background-transparent",bodyClassName:"pt-5 pb-0 px-1 cve-list",children:L.map(function(F){return(0,S.jsx)(f,{onClick:h,cveList:L,data:F,curCve:r},F.conversationID)})})})}var u=U},83988:function(we,he,t){var A=t(5574),ee=t.n(A),ve=t(62435),Y=t(46027),i=t(93967),z=t.n(i),ye=t(79817),se=t(86074);function S(j){var f=j.onSearch,U=j.className,u=(0,ve.useState)(""),n=ee()(u,2),r=n[0],L=n[1],h=(0,ve.useCallback)(function(F){L(F.target.value),f(F.target.value)},[f]);return(0,se.jsxs)("div",{className:z()("cve-searchbar ps-6 pe-6 d-flex justify-content-sm-between align-items-center",U),children:[(0,se.jsx)(ye.Input.Search,{solid:!0,size:"lg",boxClassName:"flex-row-fluid me-2",value:r,onChange:h,placeholder:"\u641C\u7D22..."}),(0,se.jsx)("a",{className:z()("cve-searchbar-actions"),children:(0,se.jsx)(Y.JO,{className:z()("svg-icon-2x svg-icon-dark"),name:"Duotune/arr087"})})]})}he.Z=S},230:function(we,he,t){t.d(he,{ED:function(){return f}});var A=t(97857),ee=t.n(A),ve=t(68400),Y=t.n(ve),i=t(75063),z=t(73359),ye,se={},S=(0,i.Ps)(ye||(ye=Y()([`
    query getUserOnlineStatus($id: ID!) {
  user(id: $id) {
    id
    name
    onlineStatus {
      status
      detailPlatformStatus {
        platform
        status
      }
    }
  }
}
    `])));function j(u){var n=_objectSpread(_objectSpread({},se),u);return Apollo.useQuery(S,n)}function f(u){var n=ee()(ee()({},se),u);return z.t(S,n)}function U(u){var n=_objectSpread(_objectSpread({},se),u);return Apollo.useSuspenseQuery(S,n)}},50252:function(we,he,t){t.d(he,{RJ:function(){return Le}});var A=t(230),ee=t(15009),ve=t.n(ee),Y=t(99289),i=t.n(Y),z=t(97857),ye=t.n(z),se=t(19632),S=t.n(se),j=t(62435),f=t(12845),U=t(74857),u=t(63438),n=t(83956),r=t(51056),L=t(79817),h=t(65956),F=t(36603),T=t(97961),H=t(78864),je=function(){return(Math.random()*36).toString(36).slice(2)+new Date().getTime().toString()},e=function(Ce,oe){return new Promise(function(Ie,x){h.S.getOneConversation({sourceID:Ce,sessionType:oe}).then(function(ce){return Ie(ce.data)}).catch(function(ce){return x(ce)})})};function He(){var m=(0,f.useModel)("open-im.cve",function(o){var c=o.state;return c.curCve}),Ce=(0,f.useModel)("open-im.cve",function(o){var c=o.state;return c.cveInitLoading}),oe=(0,f.useModel)("open-im.cve",function(o){var c=o.actions;return c.setCurCve}),Ie=(0,f.useModel)("open-im.cve",function(o){var c=o.state;return c.cves}),x=(0,f.useModel)("@@initialState",function(o){var c,B=o.initialState;return B==null||(c=B.currentUser)===null||c===void 0?void 0:c.uid}),ce=(0,f.useModel)("open-im.contacts",function(o){var c=o.actions;return c.getGroupInfo}),Ge=(0,f.useModel)("open-im.contacts",function(o){var c=o.actions;return c.getGroupMemberList}),Ae=[],p=(0,U.Z)({historyMsgList:[],firstLoad:!1,typing:!1,hasMore:!0,merModal:!1,merData:void 0,searchStatus:!1,searchCve:[]}),tt=(0,j.useRef)(null),gt=(0,j.useRef)(),Ke=(0,j.useCallback)(function(o){var c;(c=gt.current)===null||c===void 0||c.scroll({y:"100%"},o!=null?o:350)},[]);function ht(o){if(JSON.parse(o.data).length===0){p.hasMore=!1;return}JSON.stringify(p.historyMsgList[p.historyMsgList.length-1])===JSON.stringify(JSON.parse(o.data).reverse()[0])&&p.historyMsgList.pop(),p.historyMsgList=[].concat(S()(p.historyMsgList),S()(JSON.parse(o.data).reverse())),p.firstLoad||(p.firstLoad=!0,setTimeout(function(){return Ke(0)})),p.hasMore=!(JSON.parse(o.data).length<20)}var We=(0,u.Z)(h.S.getAdvancedHistoryMessageList,{manual:!0,onSuccess:ht,onError:function(c){return console.log("GetChatRecordFailed",c)}}),xt=We.loading,pt=We.run,nt=We.cancel,at=(0,j.useCallback)(function(o,c,B){var K,Se={userID:o!=null?o:"",groupID:c!=null?c:"",count:20,startClientMsgID:(K=B==null?void 0:B.clientMsgID)!==null&&K!==void 0?K:""};pt(Se)},[pt]),Ct=(0,j.useCallback)(function(o,c){h.S.markMessagesAsReadByMsgID({conversationID:o,clientMsgIDList:c})},[]),Ve=(0,j.useCallback)(function(o,c){o.unreadCount===0&&!c||(0,F.vJ)(o)&&Ct(o.userID,[])},[Ct]),yt=(0,j.useCallback)(function(o){o?(p.searchStatus=!0,p.searchCve=Ie.filter(function(c){return c.conversationID.indexOf(o)>-1||c.showName.indexOf(o)>-1})):(p.searchCve=[],p.searchStatus=!1)},[Ie,p]),At=(0,j.useCallback)(function(o){if(!(0,F.vJ)(o)){ce(o.groupID);var c={groupID:o.groupID,offset:0,filter:0,count:2e3};Ge(c)}},[ce,Ge]),rt=(0,j.useCallback)(function(o){o.conversationID!==(m==null?void 0:m.conversationID)&&(m&&H.Z.emit(T.jf,m),p.historyMsgList=[],p.firstLoad=!1,oe(o),p.hasMore=!0,At(o),nt(),at(o.userID,o.groupID),Ve(o))},[m,at,At,Ve,nt,p,oe]),Xe=(0,j.useCallback)(function(o,c,B){Ae.forEach(function(K){if(K.oid===o.operationID){var Se=p.historyMsgList.findIndex(function(Be){return Be.clientMsgID===(K==null?void 0:K.mid)});Se!==-1&&(K.flag=!0,B?p.historyMsgList[Se].status=3:p.historyMsgList[Se]=o.data)}}),c===r.Cs.MergeMessage&&L.Toast.success("ForwardSuccessTip"),Ke()},[Ae,p.historyMsgList,Ke]),st=(0,j.useCallback)(function(o,c,B,K){var Se=je();if(B&&(m==null?void 0:m.userID)===B||K&&(m==null?void 0:m.groupID)===K||!B&&!K){var Be=o,fe={oid:Se,mid:Be.clientMsgID,flag:!1};Ae=[].concat(S()(Ae),[fe]),Be.status=2,p.historyMsgList=[Be].concat(S()(p.historyMsgList)),setTimeout(function(){var me=Ae.find(function(Qe){return Qe.mid===Be.clientMsgID});me&&!me.flag&&p.historyMsgList.forEach(function(Qe){Qe.clientMsgID===me.mid&&(Qe.status=1)})},2e3),Ke()}var Ye={title:"\u4F60\u6709\u4E00\u6761\u65B0\u6D88\u606F",desc:"",ex:"",iOSPushSound:"+1",iOSBadgeCount:!0},ze={recvID:B!=null?B:m.userID,groupID:K!=null?K:m.groupID,offlinePushInfo:Ye,message:o};Ae=Ae.filter(function(me){return!me.flag}),T.Dw.includes(c)?h.S.sendMessageNotOss(ze,Se).then(function(me){return Xe(me,c)}).catch(function(me){return Xe(me,c,!0)}):h.S.sendMessage(ze,Se).then(function(me){return Xe(me,c)}).catch(function(me){return Xe(me,c,!0)})},[m]),Ze=(0,j.useCallback)(function(o,c){e(o,c).then(function(B){return rt(B)}).catch(function(B){L.Toast.error("\u83B7\u53D6\u4F1A\u8BDD\u5931\u8D25\uFF01"),console.error(B)})},[rt]),Mt=(0,j.useCallback)(function(o){var c=o.sendID===(m==null?void 0:m.userID)||o.sendID===x&&o.recvID===(m==null?void 0:m.userID);return o.sessionType===r.FF.Single?c:o.groupID===(m==null?void 0:m.groupID)},[m==null?void 0:m.groupID,m==null?void 0:m.userID,x]),Pe=(0,j.useCallback)(function(){p.typing=!0,tt.current&&clearTimeout(tt.current),tt.current=setTimeout(function(){p.typing=!1},1e3)},[p]),$e=(0,j.useCallback)(function(o){var c=JSON.parse(o.data);c.contentType!==r.Cs.TypingMessage&&c.sendID!==x&&(0,F.sc)(c,function(B,K){Ze(B,K),window.focus()}),m&&Mt(c)&&(c.contentType===r.Cs.TypingMessage?Pe():(c.contentType===r.Cs.RevokeMessage?p.historyMsgList=[c].concat(S()(p.historyMsgList.filter(function(B){return B.clientMsgID!==c.content}))):p.historyMsgList=[c].concat(S()(p.historyMsgList)),Ve(m,1)))},[Ze,m,Mt,Ve,p,x,Pe]),ot=(0,j.useCallback)(function(o){var c=p.historyMsgList.findIndex(function(B){return B.clientMsgID===o.data});c>-1&&p.historyMsgList.splice(c,1)},[p]),it=(0,j.useCallback)(function(o){JSON.parse(o.data).forEach(function(c){c.msgIDList.forEach(function(B){p.historyMsgList.forEach(function(K){K.clientMsgID===B&&(K.isRead=!0)})})})},[p]),lt=(0,j.useCallback)(function(){oe(null)},[oe]),ct=(0,j.useCallback)(function(o){var c=p.historyMsgList.findIndex(function(K){return K.clientMsgID===o}),B=S()(p.historyMsgList);B.splice(c,1),p.historyMsgList=B,L.Toast.success("\u5220\u9664\u6D88\u606F\u6210\u529F\uFF01")},[p]),ut=(0,j.useCallback)(function(o){var c=p.historyMsgList.findIndex(function(B){return B.clientMsgID===o});p.historyMsgList[c].contentType=T.j7.RevokeMessage},[p]),dt=(0,j.useCallback)(function(o,c){p.merData=ye()(ye()({},o),{},{sender:c}),p.merModal=!0},[p]),vt=(0,j.useCallback)(function(o,c,B){B.map(function(){var K=i()(ve()().mark(function Se(Be){var fe,Ye,ze,me,Qe;return ve()().wrap(function(Oe){for(;;)switch(Oe.prev=Oe.next){case 0:if(ze=(fe=Be.userID)!==null&&fe!==void 0?fe:"",me=(Ye=Be.groupID)!==null&&Ye!==void 0?Ye:"",c!==r.Cs.MergeMessage){Oe.next=8;break}return Oe.next=5,h.S.createMergerMessage(o);case 5:Qe=Oe.sent,Oe.next=11;break;case 8:return Oe.next=10,h.S.createForwardMessage(o);case 10:Qe=Oe.sent;case 11:st(Qe.data,c,ze,me),H.Z.emit(T.rl,!1);case 13:case"end":return Oe.stop()}},Se)}));return function(Se){return K.apply(this,arguments)}}())},[st]);return(0,j.useEffect)(function(){return h.S.on(n.l.OnRecvMessageRevoked,ot),h.S.on(n.l.OnRecvC2CReadReceipt,it),function(){h.S.off(n.l.OnRecvMessageRevoked,ot),h.S.off(n.l.OnRecvC2CReadReceipt,it)}},[it,ot]),(0,j.useEffect)(function(){return H.Z.on(T.$F,lt),H.Z.on(T.Cd,ct),H.Z.on(T.rF,ut),H.Z.on(T.a7,dt),function(){H.Z.off(T.$F,lt),H.Z.off(T.Cd,ct),H.Z.off(T.rF,ut),H.Z.off(T.a7,dt)}},[ct,dt,lt,ut]),(0,j.useEffect)(function(){return H.Z.on(T.jA,vt),H.Z.on(T.$M,Ze),h.S.on(n.l.OnRecvNewMessage,$e),function(){H.Z.off(T.jA,vt),H.Z.off(T.$M,Ze),h.S.off(n.l.OnRecvNewMessage,$e)}},[Ze,m,$e,vt]),(0,j.useEffect)(function(){return function(){oe(null)}},[oe]),{rs:p,cveList:Ie,loading:xt,cveLoading:Ce,curCve:m,setCurCve:oe,handleCveSearch:yt,handleItemClick:rt,scrollbar:gt,getHistoryMsg:at,sendMsg:st}}var Le=He},14903:function(){}}]);

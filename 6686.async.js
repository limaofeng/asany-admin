"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[6686],{97961:function(He,he,t){t.d(he,{$F:function(){return Y},$M:function(){return ve},Cd:function(){return ye},Co:function(){return a},Dw:function(){return H},Oo:function(){return f},a7:function(){return s},cu:function(){return j},j7:function(){return je},jA:function(){return G},jf:function(){return se},oJ:function(){return L},rF:function(){return D},rl:function(){return d}});var A=t(51056),ee="UPDATEFRIENDCARD",ve="TOASSIGNCVE",Y="RESETCVE",o="OPENSINGLEMODAL",z="OPENGROUPMODAL",ye="DELETEMESSAGE",se="ISSETDRAFT",D="REVOKEMSG",j="REPLAYMSG",f="FORWARDANDMERMSG",G="SENDFORWARDMSG",d="MUTILMSG",a="MUTILMSGCHANGE",s="MERMSGMODAL",L="ATSTATEUPDATE",h="ANTDLOCALCHANGE",F="APPLICATIONTYPEUPDATE",T="CLEARSEARCHINPUT",H=[A.Cs.PictureMessage,A.Cs.VideoMessage,A.Cs.VoiceMessage,A.Cs.FileMessage],je={RevokeMessage:A.Cs.RevokeMessage,FriendAdded:A.Cs.FriendAdded,GroupCreated:A.Cs.GroupCreated,GroupNameUpdated:A.Cs.GroupNameUpdated,GroupOwnerTransferred:A.Cs.GroupOwnerTransferred,MemberQuit:A.Cs.MemberQuit,MemberInvited:A.Cs.MemberInvited,MemberKicked:A.Cs.MemberKicked,MemberEnter:A.Cs.MemberEnter}},78864:function(He,he,t){var A=t(17187),ee=t.n(A),ve=new A.EventEmitter;ve.setMaxListeners(12),he.Z=ve},36603:function(He,he,t){t.d(he,{LF:function(){return j},RD:function(){return z},RT:function(){return ve},Sv:function(){return ye},Tf:function(){return se},_x:function(){return D},p6:function(){return Y},sc:function(){return f},vJ:function(){return ee}});var A=t(51056),ee=function(d){return d.userID!==""&&d.groupID===""},ve=function(d){var a=window.getSelection(),s=document.createRange();s.selectNodeContents(d.current),s.collapse(!1),a==null||a.removeAllRanges(),a==null||a.addRange(s)},Y=function(d){var a=new Date(d),s=a.getFullYear(),L=a.getMonth()+1,h=a.getDate(),F=a.getHours(),T=a.getMinutes();T.toString().length===1&&(T="0"+T);var H=a.getSeconds();H.toString().length===1&&(H="0"+H);var je=s+"-"+L+"-"+h,e=F+":"+T;return[s,L,h,je,e]},o=function(d,a){axios.get(d,{headers:{"Content-Type":"application/x-www-form-urlencoded"},responseType:"blob"}).then(function(s){var L=new Blob([s.data]),h=a,F=document.createElement("a");F.download=h,F.style.display="none",F.href=URL.createObjectURL(L),document.body.appendChild(F),F.click(),URL.revokeObjectURL(F.href),document.body.removeChild(F)}).catch(function(s){console.log(s)})},z=function(d){if(d===0)return"0 B";var a=1024,s=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],L=Math.floor(Math.log(d)/Math.log(a));return(d/Math.pow(a,L)).toPrecision(3)+" "+s[L]},ye=function(d){var a=["jpeg","tiff","png","gif","jpg","gif"],s=["ppt","pptx"],L=["xlsx","xls"],h=["doc","docx"],F=["rar","zip"];return a.includes(d)?"file_pic":s.includes(d)?"file_ppt":L.includes(d)?"file_xslx":h.includes(d)?"file_world":F.includes(d)?"file_zip":d==="pdf"?"file_pdf":"file_unknow"},se=function(){var d=window.getSelection(),a=d.getRangeAt(0),s=document.createElement("br"),L=document.createTextNode("\xA0");a.deleteContents(),a.insertNode(s),a.collapse(!1),a.insertNode(L),a.selectNodeContents(L),d.removeAllRanges(),d.addRange(a),document.execCommand("delete")},D=function(d){for(var a=d.split(","),s=a[0].match(/:(.*?);/)[1],L=atob(a[1]),h=L.length,F=new Uint8Array(h);h--;)F[h]=L.charCodeAt(h);return new File([F],"screenshot".concat(Date.now(),".png"),{type:s})},j=function(d,a){var s=function(p){return p===a};switch(d.contentType){case A.Cs.TextMessage:return d.content;case A.Cs.AtTextMessage:return d.atTextElem.text;case A.Cs.PictureMessage:return"PictureMessage";case A.Cs.VideoMessage:return"VideoMessage";case A.Cs.VoiceMessage:return"VoiceMessage";case A.Cs.LocationMessage:return"LocationMessage";case A.Cs.CardMessage:return"CardMessage";case A.Cs.MergeMessage:return"MergeMessage";case A.Cs.FileMessage:return"FileMessage";case A.Cs.RevokeMessage:return"".concat(s(d.sendID)?"\u4F60":d.senderNickname,"\u64A4\u56DE\u4E86\u4E00\u6761\u6D88\u606F");case A.Cs.CustomMessage:return"CustomMessage";case A.Cs.QuoteMessage:return"QuoteMessage";case A.Cs.FriendAdded:return"AlreadyFriend";case A.Cs.MemberEnter:{var L=JSON.parse(d.notificationElem.detail),h=L.entrantUser;return"".concat(s(h.userID)?"You":h.nickname,"JoinedGroup")}case A.Cs.GroupCreated:{var F=JSON.parse(d.notificationElem.detail),T=F.opUser;return"".concat(s(T.userID)?"You":T.nickname,"GroupCreated")}case A.Cs.MemberInvited:{var H,je=JSON.parse(d.notificationElem.detail),e=je.opUser,we=(H=je.invitedUserList)!==null&&H!==void 0?H:[],Le="";return we.forEach(function(Ae){return Le+=(s(Ae.userID)?"You":Ae.nickname)+" "}),"".concat(s(e.userID)?"You":e.nickname,"Invited").concat(Le,"IntoGroup")}case A.Cs.MemberKicked:{var m,Ce=JSON.parse(d.notificationElem.detail),ie=Ce.opUser,Ie=(m=Ce.kickedUserList)!==null&&m!==void 0?m:[],x="";return Ie.forEach(function(Ae){return x+=(s(Ae.userID)?"You":Ae.nickname)+" "}),"".concat(s(ie.userID)?"You":ie.nickname,"Kicked").concat(x,"OutGroup")}case A.Cs.MemberQuit:{var ce=JSON.parse(d.notificationElem.detail),Ge=ce.quitUser;return"".concat(s(Ge.userID)?"You":Ge.nickname,"QuitedGroup")}default:return d.notificationElem.detail}},f=function(d,a,s){if(Notification&&document.hidden){var L,h=d.contentType===A.Cs.FriendAdded?"FriendNotice":d.senderNickname,F=new Notification(h,{dir:"auto",tag:(L=s!=null?s:d.groupID)!==null&&L!==void 0?L:d.sendID,renotify:!0,icon:d.senderFaceUrl,body:j(d),requireInteraction:!0}),T=d.sessionType===A.FF.Single?d.contentType===A.Cs.FriendAdded?d.recvID:d.sendID:d.groupID;F.onclick=function(){a&&a(T,d.sessionType),F.close()}}}},74314:function(He,he,t){t.d(he,{Z:function(){return Kt}});var A=t(64599),ee=t.n(A),ve=t(5574),Y=t.n(ve),o=t(62435),z=t(46027),ye=t(50603),se=t(93967),D=t.n(se),j=t(73588),f=t(13757),G=t(36603),d=t(97330),a=t(97961),s=t(78864),L=t(15009),h=t.n(L),F=t(99289),T=t.n(F),H=t(1861),je=t(27856),e=t(86074),we=function(u,n){var v,r=u.data,c=u.fetchMoreData,b=u.hasMore,M=u.children,E=u.loading,k=u.holdHeight,P=k===void 0?30:k,V=(0,o.useRef)(null),Z=(v=V.current)===null||v===void 0?void 0:v.osInstance(),te=(0,o.useRef)({scrollTop:0,contentHeight:0});(0,o.useImperativeHandle)(n,function(){return Z},[Z]);var oe=(0,o.useCallback)(function(){var S=T()(h()().mark(function J(le){var N;return h()().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(N=P!=null?P:30,te.current.contentHeight=le.target.scrollHeight,te.current.scrollTop=le.target.scrollTop,!(le.target.scrollTop<N)){_.next=7;break}if(!(E||!b)){_.next=6;break}return _.abrupt("return");case 6:requestAnimationFrame(c);case 7:case"end":return _.stop()}},J)}));return function(J){return S.apply(this,arguments)}}(),[c,b,P,E]),ae=(0,je.P)(500,oe);return(0,e.jsxs)(H.E,{ref:V,className:"d-flex h-100 flex-column custom-scrollbar pe-9 pt-8",options:{scrollbars:{autoHide:"scroll"},callbacks:{onScroll:ae,onContentSizeChanged:function(J){if(J){if(!Z){setTimeout(function(){var N;(N=V.current)===null||N===void 0||(N=N.osInstance())===null||N===void 0||N.scroll({y:"100%"})});return}if(Z.scroll().max.y===0)Z.scroll({y:"100%"});else if(te.current.contentHeight){var le=J.height-te.current.contentHeight;Z.scroll({y:le+te.current.scrollTop})}}}}},children:[M,b?(0,e.jsx)("div",{className:D()("scroll-view-spin","d-flex align-items-center justify-content-center","fs-6",{"flex-column-fluid":r.length===0,"h-40px":r.length!==0}),children:(0,e.jsx)(f.Spin,{tip:"\u52A0\u8F7D\u4E2D...",indicator:"Loading",size:"small"})}):(0,e.jsx)("div",{className:"con_nomore",children:"\u6CA1\u6709\u66F4\u591A\u5566~"})]})},Le=o.forwardRef(we),m=t(97857),Ce=t.n(m),ie=t(42532),Ie=t(96522),x=t(51056),ce=t(65956),Ge=t(86366),Ae=[x.Cs.TextMessage,x.Cs.AtTextMessage],p=[x.Cs.PictureMessage,x.Cs.VideoMessage,x.Cs.FileMessage],tt=function(u){var n,v,r,c=u.msg,b=u.isSelf,M=u.children,E=(0,o.useState)(!1),k=Y()(E,2),P=k[0],V=k[1],Z=["Copy","Translate","Reply","Forward"],te=(0,Ge.Z)(),oe=Y()(te,2),ae=oe[1],S=function(){s.Z.emit(a.Oo,"forward",JSON.stringify(c))},J=function(){s.Z.emit(a.rl,!0)},le=function(){s.Z.emit(a.cu,c)},N=(0,o.useCallback)(function(){ce.S.revokeMessage(c).then(function(w){s.Z.emit(a.rF,c.clientMsgID),console.log("res",w)}).catch(function(w){return f.Toast.error("\u64A4\u56DE\u6D88\u606F\u5931\u8D25\uFF01",w)})},[c]),Me=(0,o.useCallback)(function(){console.log("msg",c),ce.S.deleteMessageFromLocalStorage(JSON.stringify(c)).then(function(w){s.Z.emit(a.Cd,c.clientMsgID),console.log("res",w)}).catch(function(w){return f.Toast.error("\u5220\u9664\u6D88\u606F\u5931\u8D25\uFF01"+w.message)})},[c]),_=(0,o.useCallback)(T()(h()().mark(function w(){var W;return h()().wrap(function(be){for(;;)switch(be.prev=be.next){case 0:return V(!1),be.next=3,f.Modal.confirm({title:"\u5220\u9664\u6D88\u606F",content:(0,e.jsx)(e.Fragment,{children:(0,e.jsx)("p",{className:"tip-confirm",children:"\u786E\u5B9A\u5220\u9664\u8BE5\u6D88\u606F\u5417\uFF1F"})}),icon:"info",okText:"\u5220\u9664"});case 3:W=be.sent,W.isConfirmed&&Me();case 5:case"end":return be.stop()}},w)})),[Me]),Ee=(0,o.useCallback)(function(){var w="";switch(c.contentType){case x.Cs.PictureMessage:w=c.pictureElem.sourcePicture.url;break;case x.Cs.VideoMessage:w=c.videoElem.videoUrl;break;case x.Cs.FileMessage:w=c.fileElem.sourceUrl;break;default:break}var W=w.lastIndexOf("/"),ke=w.slice(W+1);downloadFileUtil(w,ke)},[c.contentType,(n=c.fileElem)===null||n===void 0?void 0:n.sourceUrl,(v=c.pictureElem)===null||v===void 0||(v=v.sourcePicture)===null||v===void 0?void 0:v.url,(r=c.videoElem)===null||r===void 0?void 0:r.videoUrl]),xe=(0,o.useMemo)(function(){return[{id:"Translate",title:"\u7FFB\u8BD1",icon:"Bootstrap/translate",method:function(){},hidden:!0},{id:"Forward",title:"\u8F6C\u53D1",icon:"Bootstrap/arrow-up-right-square",method:S,hidden:!1},{id:"Copy",title:"\u590D\u5236",icon:"Bootstrap/clipboard2",method:function(){var W=c.contentType===messageTypes.ATTEXTMESSAGE?c.atElem.text:c.content;ae(W),f.Toast.success("\u590D\u5236\u6210\u529F\uFF01"),V(!1)},hidden:!1},{id:"Multiple",title:"\u591A\u9009",icon:"Bootstrap/list-check",method:J,hidden:!1},{id:"Reply",title:"\u5F15\u7528",icon:"Bootstrap/chat-quote",method:le,hidden:!1},{id:"Revoke",title:"\u64A4\u56DE",icon:"Bootstrap/arrow-90deg-down",method:N,hidden:!1},{id:"Delete",title:"\u5220\u9664",icon:"Bootstrap/trash",method:_,hidden:!1},{id:"Download",title:"\u4E0B\u8F7D",icon:"Bootstrap/download",method:Ee,hidden:!1}]},[ae,_,Ee,S,c.atElem.text,c.content,c.contentType,le,N]),Te=function(W){return!Ae.includes(c.contentType)&&Z.includes(W.id)&&(W.hidden=!0),W.id==="Download"&&!p.includes(c.contentType)&&(W.hidden=!0),!b&&W.id==="Revoke"&&(W.hidden=!0),!W.hidden&&(0,e.jsx)(f.Menu.Item,{icon:(0,e.jsx)(z.JO,{name:W.icon,className:"svg-icon-6"}),className:"px-3",onClick:W.method,children:W.title},W.id)};return(0,e.jsx)(f.Popover,{trigger:"contextMenu",visible:P,onVisibleChange:V,content:(0,e.jsx)(f.Menu,{className:"menu-sub show menu-sub-dropdown show menu-gray-600 menu-state-bg-light-primary fw-bold fs-8 w-125px py-2",children:xe.map(Te)}),overlayClassName:"overlay-no-arrow msg_item_menu_popover",children:(0,e.jsx)("div",{className:D()("chat_bg_msg_content py-3",{"ps-4 pe-8":!b,"ps-8 pe-4":b}),children:M})})},mt=tt,Ke=t(6366),gt=t(12845),We=t(3030),xt=t(30381),ht=t.n(xt),nt=[{context:"[\u6655]",src:""}],at="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAAUCAYAAABWMrcvAAAAAXNSR0IArs4c6QAAAk5JREFUOE+N081LFHEYB/Dvd9wMk0p3dsid1fIkduhUl0jIoDckDx2MOnSKPCU6o5KBkCG9ic4u1CUr6FQHQyqK3CCMBAPpXwjsZWdNZ3YxJXHNeWLH3HZTqzk+z3z4/p7fPEP8+dSPBvS9ezoo/JCw1KE1fQDML5Y3p7ZvKfWegKgXoM+2Qhf/iiqNzyWCklEh9wnQkbTU2HogW8sl6ebMXQrPeSLNyZh2byOQQ3pb6gDojYFy37a08/mgwkgfpAJJDpS/Xa37SRHTfSGQukBxoPrTjbL0ajNiuqaI9BMykohqDTlU0TKnKZsWbQB3bCt0YbWht7pHUIQRQF4vzCtN6cHgbA6FDeekQgx75PHkgBrPS5kApHJhibWpW+q3/CMzbDqXFODaYkYizm0tmwi9NbWTRTIp9HrtAe1ythZuc3aT0gSv6AF1w7lOokvmM6X2oP7dR4Z7lJQ4oDQmrOBzf27DGQexH8JhRgynG0TvD2Xzjq/9W6cLkTQmLM1HuuH2gdJOsJO6kTpNeo+WPTk0FdPe+EdpT+9SZHlSwCu2pfbk5mmSYgwxQ910qyDyEfTXpit3e+bMe4LhxYDUOn3aXMFF+NGmOwZ4NYqEqr9EubCS5h6jJy9BxjMB71Q+9D+ubsw0knwG4GrCCnXn0oxUJ+HdFMi4HdXqCjZiBTpZ1CDgiWRUHfkNncOesGwqpj5egyqN2aAwM5H1IjxjR0NP/7nlv2arAvAKQA2EZ+1o8OF6sOAnzL4QbHG3lQS8niVRhqZj6rv/QhsdKb/+E7En8byRi/iIAAAAAElFTkSuQmCC",pt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAATCAYAAABLN4eXAAAAAXNSR0IArs4c6QAAAiBJREFUOE+Fk0toU1EQhv+5oVINKrgIJAQtuCgkEHLPCQaFiiLYik+KXehKUHErIhWUYgUXFR8rV4orF4LFlaX4AhUqLpIzN5vEIgFfKZKNaEBKQ3JGTkkgMaQ9y5/5ZuafmUPo87TWEwB2GmPuAGh0hlE/SCl1i4gmAbwDcMIY86cd2xdyAUqpi0TkKuWr1er+SqWy7PQ1IRegtT4H4AGAR8aY8z2Q7/t7XaIgCN53tq21figiZ621I4VC4UNXJaXUPIAxEbkcBMG9NphMJrcNDg5+AbBgjDncBWmttwKYFZEDnueN5fP5121QKXWfiC5Ya2M9nrLZ7JZGo7EoIhVm3tUBjRLRCxEZJ631dgBnRGSWmT+1zN8AMAVgyBjz3Wm+78c8z1sCcJWUUs+IaFxEPjLzntaojxDRcwCjxphXTovFYpui0ehfADOu0iURuQ3gLjO7Zbr99ECpVCoyMDBQtdZOrXpKJBIbSqVSvaP/aSK6bq0dCoLgm9PT6fS+UCj01lp7qmcQw8PDm8Ph8CKAn8ycaSfSWs+IyGS9Xt/RBbWAp84LgEPM/NJB8Xh8YyQS+UpEn40xI//vaUFE3DCuMLPzufqUUjeJ6JqIHGXmuS4ok8mcbDabv4MgeNMBjBHRnIjMM/OxdQ82nU4fD4VCT0RkaWVlJVssFn+tCWmtT4vIY+fD87yDuVzux7r/yff93UQ0UavVpsvlcq3z6v8BSUzmcN/zXjIAAAAASUVORK5CYII=";function Ve(I){var u=I.options;return console.log("options",u),(0,e.jsx)("div",{children:"VideoPlayer"})}var yt=function(u){var n=u.msg,v=u.audio,r=u.curCve,c=u.selfID,b=(0,o.useState)(!1),M=Y()(b,2),E=M[0],k=M[1],P=(0,gt.useModel)("open-im.contacts",function(re){var Q=re.state;return Q.groupMemberList}),V=(0,o.useRef)(null),Z=(0,o.useState)({}),te=Y()(Z,2),oe=te[0],ae=te[1],S=(0,o.useRef)();(0,o.useEffect)(function(){var re;k(r?(0,G.vJ)(r):!1),((re=V.current)===null||re===void 0?void 0:re.clientHeight)>60&&ae({paddingBottom:"16px",paddingRight:"8px"})},[r]);var J=function(Q){return c===Q},le=function(Q){var g=Q,X=/@\S+\s/g,ge=g.match(X)||[],$=ee()(ge),ue;try{var de=function(){var Ne=ue.value,Ue=P.find(function(Pe){return Pe.userID===Ne.slice(1,-1)});Ue?g=g.replaceAll(Ne,`<span onclick='userClick("`.concat(Ue.userID.replace(".","-"),`")' style="color:#428be5;cursor: pointer;"> @`).concat(Ue.nickname," </span>")):g=g.replaceAll(Ne,`<span onclick="userClick('`.concat(Ne.slice(1,-1),`')" style="color:#428be5;cursor: pointer;"> `).concat(Ne,"</span>"))};for($.s();!(ue=$.n()).done;)de()}catch(Re){$.e(Re)}finally{$.f()}return g},N=function(Q){return ht()(n.sendTime).format(Q?"HH:mm":"YYYY-MM-DD HH:mm")},Me=function(Q,g){s.Z.emit(a.a7,Q,g)},_=function(){var Q=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"chat_bg_msg_content_time";return(0,e.jsx)(f.Tooltip,{placement:"bottom",inverse:!0,title:N(0),children:(0,e.jsx)("div",{className:Q,children:N(1)})})},Ee=function(Q){var g=Q,X=ee()(nt),ge;try{for(X.s();!(ge=X.n()).done;){var $=ge.value,ue=g.indexOf($.context);ue>-1&&(g=g.replaceAll($.context,'<img style="padding-right:2px" width="24px" src='.concat($.src," />")))}}catch(de){X.e(de)}finally{X.f()}return g},xe=function(Q){var g=Q.replaceAll("\\n","<br>");return g.replaceAll(`
`,"<br>")},Te=function(Q){var g=Q,X=/[(http(s)?):\/\/(www\.)?a-zA-Z0-9@:._\+-~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:_\+.~#?&\/\/=]*)/g,ge=g.match(X)||[],$=ee()(ge),ue;try{for($.s();!(ue=$.n()).done;){var de=ue.value;g=g.replaceAll(de,`<a onclick="urlClick('`.concat(de,`')" href="javascript:;">`).concat(de,"</a>"))}}catch(Re){$.e(Re)}finally{$.f()}return g},w=function(Q){switch(Q.contentType){case x.Cs.TextMessage:{var g=xe(Te(le(Ee(Q.content))));return(0,e.jsx)("div",{className:"content",dangerouslySetInnerHTML:{__html:g}})}case x.Cs.AtTextMessage:return le(Q.atTextElem.text);case x.Cs.PictureMessage:return(0,e.jsx)(We.Z,{width:60,src:Q.pictureElem.sourcePicture.url});default:return""}},W=function(Q){var g;v.current.src=Q,(g=v.current)===null||g===void 0||g.play()},ke=function(Q){S.current=Q,Q.on("waiting",function(){console.log("player is waiting")}),Q.on("dispose",function(){console.log("player will dispose")})},be=function(){var Q;switch(n.contentType){case x.Cs.TextMessage:{var g=n.content;return g=Ee(g),g=Te(g),g=xe(g),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{ref:V,style:oe,className:"chat_bg_msg_content_text ".concat(E?"":"nick_magin"),children:(0,e.jsx)("div",{dangerouslySetInnerHTML:{__html:g}})}),_()]})}case x.Cs.AtTextMessage:{var X=n.atTextElem.text;return X=Ee(X),X=le(X),X=Te(X),X=xe(X),(0,e.jsxs)("div",{style:oe,className:"chat_bg_msg_content_text ".concat(E?"":"nick_magin"),children:[(0,e.jsx)("div",{style:{display:"inline-block"},dangerouslySetInnerHTML:{__html:X}}),_()]})}case x.Cs.PictureMessage:return(0,e.jsxs)("div",{className:"chat_bg_msg_content_pic ".concat(E?"":"nick_magin"),children:[(0,e.jsx)(We.Z,{placeholder:!0,height:200,src:(Q=n.pictureElem.snapshotPicture.url)!==null&&Q!==void 0?Q:n.pictureElem.sourcePicture.url,preview:{visible:!1},fallback:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMIAAADDCAYAAADQvc6UAAABRWlDQ1BJQ0MgUHJvZmlsZQAAKJFjYGASSSwoyGFhYGDIzSspCnJ3UoiIjFJgf8LAwSDCIMogwMCcmFxc4BgQ4ANUwgCjUcG3awyMIPqyLsis7PPOq3QdDFcvjV3jOD1boQVTPQrgSkktTgbSf4A4LbmgqISBgTEFyFYuLykAsTuAbJEioKOA7DkgdjqEvQHEToKwj4DVhAQ5A9k3gGyB5IxEoBmML4BsnSQk8XQkNtReEOBxcfXxUQg1Mjc0dyHgXNJBSWpFCYh2zi+oLMpMzyhRcASGUqqCZ16yno6CkYGRAQMDKMwhqj/fAIcloxgHQqxAjIHBEugw5sUIsSQpBobtQPdLciLEVJYzMPBHMDBsayhILEqEO4DxG0txmrERhM29nYGBddr//5/DGRjYNRkY/l7////39v///y4Dmn+LgeHANwDrkl1AuO+pmgAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAwqADAAQAAAABAAAAwwAAAAD9b/HnAAAHlklEQVR4Ae3dP3PTWBSGcbGzM6GCKqlIBRV0dHRJFarQ0eUT8LH4BnRU0NHR0UEFVdIlFRV7TzRksomPY8uykTk/zewQfKw/9znv4yvJynLv4uLiV2dBoDiBf4qP3/ARuCRABEFAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghgg0Aj8i0JO4OzsrPv69Wv+hi2qPHr0qNvf39+iI97soRIh4f3z58/u7du3SXX7Xt7Z2enevHmzfQe+oSN2apSAPj09TSrb+XKI/f379+08+A0cNRE2ANkupk+ACNPvkSPcAAEibACyXUyfABGm3yNHuAECRNgAZLuYPgEirKlHu7u7XdyytGwHAd8jjNyng4OD7vnz51dbPT8/7z58+NB9+/bt6jU/TI+AGWHEnrx48eJ/EsSmHzx40L18+fLyzxF3ZVMjEyDCiEDjMYZZS5wiPXnyZFbJaxMhQIQRGzHvWR7XCyOCXsOmiDAi1HmPMMQjDpbpEiDCiL358eNHurW/5SnWdIBbXiDCiA38/Pnzrce2YyZ4//59F3ePLNMl4PbpiL2J0L979+7yDtHDhw8vtzzvdGnEXdvUigSIsCLAWavHp/+qM0BcXMd/q25n1vF57TYBp0a3mUzilePj4+7k5KSLb6gt6ydAhPUzXnoPR0dHl79WGTNCfBnn1uvSCJdegQhLI1vvCk+fPu2ePXt2tZOYEV6/fn31dz+shwAR1sP1cqvLntbEN9MxA9xcYjsxS1jWR4AIa2Ibzx0tc44fYX/16lV6NDFLXH+YL32jwiACRBiEbf5KcXoTIsQSpzXx4N28Ja4BQoK7rgXiydbHjx/P25TaQAJEGAguWy0+2Q8PD6/Ki4R8EVl+bzBOnZY95fq9rj9zAkTI2SxdidBHqG9+skdw43borCXO/ZcJdraPWdv22uIEiLA4q7nvvCug8WTqzQveOH26fodo7g6uFe/a17W3+nFBAkRYENRdb1vkkz1CH9cPsVy/jrhr27PqMYvENYNlHAIesRiBYwRy0V+8iXP8+/fvX11Mr7L7ECueb/r48eMqm7FuI2BGWDEG8cm+7G3NEOfmdcTQw4h9/55lhm7DekRYKQPZF2ArbXTAyu4kDYB2YxUzwg0gi/41ztHnfQG26HbGel/crVrm7tNY+/1btkOEAZ2M05r4FB7r9GbAIdxaZYrHdOsgJ/wCEQY0J74TmOKnbxxT9n3FgGGWWsVdowHtjt9Nnvf7yQM2aZU/TIAIAxrw6dOnAWtZZcoEnBpNuTuObWMEiLAx1HY0ZQJEmHJ3HNvGCBBhY6jtaMoEiJB0Z29vL6ls58vxPcO8/zfrdo5qvKO+d3Fx8Wu8zf1dW4p/cPzLly/dtv9Ts/EbcvGAHhHyfBIhZ6NSiIBTo0LNNtScABFyNiqFCBChULMNNSdAhJyNSiECRCjUbEPNCRAhZ6NSiAARCjXbUHMCRMjZqBQiQIRCzTbUnAARcjYqhQgQoVCzDTUnQIScjUohAkQo1GxDzQkQIWejUogAEQo121BzAkTI2agUIkCEQs021JwAEXI2KoUIEKFQsw01J0CEnI1KIQJEKNRsQ80JECFno1KIABEKNdtQcwJEyNmoFCJAhELNNtScABFyNiqFCBChULMNNSdAhJyNSiECRCjUbEPNCRAhZ6NSiAARCjXbUHMCRMjZqBQiQIRCzTbUnAARcjYqhQgQoVCzDTUnQIScjUohAkQo1GxDzQkQIWejUogAEQo121BzAkTI2agUIkCEQs021JwAEXI2KoUIEKFQsw01J0CEnI1KIQJEKNRsQ80JECFno1KIABEKNdtQcwJEyNmoFCJAhELNNtScABFyNiqFCBChULMNNSdAhJyNSiECRCjUbEPNCRAhZ6NSiAARCjXbUHMCRMjZqBQiQIRCzTbUnAARcjYqhQgQoVCzDTUnQIScjUohAkQo1GxDzQkQIWejUogAEQo121BzAkTI2agUIkCEQs021JwAEXI2KoUIEKFQsw01J0CEnI1KIQJEKNRsQ80JECFno1KIABEKNdtQcwJEyNmoFCJAhELNNtScABFyNiqFCBChULMNNSdAhJyNSiEC/wGgKKC4YMA4TAAAAABJRU5ErkJggg=="}),_("pic_msg_time")]});case x.Cs.VoiceMessage:{var ge=J(n.sendID),$=ge?{paddingLeft:"4px"}:{paddingRight:"4px"},ue=ge?at:pt;return(0,e.jsxs)("div",{style:oe,className:"chat_bg_msg_content_text chat_bg_msg_content_voice ".concat(E?"":"nick_magin"),children:[(0,e.jsxs)("div",{style:{flexDirection:ge?"row-reverse":"row"},onClick:function(){return W(n.soundElem.sourceUrl)},children:[(0,e.jsx)("img",{style:$,src:ue,alt:""}),"".concat(n.soundElem.duration," ''")]}),_()]})}case x.Cs.FileMessage:{var de=n.fileElem,Re=de.fileName.slice(de.fileName.lastIndexOf(".")+1);return(0,e.jsxs)("div",{className:"chat_bg_msg_content_text chat_bg_msg_content_file ".concat(E?"":"nick_magin"),children:[(0,e.jsxs)("div",{className:"file_container",children:[(0,e.jsx)("img",{src:(0,G.Sv)(Re),alt:""}),(0,e.jsxs)("div",{className:"file_info",children:[(0,e.jsx)("div",{children:de.fileName}),(0,e.jsx)("div",{children:(0,G.RD)(de.fileSize)})]})]}),_()]})}case x.Cs.VideoMessage:{var Ne={width:240,controls:!0,playbackRates:[.5,1,1.25,1.5,2],responsive:!0,fluid:!0,sources:[{src:n.videoElem.videoUrl,type:"video/mp4"}]};return(0,e.jsxs)("div",{className:"chat_bg_msg_content_video ".concat(E?"":"nick_magin"),children:[(0,e.jsx)(Ve,{options:Ne,onReady:ke}),_("video_msg_time")]})}case x.Cs.QuoteMessage:{var Ue=n.quoteElem.quoteMessage,Pe=n.quoteElem.text;return Pe=xe(Te(Ee(Pe))),(0,e.jsxs)("div",{style:oe,className:"chat_bg_msg_content_text chat_bg_msg_content_qute ".concat(E?"":"nick_magin"),children:[(0,e.jsxs)("div",{className:"qute_content",children:[(0,e.jsx)("div",{children:"".concat("Reply"+n.quoteElem.quoteMessage.senderNickname,":")}),w(Ue)]}),(0,e.jsx)("div",{dangerouslySetInnerHTML:{__html:Pe}}),_()]})}case x.Cs.MergeMessage:{var _e,Je=n.mergeElem;return(0,e.jsxs)("div",{style:oe,onClick:function(){return Me(Je,n.sendID)},className:"chat_bg_msg_content_text chat_bg_msg_content_mer ".concat(E?"":"nick_magin"),children:[(0,e.jsx)("div",{className:"title",children:Je.title}),(0,e.jsx)("div",{className:"content",children:(_e=Je.abstractList)===null||_e===void 0?void 0:_e.map(function(y){return(0,e.jsx)("div",{className:"item",children:y},y)})}),_()]})}case x.Cs.CardMessage:{var pe=JSON.parse(n.content);return(0,e.jsxs)("div",{style:oe,className:"chat_bg_msg_content_text chat_bg_msg_content_card ".concat(E?"":"nick_magin"),children:[(0,e.jsx)("div",{className:"title",children:"IDCard"}),(0,e.jsxs)("div",{className:"desc",children:[(0,e.jsx)(f.Symbol.Avatar,{src:pe.faceURL,size:35}),(0,e.jsx)("div",{className:"card_nick",children:pe.nickname})]}),_()]})}case x.Cs.LocationMessage:{var vt=n.locationElem,qe={longitude:vt.longitude,latitude:vt.latitude};return(0,e.jsxs)("div",{className:"chat_bg_msg_content_map ".concat(E?"":"nick_magin"),children:[(0,e.jsx)(Ke.D5,{protocol:"https",center:qe,amapkey:"dcdc861728801ee3410f67f6a487d3fa",children:(0,e.jsx)(Ke.Jx,{position:qe})}),_("pic_msg_time")]})}default:return(0,e.jsx)("div",{className:"chat_bg_msg_content_text ".concat(E?"":"nick_magin"),children:"UnsupportedMessage"})}};return be()},Ct=yt,rt=[x.Cs.TextMessage,x.Cs.AtTextMessage,x.Cs.PictureMessage,x.Cs.VideoMessage,x.Cs.VoiceMessage,x.Cs.CardMessage,x.Cs.FileMessage,x.Cs.LocationMessage],Xe=function(u){var n=u.msg,v=u.selfID,r=u.curCve,c=u.mutilSelect,b=u.className,M=(0,o.useState)(!1),E=Y()(M,2),k=E[0],P=E[1],V=(0,o.useRef)(null),Z=(0,o.useRef)(null),te=(0,ie.Z)(Z),oe=Y()(te,1),ae=oe[0],S=(0,o.useMemo)(function(){return v===n.sendID},[v,n.sendID]),J=(0,o.useMemo)(function(){return!r||!isSingleCve(r)},[r]);(0,o.useEffect)(function(){k&&P(!1)},[c]);var le=function(xe,Te){n.isRead=!0,ce.S.markC2CMessageAsRead({userID:xe,msgIDList:[Te]})};(0,o.useEffect)(function(){ae&&r.userID===n.sendID&&!n.isRead&&le(n.sendID,n.clientMsgID)},[ae,r]);var N=(0,o.useCallback)(function(){switch(n.status){case 1:return(0,e.jsx)(e.Fragment,{children:"loading..."});case 2:return r&&isSingleCve(r)?n.isRead?"\u5DF2\u8BFB":"\u672A\u8BFB":null;case 3:return(0,e.jsx)(e.Fragment,{});default:return null}},[r,n.isRead,n.status]),Me=function(){c&&rt.includes(n.contentType)&&(events.emit(MUTILMSGCHANGE,!k,n),P(function(xe){return!xe}))},_=function(){isSingleCve(r)||events.emit(ATSTATEUPDATE,n.sendID,n.senderNickname)};return(0,Ie.Z)(_,V,{onClick:function(){},delay:500}),(0,e.jsx)("div",{ref:Z,onClick:Me,className:D()("msg-item d-flex mb-10",b,{"justify-content-start":!S,"justify-content-end":S,"mt-4":S}),children:(0,e.jsxs)("div",{className:D()("d-flex align-items-start",{"flex-column":J,"flex-row-reverse":S&&!J,"flex-row":!S&&!J}),children:[(0,e.jsxs)("div",{className:D()("d-flex align-items-center mb-2"),children:[(0,e.jsx)(f.Symbol.Avatar,{className:D()({"me-4":!S&&!J,"ms-4":S&&!J}),light:!0,size:40,alt:n.senderNickname,src:n.senderFaceUrl}),J&&(0,e.jsxs)("div",{className:"ms-3",children:[(0,e.jsx)("a",{href:"#",className:"fs-5 fw-bold text-gray-900 text-hover-primary me-1",children:n.senderNickname}),(0,e.jsx)("span",{className:"text-muted fs-7 mb-1",children:"2 mins"})]})]}),(0,e.jsxs)("div",{className:D()("msg-item-content rounded text-dark fw-semibold mw-lg-400px text-start",{"bg-light-info":!S,"bg-light-primary":S}),children:[(0,e.jsx)(mt,{msg:n,isSelf:S,children:(0,e.jsx)(Ct,Ce()({},u))},n.clientMsgID),S&&(0,e.jsx)("div",{style:{color:n.isRead?"#999":"#428BE5"},className:"self_msg_chat_flag",children:N()})]})]})})},st=Xe;function Ze(I){var u,n=(0,o.useRef)(null),v=I.merID,r=I.msgList,c=I.loadMore,b=I.hasMore,M=I.curCve,E=I.loading,k=(0,o.useState)(!1),P=Y()(k,2),V=P[0],Z=P[1],te=(u=(0,d.ot)().data)===null||u===void 0?void 0:u.uid,oe=Object.values(a.j7),ae=function(Me){Z(Me)};(0,o.useEffect)(function(){return s.Z.on(a.rl,ae),function(){s.Z.off(a.rl,ae)}},[]);var S=(0,o.useCallback)(function(N){return N===te},[te]),J=(0,o.useCallback)(function(N){if(N.contentType===a.j7.RevokeMessage){var Me=N.sendID,_=(0,G.vJ)(M)?M==null?void 0:M.showName:N.senderNickname;return(0,e.jsxs)(e.Fragment,{children:[S(Me)?"\u4F60":(0,e.jsx)("b",{children:_}),"\u64A4\u56DE\u4E86\u4E00\u6761\u6D88\u606F"]})}switch(N.contentType){case a.j7.FriendAdded:return"AlreadyFriend";case a.j7.GroupCreated:{var Ee=JSON.parse(N.notificationElem.detail),xe=Ee.opUser;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("b",{children:S(xe.userID)?"You":xe.nickname}),"GroupCreated"]})}case a.j7.GroupNameUpdated:{var Te=JSON.parse(N.notificationElem.detail),w=Te.opUser;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("b",{children:S(w.userID)?"You":w.nickname}),"ModifiedGroup"]})}case a.j7.GroupOwnerTransferred:{var W=JSON.parse(N.notificationElem.detail),ke=W.opUser,be=W.newGroupOwner;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("b",{children:S(ke.userID)?"You":ke.nickname}),"TransferTo",(0,e.jsx)("b",{children:S(be.userID)?"You":be.nickname})]})}case a.j7.MemberQuit:{var re=JSON.parse(N.notificationElem.detail),Q=re.quitUser;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("b",{children:S(Q.userID)?"You":Q.nickname}),"QuitedGroup"]})}case a.j7.MemberInvited:{var g,X=JSON.parse(N.notificationElem.detail),ge=X.opUser,$=(g=X.invitedUserList)!==null&&g!==void 0?g:[],ue=[];return $.forEach(function(pe){return ue.push((0,e.jsx)("b",{children:S(pe.userID)?"You":pe.nickname+" "},pe.userID))}),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("b",{children:S(ge.userID)?"You":ge.nickname}),"Invited",ue.map(function(pe){return pe}),"IntoGroup"]})}case a.j7.MemberKicked:{var de,Re=JSON.parse(N.notificationElem.detail),Ne=Re.opUser,Ue=(de=Re.kickedUserList)!==null&&de!==void 0?de:[],Pe=[];return Ue.forEach(function(pe){return Pe.push((0,e.jsx)("b",{children:S(pe.userID)?"You":pe.nickname},pe.userID))}),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("b",{children:S(Ne.userID)?"You":Ne.nickname}),"Kicked",Pe.map(function(pe){return pe}),"OutGroup"]})}case a.j7.MemberEnter:{var _e=JSON.parse(N.notificationElem.detail),Je=_e.entrantUser;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("b",{children:S(Je.userID)?"You":Je.nickname}),"JoinedGroup"]})}default:return JSON.parse(N.content).defaultTips}},[M,S]),le=(0,o.useCallback)(function(){c(M==null?void 0:M.userID,M==null?void 0:M.groupID,r[r.length-1])},[M==null?void 0:M.groupID,M==null?void 0:M.userID,c,r]);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Le,{holdHeight:40,ref:I.scrollbar,loading:E,data:r,fetchMoreData:le,hasMore:b,children:r==null?void 0:r.map(function(N,Me){return oe.includes(N.contentType)?(0,e.jsx)("div",{className:D()("chat_bg_tips",{"mb-6":Me===0}),children:J(N)},N.clientMsgID):(0,e.jsx)(st,{audio:n,mutilSelect:V,msg:N,selfID:v!=null?v:te,curCve:M},N.clientMsgID)})}),(0,e.jsx)("audio",{ref:n})]})}var At=Ze,Mt=t(19632),Oe=t.n(Mt),$e=t(3930),it=t(13769),ot=t.n(it),lt=t(12444),ct=t.n(lt),ut=t(72004),dt=t.n(ut),i=t(25098),l=t.n(i),B=t(31996),K=t.n(B),Se=t(26037),Be=t.n(Se),Ye=t(9783),fe=t.n(Ye),ze=t(64063),me=t.n(ze),Fe=["tagName","html","innerRef","placeholder"];function It(I){return I&&I.replace(/&nbsp;|\u202F|\u00A0/g," ")}function Qe(I){var u=document.createTextNode("");I.appendChild(u);var n=document.activeElement===I;if(u!==null&&u.nodeValue!==null&&n){var v=window.getSelection();if(v!==null){var r=document.createRange();r.setStart(u,u.nodeValue.length),r.collapse(!0),v.removeAllRanges(),v.addRange(r)}I instanceof HTMLElement&&I.focus()}}var Tt=function(I){K()(n,I);var u=Be()(n);function n(){var v;ct()(this,n);for(var r=arguments.length,c=new Array(r),b=0;b<r;b++)c[b]=arguments[b];return v=u.call.apply(u,[this].concat(c)),fe()(l()(v),"lastHtml",v.props.html),fe()(l()(v),"el",typeof v.props.innerRef=="function"?{current:null}:o.createRef()),fe()(l()(v),"getEl",function(){return(v.props.innerRef&&typeof v.props.innerRef!="function"?v.props.innerRef:v.el).current}),fe()(l()(v),"emitChange",function(M){var E=v.getEl();if(E){var k=E.innerHTML;if(v.props.onChange&&k!==v.lastHtml){var P=Object.assign({},M,{target:{value:k}});v.props.onChange(P)}v.lastHtml=k}}),v}return dt()(n,[{key:"render",value:function(){var r=this,c=this.props,b=c.tagName,M=c.html,E=c.innerRef,k=c.placeholder,P=ot()(c,Fe);return o.createElement(b||"div",Ce()(Ce()({},P),{},fe()(fe()(fe()(fe()(fe()(fe()(fe()(fe()({},"data-placeholder",k),"ref",typeof E=="function"?function(V){E(V),r.el.current=V}:E||this.el),"onInput",this.emitChange),"onBlur",this.props.onBlur||this.emitChange),"onKeyUp",this.props.onKeyUp||this.emitChange),"onKeyDown",this.props.onKeyDown||this.emitChange),"contentEditable",!this.props.disabled),"dangerouslySetInnerHTML",{__html:M})),this.props.children)}},{key:"shouldComponentUpdate",value:function(r){var c=this.props,b=this.getEl();return!b||It(r.html)!==It(b.innerHTML)?!0:c.disabled!==r.disabled||c.tagName!==r.tagName||c.className!==r.className||c.innerRef!==r.innerRef||c.placeholder!==r.placeholder||!me()(c.style,r.style)}},{key:"componentDidUpdate",value:function(){var r=this.getEl();r&&(this.props.html!==r.innerHTML&&(r.innerHTML=this.props.html),this.lastHtml=this.props.html,Qe(r))}}]),n}(o.Component),bt=function(u,n){var v=new FileReader;v.onload=function(r){var c,b=(c=r.target)===null||c===void 0?void 0:c.result;n(b)},v.readAsDataURL(u)},Rt=function(u){var n=u,v=/\<img.*?\">/g,r=n.match(v);if(r&&r.length>0){var c=ee()(r),b;try{for(c.s();!(b=c.n()).done;){var M=b.value;n=n.replaceAll(M,"")}}catch(E){c.e(E)}finally{c.f()}}return n},St=function(u){var n=u,v=Oe()(Array.from(document.getElementsByClassName("face_el"))),r=ee()(v),c;try{for(r.s();!(c=r.n()).done;){var b=c.value;n=n.replaceAll(b.outerHTML,b.alt)}}catch(M){r.e(M)}finally{r.f()}return n},Lt=function(u){var n=u;return n.slice(-4)==="<br>"&&(n=n.slice(0,-4)),n=n.replaceAll("<br>",`
`),n},Bt=function(){var u=Oe()(Array.from(document.getElementsByClassName("screenshot_el")));u.length>0&&(u[u.length-1].alt="last",u.map(function(){var n=T()(h()().mark(function v(r){var c;return h()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:c=(0,G._x)(r.src),console.log(c);case 2:case"end":return M.stop()}},v)}));return function(v){return n.apply(this,arguments)}}()))};function Qt(I){var u=I.curCve,n=I.sendMsg,v=(0,o.useRef)(null),r=(0,o.useRef)(null),c=(0,o.useState)(""),b=Y()(c,2),M=b[0],E=b[1],k=(0,$e.Z)(M),P=(0,o.useState)(),V=Y()(P,2),Z=V[0],te=V[1],oe=(0,o.useState)([]),ae=Y()(oe,2),S=ae[0],J=ae[1],le=(0,gt.useModel)("open-im.contacts",function(y){var C=y.state;return C.groupMemberList}),N=(0,o.useState)(!1),Me=Y()(N,2),_=Me[0],Ee=Me[1],xe=(0,$e.Z)(_),Te=(0,o.useState)([]),w=Y()(Te,2),W=w[0],ke=w[1],be=function(C,O){ce.S.typingStatusUpdate({recvID:C,msgTip:O})},re=(0,o.useCallback)(function(){(0,G.vJ)(u)&&(v.current&&clearTimeout(v.current),v.current=setTimeout(function(){be(u.userID,"yes")},2e3))},[u]),Q=function(){var y=T()(h()().mark(function C(O){var R,U,q;return h()().wrap(function(De){for(;;)switch(De.prev=De.next){case 0:R=(O.originalEvent||O).clipboardData,R&&R.items[0].type.indexOf("image")===-1?(O.preventDefault(),U=R.getData("text/plain")||"",document.execCommand("insertText",!1,U)):R&&R.items[0].type.indexOf("image")>-1&&(O.preventDefault(),q=R.items[0].getAsFile(),bt(q,function(ft){var Et='<img style="vertical-align:bottom" class="screenshot_el" src="'.concat(ft,'" alt="" >');document.execCommand("insertHTML",!1,Et)}));case 2:case"end":return De.stop()}},C)}));return function(O){return y.apply(this,arguments)}}(),g=(0,o.useRef)({curCve:u,msgContent:M,latestContent:k,atList:S,groupMemberList:le,replyMsg:Z,draftSaved:!1});g.current.msgContent=M,g.current.curCve=u,g.current.latestContent=k,g.current.atList=S,g.current.groupMemberList=le,g.current.replyMsg=Z;var X=(0,o.useCallback)(function(y,C){var O=g.current.atList,R=g.current.latestContent,U=g.current.replyMsg;if(U&&te(void 0),O.findIndex(function(ne){return ne.id===y})===-1){var q='<b class="at_el" data_id="'.concat(y,'" data_name="').concat(C,'" contenteditable="false" style="color:#428be5"> @').concat(C,"</b>");J([].concat(Oe()(O),[{id:y,name:C,tag:q}])),E(R.current+q),(0,G.RT)(r.current.el)}},[]),ge=(0,o.useCallback)(function(y){var C=y,O=g.current.atList,R=ee()(O),U;try{for(R.s();!(U=R.n()).done;){var q=U.value;C=C.replaceAll(q.tag,"@".concat(q.id," "))}}catch(ne){R.e(ne)}finally{R.f()}return C},[]),$=(0,o.useCallback)(function(y){var C=g.current.latestContent,O=g.current.atList;if(y.draftText!==C.current&&(y.draftText!==""||C.current!=="")){g.current.draftSaved=!0;var R=C.current;R=St(R);var U={conversationID:y.conversationID,draftText:O.length>0?ge(R):R};ce.S.setConversationDraft(U).then(function(q){console.warn(q)}).catch(function(q){console.warn(q)}).finally(function(){E("")})}},[ge]),ue=(0,o.useCallback)(function(){g.current.latestContent.current="",E(""),te(void 0),J([]),Ee(!1),$(u)},[u,$]),de=(0,o.useCallback)(function(){var y=T()(h()().mark(function C(O){var R,U;return h()().wrap(function(ne){for(;;)switch(ne.prev=ne.next){case 0:return ne.next=2,ce.S.createTextMessage(O);case 2:R=ne.sent,U=R.data,n(U.atTextElem.text,x.Cs.TextMessage),ue();case 6:case"end":return ne.stop()}},C)}));return function(C){return y.apply(this,arguments)}}(),[ue,n]),Re=(0,o.useCallback)(function(){var y=T()(h()().mark(function C(O){var R,U,q;return h()().wrap(function(De){for(;;)switch(De.prev=De.next){case 0:return R={text:O,atUserIDList:S.map(function(ft){return ft.id})},De.next=3,ce.S.createTextAtMessage(R);case 3:U=De.sent,q=U.data,n(q.atTextElem.text,x.Cs.AtTextMessage),ue();case 7:case"end":return De.stop()}},C)}));return function(C){return y.apply(this,arguments)}}(),[S,ue,n]),Ne=(0,o.useCallback)(function(){var y=T()(h()().mark(function C(O){var R,U;return h()().wrap(function(ne){for(;;)switch(ne.prev=ne.next){case 0:return ne.next=2,ce.S.createQuoteMessage({text:O,message:JSON.stringify(Z)});case 2:R=ne.sent,U=R.data,n(U.atTextElem.text,x.Cs.QuoteMessage),ue();case 6:case"end":return ne.stop()}},C)}));return function(C){return y.apply(this,arguments)}}(),[ue,Z,n]),Ue=(0,o.useCallback)(function(y){var C=k.current;if(C=Rt(St(C)),C=Lt(C),Bt(),C!=="")switch(y){case"text":de(C);break;case"at":Re(ge(C));break;case"quote":Ne(C);break;default:break}},[k,ge,Ne,Re,de]),Pe=(0,o.useCallback)(function(y){y.key==="Enter"&&y.metaKey&&(y.preventDefault(),(0,G.Tf)(),(0,G.RT)(r.current.el)),y.key==="Enter"&&!y.metaKey&&(y.preventDefault(),k.current&&!xe.current&&(Ee(!0),Ue(Z?"quote":S.length>0?"at":"text")))},[S.length,k,xe,Z,Ue]),_e=(0,o.useCallback)(function(y){E(y.target.value);var C=Oe()(Array.from(document.getElementsByClassName("at_el"))),O=[];C.map(function(R){var U,q;return O.push({id:(U=R.attributes.getNamedItem("data_id"))===null||U===void 0?void 0:U.value,name:(q=R.attributes.getNamedItem("data_name"))===null||q===void 0?void 0:q.value,tag:R.outerHTML})}),J(O),re()},[re]),Je=(0,o.useCallback)(function(y){var C=y,O=ee()(nt),R;try{for(O.s();!(R=O.n()).done;){var U=R.value,q=C.indexOf(U.context);if(q>-1){var ne='<img class="face_el" alt="'.concat(U.context,'" style="padding-right:2px" width="24px" src="').concat(U.src,'">');C=C.replaceAll(U.context,ne)}}}catch(De){O.e(De)}finally{O.f()}return C},[]),pe=(0,o.useCallback)(function(y){var C=y,O=/@\S+\s/g,R=C.match(O)||[],U=[],q=g.current.groupMemberList,ne=ee()(R),De;try{var ft=function(){var Nt=De.value,et=q.find(function(Zt){return Zt.userID===Nt.slice(1,-1)});if(et){var jt='<b class="at_el" data_id="'.concat(et.userID,'" data_name="').concat(et.nickname,'" contenteditable="false" style="color:#428be5"> @').concat(et.nickname,"</b>");C=C.replaceAll(Nt,jt),U.push({id:et.userID,name:et.nickname,tag:jt})}};for(ne.s();!(De=ne.n()).done;)ft()}catch(Et){ne.e(Et)}finally{ne.f()}return J(U),C},[]),vt=(0,o.useCallback)(function(y){E(Je(pe(y)))},[pe,Je]);(0,o.useEffect)(function(){g.current.draftSaved=!1;var y=g.current.atList;return y.length>0&&J([]),u.draftText!==""?vt(u.draftText):E(""),ke([]),function(){g.current.draftSaved||$(u)}},[u,vt,$]);var qe=(0,o.useCallback)(function(y,C){var O=Oe()(W);if(y)O=[].concat(Oe()(O),[C]);else{var R=O.findIndex(function(U){return U.clientMsgID===C.clientMsgID});O.splice(R,1)}ke(O)},[W]);return(0,o.useEffect)(function(){return s.Z.on(a.Co,qe),function(){s.Z.off(a.Co,qe)}},[qe]),(0,o.useEffect)(function(){return s.Z.on(a.oJ,X),s.Z.on(a.jf,$),function(){s.Z.off(a.oJ,X),s.Z.off(a.jf,$)}},[X,$]),(0,e.jsxs)("div",{className:"pt-4 ps-8 h-100 d-flex flex-column",children:[(0,e.jsxs)("div",{className:"d-flex flex-row mb-2",children:[(0,e.jsx)(f.Tooltip,{placement:"bottom",inverse:!0,title:"\u8868\u60C5",children:(0,e.jsx)(f.Button,{variant:!1,icon:(0,e.jsx)(z.JO,{name:"Bootstrap/emoji-smile",className:"svg-icon-2"}),activeColor:"secondary",className:"me-1"})}),(0,e.jsx)(f.Tooltip,{placement:"bottom",inverse:!0,title:"\u53D1\u9001\u540D\u7247",children:(0,e.jsx)(f.Button,{variant:!1,icon:(0,e.jsx)(z.JO,{name:"Bootstrap/person-badge",className:"svg-icon-2"}),activeColor:"secondary",className:"me-1"})}),(0,e.jsx)(f.Tooltip,{placement:"bottom",inverse:!0,title:"\u53D1\u9001\u6587\u4EF6",children:(0,e.jsx)(f.Button,{variant:!1,icon:(0,e.jsx)(z.JO,{name:"Bootstrap/folder-plus",className:"svg-icon-2"}),activeColor:"secondary",className:"me-1"})}),(0,e.jsx)(f.Tooltip,{placement:"bottom",inverse:!0,title:"\u53D1\u9001\u56FE\u7247",children:(0,e.jsx)(f.Button,{variant:!1,icon:(0,e.jsx)(z.JO,{name:"Bootstrap/card-image",className:"svg-icon-2"}),activeColor:"secondary",className:"me-1"})}),(0,e.jsx)(f.Tooltip,{placement:"bottom",inverse:!0,title:"\u53D1\u9001\u89C6\u9891",children:(0,e.jsx)(f.Button,{variant:!1,icon:(0,e.jsx)(z.JO,{name:"Bootstrap/film",className:"svg-icon-2"}),activeColor:"secondary",className:"me-1"})})]}),(0,e.jsxs)("div",{className:"ps-3 flex-row-fluid position-relative",children:[(0,e.jsx)(Tt,{style:{paddingTop:Z?"32px":"4px"},placeholder:"\u53D1\u9001\u7ED9 ".concat(u.showName),className:"h-100",ref:r,html:M,onChange:_e,onKeyDown:Pe,onPaste:Q}),(0,e.jsxs)("div",{className:"chat-msg-actions d-flex flex-row position-absolute",children:[(0,e.jsxs)("div",{className:"d-flex flex-row align-items-center fs-10 text-gray-500 me-6",children:[(0,e.jsx)(z.JO,{name:"Bootstrap/arrow-return-left",className:"svg-icon-7 me-2"})," ","\u53D1\u9001",(0,e.jsx)("span",{className:"mx-3",children:"/"}),(0,e.jsx)(z.JO,{name:"Bootstrap/command",className:"svg-icon-7 me-2"})," \u6362\u884C"]}),(0,e.jsx)(f.Button,{className:"px-5",children:"\u53D1\u9001"})]})]})]})}var Ot=Qt;function Ft(){return(0,e.jsx)("div",{className:"d-flex align-items-center justify-content-center h-100",children:(0,e.jsx)("img",{src:"/assets/media/illustrations/dozzy-1/12.png",className:"mw-100 h-200px h-sm-325px"})})}var kt=Ft,Ut=t(230),Yt=t(14903),Pt=function(u){var n=u.userId,v=u.typing,r=(0,Ut.ED)({variables:{id:n},fetchPolicy:"cache-and-network"}),c=Y()(r,2),b=c[0],M=c[1],E=M.data,k=M.refetch,P=E==null?void 0:E.user.onlineStatus.status,V=E==null?void 0:E.user.onlineStatus.detailPlatformStatus,Z=(0,o.useMemo)(function(){if(P==="online"){var oe="",ae=ee()(V||[]),S;try{for(ae.s();!(S=ae.n()).done;){var J=S.value;J.status==="online"&&(oe+="".concat(J.platform,"/"))}}catch(le){ae.e(le)}finally{ae.f()}return"".concat(oe.slice(0,-1)," \u5728\u7EBF")}return"\u79BB\u7EBF"},[P,V]),te=(0,o.useRef)(P);return te.current=P,(0,o.useEffect)(function(){te.current!=="online"&&k()},[b,k,v]),(0,e.jsxs)("div",{className:"mb-0 lh-1 d-flex flex-row align-items-center",children:[(0,e.jsx)(f.Badge,{color:P==="online"?"primary":"secondary",shape:"circle",className:"w-10px h-10px me-1"}),(0,e.jsx)("span",{className:"fs-7 fw-semibold text-muted",children:Z})]})},Jt=function(){return(0,e.jsx)(e.Fragment,{})},Ht=105,wt=350;function Dt(I){return Math.min(wt,Math.max(Ht,I))}function Gt(I){var u=I.msgList,n=I.loadMore,v=I.hasMore,r=I.curCve,c=I.loading,b=I.sendMsg,M=I.scrollbar,E=I.typing,k=I.onBack,P=(0,o.useRef)({height:200}),V=(0,o.useReducer)(function(J){return J+1},0),Z=Y()(V,2),te=Z[1],oe=(0,o.useMemo)(function(){return r&&(0,G.vJ)(r)},[r]),ae=(0,o.useCallback)(function(J){P.current.height+=J,te()},[]),S=(0,o.useCallback)(function(){P.current.height=Dt(P.current.height)},[]);return(0,e.jsx)(j.vs,{className:"app-chat-main background-transparent",contentClassName:"px-0",footer:!1,header:!1,children:(0,e.jsxs)(f.Card,{className:"card chat_messenger",id:"kt_chat_messenger",children:[r&&(0,e.jsxs)(f.Card.Header,{id:"kt_chat_messenger_header",children:[(0,e.jsxs)(f.Card.Title,{className:"d-flex align-items-center",children:[(0,e.jsx)(f.Symbol.Avatar,{light:!0,size:45,alt:r==null?void 0:r.showName,src:r==null?void 0:r.faceURL}),(0,e.jsxs)("div",{className:"ms-5 d-flex justify-content-center flex-column me-3",children:[(0,e.jsx)("a",{href:"#",className:"fs-4 fw-bold text-gray-900 text-hover-primary me-1 mb-2 lh-1",children:r.showName}),(0,e.jsxs)("div",{className:"d-flex flex-row align-items-center",children:[oe?(0,e.jsx)(Pt,{userId:r.userID,typing:!!E}):(0,e.jsx)(Jt,{}),E&&(0,e.jsx)("span",{className:"mb-0 lh-1 ms-4 fs-7 fw-semibold text-muted",children:"\u6B63\u5728\u8F93\u5165..."})]})]})]}),(0,e.jsxs)(f.Card.Toolbar,{children:[(0,e.jsx)(f.Tooltip,{placement:"bottom",inverse:!0,title:"\u6587\u4EF6",children:(0,e.jsx)(f.Button,{className:"me-4",icon:(0,e.jsx)(z.JO,{name:"Bootstrap/folder",className:"svg-icon-2"}),variant:!1,activeColor:"light-primary"})}),(0,e.jsx)(f.Tooltip,{placement:"bottom",inverse:!0,title:"\u804A\u5929\u8BB0\u5F55",children:(0,e.jsx)(f.Button,{className:"me-4",icon:(0,e.jsx)(z.JO,{name:"Bootstrap/list-ul",className:"svg-icon-2"}),variant:!1,activeColor:"light-primary"})}),(0,e.jsx)(f.Tooltip,{placement:"bottom",inverse:!0,title:"\u6DFB\u52A0\u6210\u5458",children:(0,e.jsx)(f.Button,{className:"me-4",icon:(0,e.jsx)(z.JO,{name:"Bootstrap/person-plus",className:"svg-icon-2"}),variant:!1,activeColor:"light-primary"})}),(0,e.jsx)(f.Tooltip,{placement:"bottom",inverse:!0,title:"\u804A\u5929\u8BBE\u7F6E",children:(0,e.jsx)(f.Button,{className:D()({"me-4":!!k}),icon:(0,e.jsx)(z.JO,{name:"Bootstrap/gear",className:"svg-icon-2"}),variant:!1,activeColor:"light-primary"})}),k&&(0,e.jsx)(f.Tooltip,{placement:"bottom",inverse:!0,title:"\u8FD4\u56DE\u6D88\u606F\u5217\u8868",children:(0,e.jsx)(f.Button,{onClick:k,icon:(0,e.jsx)(z.JO,{name:"Bootstrap/arrow-return-left",className:"svg-icon-2"}),variant:!1,activeColor:"light-primary"})})]})]}),(0,e.jsx)(f.Card.Body,{className:"pe-0 py-0 overflow-hidden",id:"kt_chat_messenger_body",children:r?(0,e.jsx)(At,{loadMore:n,loading:c,msgList:u,hasMore:v,curCve:r,scrollbar:M}):(0,e.jsx)(kt,{})}),r&&(0,e.jsx)(f.Card.Footer,{className:"p-0",id:"kt_chat_messenger_footer",children:(0,e.jsx)(ye.w_,{style:{height:Dt(P.current.height)},direction:"y",onResize:ae,onResizeEnd:S,children:(0,e.jsx)(Ot,{curCve:r,sendMsg:b})})})]})})}var Kt=Gt},26699:function(He,he,t){t.d(he,{Z:function(){return A.Z}});var A=t(74314)},75517:function(He,he,t){t.d(he,{Z:function(){return d}});var A=t(1861),ee=t(13757),ve=t(62435),Y=t(12845),o=t(93967),z=t.n(o),ye=t(51056),se=t(36603),D=t(86074);function j(a){var s=a.data,L=a.onClick,h=a.curCve,F=(0,Y.useModel)("@@initialState",function(Le){var m;return(m=Le.initialState)===null||m===void 0||(m=m.currentUser)===null||m===void 0?void 0:m.uid}),T=function(m){if(m==="")return m;var Ce=JSON.parse(m);if(s.draftText!==""){var ie=s.draftText,Ie=/\<img.*?\">/g,x=ie.match(Ie);return x&&x.length>0&&x.forEach(function(ce){ie=ie.replaceAll(ce,"Picture")}),(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)("span",{className:"text-warning me-1",children:"[\u8349\u7A3F]"}),ie]})}return(0,se.LF)(Ce,F)},H=function(m){return m===ye.PD.Nomal},je=H(s==null?void 0:s.recvMsgOpt)?T(s.latestMsg):s.unreadCount>0?"[".concat(s.unreadCount+"Piece","] ").concat(T(s.latestMsg)):T(s.latestMsg),e=function(m){var Ce=(0,se.p6)(m),ie=(0,se.p6)(m+864e5),Ie=(0,se.p6)(new Date().getTime());return Ce[3]===Ie[3]?Ce[4]:ie[3]===Ie[3]?"\u6628\u5929":Ce[3]},we=(0,ve.useCallback)(function(){L(s)},[s,L]);return(0,D.jsxs)("div",{className:z()("cve-item d-flex flex-stack py-4 mb-1",{active:(h==null?void 0:h.conversationID)===s.conversationID}),onClick:we,children:[(0,D.jsxs)("div",{className:"d-flex align-items-center",children:[(0,D.jsx)(ee.Symbol.Avatar,{size:45,alt:s.showName,light:!0,badge:(0,D.jsx)(ee.Badge,{dot:!H(s==null?void 0:s.recvMsgOpt)&&s.unreadCount>0,color:"danger",shape:"circle",className:"start-100",count:H(s==null?void 0:s.recvMsgOpt)?s.unreadCount:null})}),(0,D.jsxs)("div",{className:"ms-5",children:[(0,D.jsx)("a",{href:"#",className:"fs-5 fw-bold text-gray-900 text-hover-primary mb-2",children:s.showName}),(0,D.jsx)("div",{className:"fw-semibold text-muted cve_msg",children:je})]})]}),(0,D.jsx)("div",{className:"d-flex flex-column align-items-end ms-2",children:(0,D.jsx)("span",{className:"text-muted fs-7 mb-1",children:e(s.latestMsgSendTime)})})]})}var f=j;function G(a){var s=a.curCve,L=a.cves,h=a.onItemClick;return(0,D.jsx)(A.E,{className:"d-flex flex-column custom-scrollbar px-2 cve-list",options:{scrollbars:{autoHide:"scroll"}},children:(0,D.jsx)(ee.Card,{flush:!0,className:"py-0 px-2 background-transparent",bodyClassName:"pt-5 pb-0 px-1 cve-list",children:L.map(function(F){return(0,D.jsx)(f,{onClick:h,cveList:L,data:F,curCve:s},F.conversationID)})})})}var d=G},83988:function(He,he,t){var A=t(5574),ee=t.n(A),ve=t(62435),Y=t(46027),o=t(93967),z=t.n(o),ye=t(13757),se=t(86074);function D(j){var f=j.onSearch,G=j.className,d=(0,ve.useState)(""),a=ee()(d,2),s=a[0],L=a[1],h=(0,ve.useCallback)(function(F){L(F.target.value),f(F.target.value)},[f]);return(0,se.jsxs)("div",{className:z()("cve-searchbar ps-6 pe-6 d-flex justify-content-sm-between align-items-center",G),children:[(0,se.jsx)(ye.Input.Search,{solid:!0,size:"lg",boxClassName:"flex-row-fluid me-2",value:s,onChange:h,placeholder:"\u641C\u7D22..."}),(0,se.jsx)("a",{className:z()("cve-searchbar-actions"),children:(0,se.jsx)(Y.JO,{className:z()("svg-icon-2x svg-icon-dark"),name:"Duotune/arr087"})})]})}he.Z=D},230:function(He,he,t){t.d(he,{ED:function(){return f}});var A=t(97857),ee=t.n(A),ve=t(68400),Y=t.n(ve),o=t(75063),z=t(73359),ye,se={},D=(0,o.Ps)(ye||(ye=Y()([`
    query getUserOnlineStatus($id: ID!) {
  user(id: $id) {
    id
    name
    onlineStatus {
      status
      detailPlatformStatus {
        platform
        status
      }
    }
  }
}
    `])));function j(d){var a=_objectSpread(_objectSpread({},se),d);return Apollo.useQuery(D,a)}function f(d){var a=ee()(ee()({},se),d);return z.t(D,a)}function G(d){var a=_objectSpread(_objectSpread({},se),d);return Apollo.useSuspenseQuery(D,a)}},50252:function(He,he,t){t.d(he,{RJ:function(){return Le}});var A=t(230),ee=t(15009),ve=t.n(ee),Y=t(99289),o=t.n(Y),z=t(97857),ye=t.n(z),se=t(19632),D=t.n(se),j=t(62435),f=t(12845),G=t(74857),d=t(63438),a=t(83956),s=t(51056),L=t(13757),h=t(65956),F=t(36603),T=t(97961),H=t(78864),je=function(){return(Math.random()*36).toString(36).slice(2)+new Date().getTime().toString()},e=function(Ce,ie){return new Promise(function(Ie,x){h.S.getOneConversation({sourceID:Ce,sessionType:ie}).then(function(ce){return Ie(ce.data)}).catch(function(ce){return x(ce)})})};function we(){var m=(0,f.useModel)("open-im.cve",function(i){var l=i.state;return l.curCve}),Ce=(0,f.useModel)("open-im.cve",function(i){var l=i.state;return l.cveInitLoading}),ie=(0,f.useModel)("open-im.cve",function(i){var l=i.actions;return l.setCurCve}),Ie=(0,f.useModel)("open-im.cve",function(i){var l=i.state;return l.cves}),x=(0,f.useModel)("@@initialState",function(i){var l,B=i.initialState;return B==null||(l=B.currentUser)===null||l===void 0?void 0:l.uid}),ce=(0,f.useModel)("open-im.contacts",function(i){var l=i.actions;return l.getGroupInfo}),Ge=(0,f.useModel)("open-im.contacts",function(i){var l=i.actions;return l.getGroupMemberList}),Ae=[],p=(0,G.Z)({historyMsgList:[],firstLoad:!1,typing:!1,hasMore:!0,merModal:!1,merData:void 0,searchStatus:!1,searchCve:[]}),tt=(0,j.useRef)(null),mt=(0,j.useRef)(),Ke=(0,j.useCallback)(function(i){var l;(l=mt.current)===null||l===void 0||l.scroll({y:"100%"},i!=null?i:350)},[]);function gt(i){if(JSON.parse(i.data).length===0){p.hasMore=!1;return}JSON.stringify(p.historyMsgList[p.historyMsgList.length-1])===JSON.stringify(JSON.parse(i.data).reverse()[0])&&p.historyMsgList.pop(),p.historyMsgList=[].concat(D()(p.historyMsgList),D()(JSON.parse(i.data).reverse())),p.firstLoad||(p.firstLoad=!0,setTimeout(function(){return Ke(0)})),p.hasMore=!(JSON.parse(i.data).length<20)}var We=(0,d.Z)(h.S.getAdvancedHistoryMessageList,{manual:!0,onSuccess:gt,onError:function(l){return console.log("GetChatRecordFailed",l)}}),xt=We.loading,ht=We.run,nt=We.cancel,at=(0,j.useCallback)(function(i,l,B){var K,Se={userID:i!=null?i:"",groupID:l!=null?l:"",count:20,startClientMsgID:(K=B==null?void 0:B.clientMsgID)!==null&&K!==void 0?K:""};ht(Se)},[ht]),pt=(0,j.useCallback)(function(i,l){h.S.markMessagesAsReadByMsgID({conversationID:i,clientMsgIDList:l})},[]),Ve=(0,j.useCallback)(function(i,l){i.unreadCount===0&&!l||(0,F.vJ)(i)&&pt(i.userID,[])},[pt]),yt=(0,j.useCallback)(function(i){i?(p.searchStatus=!0,p.searchCve=Ie.filter(function(l){return l.conversationID.indexOf(i)>-1||l.showName.indexOf(i)>-1})):(p.searchCve=[],p.searchStatus=!1)},[Ie,p]),Ct=(0,j.useCallback)(function(i){if(!(0,F.vJ)(i)){ce(i.groupID);var l={groupID:i.groupID,offset:0,filter:0,count:2e3};Ge(l)}},[ce,Ge]),rt=(0,j.useCallback)(function(i){i.conversationID!==(m==null?void 0:m.conversationID)&&(m&&H.Z.emit(T.jf,m),p.historyMsgList=[],p.firstLoad=!1,ie(i),p.hasMore=!0,Ct(i),nt(),at(i.userID,i.groupID),Ve(i))},[m,at,Ct,Ve,nt,p,ie]),Xe=(0,j.useCallback)(function(i,l,B){Ae.forEach(function(K){if(K.oid===i.operationID){var Se=p.historyMsgList.findIndex(function(Be){return Be.clientMsgID===(K==null?void 0:K.mid)});Se!==-1&&(K.flag=!0,B?p.historyMsgList[Se].status=3:p.historyMsgList[Se]=i.data)}}),l===s.Cs.MergeMessage&&L.Toast.success("ForwardSuccessTip"),Ke()},[Ae,p.historyMsgList,Ke]),st=(0,j.useCallback)(function(i,l,B,K){var Se=je();if(B&&(m==null?void 0:m.userID)===B||K&&(m==null?void 0:m.groupID)===K||!B&&!K){var Be=i,Ye={oid:Se,mid:Be.clientMsgID,flag:!1};Ae=[].concat(D()(Ae),[Ye]),Be.status=2,p.historyMsgList=[Be].concat(D()(p.historyMsgList)),setTimeout(function(){var me=Ae.find(function(Fe){return Fe.mid===Be.clientMsgID});me&&!me.flag&&p.historyMsgList.forEach(function(Fe){Fe.clientMsgID===me.mid&&(Fe.status=1)})},2e3),Ke()}var fe={title:"\u4F60\u6709\u4E00\u6761\u65B0\u6D88\u606F",desc:"",ex:"",iOSPushSound:"+1",iOSBadgeCount:!0},ze={recvID:B!=null?B:m.userID,groupID:K!=null?K:m.groupID,offlinePushInfo:fe,message:i};Ae=Ae.filter(function(me){return!me.flag}),T.Dw.includes(l)?h.S.sendMessageNotOss(ze,Se).then(function(me){return Xe(me,l)}).catch(function(me){return Xe(me,l,!0)}):h.S.sendMessage(ze,Se).then(function(me){return Xe(me,l)}).catch(function(me){return Xe(me,l,!0)})},[m]),Ze=(0,j.useCallback)(function(i,l){e(i,l).then(function(B){return rt(B)}).catch(function(B){L.Toast.error("\u83B7\u53D6\u4F1A\u8BDD\u5931\u8D25\uFF01"),console.error(B)})},[rt]),At=(0,j.useCallback)(function(i){var l=i.sendID===(m==null?void 0:m.userID)||i.sendID===x&&i.recvID===(m==null?void 0:m.userID);return i.sessionType===s.FF.Single?l:i.groupID===(m==null?void 0:m.groupID)},[m==null?void 0:m.groupID,m==null?void 0:m.userID,x]),Mt=(0,j.useCallback)(function(){p.typing=!0,tt.current&&clearTimeout(tt.current),tt.current=setTimeout(function(){p.typing=!1},1e3)},[p]),Oe=(0,j.useCallback)(function(i){var l=JSON.parse(i.data);l.contentType!==s.Cs.TypingMessage&&l.sendID!==x&&(0,F.sc)(l,function(B,K){Ze(B,K),window.focus()}),m&&At(l)&&(l.contentType===s.Cs.TypingMessage?Mt():(l.contentType===s.Cs.RevokeMessage?p.historyMsgList=[l].concat(D()(p.historyMsgList.filter(function(B){return B.clientMsgID!==l.content}))):p.historyMsgList=[l].concat(D()(p.historyMsgList)),Ve(m,1)))},[Ze,m,At,Ve,p,x,Mt]),$e=(0,j.useCallback)(function(i){var l=p.historyMsgList.findIndex(function(B){return B.clientMsgID===i.data});l>-1&&p.historyMsgList.splice(l,1)},[p]),it=(0,j.useCallback)(function(i){JSON.parse(i.data).forEach(function(l){l.msgIDList.forEach(function(B){p.historyMsgList.forEach(function(K){K.clientMsgID===B&&(K.isRead=!0)})})})},[p]),ot=(0,j.useCallback)(function(){ie(null)},[ie]),lt=(0,j.useCallback)(function(i){var l=p.historyMsgList.findIndex(function(K){return K.clientMsgID===i}),B=D()(p.historyMsgList);B.splice(l,1),p.historyMsgList=B,L.Toast.success("\u5220\u9664\u6D88\u606F\u6210\u529F\uFF01")},[p]),ct=(0,j.useCallback)(function(i){var l=p.historyMsgList.findIndex(function(B){return B.clientMsgID===i});p.historyMsgList[l].contentType=T.j7.RevokeMessage},[p]),ut=(0,j.useCallback)(function(i,l){p.merData=ye()(ye()({},i),{},{sender:l}),p.merModal=!0},[p]),dt=(0,j.useCallback)(function(i,l,B){B.map(function(){var K=o()(ve()().mark(function Se(Be){var Ye,fe,ze,me,Fe;return ve()().wrap(function(Qe){for(;;)switch(Qe.prev=Qe.next){case 0:if(ze=(Ye=Be.userID)!==null&&Ye!==void 0?Ye:"",me=(fe=Be.groupID)!==null&&fe!==void 0?fe:"",l!==s.Cs.MergeMessage){Qe.next=8;break}return Qe.next=5,h.S.createMergerMessage(i);case 5:Fe=Qe.sent,Qe.next=11;break;case 8:return Qe.next=10,h.S.createForwardMessage(i);case 10:Fe=Qe.sent;case 11:st(Fe.data,l,ze,me),H.Z.emit(T.rl,!1);case 13:case"end":return Qe.stop()}},Se)}));return function(Se){return K.apply(this,arguments)}}())},[st]);return(0,j.useEffect)(function(){return h.S.on(a.l.OnRecvMessageRevoked,$e),h.S.on(a.l.OnRecvC2CReadReceipt,it),function(){h.S.off(a.l.OnRecvMessageRevoked,$e),h.S.off(a.l.OnRecvC2CReadReceipt,it)}},[it,$e]),(0,j.useEffect)(function(){return H.Z.on(T.$F,ot),H.Z.on(T.Cd,lt),H.Z.on(T.rF,ct),H.Z.on(T.a7,ut),function(){H.Z.off(T.$F,ot),H.Z.off(T.Cd,lt),H.Z.off(T.rF,ct),H.Z.off(T.a7,ut)}},[lt,ut,ot,ct]),(0,j.useEffect)(function(){return H.Z.on(T.jA,dt),H.Z.on(T.$M,Ze),h.S.on(a.l.OnRecvNewMessage,Oe),function(){H.Z.off(T.jA,dt),H.Z.off(T.$M,Ze),h.S.off(a.l.OnRecvNewMessage,Oe)}},[Ze,m,Oe,dt]),(0,j.useEffect)(function(){return function(){ie(null)}},[ie]),{rs:p,cveList:Ie,loading:xt,cveLoading:Ce,curCve:m,setCurCve:ie,handleCveSearch:yt,handleItemClick:rt,scrollbar:mt,getHistoryMsg:at,sendMsg:st}}var Le=we},14903:function(){}}]);

(self.webpackChunkasany_admin=self.webpackChunkasany_admin||[]).push([[3609],{13609:function(ve,U,e){"use strict";e.r(U);var ye=e(3515),G=e(86288),z=e(93224),J=e(3182),f=e(11849),A=e(2824),X=e(94043),B=e.n(X),n=e(67294),Y=e(94184),w=e.n(Y),q=e(30381),K=e.n(q),ee=e(43219),ae=e(89887),h=e(33043),te=e(8845),ne=e(75468),r=e(53704),L=e(25496),a=e(85893);function se(I){var re=I.match.params.cid,W=I.location.state,o=W.categories,p=W.baseUrl,l=(0,n.useRef)({action:"draft",publishedAt:K()()}),le=(0,n.useReducer)(function(t){return t+1},0),_e=(0,A.Z)(le,2),F=_e[1],S=(0,n.useRef)(null),i=r.l0.useForm(),ue=(0,n.useMemo)(function(){return!o||!o.length?[]:(0,L.G_)(o.map(function(t){return(0,f.Z)((0,f.Z)({},t),{},{value:t.id,title:t.name})}),{idKey:"id",childrenKey:"children",pidKey:"parent.id",sort:function(_,s){return _.index-s.index}})},[o]),ie=(0,te.uw)(),Z=(0,A.Z)(ie,2),$=Z[0],M=Z[1].loading,oe=(0,n.useState)(),N=(0,A.Z)(oe,2),de=N[0],ce=N[1],me=(0,n.useCallback)(function(t){var _,s=o.find(function(m){return m.id==t});ce(s==null||(_=s.storeTemplate)===null||_===void 0?void 0:_.id)},[o]),b=(0,n.useCallback)(function(){var t=(0,J.Z)(B().mark(function _(s){var m,d,v,g,k,Q,C,H,T,y,x,E,D,R,P,c,V,j;return B().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return l.current.action=s,u.next=3,(m=S.current)===null||m===void 0?void 0:m.uploadAll();case 3:return u.next=5,i.validateFields();case 5:for(d=u.sent,v=d.meta,g=d.category,k=d.body,Q=d.publishedAt,C=(0,z.Z)(d,["meta","category","body","publishedAt"]),H={seo_title:"single_line_text_field",seo_description:"multi_line_text_field",seo_keywords:"list.single_line_text_field"},T=[],y=0,x=Object.keys(v);y<x.length;y++)for(E=x[y],D=0,R=Object.keys(v[E]);D<R.length;D++)P=R[D],T.push({namespace:E,key:P,value:v[E][P],type:H[E+"_"+P]});return c=(0,f.Z)((0,f.Z)({},C),{},{metafields:T,category:g.id,body:{type:"HTML",text:k.text}}),s=="publish"?c.status="PUBLISHED":s=="schedule"?(c.status="SCHEDULED",c.publishedAt=Q):c.status="DRAFT",V=$({variables:{input:c}}),u.next=19,r.FN.promise((0,L.gw)(V,350),{pending:"\u63D0\u4EA4\u4E2D...",success:"\u201C".concat(C.title,"\u201D \u4FEE\u6539\u6210\u529F"),error:"\u63D0\u4EA4\u51FA\u9519"},{duration:2e3,placement:"top-center"});case 19:j=u.sent,ee.m8.replace("".concat(p,"/cms/categories/").concat(g.id,"/articles/").concat(j.data.article.id)),console.log("submit result set",j);case 22:case"end":return u.stop()}},_)}));return function(_){return t.apply(this,arguments)}}(),[p,$,i]),Ee=(0,n.useCallback)(function(){b("draft")},[b]),fe=(0,n.useCallback)(function(t){b(t)},[b]),O=l.current.publishedAt,he=(0,n.useCallback)(function(t){l.current.publishedAt=t,i.setFieldsValue({publishedAt:t}),F()},[i]),be=(0,n.useCallback)(function(){l.current.publishedAt=K()(),F(),i.setFieldsValue({publishedAt:l.current.publishedAt})},[i]);return console.log("storeTemplate",de,O),(0,a.jsx)(ne.v,{header:{title:"\u65B0\u589E\u6587\u7AE0"},children:(0,a.jsxs)(r.l0,{form:i,initialValues:{status:"DRAFT",publishedAt:O,category:{id:re}},className:"form d-flex flex-column flex-lg-row",children:[(0,a.jsxs)("div",{className:"d-flex flex-column flex-row-fluid gap-7 gap-lg-10  me-lg-10",children:[(0,a.jsxs)(r.mQ,{defaultActiveKey:"general",renderContainer:!1,className:"border-0 fs-4 fw-bold mb-n2 nav-line-tabs-2x",children:[(0,a.jsx)(r.mQ.TabPane,{tab:"\u57FA\u672C\u4FE1\u606F",forceRender:!0,children:(0,a.jsx)(h.LQ,{queueUpload:S})},"general"),(0,a.jsx)(r.mQ.TabPane,{tab:"\u9AD8\u7EA7\u8BBE\u7F6E",forceRender:!0,children:(0,a.jsx)(h.aE,{})},"advanced"),(0,a.jsx)(r.mQ.TabPane,{tab:"\u5143\u6570\u636E",forceRender:!0,children:(0,a.jsx)(h.SF,{})},"meta")]}),(0,a.jsx)(G.Z,{offsetBottom:16,children:(0,a.jsxs)("div",{className:w()("d-flex bg-body-color p-5 mx-4 tw-rounded-2xl justify-content-end"),children:[(0,a.jsx)(r.zx,{variant:"light",loading:l.current.action=="draft"&&M,onClick:Ee,className:"me-5",children:!l.current.action&&M?"\u4FDD\u5B58\u4E2D...":"\u4FDD\u5B58\u8349\u7A3F"}),(0,a.jsx)(h.H5,{onPublish:fe,publishedAt:O,submitting:l.current.action!="draft"&&M,setPublishedAt:he,onCancel:be})]})})]}),(0,a.jsx)(ae.Z,{baseUrl:p,categoryTreeData:ue,onChangeCategory:me})]})})}U.default=se}}]);

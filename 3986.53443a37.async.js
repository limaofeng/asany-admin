(self.webpackChunkasany_admin=self.webpackChunkasany_admin||[]).push([[3986],{64043:function(I,S,u){"use strict";u.d(S,{ZO:function(){return t.ZO},Yw:function(){return t.Yw},KX:function(){return t.KX},I1:function(){return t.I1},Pw:function(){return t.Pw},aA:function(){return t.aA},Af:function(){return t.Af},G$:function(){return t.G$},_c:function(){return t._c},c9:function(){return t.c9},P6:function(){return t.P6},jS:function(){return t.jS},oM:function(){return t.oM},WF:function(){return t.WF},ot:function(){return t.ot},au:function(){return t.au},Nq:function(){return t.Nq},wp:function(){return t.wp},w4:function(){return t.w4},ko:function(){return t.ko},AQ:function(){return t.AQ}});var t=u(23798)},58979:function(I,S,u){"use strict";u.r(S),u.d(S,{default:function(){return V}});var t=u(39428),T=u(3182),Z=u(2824),x=u(11849),l=u(67294),z=u(65814),B=u(33389),L=u(94184),O=u.n(L),F=u(26075),K=u(76058);function W(a,s){var c=(0,F.x)(),v=(0,l.useState)({loading:!1,error:null}),h=(0,Z.Z)(v,2),C=h[0],f=h[1],r=(0,l.useMemo)(function(){return a!=null&&a.endpoints?a.endpoints.find(function(o){return o.type=="CONNECTION"}):null},[a==null?void 0:a.endpoints]);return(0,l.useEffect)(function(){if(!(!s.length||!r)){f(function(i){return(0,x.Z)((0,x.Z)({},i),{},{loading:!0})});var o=r.arguments.find(function(i){return i.name=="where"}).type,d=r.arguments.find(function(i){return i.name=="orderBy"}).type,j=`query search(
      $where: `.concat(o,`
      $page: Int
      $pageSize: Int
      $orderBy: `).concat(d,`
    ) {
      pagination: `).concat(r.code,`(
        where: $where
        page: $page
        pageSize: $pageSize
        orderBy: $orderBy
      ) {
        totalPage
        currentPage
        pageSize
        totalCount
        edges {
          cursor
          node {
            `).concat(s.map(function(i,y){return y>0?"            "+i.code:i.code}).join(`\r
`),`
          }
        }
      }
    }
    `),k=new AbortController;return c.query({query:(0,K.ZP)(j),fetchPolicy:"network-only",context:{fetchOptions:{signal:k.signal}}}).then(function(i){var y=i.data,p=i.loading,w=i.error;k.signal.aborted||(f(function(N){return(0,x.Z)((0,x.Z)({},N),{},{data:y,loading:p,error:w})}),console.log("search data: ",y))}),function(){k.abort()}}},[s,r,c]),["",C]}var G=W,b=u(76830),g=u(74200),X=u(64043),n=u(85893),M=l.forwardRef(function(a,s){var c=a.drag,v=a.style,h=a.animated,C=a.className,f=a.onCheck,r=a.data.source,o=(0,l.useCallback)(function(){f(r.key,!r.checked)},[r.checked,r.key,f]);return(0,n.jsxs)("div",(0,x.Z)((0,x.Z)({},h),{},{style:v,ref:s,className:O()("model-column",C),children:[(0,n.jsx)("div",{ref:c,className:"column-item-drag-handle",children:(0,n.jsx)("svg",{viewBox:"0 0.5 9 13",focusable:"false",children:(0,n.jsxs)("g",{fillRule:"evenodd",transform:"translate(0 .5)",children:[(0,n.jsx)("circle",{cx:"1.5",cy:"1.5",r:"1.5"}),(0,n.jsx)("circle",{cx:"7.5",cy:"1.5",r:"1.5"}),(0,n.jsx)("circle",{cx:"1.5",cy:"6.5",r:"1.5"}),(0,n.jsx)("circle",{cx:"7.5",cy:"6.5",r:"1.5"}),(0,n.jsx)("circle",{cx:"1.5",cy:"11.5",r:"1.5"}),(0,n.jsx)("circle",{cx:"7.5",cy:"11.5",r:"1.5"})]})})}),(0,n.jsx)("div",{className:"column-item-content",children:(0,n.jsx)(g.XZ,{onChange:o,checked:r.checked,label:r.title})})]}))});function J(a){var s=a.columns,c=a.onChange,v=(0,l.useRef)({columns:s});v.current.columns=s;var h=(0,l.useRef)(null),C=(0,l.useCallback)(function(r){c(r.map(function(o){return v.current.columns.find(function(d){return d.key==o.id})}))},[c]),f=(0,l.useCallback)(function(r,o){c(v.current.columns.map(function(d){return d.key==r?(0,x.Z)((0,x.Z)({},d),{},{checked:o}):d}))},[c]);return(0,n.jsx)("div",{ref:h,children:(0,n.jsx)(B.ZP,{onChange:C,tag:"ul",className:"configure-columns",accept:["default"],items:s.map(function(r){return{source:r,type:"default",name:r.title,id:r.key}}),itemRender:l.createElement(M,{onCheck:f}),preview:{render:(0,B.HG)(l.createElement(M)),axisLocked:!0,offset:[-4,0],container:document.body}})})}function Q(){var a,s=(0,z.rL)({key:"list",icon:"",title:"\u5217\u8868",props:{model:"",title:"Sales This Months",fields:[]},customizer:{fields:[{name:"model",type:"String"},{name:"fields",type:"JSON",label:"\u663E\u793A\u5B57\u6BB5",multiple:!0},{name:"subtitle",type:"String",label:"\u526F\u6807\u9898"},{name:"statistics",type:"String",label:"\u7EDF\u8BA1"}]}}),c=s.props,v=s.Provider,h=s.update,C=(0,X.jS)({fetchPolicy:"cache-and-network"}),f=(0,Z.Z)(C,2),r=f[0],o=f[1].data;(0,l.useEffect)(function(){!c.model||r({variables:{id:c.model}})},[c.model,r]);var d=(0,l.useMemo)(function(){return o!=null&&o.model?o.model.fields.map(function(e){var m=c.fields.findIndex(function($){return $.key==e.id});return{key:e.id,title:e.name,dataIndex:e.code,source:e,index:m!=-1?m:e.index,checked:m!=-1?c.fields[m].checked:!1}}).sort(function(e,m){return e.index-m.index}):[]},[c.fields,o==null?void 0:o.model]),j=(0,l.useMemo)(function(){return d.length?d.filter(function(e){return e.checked}).map(function(e){return e.source}):[]},[d]),k=G(o==null?void 0:o.model,j),i=(0,Z.Z)(k,2),y=i[1],p=y.data,w=y.loading,N=y.error;console.log("loading",w,N);var A=(0,l.useMemo)(function(){return j.length?j.map(function(e){return{key:e.code,title:e.name}}):[]},[j]),D=(0,l.useCallback)(function(e){return(0,T.Z)((0,t.Z)().mark(function m(){return(0,t.Z)().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:console.log("selectedRowKeys",e);case 1:case"end":return P.stop()}},m)}))},[]),Y=(0,l.useMemo)(function(){return function(e){return(0,n.jsx)("div",{children:(0,n.jsx)(g.zx,{color:"success",onClick:D(e),variant:!1,children:"\u6279\u91CF\u5220\u9664"})})}},[D]),H=(0,l.useCallback)(function(e){console.log("columns","change",e),h("fields",e)},[h]),U=(0,l.useState)("table"),R=(0,Z.Z)(U,2),q=R[0],_=R[1],nn=(0,l.useCallback)(function(e){_(e)},[]),E=o==null?void 0:o.model;return console.log("columns",d,A,p),(0,n.jsxs)(v,{children:[(0,n.jsx)(b.ZJ,{}),(0,n.jsxs)("div",{className:"d-flex flex-wrap pb-7",children:[(0,n.jsxs)("div",{className:"d-flex flex-row-fluid flex-wrap align-items-center",children:[(0,n.jsxs)("h3",{className:"fw-bolder me-5",children:[E==null?void 0:E.name," (",p==null||(a=p.pagination)===null||a===void 0?void 0:a.totalCount,")"]}),(0,n.jsx)(g.II.Search,{placeholder:"\u641C\u7D22",className:"border-body bg-body w-250px"})]}),(0,n.jsx)(b.ZX,{layout:q,onLayout:nn,children:(0,n.jsxs)("div",{className:"d-flex my-0",children:[(0,n.jsx)(b.wn,{}),(0,n.jsx)(g.zx,{children:"\u65B0\u5EFA\u6D77\u62A5"})]})}),(0,n.jsx)(g.J2,{offset:[0,0],placement:"bottom-end",content:(0,n.jsx)(J,{columns:d,onChange:H}),overlayClassName:"overlay-no-arrow configure-columns-popover",children:(0,n.jsx)(g.zx,{variant:!1,children:"\u914D\u7F6E\u5B57\u6BB5"})})]}),(0,n.jsx)(g.Zb,{flush:!0,bodyClassName:"pt-3",children:!!A.length&&(0,n.jsx)(g.iA,{columns:A,rowKey:"id",rowSelection:{type:"checkbox",renderTitle:function(m){return(0,n.jsxs)(n.Fragment,{children:["\u5DF2\u9009\u4E2D",(0,n.jsx)("span",{className:"mx-2",children:m}),"\u4E2A\u6D3B\u52A8"]})},toolbar:Y},dataSource:[],noRowsRenderer:function(){return(0,n.jsx)("div",{children:"\u6CA1\u6709\u6570\u636E"})}})})]})}var V=Q}}]);

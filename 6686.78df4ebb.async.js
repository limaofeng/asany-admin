"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[6686],{97961:function(Je,he,t){t.d(he,{$F:function(){return Z},$M:function(){return me},Cd:function(){return xe},Co:function(){return o},Dw:function(){return w},Oo:function(){return k},a7:function(){return d},cu:function(){return s},j7:function(){return e},jA:function(){return ue},jf:function(){return ie},oJ:function(){return C},rF:function(){return S},rl:function(){return n}});var A=t(51056),q="UPDATEFRIENDCARD",me="TOASSIGNCVE",Z="RESETCVE",l="OPENSINGLEMODAL",Y="OPENGROUPMODAL",xe="DELETEMESSAGE",ie="ISSETDRAFT",S="REVOKEMSG",s="REPLAYMSG",k="FORWARDANDMERMSG",ue="SENDFORWARDMSG",n="MUTILMSG",o="MUTILMSGCHANGE",d="MERMSGMODAL",C="ATSTATEUPDATE",N="ANTDLOCALCHANGE",T="APPLICATIONTYPEUPDATE",O="CLEARSEARCHINPUT",w=[A.Cs.PictureMessage,A.Cs.VideoMessage,A.Cs.VoiceMessage,A.Cs.FileMessage],e={RevokeMessage:A.Cs.RevokeMessage,FriendAdded:A.Cs.FriendAdded,GroupCreated:A.Cs.GroupCreated,GroupNameUpdated:A.Cs.GroupNameUpdated,GroupOwnerTransferred:A.Cs.GroupOwnerTransferred,MemberQuit:A.Cs.MemberQuit,MemberInvited:A.Cs.MemberInvited,MemberKicked:A.Cs.MemberKicked,MemberEnter:A.Cs.MemberEnter}},78864:function(Je,he,t){var A=t(17187),q=t.n(A),me=new A.EventEmitter;me.setMaxListeners(12),he.Z=me},36603:function(Je,he,t){t.d(he,{LF:function(){return s},RD:function(){return Y},RT:function(){return me},Sv:function(){return xe},Tf:function(){return ie},_x:function(){return S},p6:function(){return Z},sc:function(){return k},vJ:function(){return q}});var A=t(51056),q=function(n){return n.userID!==""&&n.groupID===""},me=function(n){var o=window.getSelection(),d=document.createRange();d.selectNodeContents(n.current),d.collapse(!1),o==null||o.removeAllRanges(),o==null||o.addRange(d)},Z=function(n){var o=new Date(n),d=o.getFullYear(),C=o.getMonth()+1,N=o.getDate(),T=o.getHours(),O=o.getMinutes();O.toString().length===1&&(O="0"+O);var w=o.getSeconds();w.toString().length===1&&(w="0"+w);var e=d+"-"+C+"-"+N,Be=T+":"+O;return[d,C,N,e,Be]},l=function(n,o){axios.get(n,{headers:{"Content-Type":"application/x-www-form-urlencoded"},responseType:"blob"}).then(function(d){var C=new Blob([d.data]),N=o,T=document.createElement("a");T.download=N,T.style.display="none",T.href=URL.createObjectURL(C),document.body.appendChild(T),T.click(),URL.revokeObjectURL(T.href),document.body.removeChild(T)}).catch(function(d){console.log(d)})},Y=function(n){if(n===0)return"0 B";var o=1024,d=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],C=Math.floor(Math.log(n)/Math.log(o));return(n/Math.pow(o,C)).toPrecision(3)+" "+d[C]},xe=function(n){var o=["jpeg","tiff","png","gif","jpg","gif"],d=["ppt","pptx"],C=["xlsx","xls"],N=["doc","docx"],T=["rar","zip"];return o.includes(n)?"file_pic":d.includes(n)?"file_ppt":C.includes(n)?"file_xslx":N.includes(n)?"file_world":T.includes(n)?"file_zip":n==="pdf"?"file_pdf":"file_unknow"},ie=function(){var n=window.getSelection(),o=n.getRangeAt(0),d=document.createElement("br"),C=document.createTextNode("\xA0");o.deleteContents(),o.insertNode(d),o.collapse(!1),o.insertNode(C),o.selectNodeContents(C),n.removeAllRanges(),n.addRange(o),document.execCommand("delete")},S=function(n){for(var o=n.split(","),d=o[0].match(/:(.*?);/)[1],C=atob(o[1]),N=C.length,T=new Uint8Array(N);N--;)T[N]=C.charCodeAt(N);return new File([T],"screenshot".concat(Date.now(),".png"),{type:d})},s=function(n,o){var d=function(h){return h===o};switch(n.contentType){case A.Cs.TextMessage:return n.content;case A.Cs.AtTextMessage:return n.atTextElem.text;case A.Cs.PictureMessage:return"PictureMessage";case A.Cs.VideoMessage:return"VideoMessage";case A.Cs.VoiceMessage:return"VoiceMessage";case A.Cs.LocationMessage:return"LocationMessage";case A.Cs.CardMessage:return"CardMessage";case A.Cs.MergeMessage:return"MergeMessage";case A.Cs.FileMessage:return"FileMessage";case A.Cs.RevokeMessage:return"".concat(d(n.sendID)?"\u4F60":n.senderNickname,"\u64A4\u56DE\u4E86\u4E00\u6761\u6D88\u606F");case A.Cs.CustomMessage:return"CustomMessage";case A.Cs.QuoteMessage:return"QuoteMessage";case A.Cs.FriendAdded:return"AlreadyFriend";case A.Cs.MemberEnter:{var C=JSON.parse(n.notificationElem.detail),N=C.entrantUser;return"".concat(d(N.userID)?"You":N.nickname,"JoinedGroup")}case A.Cs.GroupCreated:{var T=JSON.parse(n.notificationElem.detail),O=T.opUser;return"".concat(d(O.userID)?"You":O.nickname,"GroupCreated")}case A.Cs.MemberInvited:{var w,e=JSON.parse(n.notificationElem.detail),Be=e.opUser,He=(w=e.invitedUserList)!==null&&w!==void 0?w:[],Re="";return He.forEach(function(Ce){return Re+=(d(Ce.userID)?"You":Ce.nickname)+" "}),"".concat(d(Be.userID)?"You":Be.nickname,"Invited").concat(Re,"IntoGroup")}case A.Cs.MemberKicked:{var m,ye=JSON.parse(n.notificationElem.detail),oe=ye.opUser,y=(m=ye.kickedUserList)!==null&&m!==void 0?m:[],ne="";return y.forEach(function(Ce){return ne+=(d(Ce.userID)?"You":Ce.nickname)+" "}),"".concat(d(oe.userID)?"You":oe.nickname,"Kicked").concat(ne,"OutGroup")}case A.Cs.MemberQuit:{var Ne=JSON.parse(n.notificationElem.detail),Ge=Ne.quitUser;return"".concat(d(Ge.userID)?"You":Ge.nickname,"QuitedGroup")}default:return n.notificationElem.detail}},k=function(n,o,d){if(Notification&&document.hidden){var C,N=n.contentType===A.Cs.FriendAdded?"FriendNotice":n.senderNickname,T=new Notification(N,{dir:"auto",tag:(C=d!=null?d:n.groupID)!==null&&C!==void 0?C:n.sendID,renotify:!0,icon:n.senderFaceUrl,body:s(n),requireInteraction:!0}),O=n.sessionType===A.FF.Single?n.contentType===A.Cs.FriendAdded?n.recvID:n.sendID:n.groupID;T.onclick=function(){o&&o(O,n.sessionType),T.close()}}}},15132:function(Je,he,t){t.d(he,{Z:function(){return Ht}});var A=t(64599),q=t.n(A),me=t(5574),Z=t.n(me),l=t(67294),Y=t(46027),xe=t(35090),ie=t(93967),S=t.n(ie),s=t(2721),k=t(36603),ue=t(35908),n=t(97961),o=t(78864),d=t(15009),C=t.n(d),N=t(99289),T=t.n(N),O=t(1861),w=t(27856),e=t(85893),Be=function(v,a){var f,r=v.data,c=v.fetchMoreData,b=v.hasMore,M=v.children,E=v.loading,F=v.holdHeight,P=F===void 0?30:F,W=(0,l.useRef)(null),K=(f=W.current)===null||f===void 0?void 0:f.osInstance(),ee=(0,l.useRef)({scrollTop:0,contentHeight:0});(0,l.useImperativeHandle)(a,function(){return K},[K]);var le=(0,l.useCallback)(function(){var I=T()(C()().mark(function J(ce){var j;return C()().wrap(function(z){for(;;)switch(z.prev=z.next){case 0:if(j=P!=null?P:30,ee.current.contentHeight=ce.target.scrollHeight,ee.current.scrollTop=ce.target.scrollTop,!(ce.target.scrollTop<j)){z.next=7;break}if(!(E||!b)){z.next=6;break}return z.abrupt("return");case 6:requestAnimationFrame(c);case 7:case"end":return z.stop()}},J)}));return function(J){return I.apply(this,arguments)}}(),[c,b,P,E]),re=(0,w.P)(500,le);return(0,e.jsxs)(O.E,{ref:W,className:"d-flex h-100 flex-column custom-scrollbar pe-9 pt-8",options:{scrollbars:{autoHide:"scroll"},callbacks:{onScroll:re,onContentSizeChanged:function(J){if(J){if(!K){setTimeout(function(){var j;(j=W.current)===null||j===void 0||(j=j.osInstance())===null||j===void 0||j.scroll({y:"100%"})});return}if(K.scroll().max.y===0)K.scroll({y:"100%"});else if(ee.current.contentHeight){var ce=J.height-ee.current.contentHeight;K.scroll({y:ce+ee.current.scrollTop})}}}}},children:[M,b?(0,e.jsx)("div",{className:S()("scroll-view-spin","d-flex align-items-center justify-content-center","fs-6",{"flex-column-fluid":r.length===0,"h-40px":r.length!==0}),children:(0,e.jsx)(s.Spin,{tip:"\u52A0\u8F7D\u4E2D...",indicator:"Loading",size:"small"})}):(0,e.jsx)("div",{className:"con_nomore",children:"\u6CA1\u6709\u66F4\u591A\u5566~"})]})},He=l.forwardRef(Be),Re=t(97857),m=t.n(Re),ye=t(42532),oe=t(96522),y=t(51056),ne=t(65956),Ne=t(86366),Ge=[y.Cs.TextMessage,y.Cs.AtTextMessage],Ce=[y.Cs.PictureMessage,y.Cs.VideoMessage,y.Cs.FileMessage],h=function(v){var a,f,r,c=v.msg,b=v.isSelf,M=v.children,E=(0,l.useState)(!1),F=Z()(E,2),P=F[0],W=F[1],K=["Copy","Translate","Reply","Forward"],ee=(0,Ne.Z)(),le=Z()(ee,2),re=le[1],I=function(){o.Z.emit(n.Oo,"forward",JSON.stringify(c))},J=function(){o.Z.emit(n.rl,!0)},ce=function(){o.Z.emit(n.cu,c)},j=(0,l.useCallback)(function(){ne.S.revokeMessage(c).then(function(H){o.Z.emit(n.rF,c.clientMsgID),console.log("res",H)}).catch(function(H){return s.Toast.error("\u64A4\u56DE\u6D88\u606F\u5931\u8D25\uFF01",H)})},[c]),Ae=(0,l.useCallback)(function(){console.log("msg",c),ne.S.deleteMessageFromLocalStorage(JSON.stringify(c)).then(function(H){o.Z.emit(n.Cd,c.clientMsgID),console.log("res",H)}).catch(function(H){return s.Toast.error("\u5220\u9664\u6D88\u606F\u5931\u8D25\uFF01"+H.message)})},[c]),z=(0,l.useCallback)(T()(C()().mark(function H(){var _;return C()().wrap(function(Te){for(;;)switch(Te.prev=Te.next){case 0:return W(!1),Te.next=3,s.Modal.confirm({title:"\u5220\u9664\u6D88\u606F",content:(0,e.jsx)(e.Fragment,{children:(0,e.jsx)("p",{className:"tip-confirm",children:"\u786E\u5B9A\u5220\u9664\u8BE5\u6D88\u606F\u5417\uFF1F"})}),icon:"info",okText:"\u5220\u9664"});case 3:_=Te.sent,_.isConfirmed&&Ae();case 5:case"end":return Te.stop()}},H)})),[Ae]),Me=(0,l.useCallback)(function(){var H="";switch(c.contentType){case y.Cs.PictureMessage:H=c.pictureElem.sourcePicture.url;break;case y.Cs.VideoMessage:H=c.videoElem.videoUrl;break;case y.Cs.FileMessage:H=c.fileElem.sourceUrl;break;default:break}var _=H.lastIndexOf("/"),Oe=H.slice(_+1);downloadFileUtil(H,Oe)},[c.contentType,(a=c.fileElem)===null||a===void 0?void 0:a.sourceUrl,(f=c.pictureElem)===null||f===void 0||(f=f.sourcePicture)===null||f===void 0?void 0:f.url,(r=c.videoElem)===null||r===void 0?void 0:r.videoUrl]),Ee=(0,l.useMemo)(function(){return[{id:"Translate",title:"\u7FFB\u8BD1",icon:"Bootstrap/translate",method:function(){},hidden:!0},{id:"Forward",title:"\u8F6C\u53D1",icon:"Bootstrap/arrow-up-right-square",method:I,hidden:!1},{id:"Copy",title:"\u590D\u5236",icon:"Bootstrap/clipboard2",method:function(){var _=c.contentType===messageTypes.ATTEXTMESSAGE?c.atElem.text:c.content;re(_),s.Toast.success("\u590D\u5236\u6210\u529F\uFF01"),W(!1)},hidden:!1},{id:"Multiple",title:"\u591A\u9009",icon:"Bootstrap/list-check",method:J,hidden:!1},{id:"Reply",title:"\u5F15\u7528",icon:"Bootstrap/chat-quote",method:ce,hidden:!1},{id:"Revoke",title:"\u64A4\u56DE",icon:"Bootstrap/arrow-90deg-down",method:j,hidden:!1},{id:"Delete",title:"\u5220\u9664",icon:"Bootstrap/trash",method:z,hidden:!1},{id:"Download",title:"\u4E0B\u8F7D",icon:"Bootstrap/download",method:Me,hidden:!1}]},[re,z,Me,I,c.atElem.text,c.content,c.contentType,ce,j]),je=function(_){return!Ge.includes(c.contentType)&&K.includes(_.id)&&(_.hidden=!0),_.id==="Download"&&!Ce.includes(c.contentType)&&(_.hidden=!0),!b&&_.id==="Revoke"&&(_.hidden=!0),!_.hidden&&(0,e.jsx)(s.Menu.Item,{icon:(0,e.jsx)(Y.JO,{name:_.icon,className:"svg-icon-6"}),className:"px-3",onClick:_.method,children:_.title},_.id)};return(0,e.jsx)(s.Popover,{trigger:"contextMenu",visible:P,onVisibleChange:W,content:(0,e.jsx)(s.Menu,{className:"menu-sub show menu-sub-dropdown show menu-gray-600 menu-state-bg-light-primary fw-bold fs-8 w-125px py-2",children:Ee.map(je)}),overlayClassName:"overlay-no-arrow msg_item_menu_popover",children:(0,e.jsx)("div",{className:S()("chat_bg_msg_content py-3",{"ps-4 pe-8":!b,"ps-8 pe-4":b}),children:M})})},et=h,tt=t(6366),Ke=t(12845),pt=t(3030),nt=t(30381),xt=t.n(nt),at=[{context:"[\u6655]",src:""}],Ct="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAAUCAYAAABWMrcvAAAAAXNSR0IArs4c6QAAAk5JREFUOE+N081LFHEYB/Dvd9wMk0p3dsid1fIkduhUl0jIoDckDx2MOnSKPCU6o5KBkCG9ic4u1CUr6FQHQyqK3CCMBAPpXwjsZWdNZ3YxJXHNeWLH3HZTqzk+z3z4/p7fPEP8+dSPBvS9ezoo/JCw1KE1fQDML5Y3p7ZvKfWegKgXoM+2Qhf/iiqNzyWCklEh9wnQkbTU2HogW8sl6ebMXQrPeSLNyZh2byOQQ3pb6gDojYFy37a08/mgwkgfpAJJDpS/Xa37SRHTfSGQukBxoPrTjbL0ajNiuqaI9BMykohqDTlU0TKnKZsWbQB3bCt0YbWht7pHUIQRQF4vzCtN6cHgbA6FDeekQgx75PHkgBrPS5kApHJhibWpW+q3/CMzbDqXFODaYkYizm0tmwi9NbWTRTIp9HrtAe1ythZuc3aT0gSv6AF1w7lOokvmM6X2oP7dR4Z7lJQ4oDQmrOBzf27DGQexH8JhRgynG0TvD2Xzjq/9W6cLkTQmLM1HuuH2gdJOsJO6kTpNeo+WPTk0FdPe+EdpT+9SZHlSwCu2pfbk5mmSYgwxQ910qyDyEfTXpit3e+bMe4LhxYDUOn3aXMFF+NGmOwZ4NYqEqr9EubCS5h6jJy9BxjMB71Q+9D+ubsw0knwG4GrCCnXn0oxUJ+HdFMi4HdXqCjZiBTpZ1CDgiWRUHfkNncOesGwqpj5egyqN2aAwM5H1IjxjR0NP/7nlv2arAvAKQA2EZ+1o8OF6sOAnzL4QbHG3lQS8niVRhqZj6rv/QhsdKb/+E7En8byRi/iIAAAAAElFTkSuQmCC",rt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAATCAYAAABLN4eXAAAAAXNSR0IArs4c6QAAAiBJREFUOE+Fk0toU1EQhv+5oVINKrgIJAQtuCgkEHLPCQaFiiLYik+KXehKUHErIhWUYgUXFR8rV4orF4LFlaX4AhUqLpIzN5vEIgFfKZKNaEBKQ3JGTkkgMaQ9y5/5ZuafmUPo87TWEwB2GmPuAGh0hlE/SCl1i4gmAbwDcMIY86cd2xdyAUqpi0TkKuWr1er+SqWy7PQ1IRegtT4H4AGAR8aY8z2Q7/t7XaIgCN53tq21figiZ621I4VC4UNXJaXUPIAxEbkcBMG9NphMJrcNDg5+AbBgjDncBWmttwKYFZEDnueN5fP5121QKXWfiC5Ya2M9nrLZ7JZGo7EoIhVm3tUBjRLRCxEZJ631dgBnRGSWmT+1zN8AMAVgyBjz3Wm+78c8z1sCcJWUUs+IaFxEPjLzntaojxDRcwCjxphXTovFYpui0ehfADOu0iURuQ3gLjO7Zbr99ECpVCoyMDBQtdZOrXpKJBIbSqVSvaP/aSK6bq0dCoLgm9PT6fS+UCj01lp7qmcQw8PDm8Ph8CKAn8ycaSfSWs+IyGS9Xt/RBbWAp84LgEPM/NJB8Xh8YyQS+UpEn40xI//vaUFE3DCuMLPzufqUUjeJ6JqIHGXmuS4ok8mcbDabv4MgeNMBjBHRnIjMM/OxdQ82nU4fD4VCT0RkaWVlJVssFn+tCWmtT4vIY+fD87yDuVzux7r/yff93UQ0UavVpsvlcq3z6v8BSUzmcN/zXjIAAAAASUVORK5CYII=",At=function(v){var a=v.msg,f=v.audio,r=v.curCve,c=v.selfID,b=(0,l.useState)(!1),M=Z()(b,2),E=M[0],F=M[1],P=(0,Ke.useModel)("open-im.contacts",function(se){var B=se.state;return B.groupMemberList}),W=(0,l.useRef)(null),K=(0,l.useState)({}),ee=Z()(K,2),le=ee[0],re=ee[1],I=(0,l.useRef)();(0,l.useEffect)(function(){var se;F(r?(0,k.vJ)(r):!1),((se=W.current)===null||se===void 0?void 0:se.clientHeight)>60&&re({paddingBottom:"16px",paddingRight:"8px"})},[r]);var J=function(B){return c===B},ce=function(B){var g=B,V=/@\S+\s/g,ge=g.match(V)||[],X=q()(ge),ve;try{var fe=function(){var De=ve.value,Fe=P.find(function(ke){return ke.userID===De.slice(1,-1)});Fe?g=g.replaceAll(De,`<span onclick='userClick("`.concat(Fe.userID.replace(".","-"),`")' style="color:#428be5;cursor: pointer;"> @`).concat(Fe.nickname," </span>")):g=g.replaceAll(De,`<span onclick="userClick('`.concat(De.slice(1,-1),`')" style="color:#428be5;cursor: pointer;"> `).concat(De,"</span>"))};for(X.s();!(ve=X.n()).done;)fe()}catch(be){X.e(be)}finally{X.f()}return g},j=function(B){return xt()(a.sendTime).format(B?"HH:mm":"YYYY-MM-DD HH:mm")},Ae=function(B,g){o.Z.emit(n.a7,B,g)},z=function(){var B=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"chat_bg_msg_content_time";return(0,e.jsx)(s.Tooltip,{placement:"bottom",inverse:!0,title:j(0),children:(0,e.jsx)("div",{className:B,children:j(1)})})},Me=function(B){var g=B,V=q()(at),ge;try{for(V.s();!(ge=V.n()).done;){var X=ge.value,ve=g.indexOf(X.context);ve>-1&&(g=g.replaceAll(X.context,'<img style="padding-right:2px" width="24px" src='.concat(X.src," />")))}}catch(fe){V.e(fe)}finally{V.f()}return g},Ee=function(B){var g=B.replaceAll("\\n","<br>");return g.replaceAll(`
`,"<br>")},je=function(B){var g=B,V=/[(http(s)?):\/\/(www\.)?a-zA-Z0-9@:._\+-~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:_\+.~#?&\/\/=]*)/g,ge=g.match(V)||[],X=q()(ge),ve;try{for(X.s();!(ve=X.n()).done;){var fe=ve.value;g=g.replaceAll(fe,`<a onclick="urlClick('`.concat(fe,`')" href="javascript:;">`).concat(fe,"</a>"))}}catch(be){X.e(be)}finally{X.f()}return g},H=function(B){switch(B.contentType){case y.Cs.TextMessage:{var g=Ee(je(ce(Me(B.content))));return(0,e.jsx)("div",{className:"content",dangerouslySetInnerHTML:{__html:g}})}case y.Cs.AtTextMessage:return ce(B.atTextElem.text);case y.Cs.PictureMessage:return(0,e.jsx)(pt.Z,{width:60,src:B.pictureElem.sourcePicture.url});default:return""}},_=function(B){var g;f.current.src=B,(g=f.current)===null||g===void 0||g.play()},Oe=function(B){I.current=B,B.on("waiting",function(){console.log("player is waiting")}),B.on("dispose",function(){console.log("player will dispose")})},Te=function(){var B;switch(a.contentType){case y.Cs.TextMessage:{var g=a.content;return g=Me(g),g=je(g),g=Ee(g),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{ref:W,style:le,className:"chat_bg_msg_content_text ".concat(E?"":"nick_magin"),children:(0,e.jsx)("div",{dangerouslySetInnerHTML:{__html:g}})}),z()]})}case y.Cs.AtTextMessage:{var V=a.atTextElem.text;return V=Me(V),V=ce(V),V=je(V),V=Ee(V),(0,e.jsxs)("div",{style:le,className:"chat_bg_msg_content_text ".concat(E?"":"nick_magin"),children:[(0,e.jsx)("div",{style:{display:"inline-block"},dangerouslySetInnerHTML:{__html:V}}),z()]})}case y.Cs.PictureMessage:return(0,e.jsxs)("div",{className:"chat_bg_msg_content_pic ".concat(E?"":"nick_magin"),children:[(0,e.jsx)(pt.Z,{placeholder:!0,height:200,src:(B=a.pictureElem.snapshotPicture.url)!==null&&B!==void 0?B:a.pictureElem.sourcePicture.url,preview:{visible:!1},fallback:"data:image/png;base64,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"}),z("pic_msg_time")]});case y.Cs.VoiceMessage:{var ge=J(a.sendID),X=ge?{paddingLeft:"4px"}:{paddingRight:"4px"},ve=ge?Ct:rt;return(0,e.jsxs)("div",{style:le,className:"chat_bg_msg_content_text chat_bg_msg_content_voice ".concat(E?"":"nick_magin"),children:[(0,e.jsxs)("div",{style:{flexDirection:ge?"row-reverse":"row"},onClick:function(){return _(a.soundElem.sourceUrl)},children:[(0,e.jsx)("img",{style:X,src:ve,alt:""}),"".concat(a.soundElem.duration," ''")]}),z()]})}case y.Cs.FileMessage:{var fe=a.fileElem,be=fe.fileName.slice(fe.fileName.lastIndexOf(".")+1);return(0,e.jsxs)("div",{className:"chat_bg_msg_content_text chat_bg_msg_content_file ".concat(E?"":"nick_magin"),children:[(0,e.jsxs)("div",{className:"file_container",children:[(0,e.jsx)("img",{src:(0,k.Sv)(be),alt:""}),(0,e.jsxs)("div",{className:"file_info",children:[(0,e.jsx)("div",{children:fe.fileName}),(0,e.jsx)("div",{children:(0,k.RD)(fe.fileSize)})]})]}),z()]})}case y.Cs.VideoMessage:{var De={width:240,controls:!0,playbackRates:[.5,1,1.25,1.5,2],responsive:!0,fluid:!0,sources:[{src:a.videoElem.videoUrl,type:"video/mp4"}]};return(0,e.jsxs)("div",{className:"chat_bg_msg_content_video ".concat(E?"":"nick_magin"),children:[(0,e.jsx)(s.VideoPlayer,{options:De,onReady:Oe}),z("video_msg_time")]})}case y.Cs.QuoteMessage:{var Fe=a.quoteElem.quoteMessage,ke=a.quoteElem.text;return ke=Ee(je(Me(ke))),(0,e.jsxs)("div",{style:le,className:"chat_bg_msg_content_text chat_bg_msg_content_qute ".concat(E?"":"nick_magin"),children:[(0,e.jsxs)("div",{className:"qute_content",children:[(0,e.jsx)("div",{children:"".concat("Reply"+a.quoteElem.quoteMessage.senderNickname,":")}),H(Fe)]}),(0,e.jsx)("div",{dangerouslySetInnerHTML:{__html:ke}}),z()]})}case y.Cs.MergeMessage:{var We,Pe=a.mergeElem;return(0,e.jsxs)("div",{style:le,onClick:function(){return Ae(Pe,a.sendID)},className:"chat_bg_msg_content_text chat_bg_msg_content_mer ".concat(E?"":"nick_magin"),children:[(0,e.jsx)("div",{className:"title",children:Pe.title}),(0,e.jsx)("div",{className:"content",children:(We=Pe.abstractList)===null||We===void 0?void 0:We.map(function(x){return(0,e.jsx)("div",{className:"item",children:x},x)})}),z()]})}case y.Cs.CardMessage:{var pe=JSON.parse(a.content);return(0,e.jsxs)("div",{style:le,className:"chat_bg_msg_content_text chat_bg_msg_content_card ".concat(E?"":"nick_magin"),children:[(0,e.jsx)("div",{className:"title",children:"IDCard"}),(0,e.jsxs)("div",{className:"desc",children:[(0,e.jsx)(s.Symbol.Avatar,{src:pe.faceURL,size:35}),(0,e.jsx)("div",{className:"card_nick",children:pe.nickname})]}),z()]})}case y.Cs.LocationMessage:{var gt=a.locationElem,$e={longitude:gt.longitude,latitude:gt.latitude};return(0,e.jsxs)("div",{className:"chat_bg_msg_content_map ".concat(E?"":"nick_magin"),children:[(0,e.jsx)(tt.D5,{protocol:"https",center:$e,amapkey:"dcdc861728801ee3410f67f6a487d3fa",children:(0,e.jsx)(tt.Jx,{position:$e})}),z("pic_msg_time")]})}default:return(0,e.jsx)("div",{className:"chat_bg_msg_content_text ".concat(E?"":"nick_magin"),children:"UnsupportedMessage"})}};return Te()},Ve=At,yt=[y.Cs.TextMessage,y.Cs.AtTextMessage,y.Cs.PictureMessage,y.Cs.VideoMessage,y.Cs.VoiceMessage,y.Cs.CardMessage,y.Cs.FileMessage,y.Cs.LocationMessage],Mt=function(v){var a=v.msg,f=v.selfID,r=v.curCve,c=v.mutilSelect,b=v.className,M=(0,l.useState)(!1),E=Z()(M,2),F=E[0],P=E[1],W=(0,l.useRef)(null),K=(0,l.useRef)(null),ee=(0,ye.Z)(K),le=Z()(ee,1),re=le[0],I=(0,l.useMemo)(function(){return f===a.sendID},[f,a.sendID]),J=(0,l.useMemo)(function(){return!r||!(0,k.vJ)(r)},[r]);(0,l.useEffect)(function(){F&&P(!1)},[c]);var ce=function(Ee,je){a.isRead=!0,ne.S.markC2CMessageAsRead({userID:Ee,msgIDList:[je]})};(0,l.useEffect)(function(){re&&r.userID===a.sendID&&!a.isRead&&ce(a.sendID,a.clientMsgID)},[re,r]);var j=(0,l.useCallback)(function(){switch(a.status){case 1:return(0,e.jsx)(e.Fragment,{children:"loading..."});case 2:return r&&(0,k.vJ)(r)?a.isRead?"\u5DF2\u8BFB":"\u672A\u8BFB":null;case 3:return(0,e.jsx)(e.Fragment,{});default:return null}},[r,a.isRead,a.status]),Ae=function(){c&&yt.includes(a.contentType)&&(o.Z.emit(n.Co,!F,a),P(function(Ee){return!Ee}))},z=function(){(0,k.vJ)(r)||o.Z.emit(n.oJ,a.sendID,a.senderNickname)};return(0,oe.Z)(z,W,{onClick:function(){},delay:500}),(0,e.jsx)("div",{ref:K,onClick:Ae,className:S()("msg-item d-flex mb-10",b,{"justify-content-start":!I,"justify-content-end":I,"mt-4":I}),children:(0,e.jsxs)("div",{className:S()("d-flex align-items-start",{"flex-column":J,"flex-row-reverse":I&&!J,"flex-row":!I&&!J}),children:[(0,e.jsxs)("div",{className:S()("d-flex align-items-center mb-2"),children:[(0,e.jsx)(s.Symbol.Avatar,{className:S()({"me-4":!I&&!J,"ms-4":I&&!J}),light:!0,size:40,alt:a.senderNickname,src:a.senderFaceUrl}),J&&(0,e.jsxs)("div",{className:"ms-3",children:[(0,e.jsx)("a",{href:"#",className:"fs-5 fw-bold text-gray-900 text-hover-primary me-1",children:a.senderNickname}),(0,e.jsx)("span",{className:"text-muted fs-7 mb-1",children:"2 mins"})]})]}),(0,e.jsxs)("div",{className:S()("msg-item-content rounded text-dark fw-semibold mw-lg-400px text-start",{"bg-light-info":!I,"bg-light-primary":I}),children:[(0,e.jsx)(et,{msg:a,isSelf:I,children:(0,e.jsx)(Ve,m()({},v))},a.clientMsgID),I&&(0,e.jsx)("div",{style:{color:a.isRead?"#999":"#428BE5"},className:"self_msg_chat_flag",children:j()})]})]})})},st=Mt;function Xe(D){var v,a=(0,l.useRef)(null),f=D.merID,r=D.msgList,c=D.loadMore,b=D.hasMore,M=D.curCve,E=D.loading,F=(0,l.useState)(!1),P=Z()(F,2),W=P[0],K=P[1],ee=(v=(0,ue.ot)().data)===null||v===void 0?void 0:v.id,le=Object.values(n.j7),re=function(Ae){K(Ae)};(0,l.useEffect)(function(){return o.Z.on(n.rl,re),function(){o.Z.off(n.rl,re)}},[]);var I=(0,l.useCallback)(function(j){return j===ee},[ee]),J=(0,l.useCallback)(function(j){if(j.contentType===n.j7.RevokeMessage){var Ae=j.sendID,z=(0,k.vJ)(M)?M==null?void 0:M.showName:j.senderNickname;return(0,e.jsxs)(e.Fragment,{children:[I(Ae)?"\u4F60":(0,e.jsx)("b",{children:z}),"\u64A4\u56DE\u4E86\u4E00\u6761\u6D88\u606F"]})}switch(j.contentType){case n.j7.FriendAdded:return"AlreadyFriend";case n.j7.GroupCreated:{var Me=JSON.parse(j.notificationElem.detail),Ee=Me.opUser;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("b",{children:I(Ee.userID)?"You":Ee.nickname}),"GroupCreated"]})}case n.j7.GroupNameUpdated:{var je=JSON.parse(j.notificationElem.detail),H=je.opUser;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("b",{children:I(H.userID)?"You":H.nickname}),"ModifiedGroup"]})}case n.j7.GroupOwnerTransferred:{var _=JSON.parse(j.notificationElem.detail),Oe=_.opUser,Te=_.newGroupOwner;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("b",{children:I(Oe.userID)?"You":Oe.nickname}),"TransferTo",(0,e.jsx)("b",{children:I(Te.userID)?"You":Te.nickname})]})}case n.j7.MemberQuit:{var se=JSON.parse(j.notificationElem.detail),B=se.quitUser;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("b",{children:I(B.userID)?"You":B.nickname}),"QuitedGroup"]})}case n.j7.MemberInvited:{var g,V=JSON.parse(j.notificationElem.detail),ge=V.opUser,X=(g=V.invitedUserList)!==null&&g!==void 0?g:[],ve=[];return X.forEach(function(pe){return ve.push((0,e.jsx)("b",{children:I(pe.userID)?"You":pe.nickname+" "},pe.userID))}),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("b",{children:I(ge.userID)?"You":ge.nickname}),"Invited",ve.map(function(pe){return pe}),"IntoGroup"]})}case n.j7.MemberKicked:{var fe,be=JSON.parse(j.notificationElem.detail),De=be.opUser,Fe=(fe=be.kickedUserList)!==null&&fe!==void 0?fe:[],ke=[];return Fe.forEach(function(pe){return ke.push((0,e.jsx)("b",{children:I(pe.userID)?"You":pe.nickname},pe.userID))}),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("b",{children:I(De.userID)?"You":De.nickname}),"Kicked",ke.map(function(pe){return pe}),"OutGroup"]})}case n.j7.MemberEnter:{var We=JSON.parse(j.notificationElem.detail),Pe=We.entrantUser;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("b",{children:I(Pe.userID)?"You":Pe.nickname}),"JoinedGroup"]})}default:return JSON.parse(j.content).defaultTips}},[M,I]),ce=(0,l.useCallback)(function(){c(M==null?void 0:M.userID,M==null?void 0:M.groupID,r[r.length-1])},[M==null?void 0:M.groupID,M==null?void 0:M.userID,c,r]);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(He,{holdHeight:40,ref:D.scrollbar,loading:E,data:r,fetchMoreData:ce,hasMore:b,children:r==null?void 0:r.map(function(j,Ae){return le.includes(j.contentType)?(0,e.jsx)("div",{className:S()("chat_bg_tips",{"mb-6":Ae===0}),children:J(j)},j.clientMsgID):(0,e.jsx)(st,{audio:a,mutilSelect:W,msg:j,selfID:f!=null?f:ee,curCve:M},j.clientMsgID)})}),(0,e.jsx)("audio",{ref:a})]})}var it=Xe,Ze=t(19632),Ue=t.n(Ze),ot=t(3930),lt=t(13769),ct=t.n(lt),ut=t(12444),dt=t.n(ut),vt=t(72004),ft=t.n(vt),mt=t(25098),we=t.n(mt),i=t(31996),u=t.n(i),L=t(26037),G=t.n(L),Ie=t(9783),ae=t.n(Ie),Ye=t(64063),ze=t.n(Ye),_e=["tagName","html","innerRef","placeholder"];function de(D){return D&&D.replace(/&nbsp;|\u202F|\u00A0/g," ")}function Qe(D){var v=document.createTextNode("");D.appendChild(v);var a=document.activeElement===D;if(v!==null&&v.nodeValue!==null&&a){var f=window.getSelection();if(f!==null){var r=document.createRange();r.setStart(v,v.nodeValue.length),r.collapse(!0),f.removeAllRanges(),f.addRange(r)}D instanceof HTMLElement&&D.focus()}}var It=function(D){u()(a,D);var v=G()(a);function a(){var f;dt()(this,a);for(var r=arguments.length,c=new Array(r),b=0;b<r;b++)c[b]=arguments[b];return f=v.call.apply(v,[this].concat(c)),ae()(we()(f),"lastHtml",f.props.html),ae()(we()(f),"el",typeof f.props.innerRef=="function"?{current:null}:l.createRef()),ae()(we()(f),"getEl",function(){return(f.props.innerRef&&typeof f.props.innerRef!="function"?f.props.innerRef:f.el).current}),ae()(we()(f),"emitChange",function(M){var E=f.getEl();if(E){var F=E.innerHTML;if(f.props.onChange&&F!==f.lastHtml){var P=Object.assign({},M,{target:{value:F}});f.props.onChange(P)}f.lastHtml=F}}),f}return ft()(a,[{key:"render",value:function(){var r=this,c=this.props,b=c.tagName,M=c.html,E=c.innerRef,F=c.placeholder,P=ct()(c,_e);return l.createElement(b||"div",m()(m()({},P),{},ae()(ae()(ae()(ae()(ae()(ae()(ae()(ae()({},"data-placeholder",F),"ref",typeof E=="function"?function(W){E(W),r.el.current=W}:E||this.el),"onInput",this.emitChange),"onBlur",this.props.onBlur||this.emitChange),"onKeyUp",this.props.onKeyUp||this.emitChange),"onKeyDown",this.props.onKeyDown||this.emitChange),"contentEditable",!this.props.disabled),"dangerouslySetInnerHTML",{__html:M})),this.props.children)}},{key:"shouldComponentUpdate",value:function(r){var c=this.props,b=this.getEl();return!b||de(r.html)!==de(b.innerHTML)?!0:c.disabled!==r.disabled||c.tagName!==r.tagName||c.className!==r.className||c.innerRef!==r.innerRef||c.placeholder!==r.placeholder||!ze()(c.style,r.style)}},{key:"componentDidUpdate",value:function(){var r=this.getEl();r&&(this.props.html!==r.innerHTML&&(r.innerHTML=this.props.html),this.lastHtml=this.props.html,Qe(r))}}]),a}(l.Component),Le=function(v,a){var f=new FileReader;f.onload=function(r){var c,b=(c=r.target)===null||c===void 0?void 0:c.result;a(b)},f.readAsDataURL(v)},Tt=function(v){var a=v,f=/\<img.*?\">/g,r=a.match(f);if(r&&r.length>0){var c=q()(r),b;try{for(c.s();!(b=c.n()).done;){var M=b.value;a=a.replaceAll(M,"")}}catch(E){c.e(E)}finally{c.f()}}return a},St=function(v){var a=v,f=Ue()(Array.from(document.getElementsByClassName("face_el"))),r=q()(f),c;try{for(r.s();!(c=r.n()).done;){var b=c.value;a=a.replaceAll(b.outerHTML,b.alt)}}catch(M){r.e(M)}finally{r.f()}return a},bt=function(v){var a=v;return a.slice(-4)==="<br>"&&(a=a.slice(0,-4)),a=a.replaceAll("<br>",`
`),a},Rt=function(){var v=Ue()(Array.from(document.getElementsByClassName("screenshot_el")));v.length>0&&(v[v.length-1].alt="last",v.map(function(){var a=T()(C()().mark(function f(r){var c;return C()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:c=(0,k._x)(r.src),console.log(c);case 2:case"end":return M.stop()}},f)}));return function(f){return a.apply(this,arguments)}}()))};function Lt(D){var v=D.curCve,a=D.sendMsg,f=(0,l.useRef)(null),r=(0,l.useRef)(null),c=(0,l.useState)(""),b=Z()(c,2),M=b[0],E=b[1],F=(0,ot.Z)(M),P=(0,l.useState)(),W=Z()(P,2),K=W[0],ee=W[1],le=(0,l.useState)([]),re=Z()(le,2),I=re[0],J=re[1],ce=(0,Ke.useModel)("open-im.contacts",function(x){var p=x.state;return p.groupMemberList}),j=(0,l.useState)(!1),Ae=Z()(j,2),z=Ae[0],Me=Ae[1],Ee=(0,ot.Z)(z),je=(0,l.useState)([]),H=Z()(je,2),_=H[0],Oe=H[1],Te=function(p,Q){ne.S.typingStatusUpdate({recvID:p,msgTip:Q})},se=(0,l.useCallback)(function(){(0,k.vJ)(v)&&(f.current&&clearTimeout(f.current),f.current=setTimeout(function(){Te(v.userID,"yes")},2e3))},[v]),B=function(){var x=T()(C()().mark(function p(Q){var R,U,$;return C()().wrap(function(Se){for(;;)switch(Se.prev=Se.next){case 0:R=(Q.originalEvent||Q).clipboardData,R&&R.items[0].type.indexOf("image")===-1?(Q.preventDefault(),U=R.getData("text/plain")||"",document.execCommand("insertText",!1,U)):R&&R.items[0].type.indexOf("image")>-1&&(Q.preventDefault(),$=R.items[0].getAsFile(),Le($,function(ht){var Et='<img style="vertical-align:bottom" class="screenshot_el" src="'.concat(ht,'" alt="" >');document.execCommand("insertHTML",!1,Et)}));case 2:case"end":return Se.stop()}},p)}));return function(Q){return x.apply(this,arguments)}}(),g=(0,l.useRef)({curCve:v,msgContent:M,latestContent:F,atList:I,groupMemberList:ce,replyMsg:K,draftSaved:!1});g.current.msgContent=M,g.current.curCve=v,g.current.latestContent=F,g.current.atList=I,g.current.groupMemberList=ce,g.current.replyMsg=K;var V=(0,l.useCallback)(function(x,p){var Q=g.current.atList,R=g.current.latestContent,U=g.current.replyMsg;if(U&&ee(void 0),Q.findIndex(function(te){return te.id===x})===-1){var $='<b class="at_el" data_id="'.concat(x,'" data_name="').concat(p,'" contenteditable="false" style="color:#428be5"> @').concat(p,"</b>");J([].concat(Ue()(Q),[{id:x,name:p,tag:$}])),E(R.current+$),(0,k.RT)(r.current.el)}},[]),ge=(0,l.useCallback)(function(x){var p=x,Q=g.current.atList,R=q()(Q),U;try{for(R.s();!(U=R.n()).done;){var $=U.value;p=p.replaceAll($.tag,"@".concat($.id," "))}}catch(te){R.e(te)}finally{R.f()}return p},[]),X=(0,l.useCallback)(function(x){var p=g.current.latestContent,Q=g.current.atList;if(x.draftText!==p.current&&(x.draftText!==""||p.current!=="")){g.current.draftSaved=!0;var R=p.current;R=St(R);var U={conversationID:x.conversationID,draftText:Q.length>0?ge(R):R};ne.S.setConversationDraft(U).then(function($){console.warn($)}).catch(function($){console.warn($)}).finally(function(){E("")})}},[ge]),ve=(0,l.useCallback)(function(){g.current.latestContent.current="",E(""),ee(void 0),J([]),Me(!1),X(v)},[v,X]),fe=(0,l.useCallback)(function(){var x=T()(C()().mark(function p(Q){var R,U;return C()().wrap(function(te){for(;;)switch(te.prev=te.next){case 0:return te.next=2,ne.S.createTextMessage(Q);case 2:R=te.sent,U=R.data,a(U,y.Cs.TextMessage),ve();case 6:case"end":return te.stop()}},p)}));return function(p){return x.apply(this,arguments)}}(),[ve,a]),be=(0,l.useCallback)(function(){var x=T()(C()().mark(function p(Q){var R,U,$;return C()().wrap(function(Se){for(;;)switch(Se.prev=Se.next){case 0:return R={text:Q,atUserIDList:I.map(function(ht){return ht.id})},Se.next=3,ne.S.createTextAtMessage(R);case 3:U=Se.sent,$=U.data,a($,y.Cs.AtTextMessage),ve();case 7:case"end":return Se.stop()}},p)}));return function(p){return x.apply(this,arguments)}}(),[I,ve,a]),De=(0,l.useCallback)(function(){var x=T()(C()().mark(function p(Q){var R,U;return C()().wrap(function(te){for(;;)switch(te.prev=te.next){case 0:return te.next=2,ne.S.createQuoteMessage({text:Q,message:JSON.stringify(K)});case 2:R=te.sent,U=R.data,a(U,y.Cs.QuoteMessage),ve();case 6:case"end":return te.stop()}},p)}));return function(p){return x.apply(this,arguments)}}(),[ve,K,a]),Fe=(0,l.useCallback)(function(x){var p=F.current;if(p=Tt(St(p)),p=bt(p),Rt(),p!=="")switch(x){case"text":fe(p);break;case"at":be(ge(p));break;case"quote":De(p);break;default:break}},[F,ge,De,be,fe]),ke=(0,l.useCallback)(function(x){x.key==="Enter"&&x.metaKey&&(x.preventDefault(),(0,k.Tf)(),(0,k.RT)(r.current.el)),x.key==="Enter"&&!x.metaKey&&(x.preventDefault(),F.current&&!Ee.current&&(Me(!0),Fe(K?"quote":I.length>0?"at":"text")))},[I.length,F,Ee,K,Fe]),We=(0,l.useCallback)(function(x){E(x.target.value);var p=Ue()(Array.from(document.getElementsByClassName("at_el"))),Q=[];p.map(function(R){var U,$;return Q.push({id:(U=R.attributes.getNamedItem("data_id"))===null||U===void 0?void 0:U.value,name:($=R.attributes.getNamedItem("data_name"))===null||$===void 0?void 0:$.value,tag:R.outerHTML})}),J(Q),se()},[se]),Pe=(0,l.useCallback)(function(x){var p=x,Q=q()(at),R;try{for(Q.s();!(R=Q.n()).done;){var U=R.value,$=p.indexOf(U.context);if($>-1){var te='<img class="face_el" alt="'.concat(U.context,'" style="padding-right:2px" width="24px" src="').concat(U.src,'">');p=p.replaceAll(U.context,te)}}}catch(Se){Q.e(Se)}finally{Q.f()}return p},[]),pe=(0,l.useCallback)(function(x){var p=x,Q=/@\S+\s/g,R=p.match(Q)||[],U=[],$=g.current.groupMemberList,te=q()(R),Se;try{var ht=function(){var Nt=Se.value,qe=$.find(function(Gt){return Gt.userID===Nt.slice(1,-1)});if(qe){var jt='<b class="at_el" data_id="'.concat(qe.userID,'" data_name="').concat(qe.nickname,'" contenteditable="false" style="color:#428be5"> @').concat(qe.nickname,"</b>");p=p.replaceAll(Nt,jt),U.push({id:qe.userID,name:qe.nickname,tag:jt})}};for(te.s();!(Se=te.n()).done;)ht()}catch(Et){te.e(Et)}finally{te.f()}return J(U),p},[]),gt=(0,l.useCallback)(function(x){E(Pe(pe(x)))},[pe,Pe]);(0,l.useEffect)(function(){g.current.draftSaved=!1;var x=g.current.atList;return x.length>0&&J([]),v.draftText!==""?gt(v.draftText):E(""),Oe([]),function(){g.current.draftSaved||X(v)}},[v,gt,X]);var $e=(0,l.useCallback)(function(x,p){var Q=Ue()(_);if(x)Q=[].concat(Ue()(Q),[p]);else{var R=Q.findIndex(function(U){return U.clientMsgID===p.clientMsgID});Q.splice(R,1)}Oe(Q)},[_]);return(0,l.useEffect)(function(){return o.Z.on(n.Co,$e),function(){o.Z.off(n.Co,$e)}},[$e]),(0,l.useEffect)(function(){return o.Z.on(n.oJ,V),o.Z.on(n.jf,X),function(){o.Z.off(n.oJ,V),o.Z.off(n.jf,X)}},[V,X]),(0,e.jsxs)("div",{className:"pt-4 ps-8 h-100 d-flex flex-column",children:[(0,e.jsxs)("div",{className:"d-flex flex-row mb-2",children:[(0,e.jsx)(s.Tooltip,{placement:"bottom",inverse:!0,title:"\u8868\u60C5",children:(0,e.jsx)(s.Button,{variant:!1,icon:(0,e.jsx)(Y.JO,{name:"Bootstrap/emoji-smile",className:"svg-icon-2"}),activeColor:"secondary",className:"me-1"})}),(0,e.jsx)(s.Tooltip,{placement:"bottom",inverse:!0,title:"\u53D1\u9001\u540D\u7247",children:(0,e.jsx)(s.Button,{variant:!1,icon:(0,e.jsx)(Y.JO,{name:"Bootstrap/person-badge",className:"svg-icon-2"}),activeColor:"secondary",className:"me-1"})}),(0,e.jsx)(s.Tooltip,{placement:"bottom",inverse:!0,title:"\u53D1\u9001\u6587\u4EF6",children:(0,e.jsx)(s.Button,{variant:!1,icon:(0,e.jsx)(Y.JO,{name:"Bootstrap/folder-plus",className:"svg-icon-2"}),activeColor:"secondary",className:"me-1"})}),(0,e.jsx)(s.Tooltip,{placement:"bottom",inverse:!0,title:"\u53D1\u9001\u56FE\u7247",children:(0,e.jsx)(s.Button,{variant:!1,icon:(0,e.jsx)(Y.JO,{name:"Bootstrap/card-image",className:"svg-icon-2"}),activeColor:"secondary",className:"me-1"})}),(0,e.jsx)(s.Tooltip,{placement:"bottom",inverse:!0,title:"\u53D1\u9001\u89C6\u9891",children:(0,e.jsx)(s.Button,{variant:!1,icon:(0,e.jsx)(Y.JO,{name:"Bootstrap/film",className:"svg-icon-2"}),activeColor:"secondary",className:"me-1"})})]}),(0,e.jsxs)("div",{className:"ps-3 flex-row-fluid position-relative",children:[(0,e.jsx)(It,{style:{paddingTop:K?"32px":"4px"},placeholder:"\u53D1\u9001\u7ED9 ".concat(v.showName),className:"h-100",ref:r,html:M,onChange:We,onKeyDown:ke,onPaste:B}),(0,e.jsxs)("div",{className:"chat-msg-actions d-flex flex-row position-absolute",children:[(0,e.jsxs)("div",{className:"d-flex flex-row align-items-center fs-10 text-gray-500 me-6",children:[(0,e.jsx)(Y.JO,{name:"Bootstrap/arrow-return-left",className:"svg-icon-7 me-2"})," ","\u53D1\u9001",(0,e.jsx)("span",{className:"mx-3",children:"/"}),(0,e.jsx)(Y.JO,{name:"Bootstrap/command",className:"svg-icon-7 me-2"})," \u6362\u884C"]}),(0,e.jsx)(s.Button,{className:"px-5",children:"\u53D1\u9001"})]})]})]})}var Bt=Lt;function Qt(){return(0,e.jsx)("div",{className:"d-flex align-items-center justify-content-center h-100",children:(0,e.jsx)("img",{src:"/assets/media/illustrations/dozzy-1/12.png",className:"mw-100 h-200px h-sm-325px"})})}var Ot=Qt,Ft=t(230),Kt=t(14903),kt=function(v){var a=v.userId,f=v.typing,r=(0,Ft.ED)({variables:{id:a},fetchPolicy:"cache-and-network"}),c=Z()(r,2),b=c[0],M=c[1],E=M.data,F=M.refetch,P=E==null?void 0:E.user.onlineStatus.status,W=E==null?void 0:E.user.onlineStatus.detailPlatformStatus,K=(0,l.useMemo)(function(){if(P==="online"){var le="",re=q()(W||[]),I;try{for(re.s();!(I=re.n()).done;){var J=I.value;J.status==="online"&&(le+="".concat(J.platform,"/"))}}catch(ce){re.e(ce)}finally{re.f()}return"".concat(le.slice(0,-1)," \u5728\u7EBF")}return"\u79BB\u7EBF"},[P,W]),ee=(0,l.useRef)(P);return ee.current=P,(0,l.useEffect)(function(){ee.current!=="online"&&F()},[b,F,f]),(0,e.jsxs)("div",{className:"mb-0 lh-1 d-flex flex-row align-items-center",children:[(0,e.jsx)(s.Badge,{color:P==="online"?"primary":"secondary",shape:"circle",className:"w-10px h-10px me-1"}),(0,e.jsx)("span",{className:"fs-7 fw-semibold text-muted",children:K})]})},Ut=function(){return(0,e.jsx)(e.Fragment,{})},Pt=105,Jt=350;function Dt(D){return Math.min(Jt,Math.max(Pt,D))}function wt(D){var v=D.msgList,a=D.loadMore,f=D.hasMore,r=D.curCve,c=D.loading,b=D.sendMsg,M=D.scrollbar,E=D.typing,F=D.onBack,P=(0,l.useRef)({height:200}),W=(0,l.useReducer)(function(J){return J+1},0),K=Z()(W,2),ee=K[1],le=(0,l.useMemo)(function(){return r&&(0,k.vJ)(r)},[r]),re=(0,l.useCallback)(function(J){P.current.height+=J,ee()},[]),I=(0,l.useCallback)(function(){P.current.height=Dt(P.current.height)},[]);return(0,e.jsx)("div",{className:"wrapper d-flex flex-column flex-row-fluid app-chat-main background-transparent",children:(0,e.jsxs)(s.Card,{className:"card chat_messenger",id:"kt_chat_messenger",children:[r&&(0,e.jsxs)(s.Card.Header,{id:"kt_chat_messenger_header",children:[(0,e.jsxs)(s.Card.Title,{className:"d-flex align-items-center",children:[(0,e.jsx)(s.Symbol.Avatar,{light:!0,size:45,alt:r==null?void 0:r.showName,src:r==null?void 0:r.faceURL}),(0,e.jsxs)("div",{className:"ms-5 d-flex justify-content-center flex-column me-3",children:[(0,e.jsx)("a",{href:"#",className:"fs-4 fw-bold text-gray-900 text-hover-primary me-1 mb-2 lh-1",children:r.showName}),(0,e.jsxs)("div",{className:"d-flex flex-row align-items-center",children:[le?(0,e.jsx)(kt,{userId:r.userID,typing:!!E}):(0,e.jsx)(Ut,{}),E&&(0,e.jsx)("span",{className:"mb-0 lh-1 ms-4 fs-7 fw-semibold text-muted",children:"\u6B63\u5728\u8F93\u5165..."})]})]})]}),(0,e.jsxs)(s.Card.Toolbar,{children:[(0,e.jsx)(s.Tooltip,{placement:"bottom",inverse:!0,title:"\u6587\u4EF6",children:(0,e.jsx)(s.Button,{className:"me-4",icon:(0,e.jsx)(Y.JO,{name:"Bootstrap/folder",className:"svg-icon-2"}),variant:!1,activeColor:"light-primary"})}),(0,e.jsx)(s.Tooltip,{placement:"bottom",inverse:!0,title:"\u804A\u5929\u8BB0\u5F55",children:(0,e.jsx)(s.Button,{className:"me-4",icon:(0,e.jsx)(Y.JO,{name:"Bootstrap/list-ul",className:"svg-icon-2"}),variant:!1,activeColor:"light-primary"})}),(0,e.jsx)(s.Tooltip,{placement:"bottom",inverse:!0,title:"\u6DFB\u52A0\u6210\u5458",children:(0,e.jsx)(s.Button,{className:"me-4",icon:(0,e.jsx)(Y.JO,{name:"Bootstrap/person-plus",className:"svg-icon-2"}),variant:!1,activeColor:"light-primary"})}),(0,e.jsx)(s.Tooltip,{placement:"bottom",inverse:!0,title:"\u804A\u5929\u8BBE\u7F6E",children:(0,e.jsx)(s.Button,{className:S()({"me-4":!!F}),icon:(0,e.jsx)(Y.JO,{name:"Bootstrap/gear",className:"svg-icon-2"}),variant:!1,activeColor:"light-primary"})}),F&&(0,e.jsx)(s.Tooltip,{placement:"bottom",inverse:!0,title:"\u8FD4\u56DE\u6D88\u606F\u5217\u8868",children:(0,e.jsx)(s.Button,{onClick:F,icon:(0,e.jsx)(Y.JO,{name:"Bootstrap/arrow-return-left",className:"svg-icon-2"}),variant:!1,activeColor:"light-primary"})})]})]}),(0,e.jsx)(s.Card.Body,{className:"pe-0 py-0 overflow-hidden",id:"kt_chat_messenger_body",children:r?(0,e.jsx)(it,{loadMore:a,loading:c,msgList:v,hasMore:f,curCve:r,scrollbar:M}):(0,e.jsx)(Ot,{})}),r&&(0,e.jsx)(s.Card.Footer,{className:"p-0",id:"kt_chat_messenger_footer",children:(0,e.jsx)(xe.w_,{style:{height:Dt(P.current.height)},direction:"y",onResize:re,onResizeEnd:I,children:(0,e.jsx)(Bt,{curCve:r,sendMsg:b})})})]})})}var Ht=wt},26699:function(Je,he,t){t.d(he,{Z:function(){return A.Z}});var A=t(15132)},75517:function(Je,he,t){t.d(he,{Z:function(){return n}});var A=t(1861),q=t(2721),me=t(67294),Z=t(12845),l=t(93967),Y=t.n(l),xe=t(51056),ie=t(36603),S=t(85893);function s(o){var d=o.data,C=o.onClick,N=o.curCve,T=(0,Z.useModel)("@@initialState",function(Re){var m;return(m=Re.initialState)===null||m===void 0||(m=m.currentUser)===null||m===void 0?void 0:m.id}),O=function(m){if(m==="")return m;var ye=JSON.parse(m);if(d.draftText!==""){var oe=d.draftText,y=/\<img.*?\">/g,ne=oe.match(y);return ne&&ne.length>0&&ne.forEach(function(Ne){oe=oe.replaceAll(Ne,"Picture")}),(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("span",{className:"text-warning me-1",children:"[\u8349\u7A3F]"}),oe]})}return(0,ie.LF)(ye,T)},w=function(m){return m===xe.PD.Nomal},e=w(d==null?void 0:d.recvMsgOpt)?O(d.latestMsg):d.unreadCount>0?"[".concat(d.unreadCount+"Piece","] ").concat(O(d.latestMsg)):O(d.latestMsg),Be=function(m){var ye=(0,ie.p6)(m),oe=(0,ie.p6)(m+864e5),y=(0,ie.p6)(new Date().getTime());return ye[3]===y[3]?ye[4]:oe[3]===y[3]?"\u6628\u5929":ye[3]},He=(0,me.useCallback)(function(){C(d)},[d,C]);return(0,S.jsxs)("div",{className:Y()("cve-item d-flex flex-stack py-4 mb-1",{active:(N==null?void 0:N.conversationID)===d.conversationID}),onClick:He,children:[(0,S.jsxs)("div",{className:"d-flex align-items-center",children:[(0,S.jsx)(q.Symbol.Avatar,{size:45,alt:d.showName,light:!0,badge:(0,S.jsx)(q.Badge,{dot:!w(d==null?void 0:d.recvMsgOpt)&&d.unreadCount>0,color:"danger",shape:"circle",className:"start-100",count:w(d==null?void 0:d.recvMsgOpt)?d.unreadCount:null})}),(0,S.jsxs)("div",{className:"ms-5",children:[(0,S.jsx)("a",{href:"#",className:"fs-5 fw-bold text-gray-900 text-hover-primary mb-2",children:d.showName}),(0,S.jsx)("div",{className:"fw-semibold text-muted cve_msg",children:e})]})]}),(0,S.jsx)("div",{className:"d-flex flex-column align-items-end ms-2",children:(0,S.jsx)("span",{className:"text-muted fs-7 mb-1",children:Be(d.latestMsgSendTime)})})]})}var k=s;function ue(o){var d=o.curCve,C=o.cves,N=o.onItemClick;return(0,S.jsx)(A.E,{className:"d-flex flex-column custom-scrollbar px-2 cve-list",options:{scrollbars:{autoHide:"scroll"}},children:(0,S.jsx)(q.Card,{flush:!0,className:"py-0 border-0 px-2 background-transparent",bodyClassName:"pt-5 pb-0 px-1 cve-list",children:C.map(function(T){return(0,S.jsx)(k,{onClick:N,cveList:C,data:T,curCve:d},T.conversationID)})})})}var n=ue},83988:function(Je,he,t){var A=t(5574),q=t.n(A),me=t(67294),Z=t(46027),l=t(93967),Y=t.n(l),xe=t(2721),ie=t(85893);function S(s){var k=s.onSearch,ue=s.className,n=(0,me.useState)(""),o=q()(n,2),d=o[0],C=o[1],N=(0,me.useCallback)(function(T){C(T.target.value),k(T.target.value)},[k]);return(0,ie.jsxs)("div",{className:Y()("cve-searchbar ps-6 pe-6 d-flex justify-content-sm-between align-items-center",ue),children:[(0,ie.jsx)(xe.Input.Search,{solid:!0,size:"lg",boxClassName:"flex-row-fluid me-2",value:d,onChange:N,placeholder:"\u641C\u7D22..."}),(0,ie.jsx)("a",{className:Y()("cve-searchbar-actions"),children:(0,ie.jsx)(Z.JO,{className:Y()("svg-icon-2x svg-icon-dark"),name:"Duotune/arr087"})})]})}he.Z=S},230:function(Je,he,t){t.d(he,{ED:function(){return k}});var A=t(97857),q=t.n(A),me=t(68400),Z=t.n(me),l=t(75063),Y=t(73359),xe,ie={},S=(0,l.Ps)(xe||(xe=Z()([`
    query getUserOnlineStatus($id: ID!) {
  user(id: $id) {
    id
    name
    onlineStatus {
      status
      detailPlatformStatus {
        platform
        status
      }
    }
  }
}
    `])));function s(n){var o=_objectSpread(_objectSpread({},ie),n);return Apollo.useQuery(S,o)}function k(n){var o=q()(q()({},ie),n);return Y.t(S,o)}function ue(n){var o=_objectSpread(_objectSpread({},ie),n);return Apollo.useSuspenseQuery(S,o)}},50252:function(Je,he,t){t.d(he,{RJ:function(){return Re}});var A=t(230),q=t(15009),me=t.n(q),Z=t(99289),l=t.n(Z),Y=t(97857),xe=t.n(Y),ie=t(19632),S=t.n(ie),s=t(67294),k=t(12845),ue=t(74857),n=t(63438),o=t(83956),d=t(51056),C=t(2721),N=t(65956),T=t(36603),O=t(97961),w=t(78864),e=function(){return(Math.random()*36).toString(36).slice(2)+new Date().getTime().toString()},Be=function(ye,oe){return new Promise(function(y,ne){N.S.getOneConversation({sourceID:ye,sessionType:oe}).then(function(Ne){return y(Ne.data)}).catch(function(Ne){return ne(Ne)})})};function He(){var m=(0,k.useModel)("open-im.cve",function(i){var u=i.state;return u.curCve}),ye=(0,k.useModel)("open-im.cve",function(i){var u=i.state;return u.cveInitLoading}),oe=(0,k.useModel)("open-im.cve",function(i){var u=i.actions;return u.setCurCve}),y=(0,k.useModel)("open-im.cve",function(i){var u=i.state;return u.cves}),ne=(0,k.useModel)("@@initialState",function(i){var u,L=i.initialState;return L==null||(u=L.currentUser)===null||u===void 0?void 0:u.id}),Ne=(0,k.useModel)("open-im.contacts",function(i){var u=i.actions;return u.getGroupInfo}),Ge=(0,k.useModel)("open-im.contacts",function(i){var u=i.actions;return u.getGroupMemberList}),Ce=[],h=(0,ue.Z)({historyMsgList:[],firstLoad:!1,typing:!1,hasMore:!0,merModal:!1,merData:void 0,searchStatus:!1,searchCve:[]}),et=(0,s.useRef)(null),tt=(0,s.useRef)(),Ke=(0,s.useCallback)(function(i){var u;(u=tt.current)===null||u===void 0||u.scroll({y:"100%"},i!=null?i:350)},[]);function pt(i){if(JSON.parse(i.data).length===0){h.hasMore=!1;return}JSON.stringify(h.historyMsgList[h.historyMsgList.length-1])===JSON.stringify(JSON.parse(i.data).reverse()[0])&&h.historyMsgList.pop(),h.historyMsgList=[].concat(S()(h.historyMsgList),S()(JSON.parse(i.data).reverse())),h.firstLoad||(h.firstLoad=!0,setTimeout(function(){return Ke(0)})),h.hasMore=!(JSON.parse(i.data).length<20)}var nt=(0,n.Z)(N.S.getAdvancedHistoryMessageList,{manual:!0,onSuccess:pt,onError:function(u){return console.log("GetChatRecordFailed",u)}}),xt=nt.loading,at=nt.run,Ct=nt.cancel,rt=(0,s.useCallback)(function(i,u,L){var G,Ie={userID:i!=null?i:"",groupID:u!=null?u:"",count:20,startClientMsgID:(G=L==null?void 0:L.clientMsgID)!==null&&G!==void 0?G:""};at(Ie)},[at]),At=(0,s.useCallback)(function(i,u){N.S.markMessagesAsReadByMsgID({conversationID:i,clientMsgIDList:u})},[]),Ve=(0,s.useCallback)(function(i,u){i.unreadCount===0&&!u||(0,T.vJ)(i)&&At(i.userID,[])},[At]),yt=(0,s.useCallback)(function(i){i?(h.searchStatus=!0,h.searchCve=y.filter(function(u){return u.conversationID.indexOf(i)>-1||u.showName.indexOf(i)>-1})):(h.searchCve=[],h.searchStatus=!1)},[y,h]),Mt=(0,s.useCallback)(function(i){if(!(0,T.vJ)(i)){Ne(i.groupID);var u={groupID:i.groupID,offset:0,filter:0,count:2e3};Ge(u)}},[Ne,Ge]),st=(0,s.useCallback)(function(i){i.conversationID!==(m==null?void 0:m.conversationID)&&(m&&w.Z.emit(O.jf,m),h.historyMsgList=[],h.firstLoad=!1,oe(i),h.hasMore=!0,Mt(i),Ct(),rt(i.userID,i.groupID),Ve(i))},[m,rt,Mt,Ve,Ct,h,oe]),Xe=(0,s.useCallback)(function(i,u,L){Ce.forEach(function(G){if(G.oid===i.operationID){var Ie=h.historyMsgList.findIndex(function(ae){return ae.clientMsgID===(G==null?void 0:G.mid)});Ie!==-1&&(G.flag=!0,L?h.historyMsgList[Ie].status=3:h.historyMsgList[Ie]=i.data)}}),u===d.Cs.MergeMessage&&C.Toast.success("ForwardSuccessTip"),Ke()},[Ce,h.historyMsgList,Ke]),it=(0,s.useCallback)(function(i,u,L,G){var Ie=e();if(L&&(m==null?void 0:m.userID)===L||G&&(m==null?void 0:m.groupID)===G||!L&&!G){var ae=i,Ye={oid:Ie,mid:ae.clientMsgID,flag:!1};Ce=[].concat(S()(Ce),[Ye]),ae.status=2,h.historyMsgList=[ae].concat(S()(h.historyMsgList)),setTimeout(function(){var de=Ce.find(function(Qe){return Qe.mid===ae.clientMsgID});de&&!de.flag&&h.historyMsgList.forEach(function(Qe){Qe.clientMsgID===de.mid&&(Qe.status=1)})},2e3),Ke()}var ze={title:"\u4F60\u6709\u4E00\u6761\u65B0\u6D88\u606F",desc:"",ex:"",iOSPushSound:"+1",iOSBadgeCount:!0},_e={recvID:L!=null?L:m.userID,groupID:G!=null?G:m.groupID,offlinePushInfo:ze,message:i};Ce=Ce.filter(function(de){return!de.flag}),O.Dw.includes(u)?N.S.sendMessageNotOss(_e,Ie).then(function(de){return Xe(de,u)}).catch(function(de){return Xe(de,u,!0)}):N.S.sendMessage(_e,Ie).then(function(de){return Xe(de,u)}).catch(function(de){return Xe(de,u,!0)})},[m]),Ze=(0,s.useCallback)(function(i,u){Be(i,u).then(function(L){return st(L)}).catch(function(L){C.Toast.error("\u83B7\u53D6\u4F1A\u8BDD\u5931\u8D25\uFF01"),console.error(L)})},[st]),Ue=(0,s.useCallback)(function(i){var u=i.sendID===(m==null?void 0:m.userID)||i.sendID===ne&&i.recvID===(m==null?void 0:m.userID);return i.sessionType===d.FF.Single?u:i.groupID===(m==null?void 0:m.groupID)},[m==null?void 0:m.groupID,m==null?void 0:m.userID,ne]),ot=(0,s.useCallback)(function(){h.typing=!0,et.current&&clearTimeout(et.current),et.current=setTimeout(function(){h.typing=!1},1e3)},[h]),lt=(0,s.useCallback)(function(i){var u=JSON.parse(i.data);u.contentType!==d.Cs.TypingMessage&&u.sendID!==ne&&(0,T.sc)(u,function(L,G){Ze(L,G),window.focus()}),m&&Ue(u)&&(u.contentType===d.Cs.TypingMessage?ot():(u.contentType===d.Cs.RevokeMessage?h.historyMsgList=[u].concat(S()(h.historyMsgList.filter(function(L){return L.clientMsgID!==u.content}))):h.historyMsgList=[u].concat(S()(h.historyMsgList)),Ve(m,1)))},[Ze,m,Ue,Ve,h,ne,ot]),ct=(0,s.useCallback)(function(i){var u=h.historyMsgList.findIndex(function(L){return L.clientMsgID===i.data});u>-1&&h.historyMsgList.splice(u,1)},[h]),ut=(0,s.useCallback)(function(i){JSON.parse(i.data).forEach(function(u){u.msgIDList.forEach(function(L){h.historyMsgList.forEach(function(G){G.clientMsgID===L&&(G.isRead=!0)})})})},[h]),dt=(0,s.useCallback)(function(){oe(null)},[oe]),vt=(0,s.useCallback)(function(i){var u=h.historyMsgList.findIndex(function(G){return G.clientMsgID===i}),L=S()(h.historyMsgList);L.splice(u,1),h.historyMsgList=L,C.Toast.success("\u5220\u9664\u6D88\u606F\u6210\u529F\uFF01")},[h]),ft=(0,s.useCallback)(function(i){var u=h.historyMsgList.findIndex(function(L){return L.clientMsgID===i});h.historyMsgList[u].contentType=O.j7.RevokeMessage},[h]),mt=(0,s.useCallback)(function(i,u){h.merData=xe()(xe()({},i),{},{sender:u}),h.merModal=!0},[h]),we=(0,s.useCallback)(function(i,u,L){L.map(function(){var G=l()(me()().mark(function Ie(ae){var Ye,ze,_e,de,Qe;return me()().wrap(function(Le){for(;;)switch(Le.prev=Le.next){case 0:if(_e=(Ye=ae.userID)!==null&&Ye!==void 0?Ye:"",de=(ze=ae.groupID)!==null&&ze!==void 0?ze:"",u!==d.Cs.MergeMessage){Le.next=8;break}return Le.next=5,N.S.createMergerMessage(i);case 5:Qe=Le.sent,Le.next=11;break;case 8:return Le.next=10,N.S.createForwardMessage(i);case 10:Qe=Le.sent;case 11:it(Qe.data,u,_e,de),w.Z.emit(O.rl,!1);case 13:case"end":return Le.stop()}},Ie)}));return function(Ie){return G.apply(this,arguments)}}())},[it]);return(0,s.useEffect)(function(){return N.S.on(o.l.OnRecvMessageRevoked,ct),N.S.on(o.l.OnRecvC2CReadReceipt,ut),function(){N.S.off(o.l.OnRecvMessageRevoked,ct),N.S.off(o.l.OnRecvC2CReadReceipt,ut)}},[ut,ct]),(0,s.useEffect)(function(){return w.Z.on(O.$F,dt),w.Z.on(O.Cd,vt),w.Z.on(O.rF,ft),w.Z.on(O.a7,mt),function(){w.Z.off(O.$F,dt),w.Z.off(O.Cd,vt),w.Z.off(O.rF,ft),w.Z.off(O.a7,mt)}},[vt,mt,dt,ft]),(0,s.useEffect)(function(){return w.Z.on(O.jA,we),w.Z.on(O.$M,Ze),N.S.on(o.l.OnRecvNewMessage,lt),function(){w.Z.off(O.jA,we),w.Z.off(O.$M,Ze),N.S.off(o.l.OnRecvNewMessage,lt)}},[Ze,m,lt,we]),(0,s.useEffect)(function(){return function(){oe(null)}},[oe]),{rs:h,cveList:y,loading:xt,cveLoading:ye,curCve:m,setCurCve:oe,handleCveSearch:yt,handleItemClick:st,scrollbar:tt,getHistoryMsg:rt,sendMsg:it}}var Re=He},14903:function(){}}]);

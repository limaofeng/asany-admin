(self.webpackChunkasany_admin=self.webpackChunkasany_admin||[]).push([[5985],{30098:function(Se,ce,j){"use strict";j.d(ce,{G:function(){return W.Z}});var oe=j(80064),W=j(48655),T=j(39981)},84036:function(Se,ce,j){"use strict";j.r(ce),j.d(ce,{default:function(){return da}});var oe=j(32059),W=j(3182),T=j(2824),ve=j(91220),ie=j(94043),x=j.n(ie),a=j(67294),de=j(95323),Q=j(95551),fe=j(30381),ee=j.n(fe),Fe=j(94184),te=j.n(Fe),G=j(36467),H=j(11849),Me=j(93224),se=j(28865),d=j(11974),me=j(94199),e=j(85893);function Te(l){var s=(0,G.V7)({fetchPolicy:"cache-and-network"}),n=s.data,i=(0,a.useMemo)(function(){return n!=null&&n.calendars?n.calendars.filter(function(t){return t.type==="SUNRISE"}).map(function(t){return(0,H.Z)((0,H.Z)({},t),{},{label:t.name,value:t.id})}):[]},[n==null?void 0:n.calendars]);return(0,e.jsx)(d.Ph,(0,H.Z)((0,H.Z)({},l),{},{options:i,itemRender:function(S,m){var v=S.color,k=(0,e.jsx)("div",{style:{backgroundColor:v,width:12,height:12,marginRight:8,border:"1px solid ".concat((0,me.r5)(v)),borderRadius:6,display:"inline-block"}});return m?(0,e.jsxs)(e.Fragment,{children:[a.cloneElement(k,{style:(0,H.Z)((0,H.Z)({},k.props.style),{},{marginRight:5})}),S.label]}):(0,e.jsxs)(e.Fragment,{children:[k,S.label]})}}))}var be=Te,Re=d.II.TextArea,Ee=[{label:"\u65E0",value:"none",scope:["all-day","general"],remind:{alert:"NONE"}},{type:"separator",scope:["all-day","general"]},{label:"\u65E5\u7A0B\u5F53\u5929 (\u4E0A\u5348 8:00)",value:"on time of event",scope:["all-day"],remind:{alert:"ON_TIME_OF_EVENT"}},{label:"1 \u5929\u524D (\u4E0A\u5348 8:00)",value:"1 day before 8:00",scope:["all-day"],remind:{alert:"DAYS_BEFORE",times:1}},{label:"2 \u5929\u524D (\u4E0A\u5348 8:00)",value:"2 day before 8:00",scope:["all-day"],remind:{alert:"DAYS_BEFORE",times:2}},{label:"\u65E5\u7A0B\u53D1\u751F\u65F6",value:"at time of event",scope:["general"],remind:{alert:"AT_TIME_OF_EVENT"}},{label:"1 \u5206\u949F\u524D",value:"1 minute before",scope:["general"],remind:{alert:"MINUTES_BEFORE",times:1}},{label:"5 \u5206\u949F\u524D",value:"5 minute before",scope:["general"],remind:{alert:"MINUTES_BEFORE",times:5}},{label:"10 \u5206\u949F\u524D",value:"10 minute before",scope:["general"],remind:{alert:"MINUTES_BEFORE",times:10}},{label:"15 \u5206\u949F\u524D",value:"15 minute before",scope:["general"],remind:{alert:"MINUTES_BEFORE",times:15}},{label:"30 \u5206\u949F\u524D",value:"30 minute before",scope:["general"],remind:{alert:"MINUTES_BEFORE",times:30}},{label:"45 \u5206\u949F\u524D",value:"45 minute before",scope:["general"],remind:{alert:"MINUTES_BEFORE",times:45}},{label:"1 \u5C0F\u65F6\u524D",value:"1 hour before",scope:["general"],remind:{alert:"HOURS_BEFORE",times:1}},{label:"2 \u5C0F\u65F6\u524D",value:"2 hour before",scope:["general"],remind:{alert:"HOURS_BEFORE",times:2}},{label:"1 \u5929\u524D",value:"1 day before",scope:["general"],remind:{alert:"DAYS_BEFORE",times:1}},{label:"2 \u5929\u524D",value:"2 day before",scope:["general"],remind:{alert:"DAYS_BEFORE",times:2}},{type:"separator",scope:["all-day","general"]},{label:"\u81EA\u5B9A\u4E49",value:"custom",scope:[]}];function Ae(l){var s=l.visible,n=l.calendarSets,i=l.onSuccess,t=(0,a.useRef)({title:"\u6D4B\u8BD5",allDay:!0,color:"none",alert:"none",starts:"2022-01-19",ends:"2022-01-19"}),S=(0,a.useState)(!1),m=(0,T.Z)(S,2),v=m[0],k=m[1],R=(0,Q.tT)("calendar",function(u){var Y=u.state;return ee()(Y.selectedDay||new Date).format("YYYY-MM-DD")}),C=(0,Q.tT)("calendar",function(u){return u.state.state=="new"}),p=(0,Q.tT)("calendar",function(u){return u.state.calendarSet}),M=(0,G.wO)(),r=(0,T.Z)(M,1),o=r[0];t.current.starts=R,t.current.ends=R;var L=(0,a.useCallback)(function(){k(function(u){return!u})},[]),N=(0,a.useCallback)(function(u){if(u.key=="Escape"){var Y;(Y=document.querySelector(".calendar-event-header input"))===null||Y===void 0||Y.focus()}},[]),E=d.l0.useForm();(0,a.useEffect)(function(){if(!t.current.calendar)if(p=="all")t.current.calendar=null;else{var u,Y;t.current.calendar=(u=n.find(function(Z){return Z.id==p}))===null||u===void 0||(Y=u.defaultCalendar)===null||Y===void 0?void 0:Y.id}E.setFieldsValue(t.current)},[p,n,E]);var f=(0,a.useCallback)(function(){var u=(0,W.Z)(x().mark(function Y(Z){var X,O,b,F,_,A,h;return x().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return O=Z.calendar,b=Z.alert,F=(0,Me.Z)(Z,["calendar","alert"]),_=(X=Ee.find(function(B){return B.value==b}))===null||X===void 0?void 0:X.remind,D.next=4,o({variables:{calendar:O,input:(0,H.Z)((0,H.Z)({},F),{},{remind:_||{alert:"NONE"}})}});case 4:A=D.sent,h=A.data,i(h==null?void 0:h.event);case 7:case"end":return D.stop()}},Y)}));return function(Y){return u.apply(this,arguments)}}(),[o,i]);return(0,a.useEffect)(function(){!C||E.setFieldsValue(t.current)},[C,E]),(0,e.jsx)("div",{className:te()("calendar-new-event-container",{invisible:!s}),children:(0,e.jsx)("div",{className:"calendar-new-event",children:(0,e.jsx)(d.l0,{onFinish:f,form:E,onKeyUp:N,size:"sm",layout:"horizontal",initialValues:t.current,children:(0,e.jsxs)("ul",{children:[(0,e.jsx)("li",{children:(0,e.jsx)(d.l0.Item,{name:"title",noStyle:!0,children:(0,e.jsx)(d.II,{size:"sm",solid:!0,placeholder:"\u65B0\u5EFA\u65E5\u7A0B"})})}),(0,e.jsx)("li",{children:(0,e.jsx)(d.l0.Item,{name:"allDay",valuePropName:"checked",label:"\u5168\u5929",children:(0,e.jsx)(d.XZ,{size:"sm"})})}),(0,e.jsx)("li",{children:(0,e.jsx)(d.l0.Item,{noStyle:!0,dependencies:["allDay"],children:function(){return(0,e.jsx)(d.l0.Item,{name:"starts",label:"\u5F00\u59CB\u65F6\u95F4",children:(0,e.jsx)(d.Mt,{solid:!0,size:"sm",timePicker:!E.getFieldValue("allDay"),format:E.getFieldValue("allDay")?"YYYY-MM-DD":"YYYY-MM-DD A HH:mm"})})}})}),(0,e.jsx)("li",{children:(0,e.jsx)(d.l0.Item,{noStyle:!0,dependencies:["allDay","starts"],children:function(){return(0,e.jsx)(d.l0.Item,{name:"ends",label:"\u7ED3\u675F\u65F6\u95F4",children:(0,e.jsx)(d.Mt,{solid:!0,size:"sm",minDate:E.getFieldValue("starts"),timePicker:!E.getFieldValue("allDay"),format:E.getFieldValue("allDay")?"YYYY-MM-DD":"YYYY-MM-DD A HH:mm"})})}})}),(0,e.jsx)("li",{children:(0,e.jsx)(d.l0.Item,{name:"calendar",label:"\u65E5\u5386",children:(0,e.jsx)(be,{solid:!0})})}),(0,e.jsx)("li",{children:(0,e.jsx)(d.l0.Item,{noStyle:!0,dependencies:["allDay"],children:function(){return(0,e.jsx)(d.l0.Item,{name:"alert",label:"\u63D0\u9192",children:(0,e.jsx)(d.Ph,{size:"sm",solid:!0,options:Ee.filter(function(Y){return Y.scope.includes(E.getFieldValue("allDay")?"all-day":"general")})})})}})}),(0,e.jsx)("li",{className:te()({invisible:!v}),children:(0,e.jsx)(d.l0.Item,{noStyle:!0,children:(0,e.jsx)(d.II,{solid:!0,placeholder:"\u8BBE\u7F6E\u94FE\u63A5"})})}),(0,e.jsx)("li",{className:te()({invisible:!v}),children:(0,e.jsx)(d.l0.Item,{noStyle:!0,children:(0,e.jsx)(Re,{autoSize:!0,solid:!0,placeholder:"\u5907\u6CE8"})})}),(0,e.jsxs)("li",{className:"event-actions",children:[(0,e.jsx)(se.ZP,{onClick:L,className:"toggle-more svg-icon-1",name:v?"Bootstrap/chevron-compact-up":"Bootstrap/chevron-compact-down"}),(0,e.jsx)(d.l0.Item,{noStyle:!0,dependencies:["title"],children:function(){return(0,e.jsx)(d.zx,{htmlType:"submit",disabled:!E.getFieldValue("title"),className:"event-btn-add rounded-2",children:"\u6DFB\u52A0\u65E5\u7A0B"})}})]})]})})})})}var Ie=Ae;function Pe(){var l=(0,a.useRef)(null),s=(0,a.useState)(!1),n=(0,T.Z)(s,2),i=n[0],t=n[1],S=(0,a.useState)(""),m=(0,T.Z)(S,2),v=m[0],k=m[1],R=(0,Q.tT)("calendar",function(f){var u=f.state;return u.selectedDay||new Date}),C=(0,Q.tT)("calendar",function(f){return f.state.state=="new"}),p=(0,Q.tT)("calendar",function(f){return f.changeState}),M=(0,a.useCallback)(function(){var f;(f=l.current)===null||f===void 0||f.focus()},[]),r=(0,a.useCallback)(function(){t(!0)},[]),o=(0,a.useCallback)(function(){var f=document.getElementsByClassName("main-calendar")[0];f==null||f.focus(),p("none"),k(""),t(!1)},[p]),L=(0,a.useCallback)(function(f){f.key=="Escape"&&o()},[o]),N=(0,a.useCallback)(function(f){if(k(f.target.value),!f.target.value){p("none");return}!C&&p("new",R)},[p,C,R]),E=(0,a.useCallback)(function(){var f;(f=l.current)!==null&&f!==void 0&&f.value||o()},[o]);return(0,a.useEffect)(function(){var f;if(!C){k(""),t(!1);return}var u=document.activeElement,Y=!!u&&(u.tagName==="INPUT"||u.tagName==="SELECT"||u.tagName==="TEXTAREA"||u.contentEditable&&u.contentEditable==="true");Y||((f=l.current)===null||f===void 0||f.focus(),k(ee()(R).format("YYYY-MM-DD")))},[C,R]),(0,e.jsxs)("div",{className:te()("calendar-event-header",{"event-header-state-new":C}),children:[(0,e.jsx)("div",{className:te()("calendar-event-header-left"),children:(0,e.jsx)(d.II,{onFocus:r,onBlur:E,ref:l,value:v,onChange:N,solid:!0,placeholder:"\u65B0\u5EFA\u65E5\u7A0B",onKeyUp:L})}),(0,e.jsx)("a",{className:te()("calendar-event-header-right",{"calendar-event-new-icon":!(i||C)}),onClick:i||C?o:M,children:(0,e.jsx)(se.ZP,{className:te()({"svg-icon-1":i||C,"svg-icon-2x svg-icon-dark":!(i||C)}),name:i||C?"Duotune/arr088":"Duotune/arr087"})})]})}var Ye=Pe,ke=j(86582);function Be(l){var s=l.calendarSets,n=l.onAction,i=(0,Q.tT)("calendar",function(v){return v.state.calendarSet}),t=(0,Q.tT)("calendar",function(v){return v.setCalendarSet}),S=(0,a.useCallback)(function(v){if(v.startsWith("calendar-set-"))t(v.substring("calendar-set-".length));else return n(v),!1;return!0},[n,t]),m=(0,a.useMemo)(function(){return[{value:"calendar-set-all",label:"\u5168\u90E8\u65E5\u5386"}].concat((0,ke.Z)(s.map(function(v){return{value:"calendar-set-".concat(v.id),label:v.name}})),[{type:"separator"},{value:"manage-calendars",label:"\u7BA1\u7406\u65E5\u5386"}])},[s]);return(0,e.jsx)("div",{className:"calendar-sidebar-footer",children:(0,e.jsx)(d.Ph,{onChange:S,placement:"topCenter",value:"calendar-set-".concat(i),options:m})})}var Oe=Be,he=j(22028),Ne=j(32317),De=j(96486);function We(l){var s=l.onSuccess,n=l.selectedKey,i=(0,G.Xy)(),t=(0,T.Z)(i,1),S=t[0],m=(0,G.yM)(),v=(0,T.Z)(m,1),k=v[0],R=(0,a.useCallback)((0,W.Z)(x().mark(function p(){var M,r;return x().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return L.next=2,S();case 2:M=L.sent,r=M.data,s(r==null?void 0:r.createCalendarSet);case 5:case"end":return L.stop()}},p)})),[S,s]),C=(0,a.useCallback)((0,W.Z)(x().mark(function p(){return x().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,k({variables:{id:n}});case 2:s();case 3:case"end":return r.stop()}},p)})),[k,n,s]);return(0,e.jsxs)("div",{className:"calendar-sets-footer",children:[(0,e.jsx)("a",{onClick:R,children:(0,e.jsx)(se.ZP,{name:"Duotune/arr087",className:"svg-icon-2"})}),(0,e.jsx)("a",{onClick:C,children:(0,e.jsx)(se.ZP,{name:"Duotune/arr089",className:"svg-icon-2"})})]})}var Ve=We,je=j(78929),xe=j(34155),Le=a.forwardRef(function(l,s){var n=l.data,i=l.editing,t=l.actived,S=l.onSelect,m=l.onEdit,v=l.drag,k=l.indicator,R=(0,G.f4)(),C=(0,T.Z)(R,1),p=C[0],M=(0,a.useState)(n.name),r=(0,T.Z)(M,2),o=r[0],L=r[1],N=(0,a.useRef)(null),E=(0,a.useCallback)(function(){S(n.id)},[n.id,S]),f=(0,a.useCallback)(function(){m(n.id)},[n.id,m]),u=(0,a.useMemo)(function(){return(0,De.debounce)(function(){var O=(0,W.Z)(x().mark(function b(F){return x().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return A.next=2,p({variables:{id:n.id,input:{name:F}}});case 2:case"end":return A.stop()}},b)}));return function(b){return O.apply(this,arguments)}}(),250)},[p,n.id]),Y=(0,a.useCallback)((0,W.Z)(x().mark(function O(){return x().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:if(m(),n.name==o){F.next=4;break}return F.next=4,u(o);case 4:case"end":return F.stop()}},O)})),[n.name,m,u,o]),Z=(0,a.useCallback)(function(O){L(O.target.value)},[]);(0,a.useEffect)(function(){var O;!i||((O=N.current)===null||O===void 0||O.focus(),xe.nextTick(function(){var b;(b=N.current)===null||b===void 0||b.select()}))},[i]);var X=(0,a.useCallback)(function(){var O=(0,W.Z)(x().mark(function b(F){return x().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(F!="EXIT"){A.next=5;break}m(),L(n.name),A.next=10;break;case 5:if(F!="ENTER"){A.next=10;break}if(m(),n.name==o){A.next=10;break}return A.next=10,u(o);case 10:case"end":return A.stop()}},b)}));return function(b){return O.apply(this,arguments)}}(),[n.name,m,u,o]);return(0,e.jsx)(he.fQ,{tag:(0,e.jsx)("li",{ref:v(s),onClick:E,onDoubleClick:f,className:te()("calendarset-item",{active:t,"indicator-drag-over-bottom":k>0,"indicator-drag-over-top":k<0})}),name:"CALENDAR_PREFERENCES",handler:X,children:(0,e.jsxs)("div",{className:"calendarset-item-btn",children:[(0,e.jsx)("span",{className:"input-state-view",children:o}),(0,e.jsx)("input",{className:"input-state-edit",ref:N,onChange:Z,onBlur:Y,value:o})]})})});function Ue(l){var s=l.data,n=s===void 0?[]:s,i=l.refresh,t=l.onSelect,S=(0,G.f4)(),m=(0,T.Z)(S,1),v=m[0],k=(0,Q.tT)("calendar",function(h){return h.state.calendarSet}),R=(0,a.useRef)(null),C=(0,a.useRef)({calendarSets:[]}),p=(0,a.useState)(),M=(0,T.Z)(p,2),r=M[0],o=M[1],L=(0,a.useState)(),N=(0,T.Z)(L,2),E=N[0],f=N[1];C.current.activeKey=r,C.current.editing=E,C.current.calendarSets=n;var u=(0,a.useCallback)(function(h){h!=C.current.activeKey&&(o(h),xe.nextTick(function(){var y;(y=R.current)===null||y===void 0||y.focus()}))},[]),Y=(0,a.useCallback)(function(){var h=(0,W.Z)(x().mark(function y(D){return x().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.next=2,i();case 2:D?(o(D.id),f(D.id)):n.length&&o(n[0].id);case 3:case"end":return w.stop()}},y)}));return function(y){return h.apply(this,arguments)}}(),[n,i]),Z=(0,a.useCallback)(function(){var h=(0,W.Z)(x().mark(function y(D){return x().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:f(D),D||xe.nextTick(function(){var c;(c=R.current)===null||c===void 0||c.focus()});case 2:case"end":return w.stop()}},y)}));return function(y){return h.apply(this,arguments)}}(),[]);(0,a.useEffect)(function(){if(!!n.length&&!n.some(function(y){return y.id==r})){var h=k=="all"?n[0].id:String(k);o(h)}},[r,n,k]),(0,a.useEffect)(function(){!r||t(r)},[r,t]);var X=(0,a.useCallback)(function(h){var y=C.current,D=y.calendarSets,B=y.activeKey,w=D.findIndex(function(c){return c.id==B});h=="PREVIOUS"?o(D[Math.max(w-1,0)].id):h=="NEXT"?o(D[Math.min(w+1,D.length-1)].id):h=="ENTER"?f(r):h=="EXIT"&&f(void 0)},[r]),O=(0,a.useCallback)(function(){},[]),b=(0,a.useMemo)(function(){return n.map(function(h){return(0,H.Z)((0,H.Z)({},h),{},{key:h.id,actived:r==h.id,editing:E==h.id})})},[r,n,E]),F=(0,a.useCallback)(function(){var h=(0,W.Z)(x().mark(function y(D){var B,w,c,I;return x().wrap(function($){for(;;)switch($.prev=$.next){case 0:return B=(0,je.y)(D.node._rect,D.node,D.dragNode,D.dropPosition,D.node.index),w=D.node.pos,c=B-Number(w[w.length-1]),I=D.node.index,c==-1?I--:c==1&&I++,$.next=7,v({variables:{id:D.dragNode.key,input:{index:Math.max(I,0)+1}}});case 7:i();case 8:case"end":return $.stop()}},y)}));return function(y){return h.apply(this,arguments)}}(),[i,v]),_=(0,a.useCallback)(function(h){return C.current.editing!=h.id},[]),A=(0,a.useCallback)(function(h){return!isNaN(h.dropPosition)},[]);return(0,e.jsxs)(he.fQ,{tag:(0,e.jsx)("div",{ref:R,className:te()("flex-left calendar-sets",{editing:!!E})}),name:"CALENDAR_PREFERENCES",handler:X,children:[(0,e.jsx)("div",{className:"calendar-sets-header",children:"\u65E5\u5386\u96C6"}),(0,e.jsx)("div",{className:"calendar-sets-body scroll-y",children:(0,e.jsx)(Ne.ZP,{onChange:O,tag:"ul",mode:"indicator",draggable:_,onDrop:F,allowDrop:A,className:"calendar-sets-list",items:b,rerender:!1,itemRender:function(y,D){var B=y.data,w=y.index;return(0,a.createElement)(Le,(0,H.Z)((0,H.Z)({},y),{},{ref:D,actived:B.actived,editing:B.editing,key:B.id,data:B,index:w,onSelect:u,onEdit:Z}))}})}),(0,e.jsx)(Ve,{onSuccess:Y,selectedKey:r})]})}var Ke=Ue,$e=j(80256),ze=j(69293),He=a.forwardRef(function(l,s){var n=l.closeDropdown,i=l.onAction,t=l.accounts,S=(0,a.useCallback)(function(m){n(),m.keyPath.startsWith("new-calendar")?i("new",m.key):m.keyPath.startsWith("new-calendar-subscription")&&i("subscribe")},[n,i]);return(0,e.jsxs)(d.v2,{className:"menu-gray-600 menu-state-bg-light-primary fw-bold fs-7 w-150px py-2",ref:s,dropdown:!0,onSelect:S,selectedKeys:[],children:[(0,e.jsx)(d.v2.SubMenu,{title:"\u65B0\u589E\u65E5\u5386",className:"px-2",bodyClassName:"py-2 w-150px",offset:[-6.5,0],children:t.map(function(m){return(0,e.jsx)(d.v2.Item,{title:m.name,className:"px-2"},m.id)})},"new-calendar"),(0,e.jsx)(d.v2.Separator,{className:"mx-1"}),(0,e.jsx)(d.v2.Item,{className:"px-2",children:"\u65B0\u589E\u65E5\u5386\u8BA2\u9605"},"new-calendar-subscription")]})});function Xe(l){var s=l.onSuccess,n=l.selectedItem,i=l.onEdit,t=(0,G.Bo)(),S=(0,T.Z)(t,1),m=S[0],v=(0,G.Cn)(),k=(0,T.Z)(v,1),R=k[0],C=(0,G.e)({fetchPolicy:"cache-and-network"}),p=C.data,M=(0,a.useMemo)(function(){return p!=null&&p.calendarAccounts?p.calendarAccounts||[]:[]},[p==null?void 0:p.calendarAccounts]),r=(0,a.useCallback)(function(){var N=(0,W.Z)(x().mark(function E(f,u){var Y,Z;return x().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:if(console.log(f,u),f!="new"){O.next=7;break}return O.next=4,m({variables:{input:{account:u}}});case 4:Y=O.sent,Z=Y.data,s(Z==null?void 0:Z.createCalendar);case 7:case"end":return O.stop()}},E)}));return function(E,f){return N.apply(this,arguments)}}(),[m,s]),o=(0,a.useCallback)(function(){!n||i(n.id,"modal")},[i,n]),L=(0,a.useCallback)((0,W.Z)(x().mark(function N(){var E;return x().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(n){u.next=2;break}return u.abrupt("return");case 2:return u.next=4,d.u_.confirm({title:"\u4F60\u786E\u5B9A\u8981\u5220\u9664\u65E5\u5386\u5417\uFF1F",content:"\u60A8\u786E\u5B9A\u8981\u5220\u9664\u65E5\u5386\u201C<strong>".concat(n.name,"</strong>\u201D\u5417\uFF1F\u8FD9\u4E5F\u5C06\u5220\u9664\u6B64\u65E5\u5386\u4E0A\u7684\u6240\u6709\u4E8B\u4EF6\u3002"),okText:"\u5220 \u9664",cancelClassName:"btn btn-secondary btn-sm",okClassName:"btn btn-danger btn-sm"});case 4:if(E=u.sent,E.isConfirmed){u.next=7;break}return u.abrupt("return");case 7:return u.next=9,R({variables:{id:n.id}});case 9:s();case 10:case"end":return u.stop()}},N)})),[R,n,s]);return(0,e.jsxs)("div",{className:"calendars-footer",children:[(0,e.jsx)(d.Lt,{overlay:(0,e.jsx)(He,{onAction:r,accounts:M}),placement:"bottomLeft",children:(0,e.jsx)("a",{children:(0,e.jsx)(se.ZP,{name:"Duotune/arr087",className:"svg-icon-2"})})}),(0,e.jsx)("a",{onClick:L,className:te()({disabled:!n}),children:(0,e.jsx)(se.ZP,{name:"Duotune/arr089",className:"svg-icon-2"})}),(0,e.jsx)("a",{onClick:o,className:te()({disabled:!n}),children:(0,e.jsx)(se.ZP,{name:"Bootstrap/gear-fill",className:"svg-icon-7"})}),(0,e.jsx)(Je,{})]})}function Je(){return(0,e.jsx)("div",{})}var Qe=Xe,pe=j(34155),Ge=a.forwardRef(function(l,s){var n=l.data,i=l.onSelect,t=l.onEdit,S=l.onCheck,m=l.editing,v=l.actived,k=l.checked,R=l.drag,C=l.indicator,p=l.onShortcut,M=(0,a.useState)(n.name),r=(0,T.Z)(M,2),o=r[0],L=r[1],N=(0,a.useRef)(null),E=(0,G.wg)(),f=(0,T.Z)(E,1),u=f[0],Y=(0,a.useCallback)(function(){i(n.id)},[n.id,i]),Z=(0,a.useCallback)(function(y){L(y.target.value)},[]),X=(0,a.useMemo)(function(){return(0,De.debounce)(function(){var y=(0,W.Z)(x().mark(function D(B){return x().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,u({variables:{id:n.id,input:{name:B}}});case 2:case"end":return c.stop()}},D)}));return function(D){return y.apply(this,arguments)}}(),250)},[u,n.id]),O=(0,a.useCallback)((0,W.Z)(x().mark(function y(){return x().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:t(),n.name!=o&&X(o);case 2:case"end":return B.stop()}},y)})),[n.name,t,X,o]),b=(0,a.useCallback)(function(y,D){if(D){var B;(B=N.current)===null||B===void 0||B.focus(),pe.nextTick(function(){var $;($=N.current)===null||$===void 0||$.select()})}else if(y){var w,c,I,K;(w=N.current)===null||w===void 0||(c=w.offsetParent)===null||c===void 0||(I=c.parentElement)===null||I===void 0||(K=I.parentElement)===null||K===void 0||K.focus()}},[]);(0,a.useEffect)(function(){!m||b(v,m)},[v,m,b]);var F=(0,a.useCallback)(function(y){y.stopPropagation(),b(!0)},[b]),_=(0,a.useCallback)(function(y){S(n.id,y.target.checked)},[n,S]),A=(0,a.useCallback)(function(){t(n.id,"modal")},[n.id,t]),h=(0,a.useCallback)(function(){var y=(0,W.Z)(x().mark(function D(B){return x().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:B=="EXIT"?(t(),L(n.name)):B=="ENTER"?(t(),n.name!=o&&X(o)):p(B);case 1:case"end":return c.stop()}},D)}));return function(D){return y.apply(this,arguments)}}(),[n.name,t,p,X,o]);return(0,e.jsxs)(he.fQ,{tag:(0,e.jsx)("li",{ref:R(s),onClick:Y,onDoubleClick:A,className:te()("calendar-list-item",{active:v,editing:m,"indicator-drag-over-bottom":C>0,"indicator-drag-over-top":C<0})}),name:"CALENDAR_PREFERENCES",handler:h,children:[(0,e.jsx)(d.XZ,{style:{backgroundColor:n.color,borderColor:v?(0,me.tG)(n.color,80):(0,me.r5)(n.color)},checked:k,onClick:F,onChange:_,className:"calendar-check",size:"sm"}),(0,e.jsxs)("div",{className:"calendar-list-item-btn",children:[(0,e.jsx)("span",{className:"input-state-view",children:o}),(0,e.jsx)("input",{className:"input-state-edit calendar-name",ref:N,onChange:Z,onBlur:O,value:o}),n._type=="SUBSCRIPTION"&&(0,e.jsx)("span",{className:"calendar-type",children:"\u8BA2\u9605"})]})]})});function _e(l){var s=l.refresh,n=l.calendarSet,i=(0,G.wg)(),t=(0,T.Z)(i,1),S=t[0],m=(0,G.wN)(),v=(0,T.Z)(m,1),k=v[0],R=(0,G.DM)(),C=(0,T.Z)(R,1),p=C[0],M=(0,G.V7)({fetchPolicy:"cache-and-network"}),r=M.data,o=M.refetch,L=(0,a.useState)(),N=(0,T.Z)(L,2),E=N[0],f=N[1],u=(0,a.useState)(),Y=(0,T.Z)(u,2),Z=Y[0],X=Y[1],O=(0,a.useState)((n==null?void 0:n.calendars.map(function(g){return g.id}))||[]),b=(0,T.Z)(O,2),F=b[0],_=b[1],A=(0,a.useRef)(null),h=(0,a.useRef)({checkedKeys:[],calendars:[]});h.current.checkedKeys=F,h.current.activeKey=E,h.current.editing=Z,h.current.calendarSet=n,h.current.calendars=(r==null?void 0:r.calendars)||[];var y=(0,a.useCallback)(function(g){g&&f(g),X(void 0),pe.nextTick(function(){var U;(U=A.current)===null||U===void 0||U.focus()})},[]),D=(0,a.useCallback)(function(g){g!=h.current.activeKey&&y(g)},[y]),B=(0,a.useCallback)(function(){var g=(0,W.Z)(x().mark(function U(P){var ae,V=arguments;return x().wrap(function(ne){for(;;)switch(ne.prev=ne.next){case 0:ae=V.length>1&&V[1]!==void 0?V[1]:"modal",P?X({key:P,type:ae}):y();case 2:case"end":return ne.stop()}},U)}));return function(U){return g.apply(this,arguments)}}(),[y]),w=(0,a.useMemo)(function(){if(!(r!=null&&r.calendars))return[];var g=[],U=(0,ve.Z)(r.calendars),P;try{var ae=function(){var z=P.value,ne=(0,H.Z)((0,H.Z)({},z),{},{key:z.id,actived:E==z.id,editing:(Z==null?void 0:Z.key)==z.id&&(Z==null?void 0:Z.type)=="inline",checked:F.some(function(re){return re==z.id}),_type:z.type});delete ne.type;var Ce=g.find(function(re){return re.id==z.account.id});Ce==null?g.push((0,H.Z)((0,H.Z)({},z.account),{},{calendars:[ne]})):Ce.calendars.push(ne)};for(U.s();!(P=U.n()).done;)ae()}catch(V){U.e(V)}finally{U.f()}return g.sort(function(V,z){return V.index-z.index})},[E,F,r==null?void 0:r.calendars,Z==null?void 0:Z.key,Z==null?void 0:Z.type]),c=(0,a.useCallback)(function(){var g=(0,W.Z)(x().mark(function U(P){return x().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:return V.next=2,o();case 2:P&&(f(P.id),X({type:"inline",key:P.id}));case 3:case"end":return V.stop()}},U)}));return function(U){return g.apply(this,arguments)}}(),[o]),I=(0,a.useCallback)(function(){},[]),K=(0,a.useCallback)(function(){var g=(0,W.Z)(x().mark(function U(P){var ae,V,z,ne;return x().wrap(function(re){for(;;)switch(re.prev=re.next){case 0:return ae=(0,je.y)(P.node._rect,P.node,P.dragNode,P.dropPosition,P.node.index),V=P.node.pos,z=ae-Number(V[V.length-1]),ne=P.node.index,z==-1?ne--:z==1&&ne++,re.next=7,S({variables:{id:P.dragNode.key,input:{index:Math.max(ne,0)+1}}});case 7:o();case 8:case"end":return re.stop()}},U)}));return function(U){return g.apply(this,arguments)}}(),[o,S]),$=(0,a.useCallback)(function(g){var U;return((U=h.current.editing)===null||U===void 0?void 0:U.key)!=g.id},[]),J=(0,a.useCallback)(function(g){return!isNaN(g.dropPosition)},[]),le=(0,a.useCallback)(function(g){var U=h.current,P=U.calendars,ae=U.activeKey,V=P.findIndex(function(z){return z.id==ae});g=="PREVIOUS"?y(P[Math.max(V-1,0)].id):g=="NEXT"?f(P[Math.min(V+1,P.length-1)].id):g=="ENTER"?X({key:ae,type:"inline"}):g=="EXIT"&&y()},[y]),q=(0,a.useCallback)(function(){y()},[y]),ue=(0,a.useCallback)(function(){var g=(0,W.Z)(x().mark(function U(P,ae){var V,z,ne;return x().wrap(function(re){for(;;)switch(re.prev=re.next){case 0:if(z=(V=h.current.calendarSet)===null||V===void 0?void 0:V.id,ne=h.current.checkedKeys,console.log("handleChange",P,ae,z),!ae){re.next=9;break}return _([].concat((0,ke.Z)(ne),[P])),re.next=7,k({variables:{id:P,set:z}});case 7:re.next=12;break;case 9:return _(ne.filter(function(oa){return oa!=P})),re.next=12,p({variables:{id:P,set:z}});case 12:s();case 13:case"end":return re.stop()}},U)}));return function(U,P){return g.apply(this,arguments)}}(),[s,k,p]);return(0,a.useEffect)(function(){_((n==null?void 0:n.calendars.map(function(g){return g.id}))||[])},[n==null?void 0:n.calendars]),(0,e.jsxs)(he.fQ,{tag:(0,e.jsx)("div",{ref:A,className:te()("calendar-list",{editing:!!Z})}),handler:le,name:"CALENDAR_PREFERENCES",children:[(0,e.jsxs)("div",{className:"calendar-list-notes",children:["\u201C",n==null?void 0:n.name,"\u201D\u65E5\u5386\u96C6\u7684\u65E5\u5386\u548C\u4EFB\u52A1\u5217\u8868\u3002"]}),(0,e.jsxs)("div",{className:"calendar-list-content",children:[(0,e.jsx)("div",{className:"calendars-header",children:"\u6211\u7684\u65E5\u5386"}),(0,e.jsx)("div",{className:"calendars-body scroll-y",children:w.map(function(g){return(0,e.jsxs)("div",{className:"calendars-group",children:[(0,e.jsx)("div",{className:"calendars-group-header",children:"\u6211\u7684\u65E5\u5386"}),(0,e.jsx)("div",{className:"calendars-group-body",children:(0,e.jsx)(Ne.ZP,{onChange:I,tag:"ul",mode:"indicator",onDrop:K,draggable:$,allowDrop:J,className:"calendar-sets-list",items:g.calendars,rerender:!1,itemRender:function(P,ae){var V=P.data,z=P.index;return(0,a.createElement)(Ge,(0,H.Z)((0,H.Z)({},P),{},{ref:ae,actived:V.actived,editing:V.editing,checked:V.checked,onCheck:ue,key:V.id,data:V,index:z,onSelect:D,onEdit:B,onShortcut:le}))}})})]},g.id)})}),(0,e.jsx)(Qe,{onSuccess:c,selectedItem:h.current.calendars.find(function(g){return g.id==E}),onEdit:B})]}),(0,e.jsx)(qe,{data:h.current.calendars.find(function(g){return g.id==E}),visible:(Z==null?void 0:Z.type)=="modal",onClose:q})]})}function qe(l){var s=l.onClose,n=l.visible,i=l.data,t=(0,G.wg)(),S=(0,T.Z)(t,1),m=S[0],v=d.l0.useForm(),k=(0,a.useState)(i==null?void 0:i.color),R=(0,T.Z)(k,2),C=R[0],p=R[1],M=(0,a.useState)(!1),r=(0,T.Z)(M,2),o=r[0],L=r[1],N=(0,a.useRef)(null),E=(0,a.useRef)(null),f=(0,a.useMemo)(function(){return[{value:"#ff3d33",label:"\u7EA2\u8272"},{value:"#fc8328",label:"\u6A59\u8272"},{value:"#ffcc00",label:"\u9EC4\u8272"},{value:"#63da38",label:"\u7EFF\u8272"},{value:"#1badf8",label:"\u84DD\u8272"},{value:"#cc73e1",label:"\u7D2B\u8272"},{value:"#a67a63",label:"\u68D5\u8272"},{type:"separator"},{value:"other",label:"\u5176\u4ED6"}]},[]),u=(0,a.useMemo)(function(){return C&&f.some(function(b){return b.value==C})?C:"other"},[f,C]);(0,a.useEffect)(function(){var b;!n||(p(i==null?void 0:i.color),v.setFieldsValue(i),(b=N.current)===null||b===void 0||b.focus(),pe.nextTick(function(){var F;(F=N.current)===null||F===void 0||F.select()}))},[n]),(0,ze.Z)(E,function(){L(!1)});var Y=(0,a.useCallback)(function(b){b=="other"?L(!0):p(b)},[p]),Z=(0,a.useCallback)((0,W.Z)(x().mark(function b(){var F;return x().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return F=v.getFieldsValue(),A.next=3,m({variables:{id:i.id,input:(0,H.Z)({color:C},F)}});case 3:s();case 4:case"end":return A.stop()}},b)})),[C,i,v,s,m]),X=(0,a.useCallback)(function(){s(),L(!1)},[s]),O=(0,a.useCallback)(function(b){var F=b.hex;p(F)},[]);return(0,e.jsx)(d.u_,{centered:!0,visible:n,dialogClassName:"modal-dialog-concise-style w-400px",onCancel:X,onOk:Z,header:!1,closable:!1,okButtonProps:{className:"btn-xs"},cancelButtonProps:{className:"btn-xs"},children:(0,e.jsxs)(d.l0,{form:v,layout:"horizontal",initialValues:(0,H.Z)({},i),size:"xs",children:[(0,e.jsxs)("div",{className:"d-flex flex-row flex-center",children:[(0,e.jsx)("div",{className:"d-flex flex-column-fluid",children:(0,e.jsx)(d.l0.Item,{name:"name",label:"\u540D\u79F0",children:(0,e.jsx)(d.II,{ref:N,className:"calendar-name"})})}),(0,e.jsx)("div",{className:"d-flex flex-column-auto flex-center",children:(0,e.jsxs)("div",{className:"asany-form-item",children:[(0,e.jsx)(d.Ph,{value:u,size:"xs",onChange:Y,placement:"bottomCenter",itemRender:function(F,_){var A=F.value=="other"?C||(i==null?void 0:i.color):F.value;if(!A)return(0,e.jsx)(e.Fragment,{});var h=(0,e.jsx)("div",{style:{backgroundColor:A,width:20,height:14,marginRight:8,border:"1px solid ".concat((0,me.r5)(A)),display:"inline-block"}});return _?a.cloneElement(h,{style:(0,H.Z)((0,H.Z)({},h.props.style),{},{marginRight:5})}):(0,e.jsxs)(e.Fragment,{children:[h,F.label]})},options:f}),(0,e.jsx)(d.J2,{visible:o,overlayClassName:"popover-content-body",content:(0,e.jsx)("div",{ref:E,children:(0,e.jsx)($e.xS,{presetColors:f.filter(function(b){return b.value!="other"&&b.type!="separator"}).map(function(b){return{color:b.value,title:b.label}}),color:C,onChangeComplete:O,onChange:O,width:"220px"})}),children:(0,e.jsx)("div",{})})]})})]}),(i==null?void 0:i.type)=="SUBSCRIPTION"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"d-flex flex-row flex-center",children:(0,e.jsx)(d.l0.Item,{name:"url",label:"\u5730\u5740",children:(0,e.jsx)(d.II,{})})}),(0,e.jsx)("div",{className:"d-flex flex-row flex-center",children:(0,e.jsx)(d.l0.Item,{name:"refresh",label:"\u5237\u65B0",children:(0,e.jsx)(d.Ph,{className:"w-100px",placement:"bottomCenter",options:[{value:"NEVER",label:"\u4ECE\u4E0D"},{value:"EVERY_5_MINUTES",label:"\u6BCF5\u5206\u949F"},{value:"EVERY_15_MINUTES",label:"\u6BCF15\u5206\u949F"},{value:"EVERY_HOVER",label:"\u6BCF\u5C0F\u65F6"},{value:"EVERY_DAY",label:"\u6BCF\u5929"},{value:"EVERY_WEEK",label:"\u6BCF\u5468"}]})})})]}),(0,e.jsxs)("div",{className:"d-flex flex-row flex-center",children:[(0,e.jsx)("div",{className:"d-flex flex-column-auto flex-center",style:{width:56}}),(0,e.jsx)("div",{className:"d-flex flex-column-fluid",children:(0,e.jsx)(d.l0.Item,{name:"ignoreAlerts",valuePropName:"checked",children:(0,e.jsx)(d.XZ,{label:"\u5FFD\u7565\u63D0\u9192"})})})]})]})})}var ea=_e;function aa(){var l,s=(0,G.f4)(),n=(0,T.Z)(s,1),i=n[0],t=(0,G.Dn)({fetchPolicy:"cache-and-network"}),S=t.data,m=t.refetch,v=S==null?void 0:S.calendarSets,k=d.l0.useForm(),R=(0,a.useState)(),C=(0,T.Z)(R,2),p=C[0],M=C[1],r=(0,a.useCallback)(function(N){M(N)},[]),o=(v||[]).find(function(N){return N.id==p});(0,a.useEffect)(function(){var N;k.setFieldsValue({defaultCalendar:o==null||(N=o.defaultCalendar)===null||N===void 0?void 0:N.id})},[o,k]);var L=(0,a.useCallback)((0,W.Z)(x().mark(function N(){var E;return x().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(E=k.getFieldsValue(),o){u.next=3;break}return u.abrupt("return");case 3:return console.log("handleChange calendarSet",E),u.next=6,i({variables:{id:o.id,input:E}});case 6:case"end":return u.stop()}},N)})),[o,k,i]);return(0,e.jsxs)("div",{className:"settings-calendars",children:[(0,e.jsx)("div",{className:"settings-calendars-notes",children:"\u901A\u8FC7\u521B\u5EFA\u591A\u4E2A\u65E5\u5386\u96C6\u5FEB\u901F\u66F4\u6539\u663E\u793A\u7684\u65E5\u5386\u548C\u4EFB\u52A1\u5217\u8868\u3002\u4F8B\u5982\uFF0C\u60A8\u53EF\u80FD\u6709\u5355\u72EC\u7684\u5BB6\u5EAD\u548C\u5DE5\u4F5C\u65E5\u5386\u96C6\u3002"}),(0,e.jsxs)("div",{className:"d-flex",children:[(0,e.jsx)(Ke,{onSelect:r,data:v,refresh:m}),(0,e.jsxs)("div",{className:"settings-calendars-right flex-root",children:[(0,e.jsx)(ea,{refresh:m,calendarSet:o}),(0,e.jsx)("div",{className:"calendar-sets-settings",children:(0,e.jsx)(d.l0,{form:k,layout:"horizontal",size:"xs",initialValues:{defaultCalendar:o==null||(l=o.defaultCalendar)===null||l===void 0?void 0:l.id},onFieldsChange:L,children:(0,e.jsx)("div",{className:"d-flex flex-row flex-center",children:(0,e.jsx)(d.l0.Item,{name:"defaultCalendar",label:"\u9ED8\u8BA4\u65E5\u5386",children:(0,e.jsx)(be,{solid:!0})})})})})]})]})]})}var na=aa;function ra(l){var s=l.visible,n=l.onCancel,i=(0,a.useState)(!1),t=(0,T.Z)(i,2),S=t[0],m=t[1],v=(0,a.useState)("calendars"),k=(0,T.Z)(v,2),R=k[0],C=k[1],p=(0,a.useCallback)(function(){m(!0)},[]),M=(0,a.useCallback)(function(r){C(r)},[]);return(0,e.jsx)(d.u_,{centered:!0,maskClosable:!1,visible:s,onCancel:n,onOk:p,scroll:!1,confirmLoading:S,dialogClassName:"mw-750px calendar-preferences",header:(0,e.jsx)(d.u_.Header,{children:(0,e.jsxs)(d.JL,{onSelect:M,selectedKey:R,children:[(0,e.jsx)(d.JL.Item,{className:"me-2 mb-md-0",children:(0,e.jsxs)(d.JL.Link,{className:"btn d-flex flex-column btn-active-light-primary",children:[(0,e.jsx)(se.ZP,{name:"Duotune/cod001",className:"svg-icon-2 me-0"}),(0,e.jsx)("span",{className:"d-flex flex-column align-items-start pt-2",children:(0,e.jsx)("span",{className:"fs-7",children:"\u5E38\u89C4"})})]})},"general"),(0,e.jsx)(d.JL.Item,{className:"me-2 mb-md-0",children:(0,e.jsxs)(d.JL.Link,{className:"btn d-flex flex-column btn-active-light-success",children:[(0,e.jsx)(se.ZP,{name:"Duotune/gen014",className:"svg-icon-2  me-0"}),(0,e.jsx)("span",{className:"d-flex flex-column align-items-start pt-2",children:(0,e.jsx)("span",{className:"fs-7",children:"\u65E5\u5386"})})]})},"calendars"),(0,e.jsx)(d.JL.Item,{className:"me-2 mb-md-0",children:(0,e.jsxs)(d.JL.Link,{className:"btn d-flex flex-column btn-active-light-info",children:[(0,e.jsx)(se.ZP,{name:"Duotune/fil020",className:"svg-icon-2  me-0"}),(0,e.jsx)("span",{className:"d-flex flex-column align-items-start pt-2",children:(0,e.jsx)("span",{className:"fs-7",children:"\u5929\u6C14"})})]})},"weather")]})}),footer:null,children:(0,e.jsx)(na,{})})}var ta=ra,ye=j(25496),la=j(30098),sa={months:["1 \u6708","2 \u6708","3 \u6708","4 \u6708","5 \u6708","6 \u6708","7 \u6708","8 \u6708","9 \u6708","10 \u6708","11 \u6708","12 \u6708"],weekDays:[{name:"\u661F\u671F\u5929",short:"\u5468\u65E5",isWeekend:!0},{name:"\u661F\u671F\u4E00",short:"\u5468\u4E00"},{name:"\u661F\u671F\u4E8C",short:"\u5468\u4E8C"},{name:"\u661F\u671F\u4E09",short:"\u5468\u4E09"},{name:"\u661F\u671F\u56DB",short:"\u5468\u56DB"},{name:"\u661F\u671F\u4E94",short:"\u5468\u4E94"},{name:"\u661F\u671F\u516D",short:"\u5468\u516D",isWeekend:!0}],weekStartingIndex:0,getToday:function(s){return s},toNativeDate:function(s){return new Date(s.year,s.month-1,s.day)},getMonthLength:function(s){return new Date(s.year,s.month,0).getDate()},transformDigit:function(s){return s},nextMonth:"Next Month",previousMonth:"Previous Month",openMonthSelector:"Open Month Selector",openYearSelector:"Open Year Selector",closeMonthSelector:"Close Month Selector",closeYearSelector:"Close Year Selector",defaultPlaceholder:"Select...",from:"from",to:"to",digitSeparator:",",yearLetterSkip:0,isRtl:!1};function ia(l,s){for(var n=0;n<7;n++){var i=l.clone().add(n,"days"),t=i.format("YYYY-MM-DD");s.has(t)?s.get(t).isWeather=!0:s.set(t,{key:t,date:i,events:[],isToDay:i.isSame(l,"date"),isWeather:!1})}}function we(l,s){var n=l.format("YYYY-MM-DD"),i=s.find(function(t){return t.isSelected});if(i){if(i.key==n)return s;i.isTemporary?s.splice(s.findIndex(function(t){return t.isTemporary}),1):s.find(function(t){return t.isSelected}).isSelected=!1}if(s.some(function(t){return t.key==n}))s.find(function(t){return t.key==n}).isSelected=!0;else return s.push({key:n,date:l,events:[],isToDay:l.isSame(ee()(),"date"),isWeather:!1,isSelected:!0,isTemporary:!0}),s.sort(function(t,S){return t.date.toDate().getTime()-S.date.toDate().getTime()});return s}function ge(l,s){var n=ee()(),i=new Map,t=(0,ve.Z)(l),S;try{for(t.s();!(S=t.n()).done;){var m=S.value,v=(0,ve.Z)(m.dates),k;try{for(v.s();!(k=v.n()).done;){var R=k.value,C=ee()(R),p=C.format("YYYY-MM-DD");if(i.has(p)){var M;(M=i.get(p))===null||M===void 0||M.events.push(m)}else i.set(p,{key:p,date:C,isToDay:C.isSame(n,"date"),events:[m],isWeather:!1})}}catch(r){v.e(r)}finally{v.f()}}}catch(r){t.e(r)}finally{t.f()}return ia(n,i),we(ee()(s),Array.from(i.values()).sort(function(r,o){return r.date.toDate().getTime()-o.date.toDate().getTime()}))}var Ze=[];function ua(){var l=(0,G.Dn)(),s=l.data,n=(0,Q.tT)("calendar",function(c){var I=c.state;return I.calendarSet}),i=(0,Q.tT)("calendar",function(c){return c.state.state=="new"}),t=(0,Q.tT)("calendar",function(c){var I=c.state;return I.selectedDay||new Date}),S=(0,Q.tT)("calendar",function(c){return c.setSelectedDay}),m=(0,Q.tT)("calendar",function(c){return c.changeState}),v=(0,Q.tT)("calendar",function(c){return c.state.fullCalendar}),k=(0,a.useState)(!1),R=(0,T.Z)(k,2),C=R[0],p=R[1],M=(0,a.useRef)(null),r=(0,a.useRef)({selectedDay:t,eventsWithDays:[]}),o=(0,a.useReducer)(function(c){return c+1},0),L=(0,T.Z)(o,2),N=L[1];r.current.calendarSet=n;var E=(0,G.Vk)({fetchPolicy:"cache-and-network"}),f=(0,T.Z)(E,2),u=f[0],Y=f[1].refetch,Z=(0,a.useCallback)(function(){p(!1)},[]),X=(0,a.useCallback)(function(c){c==="manage-calendars"&&p(!0)},[]),O=(0,a.useCallback)(function(c){c&&S(new Date(c.year,c.month-1,c.day))},[S]),b=(0,a.useCallback)(function(c){return function(){S(r.current.selectedDay=c)}},[S]),F=(0,a.useCallback)(function(c){if(!!M.current){var I=Array.from(document.getElementsByClassName("event-list-item")),K=I.find(function(le){return ee()(le.dataset.date).isSame(ee()(c),"date")});if(!!K){var $=K.getBoundingClientRect().top+M.current.scrollTop,J=M.current.getBoundingClientRect();M.current.scrollTo({top:$-J.top-6.5}),r.current.skipNextScroll=!0,setTimeout(function(){clearTimeout(r.current.timer)},120),N()}}},[]);(0,a.useEffect)(function(){u({variables:{date:t,days:60,calendarSet:n=="all"?void 0:n}}).then(function(c){var I=c.data;r.current.eventsWithDays=ge((I==null?void 0:I.events)||[],r.current.selectedDay),r.current.toDayOrNextEvent=r.current.eventsWithDays.find(function(K){return K.key==ee()(r.current.selectedDay).format("YYYY-MM-DD")}),r.current.skipNextScroll=!0,N(),F(t)})},[n,u]);var _=(0,a.useCallback)(function(){var c=(0,W.Z)(x().mark(function I(K){var $,J;return x().wrap(function(q){for(;;)switch(q.prev=q.next){case 0:return r.current.selectedDay=K,r.current.eventsWithDays=we(ee()(K),r.current.eventsWithDays),r.current.toDayOrNextEvent=r.current.eventsWithDays.find(function(ue){return ue.key==ee()(K).format("YYYY-MM-DD")}),r.current.skipNextScroll=!0,N(),q.next=7,(0,ye._v)(60);case 7:return F(K),q.next=10,(0,ye._v)(60);case 10:if(r.current.selectedDay==K){q.next=12;break}return q.abrupt("return");case 12:return q.next=14,Y({date:K,days:60,calendarSet:r.current.calendarSet=="all"?void 0:r.current.calendarSet});case 14:return $=q.sent,J=$.data,r.current.eventsWithDays=ge(J.events,r.current.selectedDay),r.current.skipNextScroll=!0,N(),q.next=21,(0,ye._v)(60);case 21:r.current.selectedDay==K&&F(K);case 22:case"end":return q.stop()}},I)}));return function(I){return c.apply(this,arguments)}}(),[]);(0,a.useEffect)(function(){r.current.selectedDay&&ee()(r.current.selectedDay).isSame(t,"date")||!r.current.eventsWithDays.length||_(t)},[t]);var A=(0,a.useCallback)(function(){if(!!M.current){if(r.current.skipNextScroll){r.current.skipNextScroll=!1;return}var c=Array.from(document.getElementsByClassName("event-list-item")),I=M.current.getBoundingClientRect(),K=c.find(function(J){if(J.dataset.temp=="true")return!1;var le=J.getBoundingClientRect(),q=J.getElementsByClassName("event-list")[0].getBoundingClientRect().height,ue=le.top-I.top+q+16;return ue>0&&ue<le.height});if(!!K){var $=r.current.eventsWithDays.find(function(J){return J.key==K.dataset.date});!$||(r.current.eventsWithDays=r.current.eventsWithDays.filter(function(J){return!J.isTemporary}),r.current.eventsWithDays.forEach(function(J){J.isSelected=!1}),$.isSelected=!0,r.current.skipNextScroll=!0,r.current.toDayOrNextEvent=$,N(),clearTimeout(r.current.timer),r.current.timer=setTimeout((0,W.Z)(x().mark(function J(){var le,q;return x().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,Y({date:$.date.toDate(),days:60,calendarSet:r.current.calendarSet=="all"?void 0:r.current.calendarSet});case 2:le=g.sent,q=le.data,r.current.eventsWithDays=ge(q.events,r.current.selectedDay),r.current.skipNextScroll=!0,N();case 7:case"end":return g.stop()}},J)})),1e3),S(r.current.selectedDay=ee()(K.dataset.date).toDate()))}}},[S]),h=(0,a.useCallback)(function(c){var I=document.getElementsByClassName("main-calendar")[0];I==null||I.focus(),m("none"),console.log("fullCalendar",v==null?void 0:v.getApi()),v==null||v.getApi().refetchEvents(),_(new Date(c.datetime.starts))},[v,m,_]),y=r.current,D=y.toDayOrNextEvent,B=y.eventsWithDays,w=B.find(function(c){return c.key==(D==null?void 0:D.key)});return(0,e.jsxs)(la.G,{width:325,collapsible:!1,resizeable:!0,className:te()("calendar-sidebar-bg",{"state-new-event":i}),children:[(0,e.jsxs)("div",{className:"calendar-sidebar",children:[(0,e.jsx)(Ye,{}),(0,e.jsx)(Ie,{visible:i,onSuccess:h,calendarSets:(s==null?void 0:s.calendarSets)||Ze}),(0,e.jsx)(de.f,{locale:sa,value:{year:t.getFullYear(),month:t.getMonth()+1,day:t.getDate()},onChange:O,shouldHighlightWeekends:!0,colorPrimary:"#04c8c8"}),(0,e.jsxs)("div",{className:"calendar-day-list",children:[(0,e.jsxs)("div",{className:"event-list-header",children:[(0,e.jsxs)("h6",{children:[w!=null&&w.isToDay?"\u4ECA\u5929":(w==null?void 0:w.date.format("dddd"))||"\u4ECA\u5929",(0,e.jsx)("span",{className:"day-subtitle text-muted",children:(w==null?void 0:w.date.format("YYYY-MM-DD"))||ee()().format("YYYY-MM-DD")})]}),!(w!=null&&w.events.length)&&(w==null?void 0:w.isSelected)&&(0,e.jsx)("div",{className:"onday-no-events text-muted",children:"\u6CA1\u6709\u4E8B\u4EF6"})]}),(0,e.jsx)("div",{ref:M,onScrollCapture:A,className:"event-list-body hover-scroll-y",children:B.map(function(c){var I,K=c.key,$=c.date,J=c.isToDay,le=c.events,q=c.isSelected,ue=c.isTemporary;return(0,e.jsxs)("div",{className:"event-list-item","data-temp":ue,"data-date":K,children:[(0,e.jsxs)("h6",{onClick:b($.toDate()),children:[J?"\u4ECA\u5929":$.format("dddd"),(0,e.jsx)("span",{className:"day-subtitle text-muted",children:$.format("YYYY-MM-DD")})]}),(0,e.jsx)("div",{className:te()("event-list",(I={},(0,oe.Z)(I,"is-empty",!le.length),(0,oe.Z)(I,"onday-no-events",!le.length&&q),I)),children:le.map(function(g){return(0,e.jsx)(d.J2,{content:(0,e.jsx)("div",{children:"12312313"}),children:(0,e.jsx)("span",{style:{backgroundColor:g.color},className:"event-day",children:g.title},g.id)},g.id)})})]},K)})})]}),(0,e.jsx)(Oe,{calendarSets:(s==null?void 0:s.calendarSets)||Ze,onAction:X})]}),(0,e.jsx)(ta,{visible:C,onCancel:Z})]})}var ca=a.memo(ua),da=ca},78929:function(Se,ce,j){"use strict";j.d(ce,{f:function(){return T},y:function(){return ve}});var oe=j(19755),W=j.n(oe);function T(ie){var x=parseInt(W()(ie).data("click-number")||0)+1;if(x==2)return clearTimeout(W()(ie).data("timer-reset")),W()(ie).data("click-number",0),!0;var a=setTimeout(function(){W()(ie).data("click-number",0),clearTimeout(a)},500);return W()(ie).data("click-number",x).data("timer-reset",a),!1}function ve(ie,x,a,de,Q){var fe=ie.height/3/2,ee=de<fe&&de>-fe&&(a==null?void 0:a.parentKey)!==x.id;return ee?Q:de>0?Q+1:de<0?Q-1:NaN}}}]);

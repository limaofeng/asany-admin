(self.webpackChunkasany_admin=self.webpackChunkasany_admin||[]).push([[983],{10983:function(fe,q,u){"use strict";u.r(q),u.d(q,{default:function(){return Le}});var b=u(3182),j=u(2824),F=u(11849),ae=u(94043),i=u.n(ae),r=u(67294),ve=u(17187),ge=u.n(ve),re=u(51615),he=u(6182),xe=u(94184),ne=u.n(xe),G=u(28865),pe=u(96486),T=u(40839),k=u(88403),be=u(30381),le=u.n(be),Me=u(24561),ke=u(54108),E=u(11974),a=u(85893);function ye(t){return t.mimeType=="text/html"?(0,ke.Kv)(t.body||""):t.body}function Ce(t){var g=le()(t.date),e=le()().diff(g,"days");return e==0?g.format("A HH:mm"):e==1?g.fromNow():g.format("YYYY-MM-DD")}function we(t){return t.mailboxName==k.LJ.INBOX.id?t.from.map(k.ss).join("\u3001"):(t.mailboxName==k.LJ.Sent.id,t.to.map(k.ss).join("\u3001"))}function Ne(t){var g=t.index,e=t.data,y=t.refresh,Z=t.forwardNextMessage,h=(0,T.Rh)({refetchQueries:[T.f_,T.Nd]}),$=(0,j.Z)(h,1),s=$[0],L=(0,T.aB)({refetchQueries:[T.f_]}),v=(0,j.Z)(L,1),x=v[0],S=(0,T.k0)({refetchQueries:[T.Nd]}),U=(0,j.Z)(S,1),J=U[0],W=(0,r.useCallback)((0,b.Z)(i().mark(function N(){return i().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,x({variables:{id:e.id,flags:["seen"],mode:e.seen?"REMOVE":"ADD"}});case 2:y({type:"updateFlags",key:e.id,index:g});case 3:case"end":return c.stop()}},N)})),[e.id,e.seen,g,y,x]),P=(0,r.useCallback)((0,b.Z)(i().mark(function N(){return i().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,s({variables:{id:e.id,mailbox:"archive"}});case 2:Z(),y({type:"toFolder",key:e.id,index:g});case 4:case"end":return c.stop()}},N)})),[e.id,Z,y,s,g]),z=(0,r.useCallback)((0,b.Z)(i().mark(function N(){var I;return i().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!(e.mailboxName==k.LJ.Drafts.id||e.mailboxName==k.LJ.Trash.id)){n.next=11;break}return n.next=3,E.u_.confirm({title:"\u8B66\u544A",content:e.mailboxName==k.LJ.Trash.id?"\u786E\u5B9A\u6C38\u4E45\u5220\u9664\u4FE1\u606F\uFF1F":"\u786E\u5B9A\u6C38\u4E45\u5220\u9664\u8349\u7A3F\uFF1F"});case 3:if(I=n.sent,I.isConfirmed){n.next=6;break}return n.abrupt("return");case 6:return n.next=8,J({variables:{id:e.id}});case 8:y({type:"delete",key:e.id,index:g}),n.next=14;break;case 11:return n.next=13,s({variables:{id:e.id,mailbox:"trash"}});case 13:y({type:"toFolder",key:e.id,index:g});case 14:Z();case 15:case"end":return n.stop()}},N)})),[e.mailboxName,e.id,Z,J,y,g,s]);return(0,a.jsxs)("div",{className:ne()("d-flex flex-column email-message-actions",{"message-unread":!e.seen}),onClick:function(I){return I.stopPropagation()},children:[(0,a.jsx)("a",{onClick:W,className:"flags-read",children:(0,a.jsx)(G.JO,{className:"svg-icon-7 svg-icon-success",name:e.seen?"Duotune/abs009":"Duotune/abs050"})}),![k.LJ.Archive.id,k.LJ.Drafts.id,k.LJ.Trash.id].includes(e.mailboxName)&&(0,a.jsx)("a",{onClick:P,children:(0,a.jsx)(G.JO,{className:"svg-icon-6",name:k.LJ.Archive.icon})}),(0,a.jsx)("a",{onClick:z,children:(0,a.jsx)(G.JO,{className:"svg-icon-5",name:"Duotune/gen027"})})]})}function je(t){var g=t.useMessage,e=t.style,y=t.forwardNextMessage,Z=t.active,h=t.index,$=t.onClick,s=t.refresh,L=(0,re.k6)(),v=g(h),x=(0,r.useCallback)(function(){$((0,F.Z)((0,F.Z)({},v),{},{index:h}))},[v,h,$]),S=(0,r.useCallback)(function(){v.mailboxName==k.LJ.Drafts.id&&L.push("/mail/compose/".concat(v.id),{message:v})},[v,L]);return(0,a.jsx)("div",{style:e,onClick:v&&x,onDoubleClick:v&&S,className:ne()("email-message d-flex flex-row",{active:Z}),children:v?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Ne,{forwardNextMessage:y,index:h,refresh:s,data:v}),(0,a.jsxs)("div",{className:"email-message-body d-flex flex-column",children:[(0,a.jsxs)("div",{className:"email-message-attrs",children:[(0,a.jsx)(G.JO,{className:"svg-icon-4 smart-type",name:"Duotune/abs018"}),(0,a.jsx)("span",{className:"email-user",children:we(v)||"(\u65E0\u6536\u4EF6\u4EBA)"}),(0,a.jsx)("span",{className:"inbox-time",children:Ce(v)})]}),(0,a.jsx)("div",{className:"email-message-title",children:v.subject||"(\u65E0\u4E3B\u9898)"}),(0,a.jsx)("div",{className:"email-message-summary",children:ye(v)||"\u6B64\u90AE\u4EF6\u4E2D\u6CA1\u6709\u6587\u672C\u5185\u5BB9\u3002"})]})]}):(0,a.jsx)("div",{className:"email-message-loading",children:(0,a.jsxs)(Me.ZP,{speed:2,width:500,height:69,viewBox:"0 0 500 69",backgroundColor:"#f3f3f3",foregroundColor:"#ecebeb",children:[(0,a.jsx)("rect",{x:"24",y:"3",rx:"0",ry:"0",width:"476",height:"18"}),(0,a.jsx)("rect",{x:"0",y:"50",rx:"0",ry:"0",width:"500",height:"16"}),(0,a.jsx)("rect",{x:"0",y:"3",rx:"2",ry:"2",width:"18",height:"18"}),(0,a.jsx)("rect",{x:"0",y:"27",rx:"0",ry:"0",width:"500",height:"16"})]})})})}var De=je,Y=u(25496),Ie=u(75468),se=320,oe=500,_={totalCount:0,pageSize:0,totalPage:0,currentPage:0},Re=80;function Ae(t){var g=(0,r.useRef)(new(ge())),e=(0,r.useRef)({page:1,mailbox:t,loading:!1,messages:[],pagination:(0,F.Z)({},_)}),y=(0,r.useReducer)(function(c){return c+1},0),Z=(0,j.Z)(y,2),h=Z[1],$=(0,T.YD)({fetchPolicy:"cache-and-network"}),s=(0,j.Z)($,2),L=s[0],v=s[1],x=v.data,S=v.loading,U=v.refetch;e.current.loading=S;var J=(0,r.useCallback)(function(c){c.edges.map(function(n){return n.node}).forEach(function(n,d){var p=c.pageSize*(c.currentPage-1)+d;e.current.messages[p]=n}),g.current.emit("messages")},[]),W=(0,r.useCallback)(function(){var c=(0,b.Z)(i().mark(function n(d){return i().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(!(e.current.loading&&e.current.page==d)){o.next=2;break}return o.abrupt("return");case 2:if(!e.current.loading){o.next=7;break}return o.next=5,(0,Y._v)(120);case 5:o.next=2;break;case 7:e.current.page=d,U({filter:{mailbox:e.current.mailbox},page:e.current.page});case 9:case"end":return o.stop()}},n)}));return function(n){return c.apply(this,arguments)}}(),[U]),P=(0,r.useCallback)(function(){var c=(0,b.Z)(i().mark(function n(d){var p,o;return i().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:p=e.current.pagination.pageSize,e.current.pagination.totalCount%e.current.pagination.pageSize==1&&e.current.pagination.totalPage--,e.current.pagination.totalCount--,e.current.messages.splice(d,1),o=Math.ceil((d+1)/p),W(o);case 6:case"end":return O.stop()}},n)}));return function(n){return c.apply(this,arguments)}}(),[W]),z=(0,r.useCallback)(function(){var c=(0,b.Z)(i().mark(function n(d){return i().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(!e.current.loading){o.next=5;break}return o.next=3,(0,Y._v)(120);case 3:o.next=0;break;case 5:if(!(e.current.page==d||d>e.current.pagination.totalPage)){o.next=7;break}return o.abrupt("return");case 7:e.current.page=d,L({variables:{filter:{mailbox:e.current.mailbox},page:e.current.page}});case 9:case"end":return o.stop()}},n)}));return function(n){return c.apply(this,arguments)}}(),[L]),N=(0,r.useCallback)(function(){var c=(0,b.Z)(i().mark(function n(d){var p;return i().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(p=e.current.messages[d],p){m.next=12;break}case 2:if(p=e.current.messages[d],p){m.next=8;break}return m.next=6,z(Math.ceil((d+1)/e.current.pagination.pageSize));case 6:return m.next=8,(0,Y._v)(30);case 8:if(!(d>=e.current.messages.length)){m.next=11;break}return console.log("\u7D22\u5F15\u8D85\u51FA\u6700\u5927\u957F\u5EA6 [".concat(d,"/").concat(e.current.messages.length,"]")),m.abrupt("return",e.current.messages[d-1]);case 11:if(!p){m.next=2;break}case 12:return m.abrupt("return",p);case 13:case"end":return m.stop()}},n)}));return function(n){return c.apply(this,arguments)}}(),[z]);(0,r.useEffect)(function(){g.current.setMaxListeners(1e3)},[]),(0,r.useEffect)(function(){e.current.mailbox!=t&&(e.current.mailbox=t,e.current.pagination=(0,F.Z)({},_),e.current.messages.length=0,e.current.page=1),L({variables:{filter:{mailbox:t},page:e.current.page}})},[L,t]),(0,r.useEffect)(function(){S||!(x!=null&&x.mailboxMessages)||(e.current.pagination=(0,F.Z)({},x.mailboxMessages)||e.current.pagination,J(x.mailboxMessages),h())},[J,x==null?void 0:x.mailboxMessages,S]);var I=function(n){var d=(0,r.useReducer)(function(B){return B+1},0),p=(0,j.Z)(d,2),o=p[1],m=(0,r.useRef)({index:n});m.current.index=n,m.current.message=e.current.messages[n],(0,r.useEffect)(function(){if(n!=-1){var B=n+1,H,ee=function(){var te=(0,b.Z)(i().mark(function X(){return i().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:if(!e.current.loading){D.next=5;break}return D.next=3,(0,Y._v)(300);case 3:D.next=0;break;case 5:if(!m.current.message){D.next=8;break}return m.current.timer&&clearTimeout(m.current.timer),D.abrupt("return");case 8:z(Math.ceil(B/e.current.pagination.pageSize)),H=setTimeout(ee,300);case 10:case"end":return D.stop()}},X)}));return function(){return te.apply(this,arguments)}}();return H=setTimeout(ee,300),function(){H&&clearTimeout(H)}}},[n]);var O=(0,r.useCallback)(function(){var B=e.current.messages[m.current.index];B!=m.current.message&&(m.current.message=B,o())},[]);return(0,r.useEffect)(function(){return g.current.addListener("messages",O),function(){g.current.removeListener("messages",O)}},[O]),m.current.message};return[e.current.pagination,S,I,{loadMessage:N,refetch:W,refetchWithRemove:P}]}function Ze(t){var g=t.children,e=t.match.params.folder,y=(0,re.$B)({path:"/mail/:folder/:id",strict:!0,sensitive:!0}),Z=y==null?void 0:y.params.id,h=(0,re.k6)(),$=(0,r.useRef)(null),s=(0,r.useRef)({width:se,folder:e,activeIndex:-1,loading:!1,pagination:_}),L=(0,r.useReducer)(function(f){return f+1},0),v=(0,j.Z)(L,2),x=v[1];s.current.folder=e,s.current.activeId=Z;var S=(0,T.nE)({refetchQueries:[T.Nd]}),U=(0,j.Z)(S,1),J=U[0],W=Ae(e),P=(0,j.Z)(W,4),z=P[0],N=P[1],I=P[2],c=P[3],n=c.loadMessage,d=c.refetch,p=c.refetchWithRemove;s.current.loading=N,s.current.pagination=z;var o=(0,r.useMemo)(function(){return(0,pe.debounce)(function(){x()},10)},[]),m=(0,r.useCallback)(function(f){s.current.activeIndex=f.index,h.push("/mail/".concat(f.mailboxName.toLowerCase(),"/").concat(f.id))},[h]);s.current.message=I(s.current.activeIndex);var O=(0,r.useCallback)(function(){var f=(0,b.Z)(i().mark(function M(C){var w;return i().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(s.current.activeIndex!=C.index){l.next=2;break}return l.abrupt("return");case 2:return l.next=4,n(C.index);case 4:if(w=l.sent,s.current.activeIndex=C.index,s.current.activeId!=w.id){l.next=9;break}return x(),l.abrupt("return");case 9:h.push("/mail/".concat(w.mailboxName.toLowerCase(),"/").concat(w.id));case 10:case"end":return l.stop()}},M)}));return function(M){return f.apply(this,arguments)}}(),[h,n]),B=(0,r.useCallback)(function(f){s.current.width+=f,o()},[o]),H=(0,r.useCallback)(function(){s.current.width=Math.min(oe,Math.max(se,s.current.width))},[]),ee=Math.min(oe,Math.max(se,s.current.width));(0,r.useMemo)(function(){s.current.pagination=(0,F.Z)({},_),s.current.activeIndex=-1,s.current.folder=e},[e]);var te=(0,r.useCallback)(function(){var f=(0,b.Z)(i().mark(function M(C){var w;return i().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,n(C);case 2:w=l.sent,s.current.activeIndex=C,h.push("/mail/".concat(w.mailboxName.toLowerCase(),"/").concat(w.id));case 5:case"end":return l.stop()}},M)}));return function(M){return f.apply(this,arguments)}}(),[h,n]),X=(0,r.useCallback)(function(){var f=(0,b.Z)(i().mark(function M(C){var w;return i().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(w=Math.ceil((C.index+1)/s.current.pagination.pageSize),!["toFolder","delete"].includes(C.type)){l.next=6;break}return l.next=4,p(C.index);case 4:l.next=8;break;case 6:return l.next=8,d(w);case 8:case"end":return l.stop()}},M)}));return function(M){return f.apply(this,arguments)}}(),[d,p]),de=(0,r.useCallback)((0,b.Z)(i().mark(function f(){var M,C;return i().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return M=0,R.next=3,E.u_.confirm({title:"\u6E05\u7A7A&nbsp;&nbsp;\u56DE\u6536\u7AD9",content:"\u786E\u5B9A\u6C38\u4E45\u5220\u9664 \u56DE\u6536\u7AD9 \u6587\u4EF6\u5939\u5185\u7684\u5168\u90E8\u90AE\u4EF6\uFF1F",preConfirm:function(){var l=(0,b.Z)(i().mark(function ue(){var K,Q,ce;return i().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:return K=document.querySelector(".swal2-confirm"),K.textContent="\u6E05\u7406\u4E2D...",Q=document.createElement("span"),Q.classList.add("spinner-border-sm","ms-2","spinner-border","align-middle"),K.appendChild(Q),V.next=7,(0,Y.gw)(J(),350);case 7:ce=V.sent,M=ce.data.clearMailboxMessagesInTrashMailbox;case 9:case"end":return V.stop()}},ue)}));function ie(){return l.apply(this,arguments)}return ie}()});case 3:if(C=R.sent,C.isConfirmed){R.next=6;break}return R.abrupt("return");case 6:s.current.activeIndex=-1,x(),d(1),h.push("/mail/".concat(s.current.folder)),E.u_.success({title:"\u64CD\u4F5C\u6210\u529F",content:"\u56DE\u6536\u7AD9\u5DF2\u88AB\u6E05\u7A7A, \u5171\u5220\u9664 ".concat(M," \u5C01\u90AE\u4EF6"),timer:3e3});case 11:case"end":return R.stop()}},f)})),[J,h,d]),D=(0,r.useMemo)(function(){var f=k.GG.find(function(M){return M.id.toLowerCase()==e});return f||{id:e,name:e,icon:void 0}},[e]),Te=(0,r.useCallback)(function(){},[]),Ee=(0,r.useCallback)(function(){return(0,a.jsxs)("div",{className:"mailbox-is-empty",style:{height:"100%"},children:[(0,a.jsx)("img",{src:"/assets/media/illustrations/dozzy-1/4.png"}),(0,a.jsx)("span",{className:"empty-title",children:N?"\u52A0\u8F7D\u4E2D...":"\u6B64\u6587\u4EF6\u5939\u4E3A\u7A7A"}),(0,a.jsx)("span",{className:"empty-subtitle",children:N?"\u7A0D\u7B49\u4E00\u4F1A,\u6B63\u5728\u83B7\u53D6\u6570\u636E":"\u8BF7\u67E5\u770B\u5176\u4ED6\u6587\u4EF6\u5939"})]})},[N]),Se=(0,r.useCallback)(function(f){var M=f.key,C=f.style,w=f.index,R=f.isActive,l=s.current,ie=l.folder,ue=l.pagination;return(0,a.jsx)(De,{index:w,style:(0,F.Z)({},C),onClick:m,useMessage:I,refresh:X,forwardNextMessage:(0,b.Z)(i().mark(function K(){var Q;return i().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(s.current.activeIndex!=-1){A.next=2;break}return A.abrupt("return");case 2:if(ue.totalCount!=0){A.next=6;break}h.push("/mail/".concat(s.current.folder)),A.next=15;break;case 6:if(!(w<s.current.activeIndex)){A.next=11;break}s.current.activeIndex-=1,x(),A.next=15;break;case 11:return A.next=13,n(s.current.activeIndex);case 13:Q=A.sent,h.push("/mail/".concat(s.current.folder,"/").concat(Q.id));case 15:case"end":return A.stop()}},K)})),mailbox:ie,active:!!R},M)},[m,h,n,X,I]),me=s.current,ze=me.activeIndex,Fe=me.message;return(0,a.jsxs)(Ie.v,{className:"apps-email-mailbox",header:!1,footer:!1,children:[(0,a.jsxs)(he.w_,{className:ne()("mailbox-resizer d-flex flex-column flex-lg-row"),style:{width:ee},onResize:B,onResizeEnd:H,children:[(0,a.jsx)("div",{className:"flex-column flex-lg-row-auto w-100 mb-10 mb-lg-0",children:(0,a.jsxs)(E.Zb,{flush:!0,className:"mailbox-card",children:[(0,a.jsx)(E.Zb.Header,{children:(0,a.jsxs)("form",{className:"d-flex align-items-center position-relative w-100",autoComplete:"off",children:[(0,a.jsx)(G.ZP,{name:"Duotune/gen021",className:"svg-icon-2 svg-icon-lg-1 svg-icon-gray-500 position-absolute top-50 ms-5 translate-middle-y"}),(0,a.jsx)(E.II,{solid:!0,className:"px-15",placeholder:"\u641C\u7D22\u90AE\u4EF6\u2026"})]})}),(0,a.jsxs)(E.Zb.Body,{children:[(0,a.jsxs)("div",{className:"mailbox-list-header",children:[D.icon&&(0,a.jsx)(G.ZP,{className:"svg-icon-5 svg-icon-success",name:D.icon}),(0,a.jsx)("span",{className:"box-name",children:D.name}),D.id==k.LJ.Trash.id&&!!z.totalCount&&(0,a.jsx)("div",{className:"box-actions",children:(0,a.jsx)(E.zx,{className:"trash-clear",variantStyle:"light",variant:"danger",size:"sm",activeColor:"light-danger",onClick:de,children:"\u6E05\u7A7A\xA0\xA0\u56DE\u6536\u7AD9"})})]}),(0,a.jsxs)("div",{className:"infinite-scroll-container",children:[(0,a.jsx)(E.AP,{isAnimating:!!N,position:"top"}),(0,a.jsx)(E.v_,{ref:$,rowCount:z.totalCount,rowHeight:Re,scrollToIndex:s.current.activeIndex,onScrollToIndex:O,onScroll:Te,rowRenderer:Se,noRowsRenderer:Ee,className:"mailbox-list"})]})]})]})}),(0,a.jsx)("div",{className:"flex-lg-row-fluid ms-lg-7 ms-xl-10"})]}),Z?r.cloneElement(g,{pagination:z,activeIndex:ze,goto:te,refresh:X,message:Fe}):(0,a.jsx)("div",{className:"mail-message-details mailbox-message-is-empty",children:(0,a.jsx)("img",{src:"/assets/media/illustrations/sketchy-1/16.png"})})]})}var Le=Ze},88403:function(fe,q,u){"use strict";u.d(q,{LJ:function(){return j},GG:function(){return F},ss:function(){return ae}});var b=u(5618),j={INBOX:{id:"INBOX",name:"\u6536\u4EF6\u7BB1",icon:"Duotune/com010",badge:"success"},Sent:{id:"Sent",name:"\u5DF2\u53D1\u9001",icon:"Duotune/gen016"},Drafts:{id:"Drafts",name:"\u8349\u7A3F",icon:"Duotune/gen009",badge:"primary"},Archive:{id:"Archive",name:"\u5F52\u6863",icon:"Duotune/lay010"},Spam:{id:"Spam",name:"\u5783\u573E\u90AE\u4EF6",icon:"Duotune/gen044"},Trash:{id:"Trash",name:"\u56DE\u6536\u7AD9",icon:"Duotune/gen027",badge:"warning"},Outbox:{id:"Outbox",name:"\u53D1\u4EF6\u7BB1",icon:"Duotune/gen027"}},F=Object.keys(j).map(function(i){return j[i]});function ae(i){var r=(0,b.N8)(i);return r.name||r.address&&r.address.substring(0,r.address.indexOf("@"))}}}]);

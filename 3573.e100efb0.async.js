(self.webpackChunk=self.webpackChunk||[]).push([[3573],{14336:function(we,ne,n){"use strict";var ce=n(15009),i=n.n(ce),pe=n(99289),S=n.n(pe),fe=n(97857),X=n.n(fe),re=n(5574),te=n.n(re),M=n(62435),h=n(79817),u=n(12708);function _(C,c){return C.replace(/{(\w+)}/g,function(d,g){return c[g]!==void 0?c[g]:d})}function D(C,c){var d=C(X()({fetchPolicy:"network-only"},(c==null?void 0:c.mutation)||{})),g=te()(d,1),j=g[0],Y=(0,M.useRef)(!1),t=(0,M.useCallback)(function(){var $=S()(i()().mark(function k(o,s){var P,A,z,R,x,E,L,Z,H;return i()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return P=(s==null?void 0:s.dialog)||(c==null?void 0:c.dialog)||{},A=(s==null?void 0:s.mutation)||(c==null?void 0:c.mutation)||{},z=(s==null?void 0:s.onDeleted)||(c==null?void 0:c.onDeleted),R=P.width,x=P.title,E=P.content,L=!1,Array.isArray(o)?(L=!0,typeof x=="function"&&(x=x(o,{batch:!0})),typeof E=="function"&&(E=E(o,{batch:!0}))):o&&(typeof x=="string"&&(x=_(x,o)),typeof E=="string"&&(E=_(E,o)),typeof x=="function"&&(x=x(o,{batch:!1})),typeof E=="function"&&(E=E(o,{batch:!1}))),Z=function(){var ae=S()(i()().mark(function K(){return i()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,j(X()(X()({fetchPolicy:"network-only"},A),{},{variables:{where:{id_in:L?o:[o==null?void 0:o.id]}}}));case 2:case"end":return y.stop()}},K)}));return function(){return ae.apply(this,arguments)}}(),I.next=10,h.Modal.confirm(X()(X()({},P),{},{title:x,content:E,width:R,okText:"\u5220 \u9664",okClassName:"btn-danger",allowOutsideClick:function(){return!Y.current},preConfirm:function(){var ae=S()(i()().mark(function q(){var y,ve,Pe;return i()().wrap(function(ue){for(;;)switch(ue.prev=ue.next){case 0:return Y.current=!0,ue.prev=1,y=document.querySelector(".swal2-confirm"),y.textContent="\u5220\u9664\u4E2D...",ve=document.createElement("span"),ve.classList.add("spinner-border-sm","ms-2","spinner-border","align-middle"),y.appendChild(ve),ue.next=9,(0,u.gw)(Z(),350);case 9:Pe=ue.sent,z&&z(Pe);case 11:return ue.prev=11,Y.current=!1,ue.finish(11);case 14:case"end":return ue.stop()}},q,null,[[1,,11,14]])}));function K(){return ae.apply(this,arguments)}return K}()}));case 10:if(H=I.sent,H.isConfirmed){I.next=13;break}return I.abrupt("return",!1);case 13:return h.Toast.success("\u5220\u9664\u6210\u529F",2e3,{placement:"top-center",progressBar:!0}),I.abrupt("return",!0);case 15:case"end":return I.stop()}},k)}));return function(k,o){return $.apply(this,arguments)}}(),[]),B=(0,M.useCallback)(function(){var $=S()(i()().mark(function k(o,s){return i()().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return A.abrupt("return",t(o,s));case 1:case"end":return A.stop()}},k)}));return function(k,o){return $.apply(this,arguments)}}(),[c,j]),O=(0,M.useCallback)(function($,k){return t($,k)},[]);return{delete:B,deleteMany:O}}ne.Z=D},55811:function(we,ne,n){"use strict";var ce=n(97857),i=n.n(ce),pe=n(52677),S=n.n(pe),fe=n(61227),X=n.n(fe),re=n(62435),te=n(32512),M=n(93162),h=n.n(M),u=n(84105),_=function(d){var g=d.split(`
`);return g.map(function(j){return j.split(",")})},D=function(d,g){var j=X()(d),Y=j[0],t=j.slice(1);return t.map(function(B){for(var O={},$=0,k=Object.keys(g.fields);$<k.length;$++){var o=k[$],s=g.fields[o];typeof s=="number"?O[o]=B[s]:typeof s=="string"?O[o]=B[Y.indexOf(s)]:S()(s)==="object"&&(O[o]=typeof s.index=="string"?B[Y.indexOf(s.index)]:B[s.index],s.formatter&&(O[o]=s.formatter(O[o])))}return O})};function C(c,d){var g=(0,re.useCallback)(function(o){var s=o[0];if(s){var P=new FileReader;P.onload=function(A){var z=s.name.split(".").pop().toLowerCase();if(z==="csv"){var R=A.target.result,x=_(R);console.log("Parsed CSV Data:",x)}else if(z==="xls"||z==="xlsx"){var E=A.target.result,L=u.ij(E,{type:"binary"}),Z=L.SheetNames[0],H=L.Sheets[Z],de=u.P6.sheet_to_json(H,{header:d.header||1,raw:!1,dateNF:"yyyy-mm-dd hh:mm:ss"}),I=D(de,d);console.log("Formatted JSON Data:",I),c(I)}else console.error("Unsupported file type")},s.type==="text/csv"||s.name.endsWith(".csv")?P.readAsText(s):P.readAsBinaryString(s)}},[c]),j=(0,te.uI)({onDrop:g,accept:{"text/csv":[".csv"],"application/vnd.ms-excel":[".xls"],"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":[".xlsx"]},maxFiles:1}),Y=j.getRootProps,t=j.getInputProps,B=Y(),O=B.onClick,$=(0,re.useCallback)(function(o){console.log("handleImportExcel"),O&&O(o)},[O]),k=(0,re.useCallback)(function(){var o,s,P=Object.keys(d.fields).map(function(K){var q=d.fields[K];return S()(q)==="object"&&q.name||K}),A=Object.keys(d.fields).map(function(K){var q=d.fields[K];return S()(q)==="object"&&q.example||""}),z=[P,A],R=u.P6.aoa_to_sheet(z);(o=d.template)!==null&&o!==void 0&&o.cols&&(R["!cols"]=d.template.cols);for(var x=0,E=1;E<x;E++)for(var L=0;L<P.length;L++){var Z=u.P6.encode_cell({r:E,c:L});R[Z]||(R[Z]={v:null});var H=d.fields[P[L]];if(S()(H)==="object"){switch(H.type){case"date":R[Z].t="d";break}H.format&&(R[Z].z=H.format)}}var de=u.P6.book_new();u.P6.book_append_sheet(de,R,"Sheet1");var I=u.cW(de,{bookType:"xlsx",type:"array"}),ae=new Blob([I],{type:"application/octet-stream"});h()(ae,((s=d.template)===null||s===void 0?void 0:s.filename)||"template.xlsx")},[d]);return[(0,re.createElement)("input",i()(i()({},t()),{},{key:"file-input",value:""})),$,k,{data:{},error:"",handleImportExcel:$}]}ne.Z=C},58301:function(we,ne,n){"use strict";n.d(ne,{Oh:function(){return re},bp:function(){return te}});var ce=n(97857),i=n.n(ce),pe=n(62435);function S(M,h){var u,_,D=M(i()({fetchPolicy:"network-only"},h)),C=D.data,c=D.loading,d=D.previousData,g=D.refetch,j=D.error,Y=(0,pe.useMemo)(function(){return c?d==null?void 0:d.result.pageInfo:C==null?void 0:C.result.pageInfo},[C==null||(u=C.result)===null||u===void 0?void 0:u.pageInfo.total,c,d==null||(_=d.result)===null||_===void 0?void 0:_.pageInfo.total]),t=(C==null?void 0:C.result.edges.map(function(B){return B.node}))||[];return[t,{loading:c,pageInfo:Y,error:j,variables:{},refetch:g}]}function fe(M,h){return h.split(".").reduce(function(u,_){return u&&u[_]!==void 0?u[_]:void 0},M)}function X(M,h,u){for(var _=h.split("."),D=M;_.length>1;){var C=_.shift();D[C]||(D[C]={}),D=D[C]}D[_[0]]=u}function re(M,h){var u=h.map(function(_){var D=_.source,C=_.target,c=_.transform,d=_.skip,g=fe(M,D);if(g==null||d&&d(g))return"";var j=c?c(g):String(g);return"".concat(encodeURIComponent(C||D),"=").concat(encodeURIComponent(j))});return u.filter(function(_){return _}).join("&")}function te(M,h){var u={};return h.forEach(function(_){var D=_.source,C=_.target,c=_.transform,d=_.skip,g=M.get(D);if(!(!g||g.trim()==="")){var j=c?c(g):g;d&&d(j)||(C?X(u,C,j):u[D]=j)}}),u}ne.ZP=S},53776:function(we,ne,n){"use strict";n.r(ne),n.d(ne,{default:function(){return pr}});var ce=n(97857),i=n.n(ce),pe=n(15009),S=n.n(pe),fe=n(64599),X=n.n(fe),re=n(99289),te=n.n(re),M=n(5574),h=n.n(M),u=n(62435),_=n(96974),D=n(39711),C=n(46027),c=n(30381),d=n.n(c),g=n(55811),j=n(58301),Y=n(73588),t=n(79817),B=n(12708),O=n(5618),$=n(14336),k=n(68400),o=n.n(k),s=n(75063),P=n(37887),A=n(73359),z=n(50319),R,x,E,L,Z,H,de,I,ae,K,q,y={},ve=(0,s.Ps)(R||(R=o()([`
    query customers($where: CustomerWhereInput, $page: Int, $pageSize: Int, $orderBy: OrderBy) {
  result: customersConnection(
    where: $where
    page: $page
    pageSize: $pageSize
    orderBy: $orderBy
  ) {
    pageInfo {
      total
      totalPages
      current
      pageSize
    }
    edges {
      node {
        id
        name
        ticketStrategy
        contactInfo {
          name
        }
      }
      cursor
    }
  }
}
    `])));function Pe(a){var r=i()(i()({},y),a);return P.a(ve,r)}function Ue(a){var r=i()(i()({},y),a);return A.t(ve,r)}function ue(a){var r=_objectSpread(_objectSpread({},y),a);return Apollo.useSuspenseQuery(ve,r)}var Ge=(0,s.Ps)(x||(x=o()([`
    mutation createCustomer($input: CustomerCreateInput!) {
  result: createCustomer(input: $input) {
    id
    name
  }
}
    `])));function Ne(a){var r=i()(i()({},y),a);return z.D(Ge,r)}var Je=(0,s.Ps)(E||(E=o()([`
    mutation updateCustomer($id: ID!, $input: CustomerUpdateInput!) {
  result: updateCustomer(id: $id, input: $input) {
    id
    name
  }
}
    `])));function We(a){var r=i()(i()({},y),a);return z.D(Je,r)}var Xe=(0,s.Ps)(L||(L=o()([`
    mutation deleteManyCustomers($where: CustomerWhereInput!) {
  result: deleteManyCustomers(where: $where) {
    count
  }
}
    `])));function qe(a){var r=i()(i()({},y),a);return z.D(Xe,r)}var Te=(0,s.Ps)(Z||(Z=o()([`
    query customerStores($where: CustomerStoreWhereInput, $page: Int, $pageSize: Int, $orderBy: OrderBy) {
  result: customerStoresConnection(
    where: $where
    page: $page
    pageSize: $pageSize
    orderBy: $orderBy
  ) {
    pageInfo {
      total
      totalPages
      current
      pageSize
    }
    edges {
      node {
        id
        name
      }
      cursor
    }
  }
}
    `])));function Er(a){var r=_objectSpread(_objectSpread({},y),a);return Apollo.useQuery(Te,r)}function Mr(a){var r=_objectSpread(_objectSpread({},y),a);return Apollo.useLazyQuery(Te,r)}function xr(a){var r=_objectSpread(_objectSpread({},y),a);return Apollo.useSuspenseQuery(Te,r)}var er=(0,s.Ps)(H||(H=o()([`
    mutation createCustomerStore($input: CustomerStoreCreateInput!) {
  result: createCustomerStore(input: $input) {
    id
    name
  }
}
    `])));function Pr(a){var r=_objectSpread(_objectSpread({},y),a);return Apollo.useMutation(er,r)}var rr=(0,s.Ps)(de||(de=o()([`
    mutation updateCustomerStore($id: ID!, $input: CustomerStoreUpdateInput!) {
  result: updateCustomerStore(id: $id, input: $input) {
    id
    name
  }
}
    `])));function Ir(a){var r=_objectSpread(_objectSpread({},y),a);return Apollo.useMutation(rr,r)}var tr=(0,s.Ps)(I||(I=o()([`
    mutation deleteManyCustomerStores($where: CustomerStoreWhereInput!) {
  result: deleteManyCustomerStores(where: $where) {
    count
  }
}
    `])));function wr(a){var r=_objectSpread(_objectSpread({},y),a);return Apollo.useMutation(tr,r)}var Fe=(0,s.Ps)(ae||(ae=o()([`
    query tickets($where: TicketWhereInput, $page: Int, $pageSize: Int, $orderBy: OrderBy) {
  result: ticketsConnection(
    where: $where
    page: $page
    pageSize: $pageSize
    orderBy: $orderBy
  ) {
    pageInfo {
      total
      totalPages
      current
      pageSize
    }
    edges {
      node {
        id
      }
      cursor
    }
  }
}
    `])));function Tr(a){var r=_objectSpread(_objectSpread({},y),a);return Apollo.useQuery(Fe,r)}function Fr(a){var r=_objectSpread(_objectSpread({},y),a);return Apollo.useLazyQuery(Fe,r)}function Br(a){var r=_objectSpread(_objectSpread({},y),a);return Apollo.useSuspenseQuery(Fe,r)}var nr=(0,s.Ps)(K||(K=o()([`
    mutation createTicket($input: TicketCreateInput!) {
  result: createTicket(input: $input) {
    id
  }
}
    `])));function Or(a){var r=_objectSpread(_objectSpread({},y),a);return Apollo.useMutation(nr,r)}var ar=(0,s.Ps)(q||(q=o()([`
    mutation updateTicket($id: ID!, $input: TicketUpdateInput!) {
  result: updateTicket(id: $id, input: $input) {
    id
  }
}
    `])));function $r(a){var r=_objectSpread(_objectSpread({},y),a);return Apollo.useMutation(ar,r)}var e=n(86074);function ur(a){var r=(0,$.Z)(qe,{onDeleted:function(){a&&a()},dialog:{title:"\u4F60\u786E\u5B9A\u8981\u5220\u9664\u5417\uFF1F",content:function(J,N){var W;if(N.batch){var b=J;W="\u786E\u5B9A\u5220\u9664\u9009\u4E2D\u7684, \u5171 ".concat(b.length," \u4E2A\u5BA2\u6237\u5417\uFF1F")}else W=(0,e.jsxs)(e.Fragment,{children:["\u60A8\u5373\u5C06\u5220\u9664\u201C",(0,e.jsx)("strong",{children:J.name})]});return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("p",{className:"tip-confirm",children:W}),(0,e.jsx)("p",{children:"\u5220\u9664\u7684\u64CD\u4F5C\u4E0D\u53EF\u9006,\u8BF7\u8C28\u614E\u64CD\u4F5C"})]})}}}),T=r.delete,U=r.deleteMany;return{delete:T,deleteMany:U}}var Be=ur;function sr(a,r){var T=t.Form.useForm(),U=(0,u.useState)(!1),G=h()(U,2),J=G[0],N=G[1],W=r||{},b=W.messages,se=W.onSubmitted,oe=se===void 0?function(){}:se,le=W.transform,ie=le===void 0?function(_e){return _e}:le,je=Ne({fetchPolicy:"no-cache",refetchQueries:r==null?void 0:r.refetchQueries}),Se=h()(je,1),ye=Se[0],be=We({fetchPolicy:"no-cache",refetchQueries:r==null?void 0:r.refetchQueries}),Oe=h()(be,1),De=Oe[0],$e=(0,u.useMemo)(function(){return a!=null&&a.id?te()(S()().mark(function _e(){var Q,he,Ce;return S()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return N(!0),m.prev=1,m.t0=ie,m.next=5,T.validateFields();case 5:return m.t1=m.sent,Q=(0,m.t0)(m.t1),m.next=9,t.Toast.promise((0,B.gw)(De({variables:{id:a.id,input:i()({},Q)}}),350),{pending:(b==null?void 0:b.pending)||"\u4FDD\u5B58\u4E2D...",success:{render:function(){return(0,e.jsxs)(e.Fragment,{children:["\u8DEF\u7531 ",(0,e.jsx)("strong",{children:Q.name})," \u4FDD\u5B58\u6210\u529F"]})}},error:(b==null?void 0:b.error)||"\u4FDD\u5B58\u51FA\u9519"},{duration:2e3,placement:"top-center"});case 9:he=m.sent,Ce=he.data,oe(Ce.updateCustomer),N(!1),m.next=18;break;case 15:m.prev=15,m.t2=m.catch(1),N(!1);case 18:case"end":return m.stop()}},_e,null,[[1,15]])})):te()(S()().mark(function _e(){var Q,he,Ce;return S()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return N(!0),m.prev=1,m.t0=ie,m.next=5,T.validateFields();case 5:return m.t1=m.sent,Q=(0,m.t0)(m.t1),m.next=9,t.Toast.promise((0,B.gw)(ye({variables:{input:i()({},Q)}}),350),{pending:(b==null?void 0:b.pending)||"\u63D0\u4EA4\u4E2D...",success:{render:(b==null?void 0:b.pending)||"\u63D0\u4EA4\u6210\u529F"},error:(b==null?void 0:b.error)||"\u63D0\u4EA4\u51FA\u9519"},{duration:2e3,placement:"top-center"});case 9:he=m.sent,Ce=he.data,oe(Ce.createCustomer),N(!1),m.next=18;break;case 15:m.prev=15,m.t2=m.catch(1),N(!1);case 18:case"end":return m.stop()}},_e,null,[[1,15]])}))},[ye,a==null?void 0:a.id,T,oe,De]);return[$e,{form:T,submitting:J}]}var or=sr;function lr(a){var r=a.form;return(0,u.useEffect)(function(){var T=a.data;T.id||r.resetFields(),r.setFieldsValue(i()({},T))},[r,a.data]),(0,e.jsxs)(t.Form,{form:r,children:[(0,e.jsx)(t.Row,{children:(0,e.jsx)(t.Col,{span:6,children:(0,e.jsx)(t.Form.Item,{name:"title",className:"d-flex flex-column mb-7",required:!0,label:"CMMF CODE",rules:[{required:!0,message:"CMMF CODE\u4E0D\u80FD\u4E3A\u7A7A"}],children:(0,e.jsx)(t.Input,{solid:!0})})})}),(0,e.jsx)(t.Row,{children:(0,e.jsx)(t.Col,{span:6,children:(0,e.jsx)(t.Form.Item,{name:"tags",className:"d-flex flex-column mb-7",required:!0,label:"WMF CODE",children:(0,e.jsx)(O.ZP,{className:"form-control form-control-solid"})})})}),(0,e.jsx)(t.Row,{children:(0,e.jsx)(t.Col,{span:6,children:(0,e.jsx)(t.Form.Item,{name:"content",className:"d-flex flex-column mb-7",required:!0,label:"\u6587\u4EF6\u8DEF\u5F84",rules:[{required:!0,message:"\u6587\u4EF6\u8DEF\u5F84\u4E0D\u80FD\u4E3A\u7A7A"}],children:(0,e.jsx)(t.Input.TextArea,{solid:!0,autoSize:{minRows:2,maxRows:2}})})})}),(0,e.jsx)(t.Row,{children:(0,e.jsx)(t.Col,{span:6,children:(0,e.jsx)(t.Form.Item,{name:"scheduledAt",className:"d-flex flex-column mb-7",label:"\u53D1\u5E03\u65F6\u95F4",rules:[{required:!0,message:"\u53D1\u5E03\u65F6\u95F4\u4E0D\u80FD\u4E3A\u7A7A"}],children:(0,e.jsx)(t.DatePicker,{solid:!0,className:"w-100"})})})}),(0,e.jsx)(t.Row,{children:(0,e.jsx)(t.Col,{span:6,children:(0,e.jsx)(t.Form.Item,{name:"expirationAt",className:"d-flex flex-column mb-7",label:"\u8FC7\u671F\u65F6\u95F4",rules:[{required:!0,message:"\u8FC7\u671F\u65F6\u95F4\u4E0D\u80FD\u4E3A\u7A7A"}],children:(0,e.jsx)(t.DatePicker,{solid:!0,className:"w-100"})})})}),(0,e.jsx)(t.Row,{children:(0,e.jsx)(t.Col,{span:6,children:(0,e.jsx)(t.Form.Item,{className:"d-flex flex-column mb-7",name:"summary",label:"\u5907\u6CE8",children:(0,e.jsx)(t.Input.TextArea,{solid:!0,autoSize:{minRows:4,maxRows:6}})})})})]})}function ir(a){var r=a.data,T=a.visible,U=a.onClose,G=a.onSuccess,J=a.onDeleteSuccess,N=or(r,{transform:function(be){return i()({},be)},onSubmitted:G}),W=h()(N,2),b=W[0],se=W[1],oe=se.form,le=se.submitting,ie=(0,u.useMemo)(function(){return r?i()({},r):{}},[r]),je=Be(J),Se=je.delete;return(0,e.jsx)(t.Drawer,{title:r!=null&&r.id?"\u7F16\u8F91":"\u65B0\u589E",placement:"right",width:640,mask:!0,closable:!0,onClose:U,visible:T,footer:(0,e.jsxs)(t.Row,{children:[(0,e.jsx)(t.Col,{span:6,children:(0,e.jsx)(t.Button,{style:{letterSpacing:"1rem"},className:"w-100",loading:le,onClick:b,children:"\u4FDD\u5B58"})}),(0,e.jsx)(t.Col,{span:6,children:(r==null?void 0:r.id)&&(0,e.jsx)(t.Button,{style:{letterSpacing:"1rem"},className:"w-100",variant:"light-danger",onClick:function(){return Se(r)},children:"\u5220\u9664"})})]}),children:r&&(0,e.jsx)(lr,{submitting:le,data:ie,form:oe,submit:b,onDeleteSuccess:J})})}var dr=ir;function mr(a){var r=a.data,T=a.onEdit,U=a.refetch,G=(0,u.useState)(!1),J=h()(G,2),N=J[0],W=J[1],b=Be(U),se=b.delete,oe=(0,u.useCallback)(function(le){var ie=le.key;ie==="edit"?T(r):ie==="delete"&&se({name:r.name,id:r.id})},[]);return(0,e.jsx)(t.Dropdown,{overlay:(0,e.jsxs)(t.Menu,{onClick:oe,className:"menu-sub menu-sub-dropdown menu-gray-600 menu-state-bg-light-primary fw-bold w-125px py-2",children:[(0,e.jsx)(t.Menu.Item,{className:"px-3",children:"\u7F16\u8F91"},"edit"),(0,e.jsx)(t.Menu.Item,{className:"actions-delete px-3",children:"\u5220\u9664"},"delete")]}),placement:"bottomRight",onVisibleChange:W,visible:N,children:(0,e.jsxs)(t.Button,{variant:"clean",activeColor:"light-primary",children:["\u64CD \u4F5C",(0,e.jsx)(C.ZP,{className:"ms-2 svg-icon-5 m-0",name:"Duotune/arr072"})]})})}function cr(){var a=(0,_.s0)(),r=(0,D.lr)(),T=h()(r,1),U=T[0],G=(0,u.useMemo)(function(){return(0,j.bp)(U,[{source:"q",target:"keywords"}])},[U.get("q")]);(0,u.useState)({keywords:U.get("q")||""});var J=(0,u.useMemo)(function(){return(0,j.bp)(U,[{source:"q",target:"where.name_contains"},{source:"sex",target:"where.sex"},{source:"page",transform:function(l){return parseInt(l)}},{source:"per_page",transform:function(l){return parseInt(l)}},{source:"sort",target:"orderBy",transform:function(l){var w=l.split(":"),p=h()(w,2),ee=p[0],F=p[1];return"".concat(ee,"_").concat(F)}}])},[U.toString()]),N=Ue({fetchPolicy:"network-only"}),W=h()(N,1),b=W[0],se=Ne(),oe=h()(se,1),le=oe[0],ie=We(),je=h()(ie,1),Se=je[0],ye=(0,j.ZP)(Pe,{variables:J}),be=h()(ye,2),Oe=be[0],De=be[1],$e=De.loading,_e=De.pageInfo,Q=De.refetch,he=(0,u.useCallback)(function(f,l,w){var p=(0,j.Oh)({searchForm:G,pagination:f,filters:l,sorter:w},[{source:"searchForm.keywords",target:"q",skip:function(F){return!F}},{source:"pagination.current",target:"page",skip:function(F){return F===1}},{source:"pagination.pageSize",target:"per_page",skip:function(F){return F===15}},{source:"sorter.field",target:"sort",transform:function(F){return"".concat(F,":").concat(w.order==="ascend"?"asc":"desc")}}]);a(location.pathname+"?"+p,{replace:!0})},[G]),Ce=Be(Q),Ie=Ce.deleteMany,m=(0,u.useCallback)(function(f){a(location.pathname+(f?"?q="+f:""),{replace:!0})},[]),ze=(0,u.useCallback)(function(){var f=te()(S()().mark(function l(w){var p,ee,F,Ee,Ve,V,Ae,Re,Ye,me,Le,Ze,Me,He,xe;return S()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:p={totalRecords:0,insertCount:0,updateCount:0,failureCount:0,failedRecords:[],startTime:null,endTime:null},p.totalRecords=w.length,ee=t.Toast.loading("\u5F00\u59CB\u5BFC\u5165\u5BA2\u6237",{placement:"top-center"}),p.startTime=new Date,F=0,Ee=X()(w),v.prev=6,Ee.s();case 8:if((Ve=Ee.n()).done){v.next=49;break}return V=Ve.value,F++,v.prev=11,v.next=14,b({variables:{where:{title:V.title}}});case 14:if(Ye=v.sent,me=Ye.data,Le={title:V.title,summary:V.summary,tags:V.tag?[V.tag]:[],scheduledAt:V.scheduledAt,expirationAt:V.expirationAt,category:"conformity",content:{type:"PDF",url:"storage://ZovzE2fU/"+V.file}},(me==null||(Ae=me.result)===null||Ae===void 0?void 0:Ae.pageInfo.total)!==1){v.next=28;break}return ee.update("\u66F4\u65B0 ".concat(V.title," - ").concat(F,"/").concat(p.totalRecords),{icon:"loading"}),v.next=21,Se({variables:{id:me.result.edges[0].node.id,input:Le}});case 21:if(Ze=v.sent,Me=Ze.errors,!(Me!=null&&Me.length)){v.next=25;break}throw new Error(Me[0].message);case 25:p.updateCount++,v.next=40;break;case 28:if((me==null||(Re=me.result)===null||Re===void 0?void 0:Re.pageInfo.total)!==0){v.next=39;break}return ee.update("\u65B0\u589E ".concat(V.title," - ").concat(F,"/").concat(p.totalRecords),{icon:"loading"}),v.next=32,le({variables:{input:Le}});case 32:if(He=v.sent,xe=He.errors,!(xe!=null&&xe.length)){v.next=36;break}throw new Error(xe[0].message);case 36:p.insertCount++,v.next=40;break;case 39:p.failureCount++;case 40:v.next=47;break;case 42:v.prev=42,v.t0=v.catch(11),ee.update("\u5931\u8D25 ".concat(V.title," - ").concat(F,"/").concat(p.totalRecords),{icon:"error"}),p.failureCount++,p.failedRecords.push({record:V,error:v.t0});case 47:v.next=8;break;case 49:v.next=54;break;case 51:v.prev=51,v.t1=v.catch(6),Ee.e(v.t1);case 54:return v.prev=54,Ee.f(),v.finish(54);case 57:p.endTime=new Date,console.log("Import Summary:",p),ee.close(),Q(),t.Modal.success({title:"\u64CD\u4F5C\u6210\u529F",width:600,content:(0,e.jsxs)("div",{children:[(0,e.jsxs)("p",{children:["\u5BFC\u5165\u5B8C\u6210, \u5171 ",p.totalRecords," \u6761\u8BB0\u5F55, \u6210\u529F"," ",p.insertCount," \u6761, \u66F4\u65B0 ",p.updateCount," \u6761, \u5931\u8D25 ",p.failureCount," \u6761"]}),(0,e.jsxs)("p",{children:["\u8017\u65F6:"," ",d()(p.endTime).diff(p.startTime,"seconds")," ","\u79D2"]}),(0,e.jsxs)("p",{children:["\u603B\u8BB0\u5F55\u6570: ",p.totalRecords]}),(0,e.jsxs)("p",{children:["\u63D2\u5165\u6570\u91CF: ",p.insertCount]}),(0,e.jsxs)("p",{children:["\u66F4\u65B0\u6570\u91CF: ",p.updateCount]}),(0,e.jsxs)("p",{children:["\u5931\u8D25\u6570\u91CF: ",p.failureCount]})]}),allowOutsideClick:!1});case 62:case"end":return v.stop()}},l,null,[[6,51,54,57],[11,42]])}));return function(l){return f.apply(this,arguments)}}(),[Q]),fr=(0,g.Z)(ze,{header:1,fields:{title:{index:0,name:"CMMF CODE",example:"W22L1",formatter:function(l){return String(l).trim()}},tag:{index:1,name:"WMF CODE",example:"YS22ED",formatter:function(l){return String(l).trim()}},scheduledAt:{index:2,name:"\u53D1\u5E03\u65F6\u95F4",example:"2024/8/22 0:00",formatter:function(l){return String(l).trim()&&d()(l).format("YYYY-MM-DD HH:mm")}},expirationAt:{index:3,name:"\u7ED3\u675F\u65F6\u95F4",example:"2024/8/31 0:00",formatter:function(l){return String(l).trim()&&d()(l).format("YYYY-MM-DD HH:mm")}},file:{index:4,name:"\u5BA2\u6237\u4F4D\u7F6E",example:"3201000159 1873596030 \u7092\u9505\u94F2.pdf.pdf",formatter:function(l){return String(l).trim()}},summary:{index:5,name:"\u5907\u6CE8",example:"",formatter:function(l){return String(l).trim()}}},template:{filename:"\u7B26\u5408\u6027\u89C4\u8303\u6279\u91CF\u4E0A\u4F20.xlsx",cols:[{wch:20},{wch:20},{wch:20},{wch:20},{wch:50},{wch:30}]}}),ke=h()(fr,3),vr=ke[0],_r=ke[1],hr=ke[2],Cr=(0,u.useCallback)(function(f){return te()(S()().mark(function l(){return S()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,Ie(f);case 2:case"end":return p.stop()}},l)}))},[Ie]),gr=(0,u.useState)({visible:!1}),Ke=h()(gr,2),Qe=Ke[0],ge=Ke[1],yr=(0,u.useCallback)(function(){ge(function(f){return i()(i()({},f),{},{visible:!1})})},[]),br=(0,u.useCallback)(function(f){ge(function(l){return i()(i()({},l),{},{route:f})}),Q()},[ge]),Dr=(0,u.useCallback)(function(f){ge(function(l){var w;return((w=l.data)===null||w===void 0?void 0:w.id)!==f.id?l:i()(i()({},l),{},{visible:!1,menu:void 0})}),Q()},[ge]),jr=(0,u.useCallback)(function(){ge(function(f){return i()(i()({},f),{},{visible:!0,data:{}})})},[]),Sr=(0,u.useCallback)(function(f){ge(function(l){return i()(i()({},l),{},{visible:!0,data:f})})},[]);return(0,e.jsxs)(Y.vs,{header:{title:"\u5BA2\u6237\u7BA1\u7406"},children:[(0,e.jsx)(dr,{data:Qe.data,onClose:yr,onSuccess:br,onDeleteSuccess:Dr,visible:Qe.visible}),(0,e.jsxs)(t.Card,{className:"mb-5 mb-xl-10",children:[(0,e.jsxs)(t.Card.Header,{className:"pt-8",children:[(0,e.jsx)(t.Card.Title,{className:"flex-column",children:(0,e.jsx)(t.Input.Search,{solid:!0,defaultValue:G.keywords,className:"w-250px",placeholder:"\u5173\u952E\u8BCD\u641C\u7D22",onSearch:m})}),(0,e.jsx)(t.Card.Toolbar,{children:(0,e.jsxs)("div",{children:[(0,e.jsx)(t.Button,{onClick:jr,className:"me-4 my-1",children:"\u65B0\u5EFA"}),vr,(0,e.jsx)(t.Button,{className:"me-4 my-1",onClick:_r,children:"\u6A21\u677F\u6570\u636E\u5BFC\u5165"}),(0,e.jsx)(t.Button,{variant:"light",className:"me-4 my-1",onClick:hr,children:"\u7B26\u5408\u6027\u58F0\u660E\u6A21\u677F\u4E0B\u8F7D"})]})})]}),(0,e.jsx)(t.Card.Body,{children:(0,e.jsx)(t.BlockUI,{overlayClassName:"bg-white bg-opacity-25",loading:$e,children:(0,e.jsx)(t.Table,{hover:!0,rowKey:"id",rowSelection:{type:"checkbox",renderTitle:function(l){return(0,e.jsxs)(e.Fragment,{children:["\u5DF2\u9009\u4E2D",(0,e.jsx)("span",{className:"mx-2",children:l}),"\u4E2A"]})},toolbar:function(l){return(0,e.jsx)("div",{children:(0,e.jsx)(t.Button,{color:"danger",onClick:Cr(l),variant:!1,children:"\u6279\u91CF\u5220\u9664"})})}},noRowsRenderer:function(){return(0,e.jsx)(t.Empty,{description:"\u5217\u8868\u6570\u636E\u4E3A\u7A7A",image:"/assets/media/illustrations/sigma-1/5.png"})},columns:[{key:"name",title:"\u540D\u79F0",width:130,sorter:!0,sortOrder:(0,B.PE)(U,"name")},{key:"contact.name",title:"\u8054\u7CFB\u4EBA"},{key:"ticketStrategy",title:"\u5DE5\u5355\u7B56\u7565",width:130,render:function(l){var w={NONE:"\u4E0D\u5904\u7406",AUTO:"\u81EA\u52A8\u5206\u914D",ASSIGN:"\u5BA2\u6237\u5206\u914D"};return w[l]}},{key:"ticketCount",title:"\u662F\u5426\u542F\u7528\u7BA1\u7406\u529F\u80FD",width:130},{title:"\u64CD\u4F5C",key:"action",width:120,render:function(l,w){return(0,e.jsx)(mr,{data:w,refetch:Q,onEdit:Sr})}}],pagination:_e,onChange:he,dataSource:Oe})})})]})]})}var pr=cr},20067:function(){}}]);

"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[6633],{85947:function(oe,G,r){r.d(G,{u7:function(){return s.u7},pM:function(){return s.pM},dP:function(){return s.dP},zR:function(){return s.zR},bo:function(){return s.bo},CF:function(){return s.CF},hT:function(){return s.hT},X4:function(){return s.X4},rq:function(){return s.rq},qb:function(){return s.qb},a$:function(){return s.a$},mp:function(){return s.mp},WE:function(){return s.WE},HC:function(){return s.HC},cT:function(){return k},Hr:function(){return re},r3:function(){return s.r3},bI:function(){return s.bI},A6:function(){return s.A6},LV:function(){return s.LV}});var s=r(10557),O=r(15009),E=r.n(O),V=r(99289),g=r.n(V),a=r(5574),C=r.n(a),y=r(62435),m=r(79817),p=r(86074);function X(l,P){var S,w=(0,s.rz)({variables:{id:l==null?void 0:l.id},refetchQueries:[{query:s.dP,variables:{id:l==null||(S=l.application)===null||S===void 0?void 0:S.id}}]}),$=C()(w,1),T=$[0],Y=(0,y.useCallback)(g()(E()().mark(function H(){var b;return E()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.Modal.confirm({title:"\u4F60\u786E\u5B9A\u8981\u5220\u9664\u8BE5\u8DEF\u7531\u5417\uFF1F",content:(0,p.jsxs)(p.Fragment,{children:["\u60A8\u5373\u5C06\u5220\u9664\u201C",(0,p.jsx)("strong",{children:l.name}),"\u201D\u3002\u5220\u9664\u64CD\u4F5C\u4E0D\u53EF\u9006\u8F6C\uFF0C\u8BF7\u8C28\u614E\u64CD\u4F5C\uFF0C\u60A8\u786E\u5B9A\u5220\u9664\u5417\uFF1F"]}),okText:"\u5220 \u9664",okClassName:"btn-danger"});case 2:if(b=e.sent,!b.isConfirmed){e.next=8;break}return e.next=6,T();case 6:m.Toast.success("\u5220\u9664\u6210\u529F"),P(l);case 8:case"end":return e.stop()}},H)})),[T,l,P]);return[Y]}var k=X,ne=r(97857),Z=r.n(ne),n=r(12708);function J(l,P){var S,w,$,T=m.Form.useForm(),Y=(0,y.useState)(!1),H=C()(Y,2),b=H[0],B=H[1],e=(0,s.X4)({fetchPolicy:"no-cache",refetchQueries:[{query:s.dP,variables:{id:l==null||(S=l.application)===null||S===void 0?void 0:S.id}}]}),te=C()(e,1),_=te[0],ae=(0,s.LV)({fetchPolicy:"no-cache",refetchQueries:[{query:s.dP,variables:{id:l==null||(w=l.application)===null||w===void 0?void 0:w.id}}]}),ue=C()(ae,1),ee=ue[0],le=(0,y.useMemo)(function(){return l!=null&&l.id?g()(E()().mark(function q(){var i,u,h;return E()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return B(!0),t.prev=1,t.next=4,T.validateFields();case 4:return i=t.sent,t.next=7,m.Toast.promise((0,n.gw)(ee({variables:{id:l.id,input:Z()({},i)}}),350),{pending:"\u63D0\u4EA4\u4E2D...",success:{render:function(){return(0,p.jsxs)(p.Fragment,{children:["\u8DEF\u7531 ",(0,p.jsx)("strong",{children:i.name})," \u4FDD\u5B58\u6210\u529F"]})}},error:"\u63D0\u4EA4\u51FA\u9519"},{duration:2e3,placement:"top-center"});case 7:u=t.sent,h=u.data,P(h.updateRoute),B(!1),t.next=16;break;case 13:t.prev=13,t.t0=t.catch(1),B(!1);case 16:case"end":return t.stop()}},q,null,[[1,13]])})):g()(E()().mark(function q(){var i,u,h;return E()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return B(!0),t.prev=1,t.next=4,T.validateFields();case 4:return i=t.sent,t.next=7,m.Toast.promise((0,n.gw)(_({variables:{input:Z()(Z()({},i),{},{application:l.application.id})}}),350),{pending:"\u63D0\u4EA4\u4E2D...",success:{render:function(){return(0,p.jsxs)(p.Fragment,{children:["\u8DEF\u7531 ",(0,p.jsx)("strong",{children:i.name})," \u65B0\u589E\u6210\u529F"]})}},error:"\u63D0\u4EA4\u51FA\u9519"},{duration:2e3,placement:"top-center"});case 7:u=t.sent,h=u.data,P(h.createRoute),B(!1),t.next=16;break;case 13:t.prev=13,t.t0=t.catch(1),B(!1);case 16:case"end":return t.stop()}},q,null,[[1,13]])}))},[_,l==null||($=l.application)===null||$===void 0?void 0:$.id,l==null?void 0:l.id,T,P,ee]);return[le,{form:T,submitting:b}]}var re=J},66633:function(oe,G,r){r.r(G),r.d(G,{default:function(){return q}});var s=r(15009),O=r.n(s),E=r(99289),V=r.n(E),g=r(97857),a=r.n(g),C=r(5574),y=r.n(C),m=r(62435),p=r(96974),X=r(46027),k=r(93967),ne=r.n(k),Z=r(73588),n=r(79817),J=r(12708),re=r(19632),l=r.n(re),P=r(13769),S=r.n(P),w=r(64599),$=r.n(w),T=r(49677),Y=r.n(T),H=r(50603),b=r(85947),B=r(17754),e=r(86074),te=["children","_rect","pos","parent"];function _(i){var u,h=i.form,F=i.appId,t=i.libraryId,R=(0,b.mp)({variables:{id:F}}),I=R.data,N=(0,b.qb)({variables:{id:t},fetchPolicy:"cache-and-network"}),A=N.data,U=(I==null||(u=I.app)===null||u===void 0?void 0:u.routes)||[],z=(0,m.useMemo)(function(){return(0,J.$H)((0,J.G_)((U||[]).map(function(v){return a()({},v)}),{pidKey:"parent.id",sort:function(f,D){return f.index-D.index},converter:function(f,D){return Y()(D),a()(a()({},f),{},{key:f.id,routeType:f.type,title:f.path})}}))},[U]),M=A==null?void 0:A.library,K=(0,m.useMemo)(function(){var v=[],f=$()((M==null?void 0:M.components)||[]),D;try{for(f.s();!(D=f.n()).done;){var L=D.value,x=$()(L.tags),j;try{for(x.s();!(j=x.n()).done;){var se=j.value;(0,B.v)(se,v,L)}}catch(Q){x.e(Q)}finally{x.f()}}}catch(Q){f.e(Q)}finally{f.f()}return v},[M]);return(0,m.useEffect)(function(){var v=i.data,f=v.children,D=v._rect,L=v.pos,x=v.parent,j=S()(v,te);i.data.id||h.resetFields(),h.setFieldsValue(a()(a()({},j),{},{parentRoute:x?x.id:void 0}))},[h,i.data]),console.log("componentTreeData",K),(0,e.jsxs)(n.Form,{form:h,children:[(0,e.jsx)(n.Row,{children:(0,e.jsx)(n.Col,{span:6,children:(0,e.jsx)(n.Form.Item,{name:"name",className:"d-flex flex-column mb-7",required:!0,label:"\u540D\u79F0",rules:[{required:!0,message:"\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A"}],children:(0,e.jsx)(n.Input,{solid:!0})})})}),(0,e.jsx)(n.Row,{children:(0,e.jsx)(n.Col,{span:6,children:(0,e.jsx)(n.Form.Item,{name:"parentRoute",className:"d-flex flex-column mb-7",label:"\u4E0A\u7EA7\u8DEF\u7531",children:(0,e.jsx)(n.Select2,{solid:!0,options:[{value:"",label:"\u6839\u8282\u70B9"}].concat(l()(z.map(function(v){return{value:v.id,label:v.title}})))})})})}),(0,e.jsx)(n.Row,{children:(0,e.jsx)(n.Form.Item,{name:"type",className:"d-flex flex-column mb-7",label:"\u7C7B\u578B",children:(0,e.jsx)(n.Radio.Group,{solid:!0,options:[{value:"MENU",label:"\u83DC\u5355"},{value:"HEADER",label:"\u6807\u9898"},{value:"DIVIDER",label:"\u5206\u9694\u7B26"},{value:"ROUTE",label:"\u8DEF\u7531"}]})})}),(0,e.jsxs)(n.Row,{children:[(0,e.jsx)(n.Col,{span:6,children:(0,e.jsx)(n.Form.Item,{name:"icon",className:"d-flex flex-column mb-7",label:"\u56FE\u6807",children:(0,e.jsx)(n.Input,{})})}),(0,e.jsx)(n.Col,{span:6,children:(0,e.jsx)(n.Form.Item,{className:"d-flex flex-column mb-7",name:"index",label:"\u6392\u5E8F\u4F4D\u7F6E",children:(0,e.jsx)(n.Input,{solid:!0})})})]}),(0,e.jsxs)(n.Row,{children:[(0,e.jsx)(n.Col,{span:4,children:(0,e.jsx)(n.Form.Item,{valuePropName:"checked",className:"d-flex flex-column mb-7",name:"authorized",children:(0,e.jsx)(n.Switch,{solid:!0,label:"\u6388\u6743\u540E\u8BBF\u95EE"})})}),(0,e.jsx)(n.Col,{span:4,children:(0,e.jsx)(n.Form.Item,{valuePropName:"checked",className:"d-flex flex-column mb-7",name:"enabled",children:(0,e.jsx)(n.Switch,{solid:!0,label:"\u542F\u7528"})})}),(0,e.jsx)(n.Col,{span:4,children:(0,e.jsx)(n.Form.Item,{valuePropName:"checked",className:"d-flex flex-column mb-7",name:"hideInBreadcrumb",children:(0,e.jsx)(n.Switch,{solid:!0,label:"\u4E0D\u5728\u9762\u5305\u5C51\u4E2D\u663E\u793A"})})})]}),(0,e.jsxs)(n.Row,{children:[(0,e.jsx)(n.Col,{span:4,children:(0,e.jsx)(n.Form.Item,{valuePropName:"checked",className:"d-flex flex-column mb-7",name:["layout","pure"],children:(0,e.jsx)(n.Switch,{solid:!0,label:"\u4E0D\u4F7F\u7528\u9ED8\u8BA4\u5E03\u5C40"})})}),(0,e.jsx)(n.Col,{span:4,children:(0,e.jsx)(n.Form.Item,{valuePropName:"checked",className:"d-flex flex-column mb-7",name:["layout","hideMenu"],children:(0,e.jsx)(n.Switch,{solid:!0,label:"\u9690\u85CF\u83DC\u5355\u680F"})})})]}),(0,e.jsx)(n.Form.Item,{dependencies:["hideInBreadcrumb"],noStyle:!0,children:function(){return h.getFieldValue("hideInBreadcrumb")?(0,e.jsx)(e.Fragment,{}):(0,e.jsx)(n.Row,{children:(0,e.jsx)(n.Form.Item,{className:"d-flex flex-column mb-7",name:"breadcrumb",label:"\u81EA\u5B9A\u4E49\u9762\u5305\u5C51\u7EC4\u4EF6",children:(0,e.jsx)(H.zm,{treeDate:K,placeholder:"\u9009\u62E9\u9762\u5305\u5C51\u7EC4\u4EF6"})})})}}),(0,e.jsx)(n.Row,{children:(0,e.jsx)(n.Form.Item,{className:"d-flex flex-column mb-7",name:"access",label:"\u8BBF\u95EE\u6743\u9650",children:(0,e.jsx)(n.Input,{solid:!0})})}),(0,e.jsx)(n.Row,{children:(0,e.jsx)(n.Form.Item,{rules:[{required:!0,message:"\u8BBF\u95EE\u8DEF\u5F84\u4E0D\u80FD\u4E3A\u7A7A"}],className:"d-flex flex-column mb-7",name:"path",label:"\u8DEF\u5F84",children:(0,e.jsx)(n.Input,{solid:!0})})}),(0,e.jsx)(n.Row,{children:(0,e.jsx)(n.Form.Item,{className:"d-flex flex-column mb-7",name:"redirect",label:"\u91CD\u5B9A\u5411",children:(0,e.jsx)(n.Input,{solid:!0})})}),(0,e.jsx)(n.Row,{children:(0,e.jsx)(n.Form.Item,{className:"d-flex flex-column mb-7",name:"component",label:"\u7EC4\u4EF6",children:(0,e.jsx)(H.zm,{treeDate:K,placeholder:"\u9009\u62E9\u7EC4\u4EF6\u6A21\u7248"})})})]})}function ae(i){var u=i.route,h=i.visible,F=i.onClose,t=i.onSuccess,R=i.onDeleteSuccess,I=i.libraryId,N=(0,b.Hr)(u,t),A=y()(N,2),U=A[0],z=A[1],M=z.form,K=z.submitting,v=(0,m.useMemo)(function(){var x,j;return u?a()(a()({},u),{},{breadcrumb:(x=u.breadcrumb)===null||x===void 0?void 0:x.id,component:(j=u.component)===null||j===void 0?void 0:j.id}):{type:"URL",index:0}},[u]),f=(0,b.cT)(u,R),D=y()(f,1),L=D[0];return(0,e.jsx)(n.Drawer,{title:u!=null&&u.id?"\u7F16\u8F91\u8DEF\u7531":"\u65B0\u589E\u8DEF\u7531",placement:"right",width:640,mask:!1,onClose:F,visible:h,footer:(0,e.jsxs)(n.Row,{children:[(0,e.jsx)(n.Col,{span:6,children:(0,e.jsx)(n.Button,{style:{letterSpacing:"1rem"},className:"w-100",loading:K,onClick:U,children:"\u4FDD\u5B58"})}),(0,e.jsx)(n.Col,{span:6,children:(u==null?void 0:u.id)&&(0,e.jsx)(n.Button,{style:{letterSpacing:"1rem"},className:"w-100",variant:"light-danger",onClick:L,children:"\u5220\u9664"})})]}),children:u&&(0,e.jsx)(_,{submitting:K,data:v,appId:u.application.id,form:M,libraryId:I,submit:U,onDeleteSuccess:R})})}var ue=ae;function ee(i){var u=i.data,h=i.onDeleteSuccess,F=(0,b.cT)(u,h),t=y()(F,1),R=t[0],I=(0,m.useCallback)(function(N){N.preventDefault(),N.stopPropagation()},[]);return(0,e.jsx)("div",{className:"d-flex flex-row-fluid justify-content-center",onClick:I,children:(0,e.jsx)("div",{className:"ms-2",children:(0,e.jsx)(n.Button,{variant:"light-danger",onClick:R,icon:(0,e.jsx)(X.ZP,{className:"svg-icon-2",name:"Duotune/arr088"})})})})}function le(){var i,u,h=(0,p.UO)(),F=h.id,t=(0,p.bx)(),R=t.app,I=(0,b.mp)({variables:{id:F},fetchPolicy:"cache-and-network"}),N=I.data,A=I.loading,U=R.dependencies.find(function(o){return o.name==="component.library"}).value,z=N==null||(i=N.app)===null||i===void 0?void 0:i.routes,M=(0,b.WE)({fetchPolicy:"no-cache",refetchQueries:[{query:b.dP,variables:{id:F}}]}),K=y()(M,1),v=K[0],f=(0,m.useMemo)(function(){return(0,J.G_)((z||[]).map(function(o){return a()({},o)}),{pidKey:"parent.id",sort:function(c,d){return c.index-d.index},converter:function(c){return a()(a()({},c),{},{key:c.id,title:c.name,routeType:c.type,type:"directory"})}})},[z]),D=(0,m.useState)({visible:!1}),L=y()(D,2),x=L[0],j=L[1],se=(0,m.useState)([]),Q=y()(se,2),me=Q[0],de=Q[1];(0,m.useEffect)(function(){f.length&&de(function(o){return o.length?o:f.map(function(c){return c.id})})},[f]);var ve=(0,m.useCallback)(function(){j(function(o){return a()(a()({},o),{},{visible:!1})})},[]),fe=(0,m.useCallback)(function(o){j(function(c){return a()(a()({},c),{},{route:o})})},[j]),ce=(0,m.useCallback)(function(o){j(function(c){var d;return((d=c.route)===null||d===void 0?void 0:d.id)!==o.id?c:a()(a()({},c),{},{visible:!1,menu:void 0})})},[j]),he=(0,m.useCallback)(function(){j(function(o){return a()(a()({},o),{},{visible:!0,route:{index:0,icon:"Duotune/abs005",type:"ROUTE",application:{id:F}}})})},[F]),pe=(0,m.useCallback)(function(o){j(function(c){var d;return((d=c.route)===null||d===void 0?void 0:d.id)===o.node.id&&c.visible?a()(a()({},c),{},{visible:!1}):a()(a()({},c),{},{visible:!0,route:a()(a()({},o.node),{},{type:o.node.routeType,parentRoute:o.node.parentKey})})})},[]),xe=(0,m.useCallback)(function(){var o=V()(O()().mark(function c(d){var ie;return O()().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:if(console.log("handleDrop",d),!(((ie=d.dragNode.parent)===null||ie===void 0?void 0:ie.id)===d.toParentKey&&d.dragNode.index===d.toIndex)){W.next=3;break}return W.abrupt("return");case 3:return W.next=5,n.Toast.promise(v({variables:{id:d.dragNode.id,parentRoute:d.toParentKey,location:d.toIndex}}),{pending:"\u66F4\u65B0\u6392\u5E8F...",success:"\u6392\u5E8F\u8C03\u6574\u6210\u529F",error:"\u63D0\u4EA4\u51FA\u9519"},{duration:2e3,placement:"top-center"});case 5:case"end":return W.stop()}},c)}));return function(c){return o.apply(this,arguments)}}(),[v]);return console.log("keys",f.map(function(o){return o.id})),(0,e.jsxs)(Z.vs,{header:{title:"\u8DEF\u7531\u8BBE\u7F6E"},loading:A,children:[(0,e.jsxs)(n.Card,{flush:!0,className:"mt-6 mt-xl-9",headerClassName:"mt-5",children:[(0,e.jsxs)(n.Card.Header,{className:"pt-8",children:[(0,e.jsx)(n.Card.Title,{}),(0,e.jsx)(n.Card.Toolbar,{children:(0,e.jsx)("div",{className:"d-flex justify-content-end",children:(0,e.jsx)(n.Button,{onClick:he,variant:"primary",children:"\u65B0\u5EFA\u8DEF\u7531"})})})]}),(0,e.jsx)(n.Card.Body,{className:"pt-0",children:(0,e.jsx)(n.TreeList,{className:"app-treelist",rowKey:"id",draggable:!0,expandedKeys:me,onExpand:de,selectedKeys:(u=x.route)!==null&&u!==void 0&&u.id?[x.route.id]:[],onSelect:pe,onDrop:xe,columns:[{key:"title",title:"\u540D\u79F0",width:"auto",render:function(c,d){return(0,e.jsxs)("div",{className:"d-flex flex-column py-5",children:[(0,e.jsx)("span",{className:ne()("title  text-hover-primary mb-1 fs-6",{"text-gray-800":!!d.title,"text-gray-600":!d.title}),children:d.title||"(\u672A\u8BBE\u7F6E\u540D\u79F0)"}),(0,e.jsxs)("div",{className:"d-flex flex-row col-stacked",children:[(0,e.jsx)(n.Badge,{color:"secondary",className:"me-2",children:d.path}),d.authorized&&(0,e.jsx)(n.Badge,{color:"primary",children:"\u9700\u8981\u767B\u5F55"})]})]})}},{key:"index",title:"\u6392\u5E8F",className:"w-100px"},{key:"actions",title:"\u64CD\u4F5C",className:"min-w-125px text-center",render:function(c,d){return(0,e.jsx)(ee,{data:d,onDeleteSuccess:ce})}}],dataSource:f})})]}),(0,e.jsx)(ue,{route:x.route,libraryId:U,onClose:ve,onSuccess:fe,onDeleteSuccess:ce,visible:x.visible})]})}var q=le},17754:function(oe,G,r){r.d(G,{v:function(){return E}});var s=r(97857),O=r.n(s);function E(V,g,a){V.split("/").forEach(function(C,y,m){var p=g.find(function(X){var k=X.id;return k==="tag-".concat(C)});p||g.push(p={id:"tag-".concat(C),value:"tag-".concat(C),label:C,children:[]}),g=p.children,m.length===y+1&&g.push(O()(O()({},a),{},{value:a.id,label:a.title||a.name||a.id}))})}}}]);

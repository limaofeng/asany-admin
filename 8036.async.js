"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[8036],{8036:function(K,A,t){t.r(A),t.d(A,{default:function(){return xe}});var k=t(15009),p=t.n(k),F=t(99289),T=t.n(F),J=t(5574),b=t.n(J),m=t(62435),W=t(24561),Z=t(39711),w=t(96974),u=t(46027),V=t(93967),L=t.n(V),q=t(1861),i=t(13757),_=t(12708),ee=t(19755),ae=t.n(ee),te=t(30381),S=t.n(te),se=t(32115),l=t(92623),e=t(86074),ne=i.Symbol.Avatar;function ie(x){var a=x.message,s=x.mailbox,c=(0,m.useState)(!0),g=b()(c,2),v=g[0],M=g[1],D=(0,m.useCallback)(function(O){ae()(O.target).hasClass("message-handover")&&M(function(E){return!E})},[M]);return(0,e.jsxs)("div",{className:L()("message_wrapper",{shrink:!v}),children:[(0,e.jsxs)("div",{className:"d-flex flex-wrap gap-2 cursor-pointer message-handover",onClick:D,children:[(0,e.jsxs)("div",{className:"d-flex align-items-center message-handover",children:[(0,e.jsx)(ne,{alt:a==null?void 0:a.from.map(l.ss).join("\u3001"),src:"assets/media/avatars/300-6.jpg",size:50,labelClassName:"fs-2",className:"me-4"}),(0,e.jsxs)("div",{className:"pe-5",children:[(0,e.jsxs)("div",{className:"d-flex align-items-center flex-wrap gap-1",children:[(0,e.jsx)("a",{className:"fw-bolder text-dark text-hover-primary",children:a==null?void 0:a.from.map(l.ss).join("\u3001")}),(0,e.jsx)(u.JO,{className:"svg-icon-7 svg-icon-success mx-3",name:"Duotune/abs050"}),(0,e.jsx)("span",{className:"text-muted fw-bolder",children:a&&S()(a.date).fromNow()})]}),(0,e.jsx)(i.Popover,{stopPropagation:!0,content:(0,e.jsx)("div",{className:"menu menu-column menu-rounded menu-gray-600 menu-state-bg-light-primary fw-bold fs-7","data-kt-menu":"true",children:(0,e.jsx)("table",{className:"table mb-0",children:(0,e.jsxs)("tbody",{children:[s!=="sent"&&(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{className:"w-75px text-muted",children:"\u53D1\u4EF6\u4EBA"}),(0,e.jsx)("td",{children:a==null?void 0:a.from.join("\u3001")})]}),s!=="inbox"&&(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{className:"w-75px text-muted",children:"\u6536\u4EF6\u4EBA"}),(0,e.jsx)("td",{children:a==null?void 0:a.to.join("\u3001")})]}),(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{className:"text-muted",children:"\u65F6\u95F4"}),(0,e.jsx)("td",{children:a&&S()(a.date).format("lll")})]}),(a==null?void 0:a.replyTo)&&(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{className:"text-muted",children:"\u56DE\u590D"}),(0,e.jsx)("td",{children:a.replyTo.map(l.ss).join("\u3001")})]})]})})}),placement:"bottom-start",children:(0,e.jsxs)("div",{className:L()("inbox-message-details",{"d-none":!v}),children:[(0,e.jsxs)("span",{className:"text-muted fw-bold",children:["\u53D1\u9001\u7ED9"," ",s==="inbox"?"\u6211":a==null?void 0:a.to.map(l.ss).join("\u3001")]}),(0,e.jsx)("a",{className:"me-1","data-kt-menu-trigger":"click","data-kt-menu-placement":"bottom-start",children:(0,e.jsx)(u.JO,{className:"svg-icon-5 m-0",name:"Duotune/arr072"})})]})}),(0,e.jsx)("div",{className:L()("message_wrapper_preview-message message-handover text-muted fw-bold",{"d-none":v}),children:(a==null?void 0:a.mimeType)==="text/html"?(0,se.Kv)(a.body||""):a==null?void 0:a.body})]})]}),(0,e.jsxs)("div",{className:"message_wrapper_actions d-flex align-items-center flex-wrap gap-2",children:[(0,e.jsx)("span",{className:"mail-message-date fw-bold text-muted me-3",children:a&&S()(a.date).format("YYYY-MM-DD A HH:mm")}),(0,e.jsxs)("div",{className:"mail-message-actions d-flex",children:[(0,e.jsx)(i.Tooltip,{placement:"bottom",title:"\u6536\u85CF",children:(0,e.jsx)("a",{className:"btn btn-icon btn-clear btn-active-light-primary me-3",children:(0,e.jsx)(u.JO,{name:"Duotune/gen029",className:"svg-icon-2 m-0"})})}),(0,e.jsx)(i.Tooltip,{placement:"bottom",title:"\u8BBE\u7F6E\u4E3A\u91CD\u8981",children:(0,e.jsx)("a",{className:"btn btn-icon btn-clear btn-active-light-primary me-3",children:(0,e.jsx)(u.JO,{name:"Duotune/gen056",className:"svg-icon-2 m-0"})})}),(0,e.jsx)(i.Tooltip,{placement:"bottom",title:"\u56DE\u590D",children:(0,e.jsx)("a",{className:"btn btn-icon btn-clear btn-active-light-primary me-3",children:(0,e.jsx)(u.JO,{name:"Duotune/gen055",className:"svg-icon-2 m-0"})})}),(0,e.jsx)("a",{className:"btn btn-icon btn-clear btn-active-light-primary","data-bs-toggle":"tooltip","data-bs-placement":"top",title:"Settings",children:(0,e.jsx)(u.JO,{name:"Duotune/gen053",className:"svg-icon-2 m-0"})})]})]})]}),(0,e.jsx)("div",{className:L()("collapse fade",{show:v}),"data-kt-inbox-message":"message",children:(0,e.jsx)("div",{className:"py-5",dangerouslySetInnerHTML:{__html:(a==null?void 0:a.body)||""}})})]})}function re(x){var a=x.message,s=x.mailbox;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"d-flex flex-wrap gap-2 justify-content-between mb-8",children:[(0,e.jsx)("div",{className:"d-flex align-items-center flex-wrap gap-2",children:(0,e.jsx)("h2",{className:"fw-bold me-3 my-1",children:(a==null?void 0:a.subject)||"(\u65E0\u4E3B\u9898)"})}),(0,e.jsx)("div",{className:"d-flex",children:(0,e.jsx)(i.Tooltip,{placement:"bottom",title:"\u6253\u5370",children:(0,e.jsx)("a",{className:"btn btn-icon btn-light btn-active-light-primary me-2",children:(0,e.jsx)("i",{className:"bi bi-printer-fill fs-2"})})})})]}),(0,e.jsx)(ie,{message:a,mailbox:s}),(0,e.jsx)("div",{className:"separator my-6"})]})}var le=re,oe=t(60489),N=t(74600);function ce(x){var a=x.message,s=x.onAction,c=(0,m.useCallback)(function(g){return function(){s(g)}},[s]);return(0,e.jsx)("div",{className:"d-flex",children:a&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(i.Tooltip,{placement:"bottom",title:"\u8FD4\u56DE",children:(0,e.jsx)(Z.rU,{className:"btn btn-icon btn-clear btn-active-light-primary me-3",to:"/mail/".concat(a.mailboxName.toLowerCase()),children:(0,e.jsx)(u.JO,{name:"Duotune/arr063",className:"svg-icon-1 m-0"})})}),![l.LJ.INBOX.id,l.LJ.Drafts.id].includes(a.mailboxName)&&l.LJ.INBOX.id===a.originalMailboxName&&(0,e.jsx)(i.Tooltip,{placement:"bottom",title:"\u6536\u4EF6\u7BB1",children:(0,e.jsx)("a",{onClick:c("inbox"),className:"btn btn-icon btn-light btn-active-light-primary me-2",children:(0,e.jsx)(u.JO,{name:l.LJ.INBOX.icon,className:"svg-icon-2 m-0"})})}),![l.LJ.Sent.id,l.LJ.Drafts.id].includes(a.mailboxName)&&l.LJ.Sent.id===a.originalMailboxName&&(0,e.jsx)(i.Tooltip,{placement:"bottom",title:"\u5DF2\u53D1\u9001",children:(0,e.jsx)("a",{onClick:c("sent"),className:"btn btn-icon btn-light btn-active-light-primary me-2",children:(0,e.jsx)(u.JO,{name:l.LJ.Sent.icon,className:"svg-icon-2 m-0"})})}),![l.LJ.Archive.id,l.LJ.Drafts.id,l.LJ.Trash.id].includes(a.mailboxName)&&(0,e.jsx)(i.Tooltip,{placement:"bottom",title:"\u5B58\u6863",children:(0,e.jsx)("a",{onClick:c("archive"),className:"btn btn-icon btn-light btn-active-light-primary me-2",children:(0,e.jsx)(u.JO,{name:l.LJ.Archive.icon,className:"svg-icon-2 m-0"})})}),![l.LJ.Spam.id,l.LJ.Drafts.id].includes(a.mailboxName)&&(0,e.jsx)(i.Tooltip,{placement:"bottom",title:"\u5783\u573E\u90AE\u4EF6",children:(0,e.jsx)("a",{onClick:c("spam"),className:"btn btn-icon btn-light btn-active-light-primary me-2",children:(0,e.jsx)(u.JO,{name:l.LJ.Spam.icon,className:"svg-icon-2 m-0"})})}),(0,e.jsx)(i.Tooltip,{placement:"bottom",title:"\u5220\u9664\u90AE\u4EF6",children:(0,e.jsx)("a",{onClick:c("deleted"),className:"btn btn-icon btn-light btn-active-light-primary me-2",children:(0,e.jsx)(u.JO,{name:"Duotune/gen027",className:"svg-icon-2 m-0"})})}),(0,e.jsx)(i.Tooltip,{placement:"bottom",title:a.seen?"\u6807\u8BB0\u4E3A\u672A\u8BFB":"\u6807\u8BB0\u4E3A\u5DF2\u8BFB",children:(0,e.jsx)("a",{onClick:c(a.seen?"unread":"read"),className:"btn btn-icon btn-light btn-active-light-primary me-2",children:(0,e.jsx)(u.JO,{name:a.seen?"Duotune/gen028":"Duotune/gen054",className:"svg-icon-2 m-0"})})})]})})}function de(x){var a=x.current,s=x.pagination,c=x.goto,g=(0,m.useCallback)(function(){c(Math.max(0,a-2))},[c,a]),v=(0,m.useCallback)(function(){c(Math.min(s.totalCount-1,a))},[a,c,s.totalCount]);return(0,e.jsxs)("div",{className:"d-flex align-items-center",children:[(0,e.jsxs)("span",{className:"fw-bold text-muted me-2",children:[a===0?"loading...":a," / ",s.totalCount]}),(0,e.jsx)(i.Tooltip,{placement:"bottom",title:"\u4E0A\u4E00\u5C01\u90AE\u4EF6",children:(0,e.jsx)(i.Button,{onClick:g,icon:(0,e.jsx)(u.JO,{name:"Duotune/arr074",className:"svg-icon-2 m-0"}),variant:"light",activeColor:"light-primary",className:"me-3",disabled:a===1})}),(0,e.jsx)(i.Tooltip,{placement:"bottom",title:"\u4E0B\u4E00\u5C01\u90AE\u4EF6",children:(0,e.jsx)(i.Button,{onClick:v,icon:(0,e.jsx)(u.JO,{name:"Duotune/arr071",className:"svg-icon-2 m-0"}),variant:"light",activeColor:"light-primary",className:"me-2",disabled:a===s.totalCount})})]})}function me(){return(0,e.jsx)("div",{children:(0,e.jsxs)(W.ZP,{speed:2,width:"100%",height:500,viewBox:"0 0 926 500",backgroundColor:"#f3f3f3",foregroundColor:"#ecebeb",children:[(0,e.jsx)("rect",{x:"0",y:"0",rx:"3",ry:"3",width:"230",height:"34"}),(0,e.jsx)("rect",{x:"48",y:"26",rx:"3",ry:"3",width:"52",height:"6"}),(0,e.jsx)("rect",{x:"0",y:"60",rx:"3",ry:"3",width:"50",height:"50"}),(0,e.jsx)("rect",{x:"2",y:"126",rx:"4",ry:"4",width:"178",height:"20"}),(0,e.jsx)("rect",{x:"60",y:"65",rx:"0",ry:"0",width:"228",height:"13"}),(0,e.jsx)("rect",{x:"62",y:"88",rx:"0",ry:"0",width:"226",height:"18"}),(0,e.jsx)("rect",{x:"826",y:"83",rx:"0",ry:"0",width:"100",height:"23"}),(0,e.jsx)("rect",{x:"6",y:"158",rx:"0",ry:"0",width:"242",height:"17"}),(0,e.jsx)("rect",{x:"6",y:"190",rx:"0",ry:"0",width:"325",height:"14"}),(0,e.jsx)("rect",{x:"6",y:"220",rx:"0",ry:"0",width:"427",height:"20"}),(0,e.jsx)("rect",{x:"6",y:"255",rx:"0",ry:"0",width:"513",height:"15"})]})})}function ue(){var x=(0,w.UO)(),a=x.folder,s=x.id,c=(0,w.s0)(),g=(0,w.bx)(),v=g.message,M=g.pagination,D=g.goto,O=g.activeIndex,E=g.refresh,ge=(0,N.Pg)({fetchPolicy:"cache-and-network"}),H=b()(ge,2),z=H[0],I=H[1],j=I.data,G=I.loading,P=I.error,ve=(0,N.Rh)({refetchQueries:[N.f_,N.Nd]}),he=b()(ve,1),R=he[0],be=(0,N.aB)({refetchQueries:[N.f_]}),fe=b()(be,1),Y=fe[0],je=(0,N.k0)({refetchQueries:[N.Nd]}),pe=b()(je,1),$=pe[0],d=(0,m.useRef)({pagination:M,mailbox:a,activeIndex:O}),n=(0,m.useMemo)(function(){var o;return(j==null||(o=j.message)===null||o===void 0?void 0:o.id)===s?j==null?void 0:j.message:(v==null?void 0:v.id)===s?v:d.current.message},[s,j==null?void 0:j.message,v]);d.current.mailbox=a,d.current.message=n,d.current.pagination=M,d.current.activeIndex=O;var B=(0,m.useCallback)(function(){var o=d.current,y=o.mailbox,f=o.pagination,h=o.activeIndex;f.totalCount===0?c("/mail/".concat(y)):D(Math.min(h,f.totalCount-1))},[D,history]),X=(0,m.useCallback)(function(){var o=T()(p()().mark(function y(f){var h,U,C,Q;return p()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:h=d.current.message;case 1:if(((U=h)===null||U===void 0?void 0:U.index)!==void 0){r.next=7;break}return r.next=4,(0,_._v)(60);case 4:h=d.current.message,r.next=1;break;case 7:if(!(f==="read"||f==="unread")){r.next=13;break}return r.next=10,Y({variables:{id:s,flags:["seen"],mode:f==="unread"?"REMOVE":"ADD"}});case 10:C="updateFlags",r.next=34;break;case 13:if(f!=="deleted"){r.next=30;break}if(!(a==="drafts"||a==="trash")){r.next=25;break}return r.next=17,i.Modal.confirm({title:"\u8B66\u544A",content:a==="trash"?"\u786E\u5B9A\u6C38\u4E45\u5220\u9664\u4FE1\u606F\uFF1F":"\u786E\u5B9A\u6C38\u4E45\u5220\u9664\u8349\u7A3F\uFF1F"});case 17:if(Q=r.sent,Q.isConfirmed){r.next=20;break}return r.abrupt("return");case 20:return r.next=22,$({variables:{id:s}});case 22:C="delete",r.next=28;break;case 25:return r.next=27,R({variables:{id:s,mailbox:"trash"}});case 27:C="toFolder";case 28:r.next=34;break;case 30:if(!["archive","spam","inbox","sent"].includes(f)){r.next=34;break}return r.next=33,R({variables:{id:s,mailbox:f}});case 33:C="toFolder";case 34:E({type:C,key:h.id,index:h.index-1}),C!=="updateFlags"&&B();case 36:case"end":return r.stop()}},y)}));return function(y){return o.apply(this,arguments)}}(),[$,s,a,B,E,R,Y]);(0,m.useEffect)(function(){d.current.autoReadExecuted=!1;var o=setTimeout(function(){z({variables:{id:s}})},600);return function(){clearTimeout(o)}},[z,s]),(0,m.useEffect)(function(){if(!(!n||n.id!==s)&&(n==null?void 0:n.mailboxName)===l.LJ.INBOX.id){if(d.current.autoReadExecuted||n.seen){d.current.autoReadExecuted=!0;return}d.current.autoReadExecuted=!0,X("read")}},[X,s,n]);var Ne=(0,m.useCallback)(function(o){d.current.message=o},[]),ye=(0,m.useCallback)(T()(p()().mark(function o(){var y;return p()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:y=d.current.message,E({type:"toFolder",key:y.id,index:y.index-1}),B();case 3:case"end":return h.stop()}},o)})),[B,E]);return(0,m.useEffect)(function(){if(!(!n||G||n.index===void 0||n.id!==s)){var o=d.current.activeIndex;o!==n.index-1&&D(n.index-1)}},[n,D,G,s]),(0,m.useEffect)(function(){P&&i.Modal.error({title:"\u9519\u8BEF",content:P.message,timer:3e3,timerProgressBar:!0}).then(function(){c("/mail/".concat(d.current.mailbox))})},[P,history]),(0,e.jsx)(q.E,{className:"mail-message-details flex-lg-row-fluid custom-scrollbar",options:{scrollbars:{autoHide:"scroll"}},children:(0,e.jsxs)(i.Card,{className:"mail-message-container",children:[(0,e.jsxs)(i.Card.Header,{className:"align-items-center py-5 gap-5",children:[(0,e.jsx)(ce,{message:n,onAction:X}),(0,e.jsx)(de,{pagination:M,current:(n==null?void 0:n.index)||O+1,goto:D})]}),(0,e.jsx)(i.Card.Body,{className:L()({"px-5 py-0 mail-message-draft":n==null?void 0:n.draft}),children:n?n.draft?(0,e.jsx)(oe.Z,{message:n,onAutoSave:Ne,onSend:ye}):(0,e.jsx)(le,{message:n,mailbox:a}):(0,e.jsx)(me,{})})]})})}var xe=ue},92623:function(K,A,t){t.d(A,{GG:function(){return F},LJ:function(){return p},ss:function(){return T}});var k=t(5618),p={INBOX:{id:"INBOX",name:"\u6536\u4EF6\u7BB1",icon:"Duotune/com010",badge:"success"},Sent:{id:"Sent",name:"\u5DF2\u53D1\u9001",icon:"Duotune/gen016"},Drafts:{id:"Drafts",name:"\u8349\u7A3F",icon:"Duotune/gen009",badge:"primary"},Archive:{id:"Archive",name:"\u5F52\u6863",icon:"Duotune/lay010"},Spam:{id:"Spam",name:"\u5783\u573E\u90AE\u4EF6",icon:"Duotune/gen044"},Trash:{id:"Trash",name:"\u56DE\u6536\u7AD9",icon:"Duotune/gen027",badge:"warning"},Outbox:{id:"Outbox",name:"\u53D1\u4EF6\u7BB1",icon:"Duotune/gen027"},Later:{id:"Later",name:"\u5F85\u529E",icon:"Duotune/gen027"},Blocked:{id:"Blocked",name:"\u5DF2\u5C4F\u853D",icon:"Duotune/gen027"}},F=Object.keys(p).map(function(J){return p[J]});function T(J){var b=(0,k.N8)(J);return b.name||b.address&&b.address.substring(0,b.address.indexOf("@"))}}}]);

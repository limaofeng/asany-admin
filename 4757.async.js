"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[4757],{53150:function(pe,B,e){e.r(B);var Q=e(15009),K=e.n(Q),z=e(13769),J=e.n(z),X=e(99289),Y=e.n(X),w=e(97857),b=e.n(w),q=e(5574),A=e.n(q),t=e(62435),O=e(12845),ee=e(64218),ae=e(93967),_e=e.n(ae),te=e(30381),L=e.n(te),ne=e(73588),s=e(13757),I=e(12708),se=e(25136),h=e(58496),re=e(42755),Me=e(34545),a=e(86074),le=["meta","category","body","publishedAt"];function ue(){var oe=(0,O.useParams)(),de=(0,O.useNavigate)(),W=(0,O.useOutletContext)(),d=W.categories,p=W.baseUrl,ie=oe.cid,r=(0,t.useRef)({action:"draft",publishedAt:L()()}),me=(0,t.useReducer)(function(_){return _+1},0),ce=A()(me,2),F=ce[1],S=(0,t.useRef)(null),o=s.Form.useForm(),Ee=(0,t.useMemo)(function(){return!d||!d.length?[]:(0,I.G_)(d.map(function(_){return b()(b()({},_),{},{value:_.id,title:_.name})}),{idKey:"id",childrenKey:"children",pidKey:"parent.id",sort:function(l,n){return l.index-n.index}})},[d]),be=(0,re.uw)(),N=A()(be,2),$=N[0],M=N[1].loading,he=(0,t.useState)(),k=A()(he,2),ve=k[0],fe=k[1],ye=(0,t.useCallback)(function(_){var l,n=d.find(function(c){return c.id=_});fe(n==null||(l=n.storeTemplate)===null||l===void 0?void 0:l.id)},[d]),v=(0,t.useCallback)(function(){var _=Y()(K()().mark(function l(n){var c,i,f,T,H,G,g,V,j,y,R,E,P,x,D,m,Z,U;return K()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return r.current.action=n,u.next=3,(c=S.current)===null||c===void 0?void 0:c.uploadAll();case 3:return u.next=5,o.validateFields();case 5:for(i=u.sent,f=i.meta,T=i.category,H=i.body,G=i.publishedAt,g=J()(i,le),V={seo_title:"single_line_text_field",seo_description:"multi_line_text_field",seo_keywords:"list.single_line_text_field"},j=[],y=0,R=Object.keys(f);y<R.length;y++)for(E=R[y],P=0,x=Object.keys(f[E]);P<x.length;P++)D=x[P],j.push({namespace:E,key:D,value:f[E][D],type:V[E+"_"+D]});return m=b()(b()({},g),{},{metafields:j,category:T.id,body:{type:"HTML",text:H.text}}),n==="publish"?m.status="PUBLISHED":n==="schedule"?(m.status="SCHEDULED",m.publishedAt=G):m.status="DRAFT",Z=$({variables:{input:m}}),u.next=19,s.Toast.promise((0,I.gw)(Z,350),{pending:"\u63D0\u4EA4\u4E2D...",success:"\u201C".concat(g.title,"\u201D \u4FEE\u6539\u6210\u529F"),error:"\u63D0\u4EA4\u51FA\u9519"},{duration:2e3,placement:"top-center"});case 19:U=u.sent,de("".concat(p,"/cms/categories/").concat(T.id,"/articles/").concat(U.data.article.id),{replace:!0}),console.log("submit result set",U);case 22:case"end":return u.stop()}},l)}));return function(l){return _.apply(this,arguments)}}(),[p,$,o]),Pe=(0,t.useCallback)(function(){v("draft")},[v]),De=(0,t.useCallback)(function(_){v(_)},[v]),C=r.current.publishedAt,Ae=(0,t.useCallback)(function(_){r.current.publishedAt=_,o.setFieldsValue({publishedAt:_}),F()},[o]),Oe=(0,t.useCallback)(function(){r.current.publishedAt=L()(),F(),o.setFieldsValue({publishedAt:r.current.publishedAt})},[o]);return console.log("storeTemplate",ve,C),(0,a.jsx)(ne.vs,{header:{title:"\u65B0\u589E\u6587\u7AE0"},children:(0,a.jsxs)(s.Form,{form:o,initialValues:{status:"DRAFT",publishedAt:C,category:{id:ie}},className:"form d-flex flex-column flex-lg-row",children:[(0,a.jsxs)("div",{className:"d-flex flex-column flex-row-fluid gap-7 gap-lg-10  me-lg-10",children:[(0,a.jsxs)(s.Tabs,{defaultActiveKey:"general",contentContainer:!1,className:"border-0 fs-4 fw-bold mb-n2 nav-line-tabs-2x",children:[(0,a.jsx)(s.Tabs.TabPane,{tab:"\u57FA\u672C\u4FE1\u606F",forceRender:!0,children:(0,a.jsx)(h.LQ,{queueUpload:S})},"general"),(0,a.jsx)(s.Tabs.TabPane,{tab:"\u9AD8\u7EA7\u8BBE\u7F6E",forceRender:!0,children:(0,a.jsx)(h.aE,{})},"advanced"),(0,a.jsx)(s.Tabs.TabPane,{tab:"\u5143\u6570\u636E",forceRender:!0,children:(0,a.jsx)(h.SF,{})},"meta")]}),(0,a.jsx)(ee.Z,{offsetBottom:16,children:(0,a.jsxs)("div",{className:_e()("d-flex bg-body-color p-5 mx-4 tw-rounded-2xl justify-content-end"),children:[(0,a.jsx)(s.Button,{variant:"light",loading:r.current.action==="draft"&&M,onClick:Pe,className:"me-5",children:!r.current.action&&M?"\u4FDD\u5B58\u4E2D...":"\u4FDD\u5B58\u8349\u7A3F"}),(0,a.jsx)(h.H5,{onPublish:De,publishedAt:C,submitting:r.current.action!=="draft"&&M,setPublishedAt:Ae,onCancel:Oe})]})})]}),(0,a.jsx)(se.Z,{baseUrl:p,categoryTreeData:Ee,onChangeCategory:ye})]})})}B.default=ue}}]);
